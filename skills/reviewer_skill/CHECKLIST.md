# CHECKLIST.md - 代码审查专家自检清单

## 每次代码审查前必须自检的项目

### ✅ 审查准备和PR分析
- [ ] 我是否仔细阅读了PR描述和变更目的？
- [ ] 是否理解了本次变更的业务需求和技术背景？
- [ ] 审查重点是否已经明确确定？
- [ ] 本地测试环境是否准备就绪？
- [ ] 是否准备了充足的测试数据和场景？

### ✅ 代码质量和规范性检查
- [ ] 代码是否符合项目的编码规范？
- [ ] 变量和函数命名是否清晰合理？
- [ ] 代码注释是否充分且有用？
- [ ] 代码结构是否清晰，模块化是否良好？
- [ ] 是否存在重复代码需要重构？

### ✅ 业务逻辑正确性验证
- [ ] 代码是否正确实现了产品需求？
- [ ] 业务流程是否完整且正确？
- [ ] 边界条件和异常场景是否都已处理？
- [ ] 数据验证和过滤是否充分？
- [ ] 用户体验是否友好？

### ✅ 安全性审查（重点检查）
- [ ] 用户输入是否都经过验证和过滤？
- [ ] 权限检查是否完整且严格？
- [ ] 敏感信息是否加密存储和传输？
- [ ] 是否存在SQL注入、XSS等安全漏洞？
- [ ] API接口是否有适当的访问控制？

### ✅ 配额管理安全审查（最高优先级）
- [ ] 配额操作是否使用数据库事务？
- [ ] 是否使用行锁防止并发竞争？
- [ ] 配额检查是否在扣减之前进行？
- [ ] 配额不足时是否有正确处理？
- [ ] 配额返还逻辑是否完整可靠？
- [ ] 并发场景下配额是否安全？

### ✅ 数据库操作和性能审查
- [ ] SQL查询是否优化，避免N+1问题？
- [ ] 是否使用了合适的索引？
- [ ] 数据库操作是否在事务中执行？
- [ ] 大数据量查询是否做了分页处理？
- [ ] 数据库连接池配置是否合理？

### ✅ API设计和接口规范
- [ ] RESTful API设计是否规范？
- [ ] 请求参数验证是否完整？
- [ ] 响应格式是否统一？
- [ ] HTTP状态码使用是否正确？
- [ ] API文档是否完整准确？

### ✅ 前端代码专项审查
- [ ] React组件设计是否合理？
- [ ] 状态管理是否适当？
- [ ] 性能优化是否到位（memo、useMemo等）？
- [ ] CSS样式是否规范，响应式设计是否良好？
- [ ] 用户交互体验是否流畅？

### ✅ 后端代码专项审查
- [ ] 控制器职责是否单一？
- [ ] 服务层业务逻辑是否清晰？
- [ ] 异常处理是否完整？
- [ ] 日志记录是否充分？
- [ ] 第三方服务集成是否安全可靠？

### ✅ 测试覆盖率和测试质量
- [ ] 单元测试覆盖率是否达标？
- [ ] 测试用例是否覆盖关键场景？
- [ ] 测试数据是否合理有效？
- [ ] 集成测试是否完整？
- [ ] 边界条件和异常场景是否都有测试？

### ✅ 性能和资源使用审查
- [ ] 算法时间复杂度是否合理？
- [ ] 内存使用是否高效，无内存泄漏？
- [ ] 文件操作是否及时关闭资源？
- [ ] 缓存使用是否合理？
- [ ] 并发处理是否安全高效？

### ✅ 第三方集成和外部依赖
- [ ] 第三方API调用是否有错误处理？
- [ ] 网络请求是否有超时和重试机制？
- [ ] 外部服务异常是否影响核心业务？
- [ ] API密钥是否安全存储？
- [ ] 依赖包版本是否安全稳定？

### ✅ 部署和运维考虑
- [ ] 环境变量配置是否合理？
- [ ] 日志级别是否适合生产环境？
- [ ] 健康检查接口是否完整？
- [ ] 监控和告警是否充分？
- [ ] 回滚方案是否可行？

### ✅ 文档和知识传递
- [ ] 代码注释是否充分？
- [ ] API文档是否完整？
- [ ] 变更说明是否清晰？
- [ ] 复杂逻辑是否有解释？
- [ ] 是否需要更新相关文档？

## 输出前最后检查

在给出审查结论之前，请确认：

1. **全面性**：所有重要方面都已审查覆盖
2. **深度**：对关键逻辑和风险点有深入分析
3. **准确性**：审查意见和建议准确可行
4. **建设性**：提供了具体的改进方案
5. **及时性**：审查反馈及时，不影响开发进度

## 常见错误避免

❌ **避免这些审查错误**：
- 只看代码格式，忽略业务逻辑正确性
- 对安全问题掉以轻心，特别是配额管理
- 使用模糊的审查意见，让开发者无从下手
- 忽略性能和可维护性问题
- 在没有完全理解的情况下急于给出结论

✅ **坚持这些审查原则**：
- 安全第一，特别关注配额管理的原子性
- 业务导向，确保代码实现正确的业务逻辑
- 质量优先，关注代码的长期可维护性
- 建设性反馈，提供具体可行的改进建议
- 持续学习，分享最佳实践和技术知识

## 安全审查特别检查

⚠️ **配额管理安全审查（最高优先级）**：
- [ ] 是否使用了 `BEGIN TRANSACTION`？
- [ ] 是否使用了 `SELECT ... FOR UPDATE`？
- [ ] 配额检查逻辑是否在事务内？
- [ ] 并发场景是否测试过？
- [ ] 配额操作日志是否完整？
- [ ] 异常时是否能正确回滚？

⚠️ **权限和认证审查**：
- [ ] JWT token验证是否严格？
- [ ] 用户权限检查是否完整？
- [ ] API访问控制是否到位？
- [ ] 敏感操作是否有二次验证？
- [ ] 会话管理是否安全？

## 性能审查重点

⚠️ **数据库性能审查**：
- [ ] 查询是否使用了合适的索引？
- [ ] 是否有全表扫描的问题？
- [ ] 分页查询是否高效？
- [ ] 事务是否尽可能短？
- [ ] 连接池配置是否合理？

⚠️ **应用性能审查**：
- [ ] 是否有不必要的循环嵌套？
- [ ] 大对象处理是否高效？
- [ ] 缓存策略是否合理？
- [ ] 异步处理是否恰当？
- [ ] 内存使用是否优化？

## 代码质量评估标准

### 优秀代码特征
- 结构清晰，职责单一
- 命名规范，语义明确
- 注释充分，文档完整
- 错误处理完善
- 易于测试和维护

### 需要改进的代码特征
- 函数过长，职责不清
- 命名模糊，难以理解
- 缺少注释，文档不足
- 异常处理缺失
- 难以测试和维护

### 不可接受的代码特征
- 存在安全漏洞
- 数据一致性无法保证
- 性能严重不达标
- 逻辑错误，功能异常
- 无法维护和扩展

## 审查沟通技巧

- 使用建设性的语言，避免批评性表达
- 解释问题的影响和重要性
- 提供具体的改进建议和最佳实践
- 尊重开发者的工作，承认代码的优点
- 保持开放的态度，听取开发者的解释