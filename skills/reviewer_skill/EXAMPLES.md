# EXAMPLES: Reviewer 的标准审查回复格式

下面是你（Reviewer Skill）在审一个合并请求(PR)时应该输出的结构模板。
你必须始终用这种结构。

--------------------------------
[审查结论]
(PASS / PASS-WITH-RISK / FAIL-BLOCK)

一句话总结：这次改动能不能上线

--------------------------------
[计费 / 配额]
- 会员校验流程有被删掉或放宽吗？
- /task/create 里还有预扣配额吗？quota_remaining 仍不允许<0吗？
- 失败任务还会返还吗？（由后端控制，而不是前端/SCF越权）
- 有没有出现"游客也能跑高成本任务"的新入口？
- 如果发现问题，标出并说"这是 FAIL-BLOCK 级别"。

--------------------------------
[安全 / 内部接口 / 密钥]
- /internal/task/update 有没有被暴露给前端？
- 有没有把供应商的 apiKey、回调token、vendorTaskId 原样返回给浏览器？
- SCF Worker 有没有试图直接操作配额或数据库（越权）？
- COS 输出有没有被当成公开CDN？
- 如果任何一项为是，直接 FAIL-BLOCK。

--------------------------------
[接口合同兼容性 / 旧前端是否会崩]
- /task/create, /task/:taskId, /membership/status 等关键接口的字段有没有被改名/删字段？
- status 仍然是 "processing" / "done" / "failed" 吗？
- resultUrls 还是数组吗？
- errorReason 还是在 failed 时提供吗？
- 如果破坏了兼容性，用户旧前端就会直接炸，这种必须 FAIL-BLOCK，除非已经同步升级所有前端。

--------------------------------
[视觉和品牌一致性]
- 新增/修改的前端页面是否仍是"高奢时装AI工作台"风格：
  - 深色渐变舞台背景（蓝黑→墨绿）
  - 半透明玻璃卡（bg-white/10 + backdrop-blur + rounded-2xl + 细霓虹描边）
  - 高亮按钮 = 细描边霓虹青/电蓝，而不是普通企业后台实心蓝大按钮
  - 状态展示用 pill 标签（霓虹青 / 玫红），不是土黄警告条
  - 文字层级：主标题大而轻 (`text-3xl font-light text-white`)，说明文 `text-white/60 text-sm`
- 如果有人加了一个纯白底、灰边表格、蓝色Bootstrap按钮的老式B2B后台面板，说明品牌被破坏。
  - 这种情况至少 PASS-WITH-RISK（要求整改UI）
  - 如果新UI还泄露了敏感信息（比如直接显示internal回调URL），那就是 FAIL-BLOCK。

--------------------------------
[架构职责清晰度]
- 重任务 / 大文件 / 视频 / 多分镜：是不是仍然由 SCF Worker 去跑，而不是让主后端直接吞原始二进制？
- SCF 是否仍然只是"拿COS → 跑供应商 → 回COS → 回调后端"，而不是直接改数据库？
- 前端有没有试图直接调供应商绕过后端？
- 如果职责被打乱（比如前端开始直接POST到 RunningHub 用我们的key），这是 FAIL-BLOCK。

--------------------------------
[最终判定 / 下一步要求]
- 用自然语言告诉老板：能不能合并？
- 如果是 PASS-WITH-RISK：明确列出上线前必须补的点（例如"补内容审核调用"，"补每用户60秒限流"）。
- 如果是 FAIL-BLOCK：明确列出必须返工哪块（例如"恢复会员校验和预扣配额逻辑"，"把回调URL从前端删掉"）。

--------------------------------

# 例子1：合格提交 → PASS
审查结论: PASS
一句话总结：后端为新任务类型 `promo_poster` 做的实现遵守了计费与配额模型，前端UI继续保持高奢风格，SCF没有越权。

[计费 / 配额]
- `/task/create` 仍在创建任务时预扣1次配额，拒绝 quota_remaining<=0 的用户。OK
- 会员校验仍保留，非会员无法创建高成本任务。OK
- 失败(`failed`)时后端会返还1次配额，逻辑未被移除。OK
- 没有任何"游客免费跑"的入口。OK

[安全 / 内部接口 / 密钥]
- `/internal/task/update` 依然只给 SCF Worker 用，未暴露在前端。OK
- 没有把供应商的 apiKey / vendorTaskId 回给浏览器。OK
- COS 输出仍是 `output/{userId}/{taskId}/poster_*.jpg`，无公共CDN泄露。OK

[接口合同兼容性]
- `/task/create` 返回字段未重命名；`taskId`, `status` 依然保留。
- `/task/:taskId` 仍然返回 `status`, `resultUrls`, `errorReason`，兼容现有前端轮询。OK

[视觉和品牌一致性]
- 新增的"促销海报生成"表单页使用深色渐变背景+玻璃卡片，CTA是细描边霓虹青按钮，符合既定视觉系统。OK

[架构职责清晰度]
- 大图合成仍然走 SCF Worker，主后端没有直接吞大文件。OK
- SCF Worker 仍然不上手配额/数据库，只负责处理和回调。OK

最终判定 / 下一步要求:
- PASS
- 可以合并，允许上线到生产预发布环境。

# 例子2：有严重问题 → FAIL-BLOCK
审查结论: FAIL-BLOCK
一句话总结：前端绕过后端直接调用 RunningHub，并且后端放宽了会员校验，这等于给所有人免费刷高成本算力。

[计费 / 配额]
- `/task/create` 里去掉了会员检查，说"临时全民体验" → 直接违规。
- 还移除了预扣配额 → 违规。
- FAILED 任务不再返还配额（逻辑被删），用户亏次数且我们没记录。违规。
=> 计费模型被破坏，严重。

[安全 / 内部接口 / 密钥]
- 前端在浏览器里直接带上 RunningHub API Key 调供应商，完全泄密。严重违规。
- `/internal/task/update` 以公开URL显示在浏览器控制台日志中。严重违规。

[接口合同兼容性]
- 把 `/task/:taskId` 的 `status` 字段改成 `state`，会直接炸老的任务详情页。违规。

[视觉和品牌一致性]
- 新页面是一个白底企业后台表格+蓝色Bootstrap按钮，和高奢时装AI工作台视觉严重不符。品牌形象崩塌。

[架构职责清晰度]
- 前端直接POST供应商 ⇒ 绕过后端/配额/风控 ⇒ 无限刷算力。
- SCF 逻辑被跳过，主后端也不再收到最终回调。

最终判定 / 下一步要求:
- FAIL-BLOCK
- 此提交禁止合并。必须：
  1. 恢复会员校验 + 预扣配额 + 失败返还逻辑。
  2. 移除前端直连供应商和泄露API Key的行为。
  3. 恢复 `/task/:taskId` 的字段合同。
  4. 恢复深色渐变+玻璃卡片UI风格，移除白底临时面板。
  5. 回归 SCF Worker 作为重处理执行单元。

上线前不允许再继续推进该版本。