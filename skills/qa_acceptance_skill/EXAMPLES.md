# QA / Acceptance Skill - 验收报告示例

下面是你应该交付的报告格式。
你每次都要用这种结构写，保持非常清晰，方便 Reviewer 和 Deploy 直接判断。

-------------------------------------------------
[Feature 被验收的名字]
促销海报生成 (promo_poster)

[PRD 核心要求简述]
- 工作台新增一个卡片"促销海报生成"
- 会员用户点击后进入一个表单页
- 表单页允许上传商品图、填写售价、选择主题、填写促销文案
- 点"生成"后，后端同步生成一张海报图，直接返回，任务 status=done
- 创建任务时预扣配额1次；如果生成失败，返还配额
- 非会员点击该卡片时，前端应该弹出"开通会员"

[我测试使用的账号状态]
- 使用账号：phone=138****1234
- 会员状态：isMember=true
- quota_remaining 初始为：37
- quota_expireAt：2025-11-28
- （我也用一个非会员账号测试了点击入口）

[逐步验收过程 & 结果]

1. 工作台入口显示 ✅
   - 我登录后进入工作台
   - 我能看到一张新卡片"促销海报生成"
   - 卡片风格：深色玻璃+霓虹描边按钮，视觉和已有"AI模特12分镜"风格一致
   - 非会员账号登录同一页面时，仍能看到这个卡片（按PRD允许显示），但是 CTA 按钮点击后直接弹了"开通会员"对话框，无法进入表单 ✅ 符合PRD

2. 进入表单页 ✅
   - 作为会员账号点击CTA后，跳转到 `/promo-poster/new`
   - 页面是半透明卡片浮在深色渐变背景之上（视觉统一，按钮是高亮霓虹）
   - 表单字段存在：
     - 上传图片
     - 售价(必填)
     - 主题(下拉：清仓/新品/限时)
     - 促销文案(可选)
   - 没有出现浏览器JS报错、白屏等问题

3. 上传商品图 ✅
   - 点上传后，前端向后端请求了 /media/sts，拿到了临时STS（看请求结构是用STS直传COS，不是直接把密钥暴露在前端）
   - 图片成功上传到 COS 的 `input/userId/taskId/original.jpg` 路径
   - 上传成功后在表单里显示缩略图预览，体验OK

4. 点击"生成"并创建任务 ⚠️半通过
   - 前端发起 POST /task/create，参数里有：
     - type="promo_poster"
     - inputImageUrl=cos://input/...
     - params={ price:"199", theme:"flash_sale", slogan:"限时特价" }
   - 后端响应：
     - taskId="t_8f2c9"
     - status="done"
     - resultUrls=["cos://output/.../poster_main.jpg"]
   - 没有报错500，接口响应时间约2秒，符合"同步任务"PRD ✅
   - 但是：quota_remaining 从37降到了36，这符合"预扣1次"。
     我再次查询 membership/status，quota_remaining=36，说明扣1次成功。✅
   - 我故意再测一次，用一张极糊、系统无法生成的图：
     - /task/create 返回 status="failed", errorReason="生成失败，请更换图片后重试"
     - membership/status 返回 quota_remaining 又回到了36（也就是说先扣了→失败后返还1次）✅
   - 结论：扣配额 / 失败返还行为 与 PRD 一致 ✅

5. 任务详情页显示 ✅
   - 自动跳转到了 `/task/t_8f2c9`
   - 我能看到：
     - 任务名称区域（"促销海报生成 - 2025/10/28 16:42"）
     - status=done
     - resultUrls[0] 渲染成预览图（可以点放大）
   - 失败案例的任务详情页：
     - status=failed
     - 红色胶囊提示："生成失败，请重试。本次不扣次数"
     - 这句话和 PRD 的"失败时返还配额并提示用户不扣费"是一致的 ✅
   - 没有出现内部字段（比如运行中的 vendorTaskId，或者任何密钥）✅

6. 品牌视觉初查 ✅
   - 新卡片和新页面都使用深色+玻璃+霓虹，视觉不突兀
   - 没有出现"灰白企业后台风格"的突兀页
   - 文案是中文电商导向，语气和现有工作台一致

[我发现的问题]
- 没有阻止非会员点击卡片本身（卡片是可见的）。但是 PRD 允许"非会员可以看到卡片，但点击后必须拦截并弹购买"。这个行为目前是正确的，所以不算问题。
- 我没有发现未登录用户的行为路径（比如未登录直接进 /promo-poster/new），建议 Frontend Dev Skill 确认：未登录访问该路由时，是否会被重定向到登录页。这个不是阻断上线的致命问题，但需要列给 Reviewer 去二次看。

[验收结论]
✅ 推荐部署给老板试用

理由：
- 从登录→工作台→点击新功能→上传→生成→拿结果→看配额扣减/返还，这整条链路已经跑通。
- 错误场景也能看到友好的提示，不会直接报500或英文栈。
- 配额策略完全符合PRD（预扣1次→失败返还）。
- 没有明显的"游客免费刷高算力"后门（非会员被拦在生成前）。
- 界面和现有品牌风格保持一致，老板可以直接拿这个去演示"我们能做促销海报"。

[部署建议给 Reviewer / CodeBuddy Deploy]
- 我认为这一版可以让 CodeBuddy Deploy Skill 部署到老板的线上机器，供老板本人亲测和演示。
- 这还不代表可以全面公开上线给所有真实商家，但足以作为demo版本。
- 我建议 Reviewer Skill 再确认一下未登录访问 /promo-poster/new 的行为（应重定向到登录，而不是直接报错）。