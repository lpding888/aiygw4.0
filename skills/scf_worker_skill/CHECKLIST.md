# CHECKLIST.md - 云函数处理工程师自检清单

## 每次云函数部署前必须自检的项目

### ✅ 需求分析和方案设计
- [ ] 任务类型是否明确识别（基础修图 vs AI模特生成）？
- [ ] 输入输出格式是否清晰定义？
- [ ] 技术方案是否考虑了性能和成本？
- [ ] 处理流程是否完整覆盖所有场景？
- [ ] 是否评估了资源需求和并发量？

### ✅ 腾讯云SCF函数开发
- [ ] 函数代码是否符合SCF的编程模型？
- [ ] 运行时环境和依赖包是否正确配置？
- [ ] 内存大小和超时时间是否合理设置？
- [ ] 函数入口和返回值格式是否正确？
- [ ] 代码包大小是否在限制范围内？

### ✅ 触发器和事件配置
- [ ] COS触发器是否配置了正确的Bucket和前缀？
- [ ] API网关触发器的路径和方法是否正确？
- [ ] 事件过滤规则是否精确匹配需求？
- [ ] 触发器的权限配置是否完整？
- [ ] 是否测试了触发器的实际效果？

### ✅ 腾讯云数据万象集成（基础修图）
- [ ] 万象API的参数配置是否正确？
- [ ] 图片处理规则是否符合业务需求？
- [ ] 输出文件的格式和质量是否合适？
- [ ] 处理失败的错误处理是否完整？
- [ ] 处理时间是否在可接受范围内？

### ✅ RunningHub AI集成（AI模特生成）
- [ ] RunningHub API的调用参数是否正确？
- [ ] 12张分镜的生成逻辑是否完整？
- [ ] 异步状态轮询的间隔和次数是否合理？
- [ ] 结果文件的下载和存储是否可靠？
- [ ] API密钥的安全存储是否到位？

### ✅ COS文件管理和存储
- [ ] 输入文件的COS路径是否按规范命名？
- [ ] 输出文件的存储路径是否清晰可管理？
- [ ] 文件权限设置是否正确？
- [ ] 临时文件的清理机制是否配置？
- [ ] 存储成本是否得到有效控制？

### ✅ 错误处理和重试机制
- [ ] 所有可能的异常是否都被捕获？
- [ ] 错误信息是否详细且对调试有帮助？
- [ ] 失败任务的重试逻辑是否合理？
- [ ] 重试次数和间隔是否恰当？
- [ ] 死信队列的配置是否完整？

### ✅ 日志记录和监控
- [ ] 关键操作是否都有日志记录？
- [ ] 日志格式是否标准化？
- [ ] 敏感信息是否没有记录到日志中？
- [ ] 监控指标是否覆盖了关键业务指标？
- [ ] 告警规则是否配置合理？

### ✅ 安全性和权限控制
- [ ] 函数的执行角色权限是否最小化？
- [ ] API密钥和敏感信息是否安全存储？
- [ ] 输入参数是否进行了安全验证？
- [ ] 网络访问权限是否限制在必要范围？
- [ ] 是否防止了路径遍历等安全漏洞？

### ✅ 性能和成本优化
- [ ] 函数的冷启动时间是否得到优化？
- [ ] 内存使用是否在合理范围内？
- [ ] 处理时间是否尽可能短？
- [ ] 并发配置是否合理？
- [ ] 是否使用了预置并发减少延迟？

### ✅ 测试和验证
- [ ] 本地环境测试是否通过？
- [ ] 云函数部署是否成功？
- [ ] 端到端测试是否覆盖所有场景？
- [ ] 性能测试是否满足要求？
- [ ] 错误场景的测试是否完整？

## 输出前最后检查

在部署云函数之前，请确认：

1. **功能完整性**：所有处理逻辑都已实现
2. **性能达标**：处理时间和资源使用符合要求
3. **错误处理**：异常情况都有合适的处理
4. **安全性**：没有安全漏洞和敏感信息泄露
5. **成本控制**：资源配置合理，成本在预算范围内

## 常见错误避免

❌ **避免这些错误**：
- 在函数代码中硬编码API密钥和敏感信息
- 忽略输入验证，导致安全漏洞
- 超出云函数的资源限制（内存、时间、并发）
- 没有适当的错误处理，导致任务失败无法恢复
- 配置过大的内存或超时时间，造成成本浪费
- 忽略冷启动优化，影响用户体验

✅ **坚持这些原则**：
- 安全第一，所有敏感信息都要加密存储
- 性能优先，优化处理速度和资源使用
- 可靠性保证，完善的错误处理和重试机制
- 成本控制，合理配置资源避免浪费
- 监控完善，及时发现和解决问题

## 云函数特别检查

⚠️ **SCF函数安全检查**：
- [ ] 函数执行角色是否遵循最小权限原则？
- [ ] API密钥是否通过环境变量配置？
- [ ] 是否配置了VPC网络访问控制？
- [ ] 函数代码是否经过安全扫描？
- [ ] 是否配置了函数级别的访问控制？

⚠️ **COS集成安全检查**：
- [ ] COS访问权限是否限制在必需的Bucket和前缀？
- [ ] 文件上传是否进行了类型和大小限制？
- [ ] 是否防止了恶意文件上传？
- [ ] 临时文件的清理机制是否可靠？
- [ ] 文件访问日志是否启用？

## 第三方服务集成检查

⚠️ **外部API调用检查**：
- [ ] API密钥是否安全存储，没有暴露在代码中？
- [ ] 网络请求是否包含超时和重试处理？
- [ ] 第三方服务的异常是否影响核心业务？
- [ ] API调用频率是否在限制范围内？
- [ ] 调用失败时的降级策略是否完整？