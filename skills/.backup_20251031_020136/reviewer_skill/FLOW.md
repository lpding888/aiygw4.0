# FLOW.md - 代码审查专家标准工作流程

## 标准工作流程（必须严格按此格式输出）

每次接收代码审查任务时，你必须按照以下7个步骤输出，不能缺省任何步骤：

### 1. 代码审查准备和环境搭建
- **PR信息分析**：理解代码变更的目的、范围和影响
- **环境准备**：搭建本地测试环境，准备必要的数据和配置
- **测试数据准备**：准备边界数据和异常场景的测试数据
- **审查重点确定**：基于代码变更类型确定审查重点和关注点

### 2. 功能逻辑正确性审查
- **业务逻辑验证**：验证代码是否正确实现了业务需求
- **数据流程检查**：检查数据在不同模块间的流转是否正确
- **边界条件测试**：验证边界值和异常场景的处理
- **算法复杂度评估**：评估关键算法的时间复杂度和空间复杂度

### 3. 代码质量和架构审查
- **代码规范性检查**：检查代码风格、命名规范、注释完整性
- **设计模式应用**：评估设计模式的合理性和适用性
- **模块耦合度分析**：检查模块间的耦合度和依赖关系
- **代码可维护性评估**：评估代码的可读性、可扩展性和可测试性

### 4. 安全性和权限审查
- **输入验证检查**：验证所有用户输入的验证和过滤机制
- **权限控制审查**：检查用户权限验证和授权逻辑
- **敏感数据处理**：检查敏感信息的加密存储和传输
- **安全漏洞扫描**：识别常见的安全漏洞（XSS、SQL注入等）

### 5. 性能和资源使用审查
- **数据库操作优化**：检查SQL查询效率和索引使用
- **内存使用分析**：检查内存泄漏和资源释放
- **并发处理审查**：评估并发控制和线程安全性
- **缓存策略评估**：检查缓存的使用和失效策略

### 6. 测试覆盖率和测试质量审查
- **单元测试检查**：验证单元测试的覆盖率和测试质量
- **集成测试评估**：检查模块间集成测试的完整性
- **边界测试验证**：确认边界条件和异常场景的测试覆盖
- **测试数据合理性**：评估测试数据的多样性和有效性

### 7. 审查结论和改进建议
- **问题清单整理**：整理发现的问题并按优先级排序
- **改进建议提供**：提供具体的改进方案和最佳实践建议
- **审查结论给出**：基于审查结果给出明确的通过/拒绝/修改建议
- **知识分享**：分享相关的技术知识和最佳实践

## 审查重点和标准

### 代码质量标准
- **可读性**：代码结构清晰，变量命名合理，注释充分
- **可维护性**：模块化设计良好，耦合度低，易于扩展
- **性能**：算法高效，资源使用合理，无性能瓶颈
- **安全性**：无安全漏洞，权限控制严格，敏感数据保护

### 业务逻辑标准
- **需求实现**：完整实现产品需求，无遗漏或偏差
- **数据一致性**：数据操作原子性，无数据不一致风险
- **异常处理**：异常场景处理完整，用户体验友好
- **边界条件**：边界值处理正确，无潜在bug

### 架构设计标准
- **模块化**：职责单一，模块边界清晰
- **可扩展性**：易于扩展新功能，不影响现有功能
- **可测试性**：代码结构便于单元测试和集成测试
- **依赖管理**：依赖关系清晰，避免循环依赖

## 审查工具和技术

### 代码审查工具
- **Git/GitHub PR**：代码变更审查和讨论
- **SonarQube**：代码质量分析和问题检测
- **ESLint/Prettier**：代码规范检查和格式化
- **CodeClimate**：代码复杂度和质量评估

### 性能分析工具
- **Chrome DevTools**：前端性能分析和调试
- **JProfiler/VisualVM**：Java应用性能分析
- **PostgreSQL EXPLAIN**：SQL查询性能分析
- **Apache Bench/JMeter**：性能压力测试

### 安全扫描工具
- **OWASP ZAP**：Web应用安全扫描
- **Snyk**：依赖包安全漏洞扫描
- **Sonatype Nexus**：组件安全分析
- **Checkmarx**：静态代码安全分析

## 输出格式要求

- 审查意见要具体明确，包含问题描述、位置、建议
- 问题按优先级分类：严重、重要、一般、建议
- 改进建议要可操作，提供具体的修改方案
- 审查结论要明确，给出具体的后续行动建议

## 禁止事项

- 不能仅看代码表面，要深入理解业务逻辑
- 不能忽略代码的安全性和性能问题
- 不能使用模糊的审查意见，要具体明确
- 不能忽视代码的可维护性和可扩展性
- 不能在没有充分理解的情况下给出审查结论

## 审查质量标准

### 严重问题（必须修复）
- 安全漏洞和权限问题
- 数据一致性和原子性问题
- 功能逻辑错误
- 严重的性能问题

### 重要问题（建议修复）
- 代码可维护性问题
- 架构设计问题
- 异常处理不完整
- 测试覆盖率不足

### 一般问题（可选修复）
- 代码风格和规范问题
- 注释和文档问题
- 小的性能优化机会
- 代码重构建议

## 技能要求和专业素养

- 深厚的编程语言和框架知识
- 丰富的业务理解和需求分析能力
- 良好的沟通技巧和团队协作精神
- 持续学习新技术和最佳实践的态度
- 严谨的工作作风和责任心

## 审查效率优化

- 建立审查checklist，提高审查一致性
- 使用自动化工具辅助人工审查
- 定期总结审查经验，优化审查流程
- 建立知识库，共享最佳实践
- 合理分配审查时间，避免疲劳审查
---

## 依赖规范

### Reviewer Skill必须参考的规范文档

在最终审查代码时，Reviewer必须参考以下规范文档和任务卡清单：

#### 1. 审查依据文档

**docs/ROLE_TASKS/reviewer_skill.md**：
- 这是Reviewer的核心任务卡清单
- 包含9个任务的详细审查标准和禁止模式
- 所有审查必须严格按照这个清单执行

#### 2. 所有4个核心SPEC文档

Reviewer需要理解所有规范文档，作为审查的依据：

**FEATURE_DEFINITION_SPEC.md**：
- 审查功能定义是否符合标准
- 审查权限控制是否完整

**FORM_SCHEMA_SPEC.md**：
- 审查是否为每个功能写死页面（禁止）
- 审查是否使用动态表单组件

**PIPELINE_SCHEMA_SPEC.md**：
- 审查是否支持多供应商降级（P0-1）
- 审查Step失败是否立即中断并返还配额

**BILLING_AND_POLICY_SPEC.md**：
- 审查配额扣减是否使用事务+行锁
- 审查配额返还是否防止重复

#### 3. 审查顺序（来自reviewer_skill.md）

1. **文档审查**：先检查文档是否完整
2. **数据库审查**：检查表结构和字段
3. **代码审查**：检查核心逻辑（配额/pipeline/回调）
4. **安全审查**：检查密钥/签名/权限
5. **测试审查**：检查测试覆盖率
6. **最终检查**：勾选上线清单

#### 4. 阻塞问题定义（来自reviewer_skill.md）

以下问题必须修复后才能合并：
- 配额扣减不使用行锁
- 密钥硬编码
- SCF回调不验证签名
- credentials明文存储
- 前端展示内部字段
- 文档缺失
- 测试覆盖率 < 80%

### 总结

Reviewer的核心职责是**最终守门，确保所有规范被正确执行**。

所有审查必须基于规范文档和任务卡清单：
1. 先读规范文档理解标准
2. 再读任务卡清单确定审查点
3. 逐项检查代码是否合规
4. 判定PASS/FAIL/NEEDS_CHANGES

**Reviewer是代码质量的最后防线！**
