# CHECKLIST.md - CodeBuddy部署专家自检清单

## 每次部署前必须自检的项目

### ✅ 部署准备和环境检查
- [ ] 部署范围和影响是否明确？
- [ ] 目标环境状态是否正常？
- [ ] 部署时间窗口是否已确认？
- [ ] 相关人员是否已通知？
- [ ] 回滚方案是否准备完整？
- [ ] 部署脚本是否经过测试？

### ✅ 代码版本和构建检查
- [ ] 部署的代码版本是否正确？
- [ ] 代码是否已通过所有测试？
- [ ] 构建过程是否成功完成？
- [ ] 构建产物是否完整？
- [ ] 配置文件是否正确？
- [ ] Docker镜像（如使用）是否构建成功？

### ✅ 数据库变更检查（高危项）
- [ ] 数据库迁移脚本是否准备？
- [ ] 迁移脚本是否在测试环境验证？
- [ ] 数据库备份是否创建？
- [ ] 迁移回滚脚本是否准备？
- [ ] 迁移对性能的影响是否评估？
- [ ] 数据一致性验证方案是否准备？

### ✅ 前端部署检查
- [ ] 前端构建是否成功？
- [ ] 静态资源是否上传到CDN？
- [ ] CDN缓存是否刷新？
- [ ] 域名配置是否正确？
- [ ] 静态资源是否可正常访问？
- [ ] 页面加载是否正常？

### ✅ 后端服务部署检查
- [ ] PM2进程是否正常停止？
- [ ] 代码包是否正确更新？
- [ ] npm依赖是否正确安装？
- [ ] 环境变量是否配置正确？
- [ ] PM2进程是否成功启动？
- [ ] 服务健康检查是否通过？

### ✅ 云函数部署检查
- [ ] SCF函数代码是否更新？
- [ ] 函数配置是否正确？
- [ ] 触发器配置是否更新？
- [ ] 环境变量是否设置？
- [ ] 函数版本是否发布？
- [ ] 函数功能是否正常？

### ✅ 安全和权限检查
- [ ] API密钥是否安全配置？
- [ ] 文件权限是否正确设置？
- [ ] 网络访问权限是否限制？
- [ ] 防火墙规则是否配置？
- [ ] HTTPS证书是否有效？
- [ ] 安全扫描是否通过？

### ✅ 监控和日志检查
- [ ] 监控指标是否配置？
- [ ] 告警规则是否设置？
- [ ] 日志收集是否正常？
- [ ] 错误监控是否启用？
- [ ] 性能监控是否配置？
- [ ] 告警通知是否测试？

### ✅ 配额和计费检查（核心业务）
- [ ] 配额管理逻辑是否正常？
- [ ] 微信支付配置是否正确？
- [ ] 第三方服务配置是否更新？
- [ ] 计费逻辑是否验证？
- [ ] 用户数据是否完整？
- [ ] 财务数据是否准确？

### ✅ 性能和负载检查
- [ ] 服务响应时间是否正常？
- [ ] 数据库查询性能是否正常？
- [ ] 系统资源使用率是否正常？
- [ ] 并发处理能力是否足够？
- [ ] 缓存机制是否正常？
- [ ] CDN加速是否生效？

### ✅ 第三方服务集成检查
- [ ] 腾讯云COS连接是否正常？
- [ ] 微信支付接口是否正常？
- [ ] RunningHub API是否正常？
- [ ] 短信服务是否正常？
- [ ] 邮件服务是否正常？
- [ ] 其他第三方服务是否正常？

### ✅ 功能验证检查
- [ ] 用户注册登录是否正常？
- [ ] 会员购买流程是否正常？
- [ ] 基础修图功能是否正常？
- [ ] AI模特生成功能是否正常？
- [ ] 配额管理系统是否正常？
- [ ] 核心业务流程是否完整？

### ✅ 用户体验检查
- [ ] 页面加载速度是否正常？
- [ ] 用户操作是否流畅？
- [ ] 错误提示是否友好？
- [ ] 移动端体验是否正常？
- [ ] 浏览器兼容性是否正常？
- [ ] 关键路径是否畅通？

### ✅ 部署后验证
- [ ] 所有服务是否正常运行？
- [ ] 监控指标是否正常？
- [ ] 错误日志是否在正常范围？
- [ ] 用户反馈是否正常？
- [ ] 业务数据是否正常？
- [ ] 系统性能是否达标？

### ✅ 文档和记录
- [ ] 部署文档是否更新？
- [ ] 变更记录是否完整？
- [ ] 配置变更是否记录？
- [ ] 问题处理是否记录？
- [ ] 知识分享是否完成？
- [ ] 后续计划是否制定？

## 输出前最后检查

在完成部署并交接之前，请确认：

1. **功能完整性**：所有核心功能都已验证正常
2. **性能达标**：系统性能指标达到预期标准
3. **安全可靠**：安全配置正确，无安全漏洞
4. **监控完善**：监控告警机制工作正常
5. **文档完整**：部署文档和变更记录完整

## 常见错误避免

❌ **避免这些部署错误**：
- 在生产环境直接执行未测试的脚本
- 忽略数据库备份就进行迁移
- 不验证部署结果就完成交接
- 忽略回滚方案的准备
- 在业务高峰期进行高风险部署

✅ **坚持这些部署原则**：
- 安全第一，备份和验证优先
- 渐进部署，小步快跑
- 充分测试，验证完备
- 监控到位，告警及时
- 文档完整，知识共享

## 数据库部署特别检查

⚠️ **数据库迁移安全检查（最高优先级）**：
- [ ] 是否创建了完整的数据库备份？
- [ ] 迁移脚本是否在测试环境充分验证？
- [ ] 迁移过程的回滚方案是否准备？
- [ ] 迁移对线上服务的影响是否评估？
- [ ] 迁移后的数据一致性是否验证？
- [ ] 迁移失败时的应急处理是否准备？

## 配额和支付部署检查

⚠️ **核心业务逻辑检查**：
- [ ] 配额扣减逻辑是否正常工作？
- [ ] 支付回调处理是否正确？
- [ ] 用户配额余额显示是否准确？
- [ ] 并发场景下配额管理是否安全？
- [ ] 财务数据记录是否完整？
- [ ] 异常情况下的配额返还是否正常？

## 安全部署特别检查

⚠️ **安全配置检查**：
- [ ] API密钥和敏感信息是否安全配置？
- [ ] 网络访问权限是否最小化？
- [ ] HTTPS证书是否正确配置？
- [ ] 防火墙规则是否合理设置？
- [ ] 日志中是否包含敏感信息？
- [ ] 安全扫描是否通过？

## 监控和告警检查

⚠️ **监控系统检查**：
- [ ] 服务可用性监控是否配置？
- [ ] 性能指标监控是否设置？
- [ ] 错误率监控是否正常？
- [ ] 资源使用监控是否配置？
- [ ] 告警通知是否测试通过？
- [ ] 监控仪表板是否更新？

## 应急响应准备

⚠️ **应急方案检查**：
- [ ] 快速回滚脚本是否准备？
- [ ] 紧急联系人列表是否更新？
- [ ] 应急处理流程是否明确？
- [ ] 系统降级方案是否准备？
- [ ] 用户通知预案是否制定？
- [ ] 事后分析流程是否制定？

## 部署最佳实践

### 部署前
- 充分的沟通和计划
- 完整的测试和验证
- 详细的回滚方案
- 充分的备份准备

### 部署中
- 严格按照流程执行
- 实时监控系统状态
- 及时记录操作日志
- 快速响应异常情况

### 部署后
- 全面的功能和性能验证
- 监控指标确认
- 用户反馈收集
- 经验总结和文档更新