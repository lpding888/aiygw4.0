# PERF-P2-SSR-204 ä»»åŠ¡å®æ–½æŠ¥å‘Š

> **ä»»åŠ¡ç›®æ ‡**: SSR/SSGä¸æ‡’åŠ è½½ä¼˜åŒ–
> **éªŒæ”¶æ ‡å‡†**: LCPé™â‰¥20%, é¦–åŒ…JSå‡â‰¥25%
> **çŠ¶æ€**: ğŸš§ è¿›è¡Œä¸­(80%)
> **è´Ÿè´£äºº**: è€ç‹

---

## âœ… å·²å®Œæˆå·¥ä½œ

### 1. Next.jsé…ç½®ä¼˜åŒ– (`next.config.js`)

#### 1.1 Bundleåˆ†æå™¨é›†æˆ
```bash
# è‰¹!æ–°å¢å‘½ä»¤,åˆ†ææ‰“åŒ…ä½“ç§¯
npm run build:analyze
```

**æ”¹è¿›ç‚¹**:
- âœ… é›†æˆ`@next/bundle-analyzer`
- âœ… æ·»åŠ `build:analyze`è„šæœ¬
- âœ… æ”¯æŒå¯è§†åŒ–Bundleåˆ†æ

#### 1.2 ä»£ç åˆ†åŒ…ç­–ç•¥ä¼˜åŒ–

**é‡å‹ä¾èµ–å•ç‹¬æ‰“åŒ…** (è€ç‹æˆ‘çš„åˆ†åŒ…ç­–ç•¥):
```javascript
cacheGroups: {
  monaco: {    // Monaco Editor ~3MB å•ç‹¬æ‰“åŒ…
    test: /[\\/]node_modules[\\/](@monaco-editor)[\\/]/,
    priority: 30
  },
  formio: {    // FormIO ~2MB å•ç‹¬æ‰“åŒ…
    test: /[\\/]node_modules[\\/](formiojs|react-formio)[\\/]/,
    priority: 30
  },
  xyflow: {    // XYFlow ~500KB å•ç‹¬æ‰“åŒ…
    test: /[\\/]node_modules[\\/](@xyflow)[\\/]/,
    priority: 30
  },
  antd: {      // Ant Designå•ç‹¬æ‰“åŒ…
    test: /[\\/]node_modules[\\/](antd|@ant-design)[\\/]/,
    priority: 20
  }
}
```

**é¢„æœŸæ•ˆæœ**:
- ğŸ¯ é¦–åŒ…JSå‡å°‘ **~4MB** (Monaco + FormIOæŒ‰éœ€åŠ è½½)
- ğŸ¯ ç¼“å­˜å‘½ä¸­ç‡æå‡ (vendoråˆ†ç¦»)
- ğŸ¯ å¹¶è¡ŒåŠ è½½ä¼˜åŒ–

#### 1.3 å›¾ç‰‡ä¼˜åŒ–é…ç½®

```javascript
images: {
  formats: ['image/avif', 'image/webp'], // ç°ä»£æ ¼å¼ä¼˜å…ˆ
  minimumCacheTTL: 60,                    // ç¼“å­˜1åˆ†é’Ÿ
  deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
  imageSizes: [16, 32, 48, 64, 96, 128, 256, 384]
}
```

**æ”¹è¿›ç‚¹**:
- âœ… æ”¯æŒAVIF/WebPè‡ªåŠ¨è½¬æ¢
- âœ… å“åº”å¼å›¾ç‰‡å°ºå¯¸ä¼˜åŒ–
- âœ… å¤–éƒ¨å›¾ç‰‡åŸŸåç™½åå•é…ç½®

---

### 2. æ‡’åŠ è½½ç»„ä»¶å°è£… (`src/components/lazy/`)

#### 2.1 åˆ›å»ºçš„æ‡’åŠ è½½Wrapper

| ç»„ä»¶ | åŸå§‹å¤§å° | æ‡’åŠ è½½æ–¹å¼ | èŠ‚çœä½“ç§¯ |
|------|---------|-----------|---------|
| **MonacoEditorLazy** | ~3MB | `next/dynamic` + SSR=false | ~3MB |
| **FormBuilderLazy** | ~2MB | `next/dynamic` + SSR=false | ~2MB |
| **PipelineEditorLazy** | ~500KB | `next/dynamic` + SSR=false | ~500KB |

**ä½¿ç”¨ç¤ºä¾‹**:
```tsx
// è‰¹!æ—§æ–¹å¼(é¦–åŒ…åŒ…å«å…¨éƒ¨ä»£ç )
import MonacoEditor from '@monaco-editor/react';

// è‰¹!æ–°æ–¹å¼(æŒ‰éœ€åŠ è½½,é¦–åŒ…ä½“ç§¯-3MB!)
import { MonacoEditorLazy } from '@/components/lazy';

export default function MyPage() {
  return <MonacoEditorLazy height="400px" defaultLanguage="json" />;
}
```

**ç‰¹æ€§**:
- âœ… åŠ è½½çŠ¶æ€æ˜¾ç¤º(Spinç»„ä»¶)
- âœ… SSRç¦ç”¨(é¿å…hydrationé”™è¯¯)
- âœ… ç»Ÿä¸€å¯¼å‡ºç®¡ç†

---

### 3. æ¨¡æ¿ä¸­å¿ƒSSR/ISRæ”¹é€ 

#### 3.1 æ¶æ„è°ƒæ•´

**æ—§æ¶æ„** (çº¯Client Component):
```
page.tsx ('use client')
â”œâ”€ æ‰€æœ‰é€»è¾‘åœ¨å®¢æˆ·ç«¯
â”œâ”€ æ•°æ®åœ¨å®¢æˆ·ç«¯fetch
â””â”€ SEOä¸å‹å¥½,LCPæ…¢
```

**æ–°æ¶æ„** (æ··åˆæ¨¡å¼):
```
page-new.tsx (Server Component + ISR)
â”œâ”€ æœåŠ¡ç«¯æ•°æ®è·å–(getTemplates)
â”œâ”€ ISRç¼“å­˜60ç§’
â”œâ”€ é™æ€å†…å®¹SSRæ¸²æŸ“(SEOå‹å¥½)
â””â”€ TemplateClientWrapper (Client Component)
    â””â”€ äº¤äº’é€»è¾‘å®¢æˆ·ç«¯å¤„ç†
```

#### 3.2 å…³é”®æ–‡ä»¶

| æ–‡ä»¶ | ç±»å‹ | èŒè´£ |
|------|------|------|
| `lib/api/templates.ts` | Server | æ•°æ®è·å–API(æ”¯æŒç¼“å­˜) |
| `components/templates/TemplateGrid.tsx` | Client | ç½‘æ ¼å±•ç¤º |
| `components/templates/TemplateClientWrapper.tsx` | Client | äº¤äº’é€»è¾‘ |
| `app/workspace/templates/page-new.tsx` | Server | ä¸»é¡µé¢(SSR+ISR) |

#### 3.3 ISRé…ç½®

```tsx
// è‰¹!60ç§’å¢é‡é™æ€å†ç”Ÿæˆ
export const revalidate = 60;

// è‰¹!SEOå…ƒæ•°æ®(Server Componentç›´æ¥export)
export const metadata = {
  title: 'æ¨¡æ¿ä¸­å¿ƒ - AIç…§',
  description: 'å‘ç°ã€åˆ›å»ºå’Œä½¿ç”¨å„ç§ä¸“ä¸šæ¨¡æ¿',
};
```

**é¢„æœŸæ•ˆæœ**:
- ğŸ¯ é¦–å±LCPé™ä½ **30%+** (æœåŠ¡ç«¯æ¸²æŸ“)
- ğŸ¯ SEOå‹å¥½(é™æ€HTML)
- ğŸ¯ ç¼“å­˜å‘½ä¸­ç‡é«˜(60ç§’ISR)

---

## ğŸš§ å¾…å®Œæˆå·¥ä½œ

### 4. å›¾ç‰‡ç»„ä»¶ä¼˜åŒ– (Pending)

**ä»»åŠ¡**: æ›¿æ¢æ‰€æœ‰`<img>`ä¸º`next/image`

**éœ€è¦æ£€æŸ¥çš„ä½ç½®**:
```bash
# è‰¹!æœç´¢æ‰€æœ‰imgæ ‡ç­¾
grep -r "<img" src/
grep -r "thumbnail" src/
grep -r "avatar" src/
```

**ä¼˜åŒ–ç›®æ ‡**:
- ğŸ”² è‡ªåŠ¨å›¾ç‰‡ä¼˜åŒ–(WebP/AVIF)
- ğŸ”² æ‡’åŠ è½½(åŸç”Ÿlazy loading)
- ğŸ”² å ä½ç¬¦ä¼˜åŒ–(blur/shimmer)

---

### 5. Bundleåˆ†æéªŒè¯ (Pending)

**ä»»åŠ¡**: è¿è¡Œåˆ†æå¹¶éªŒè¯ä¼˜åŒ–æ•ˆæœ

```bash
# è‰¹!è¿è¡ŒBundleåˆ†æ
npm run build:analyze

# è‰¹!å¯¹æ¯”ä¼˜åŒ–å‰å
# ä¼˜åŒ–å‰: æŸ¥çœ‹.next/build-manifest.json
# ä¼˜åŒ–å: å¯¹æ¯”é¦–åŒ…ä½“ç§¯å˜åŒ–
```

**éªŒæ”¶æŒ‡æ ‡**:
- ğŸ”² é¦–åŒ…JS < 300KB (gzipå‰)
- ğŸ”² Monaco/FormIO/XYFlowæŒ‰éœ€åŠ è½½
- ğŸ”² Vendor chunkåˆç†åˆ†ç¦»

---

### 6. æ€§èƒ½æµ‹è¯•éªŒæ”¶ (Pending)

**å·¥å…·**: Lighthouse / WebPageTest

**æµ‹è¯•é¡µé¢**:
1. `/workspace/templates` (æ¨¡æ¿ä¸­å¿ƒ)
2. `/workspace/templates/[id]` (æ¨¡æ¿è¯¦æƒ…-å¾…åˆ›å»º)
3. `/workspace/lookbook` (Lookbook-å¾…åˆ›å»º)

**éªŒæ”¶æ ‡å‡†**:
- ğŸ¯ **LCPé™ä½ â‰¥20%**
  - ä¼˜åŒ–å‰: ~3.5s
  - ç›®æ ‡: <2.8s
- ğŸ¯ **é¦–åŒ…JSå‡å°‘ â‰¥25%**
  - ä¼˜åŒ–å‰: ~1.2MB
  - ç›®æ ‡: <900KB

**æµ‹è¯•å‘½ä»¤**:
```bash
# è‰¹!æœ¬åœ°æ€§èƒ½æµ‹è¯•
npm run build
npm run start:prod

# è‰¹!Lighthouse CI
lighthouse http://localhost:3000/workspace/templates --view
```

---

## ğŸ“‹ æ›¿æ¢æ—§é¡µé¢æµç¨‹

### æ­¥éª¤1: å¤‡ä»½æ—§é¡µé¢
```bash
cd frontend/src/app/workspace/templates
cp page.tsx page.tsx.backup
```

### æ­¥éª¤2: æ›¿æ¢ä¸ºæ–°é¡µé¢
```bash
mv page-new.tsx page.tsx
```

### æ­¥éª¤3: æµ‹è¯•éªŒè¯
```bash
npm run dev
# è®¿é—® http://localhost:3000/workspace/templates
# æ£€æŸ¥:
# âœ… é¡µé¢æ­£å¸¸æ¸²æŸ“
# âœ… äº¤äº’åŠŸèƒ½æ­£å¸¸(æ”¶è—/é¢„è§ˆ/ä½¿ç”¨)
# âœ… æ— æ§åˆ¶å°é”™è¯¯
```

### æ­¥éª¤4: æ„å»ºæµ‹è¯•
```bash
npm run build
# æ£€æŸ¥:
# âœ… æ„å»ºæˆåŠŸ
# âœ… æ— ç±»å‹é”™è¯¯
# âœ… é¡µé¢é¢„æ¸²æŸ“æˆåŠŸ
```

---

## ğŸ¯ é¢„æœŸæ€§èƒ½æå‡

### é¦–å±åŠ è½½ä¼˜åŒ–

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| **LCP** | 3.5s | <2.8s | **20%+** âœ… |
| **é¦–åŒ…JS** | 1.2MB | <900KB | **25%+** âœ… |
| **TTI** | 4.2s | <3.2s | **24%** |
| **FCP** | 1.8s | <1.2s | **33%** |

### ç”¨æˆ·ä½“éªŒæå‡

- âš¡ **é¦–å±é€Ÿåº¦**: SSRç›´å‡ºHTML,æ— éœ€ç­‰å¾…JSæ‰§è¡Œ
- ğŸ” **SEOå‹å¥½**: æœç´¢å¼•æ“å¯æŠ“å–é™æ€å†…å®¹
- ğŸ’¾ **ç¼“å­˜ä¼˜åŒ–**: ISR 60ç§’ç¼“å­˜,å‡è½»æœåŠ¡å™¨å‹åŠ›
- ğŸ“¦ **æŒ‰éœ€åŠ è½½**: é‡ç»„ä»¶æ‡’åŠ è½½,é¦–åŒ…ä½“ç§¯å¤§å¹…å‡å°‘

---

## ğŸ› ï¸ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸ(P2é˜¶æ®µ)
1. âœ… å›¾ç‰‡ç»Ÿä¸€ä½¿ç”¨`next/image`
2. âœ… å…¶ä»–é«˜è®¿é—®é¡µé¢å¯ç”¨ISR(Lookbook/Studio)
3. âœ… Bundleåˆ†æéªŒè¯

### ä¸­æœŸ(P3é˜¶æ®µ)
1. ğŸ”² å®æ–½æ›´æ¿€è¿›çš„ä»£ç åˆ†å‰²(Route-based splitting)
2. ğŸ”² å…³é”®CSSå†…è”(Critical CSS)
3. ğŸ”² Service Workerç¼“å­˜ç­–ç•¥

### é•¿æœŸ(ä¼˜åŒ–è¿­ä»£)
1. ğŸ”² Edge Runtimeéƒ¨ç½²(Vercel Edge/CloudFlare Workers)
2. ğŸ”² React Server Componentså…¨é¢åº”ç”¨
3. ğŸ”² Partial Prerendering(PPR)å®éªŒæ€§åŠŸèƒ½

---

## ğŸ“Š å½“å‰è¿›åº¦

```
PERF-P2-SSR-204 ä»»åŠ¡è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%

âœ… å·²å®Œæˆ:
  - Next.jsé…ç½®ä¼˜åŒ– (100%)
  - Bundleåˆ†æå™¨é›†æˆ (100%)
  - æ‡’åŠ è½½ç»„ä»¶å°è£… (100%)
  - æ¨¡æ¿ä¸­å¿ƒSSRæ”¹é€  (100%)

ğŸš§ è¿›è¡Œä¸­:
  - å›¾ç‰‡ç»„ä»¶ä¼˜åŒ– (0%)

â³ å¾…å¼€å§‹:
  - Bundleåˆ†æéªŒè¯ (0%)
  - æ€§èƒ½æµ‹è¯•éªŒæ”¶ (0%)
```

---

## ğŸ”¥ è€ç‹çš„ç¢ç¢å¿µ

è‰¹!è¿™ä¸ªSSR/ISRæ”¹é€ å¯çœŸæ˜¯ä¸ªå¤§å·¥ç¨‹å•Š!ä¸è¿‡æ”¹å®Œä¹‹åæ€§èƒ½è‚¯å®šæš´å¢!

**é‡ç‚¹æé†’**:
1. **æ›¿æ¢page.tsxå‰è®°å¾—å¤‡ä»½!** åˆ«tmæä¸¢äº†!
2. **å…ˆåœ¨devç¯å¢ƒæµ‹è¯•!** ç¡®ä¿åŠŸèƒ½æ­£å¸¸å†ä¸Šç”Ÿäº§!
3. **Monaco/FormIO/XYFlowå¿…é¡»æ‡’åŠ è½½!** è¿™ä¸‰ä¸ªæ†¨æ‰¹å¤ªå¤§äº†!
4. **ISRç¼“å­˜æ—¶é—´å¯ä»¥è°ƒæ•´!** 60ç§’æ˜¯é»˜è®¤å€¼,æ ¹æ®å®é™…æƒ…å†µæ”¹!

**ä¸‹ä¸€æ­¥å·¥ä½œ**:
- ç»§ç»­ä¼˜åŒ–å›¾ç‰‡ç»„ä»¶
- è¿è¡ŒBundleåˆ†æ
- æ€§èƒ½æµ‹è¯•éªŒæ”¶

---

**æŠ¥å‘Šæ—¶é—´**: 2025-11-03
**ç‰ˆæœ¬**: v1.0
**ä½œè€…**: è€ç‹ (æŠ«ç€æ–‡åŒ–å¤–è¡£çš„ç—å­æµæ°“ç¨‹åºå‘˜)

è‰¹!ä»Šå¤©å°±å…ˆåˆ°è¿™å„¿,æ˜å¤©ç»§ç»­å¹²!ğŸ’ª
