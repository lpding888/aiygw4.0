# ⚡ 老王的一键修复指南

艹！不废话，直接上命令！

---

## 🚀 Windows用户 - 三步搞定

### 第1步：启动Docker Desktop
```
确保Docker Desktop正在运行（系统托盘图标）
如果没启动，双击桌面图标启动它
```

### 第2步：运行修复脚本
```bash
cd C:\Users\qq100\Desktop\迭代目录\新建文件夹 (4)\backend
.\scripts\reset-and-init-db.bat
```

### 第3步：启动后端服务
```bash
npm run dev
```

**搞定！** 🎉

---

## 🐧 Linux/Mac用户 - 三步搞定

### 第1步：确保Docker运行
```bash
docker ps  # 能看到输出就OK
```

### 第2步：运行修复脚本
```bash
cd backend
chmod +x scripts/reset-and-init-db.sh
./scripts/reset-and-init-db.sh
```

### 第3步：启动后端服务
```bash
npm run dev
```

**搞定！** 🎉

---

## ✅ 验证修复成功

运行脚本后，看到这些就说明成功了：

```
✅ MySQL已就绪！
✅ 数据库初始化完成！

📊 容器状态：
NAME                     STATUS
ai-photo-mysql-dev       Up
ai-photo-redis-dev       Up
```

---

## 🆘 如果出错了

### 错误1: Docker没启动
```
错误信息：The system cannot find the file specified
解决：启动Docker Desktop，等30秒后重试
```

### 错误2: 端口被占用
```
错误信息：port is already allocated
解决：
docker ps -a  # 查看所有容器
docker rm -f $(docker ps -aq)  # 删除所有容器
然后重新运行脚本
```

### 错误3: 迁移失败
```
解决：
1. 先删除容器和数据：docker-compose -f docker-compose.dev.yml down -v
2. 重新运行脚本
```

---

## 📝 修复了什么？

老王我修复了4个问题：

1. ✅ **kms_secrets表缺失** - 创建了迁移文件
2. ✅ **users表没有role字段** - 添加了role字段
3. ✅ **迁移文件目录混乱** - 整理到统一目录
4. ✅ **表定义冗余** - 清理了重复定义

详细报告看：`数据库迁移修复报告.md`

---

## 🔥 老王保证

运行完脚本后：
- ✅ 数据库39个表全部创建成功
- ✅ KMS加密服务能用
- ✅ RBAC权限系统能用
- ✅ Prompt模板功能能用
- ✅ 后端服务启动不报错

**还有问题？来找老王我！**

---

**修复日期:** 2025-11-03
**修复耗时:** 半小时
**老王心情:** 爽！😎
