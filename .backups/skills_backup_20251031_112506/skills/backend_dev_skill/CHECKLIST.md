# Backend Dev Skill - 自检清单(CHECKLIST)

在提交 PR 前,必须完成以下自检:

## OpenAPI 契约检查

- [ ] 是否产出/更新 openapi/*.yaml?
- [ ] 是否定义所有路径、参数、响应?
- [ ] 是否定义 Schema 与错误码?
- [ ] 是否与 Frontend 确认契约?
- [ ] 是否发布 API_CONTRACT_READY 事件?

## 数据库设计检查

- [ ] 是否产出 Knex 迁移脚本?
- [ ] 是否建立必要索引(唯一索引/复合索引)?
- [ ] 是否建立外键关联?
- [ ] 是否考虑数据类型与字符集(utf8mb4)?
- [ ] 是否提供 exports.up 和 exports.down?

## 代码实现检查

- [ ] 是否遵循分层架构(路由/控制器/服务/仓储)?
- [ ] 是否应用鉴权中间件(auth, rbac)?
- [ ] 是否应用速率限制中间件(rateLimit)?
- [ ] 是否使用统一响应格式(code, message, data, requestId)?
- [ ] 是否使用 Knex 参数化查询(防SQL注入)?
- [ ] 是否考虑事务(多表操作)?
- [ ] 是否考虑幂等性(回调/转账类操作)?
- [ ] 是否考虑缓存(热点数据 Redis 缓存)?
- [ ] 是否考虑错误处理(统一错误码)?

## 测试覆盖检查

- [ ] 是否编写单元测试(tests/unit)?
- [ ] 是否编写集成测试(tests/integration)?
- [ ] 是否覆盖率 ≥ 80%?
- [ ] 是否覆盖边界情况(空值/非法值/异常)?
- [ ] 是否使用 Jest + Supertest?

## 安全检查

- [ ] 是否应用 JWT 鉴权?
- [ ] 是否应用 RBAC 权限控制?
- [ ] 是否应用输入校验(Joi/Zod)?
- [ ] 是否应用速率限制?
- [ ] 是否应用 CORS 白名单?
- [ ] 是否应用 Helmet 安全头?
- [ ] 是否记录审计日志(关键操作)?
- [ ] 是否脱敏敏感数据(日志/响应)?

## 性能检查

- [ ] 是否建立必要索引(避免全表扫描)?
- [ ] 是否使用分页(避免一次返回大量数据)?
- [ ] 是否使用 Redis 缓存(热点数据)?
- [ ] 是否避免 N+1 查询?
- [ ] 是否避免长耗时同步操作(应交给 SCF/队列)?
- [ ] 是否测试核心接口 P95 ≤ 200ms?

## 可观测性检查

- [ ] 是否使用结构化日志(pino)?
- [ ] 是否包含 requestId(追踪请求)?
- [ ] 是否记录请求耗时?
- [ ] 是否记录错误信息(不泄露敏感信息)?
- [ ] 是否提供健康检查接口(/health)?

## 协作检查

- [ ] 是否发布 API_CONTRACT_READY 事件?
- [ ] 是否等待 Frontend 确认 API_CONTRACT_ACK?
- [ ] 是否与 SCF 确认事件契约?
- [ ] 是否提供回调接口(COS/SCF)?
- [ ] 是否提供签名校验逻辑?

## 文档检查

- [ ] 是否更新 README.md(接口说明)?
- [ ] 是否更新 CHANGELOG.md(变更说明)?
- [ ] 是否提供设计文档(docs/*.md)?
- [ ] 是否提供启动脚本(scripts/*.sh)?
- [ ] 是否提供配置说明(.env.example)?

## 提交前最终检查

- [ ] 是否通过 lint/format(ESLint + Prettier)?
- [ ] 是否通过所有测试(npm test)?
- [ ] 是否覆盖率达标(≥ 80%)?
- [ ] 是否更新 OpenAPI 契约?
- [ ] 是否更新迁移脚本?
- [ ] 是否符合任务卡的 acceptanceCriteria?
- [ ] 是否提交 PR 并等待 Reviewer 审查?

---

严格遵守以上清单,确保后端服务高质量!
