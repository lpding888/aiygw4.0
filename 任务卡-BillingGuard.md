# 🎯 Billing Guard Skill - 任务卡

## 📋 任务名称
服装视频生成功能 - 计费逻辑审查

## 🎨 任务价值
确保视频生成功能的计费逻辑准确无误，保护用户和平台利益

## 📥 输入依赖
- PRD文档：服装视频生成功能-任务分派.md
- 后端配额管理实现代码
- 数据库表结构

## 📤 输出要求
- 计费逻辑审查报告
- 发现问题的详细说明
- 改进建议

## 🎯 具体任务

### 1. 配额扣减审查
- [ ] 审查5次配额消耗的合理性
- [ ] 验证预扣逻辑的原子性（forUpdate行锁）
- [ ] 检查并发场景下的配额一致性

### 2. 配额返还审查
- [ ] 审查失败返还逻辑的完整性
  - 混元脚本生成失败
  - KUAI生成失败
  - 2小时超时
- [ ] 验证返还操作的原子性
- [ ] 检查重复返还的风险

### 3. 边界条件审查
- [ ] 审查配额不足时的处理
- [ ] 审查会员过期时的处理
- [ ] 审查系统异常时的配额保护

### 4. 安全性审查
- [ ] 审查配额操作的权限控制
- [ ] 检查潜在的配额操纵风险
- [ ] 验证日志记录的完整性

## ✅ 验收标准
- [ ] 配额扣减逻辑合理且安全
- [ ] 所有失败场景都有返还机制
- [ ] 无配额泄露或重复返还风险
- [ ] 提供完整的审查报告

## ⏰ 工期估计
1天

## 📚 参考资料
- PRD文档中的配额与计费策略
- 后端配额管理实现代码
- 数据库表结构设计