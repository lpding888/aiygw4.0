# å‰ç«¯æ¶æ„è®¾è®¡æ–‡æ¡£

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [layout.tsx](file://frontend/src/app/layout.tsx) - *æ›´æ–°äº†å¯è®¿é—®æ€§æ”¯æŒ*
- [authStore.ts](file://frontend/src/store/authStore.ts)
- [api.ts](file://frontend/src/lib/api.ts)
- [ImageUploader.tsx](file://frontend/src/components/ImageUploader.tsx)
- [globals.css](file://frontend/src/app/globals.css)
- [login/page.tsx](file://frontend/src/app/login/page.tsx)
- [task/[taskId]/page.tsx](file://frontend/src/app/task/[taskId]/page.tsx)
- [workspace/page.tsx](file://frontend/src/app/workspace/page.tsx)
- [page.tsx](file://frontend/src/app/page.tsx)
- [index.ts](file://frontend/src/types/index.ts)
- [package.json](file://frontend/package.json)
- [next.config.js](file://frontend/next.config.js)
- [A11Y-P2-ACCESS-206-å¯è®¿é—®æ€§æŒ‡å—.md](file://frontend/A11Y-P2-ACCESS-206-å¯è®¿é—®æ€§æŒ‡å—.md) - *æ–°å¢å¯è®¿é—®æ€§æŒ‡å—*
- [I18N-P2-LOCALE-209-ä½¿ç”¨æŒ‡å—.md](file://frontend/I18N-P2-LOCALE-209-ä½¿ç”¨æŒ‡å—.md) - *æ–°å¢å›½é™…åŒ–æŒ‡å—*
- [security.md](file://frontend/docs/security.md) - *æ–°å¢å®‰å…¨é˜²æŠ¤æŒ‡å—*
- [accessibility.css](file://frontend/src/styles/accessibility.css) - *æ–°å¢å¯è®¿é—®æ€§æ ·å¼*
- [LanguageSwitcher.tsx](file://frontend/src/components/LanguageSwitcher.tsx) - *æ–°å¢è¯­è¨€åˆ‡æ¢å™¨*
- [lighthouse-a11y.js](file://frontend/scripts/lighthouse-a11y.js) - *æ–°å¢å¯è®¿é—®æ€§æ£€æŸ¥è„šæœ¬*
</cite>

## æ›´æ–°æ‘˜è¦
**å˜æ›´å†…å®¹**
- æ–°å¢å¯è®¿é—®æ€§ä¼˜åŒ–æŒ‡å—ï¼ŒåŒ…å«ESLintæ£€æŸ¥ã€å·¥å…·åº“ã€æ ·å¼è§„èŒƒå’ŒLighthouseè‡ªåŠ¨åŒ–æµ‹è¯•
- æ–°å¢å›½é™…åŒ–ä½¿ç”¨æŒ‡å—ï¼Œæ”¯æŒä¸­è‹±æ–‡åˆ‡æ¢å’Œè·¯ç”±å›½é™…åŒ–
- æ–°å¢å®‰å…¨é˜²æŠ¤æŒ‡å—ï¼Œæ¶µç›–XSSã€CSRFç­‰é˜²æŠ¤æªæ–½
- æ›´æ–°äº†æ ¹å¸ƒå±€ä»¥æ”¯æŒå¯è®¿é—®æ€§åŠŸèƒ½
- æ·»åŠ äº†è¯­è¨€åˆ‡æ¢å™¨ç»„ä»¶å’Œç›¸å…³é…ç½®

## ç›®å½•
1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆæ¶æ„](#æŠ€æœ¯æ ˆæ¶æ„)
3. [Next.js App Router è·¯ç”±ç³»ç»Ÿ](#nextjs-app-router-è·¯ç”±ç³»ç»Ÿ)
4. [çŠ¶æ€ç®¡ç†æ¶æ„](#çŠ¶æ€ç®¡ç†æ¶æ„)
5. [APIè°ƒç”¨å±‚è®¾è®¡](#apiè°ƒç”¨å±‚è®¾è®¡)
6. [é¡µé¢ç»„ä»¶æ¶æ„](#é¡µé¢ç»„ä»¶æ¶æ„)
7. [å¯å¤ç”¨UIç»„ä»¶è®¾è®¡](#å¯å¤ç”¨uiç»„ä»¶è®¾è®¡)
8. [æ ·å¼ç³»ç»Ÿä¸å¸ƒå±€](#æ ·å¼ç³»ç»Ÿä¸å¸ƒå±€)
9. [è®¤è¯ä¸æƒé™æ§åˆ¶](#è®¤è¯ä¸æƒé™æ§åˆ¶)
10. [å¼€å‘æœ€ä½³å®è·µ](#å¼€å‘æœ€ä½³å®è·µ)
11. [å¯è®¿é—®æ€§ä¼˜åŒ–æŒ‡å—](#å¯è®¿é—®æ€§ä¼˜åŒ–æŒ‡å—)
12. [å›½é™…åŒ–ä½¿ç”¨æŒ‡å—](#å›½é™…åŒ–ä½¿ç”¨æŒ‡å—)
13. [å®‰å…¨é˜²æŠ¤æŒ‡å—](#å®‰å…¨é˜²æŠ¤æŒ‡å—)
14. [æ€»ç»“](#æ€»ç»“)

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºNext.js 14çš„ç°ä»£åŒ–å‰ç«¯åº”ç”¨ï¼Œé‡‡ç”¨App Routeræ¶æ„ï¼Œä¸“æ³¨äºAIæœè£…å¤„ç†æœåŠ¡ã€‚é¡¹ç›®å®ç°äº†å®Œæ•´çš„ç”¨æˆ·è®¤è¯ã€ä»»åŠ¡ç®¡ç†ã€ä¼šå‘˜ä½“ç³»ç­‰åŠŸèƒ½æ¨¡å—ï¼Œæä¾›äº†æµç•…çš„ç”¨æˆ·ä½“éªŒå’Œé«˜æ•ˆçš„å¼€å‘æ¨¡å¼ã€‚

### æ ¸å¿ƒç‰¹æ€§
- **ç°ä»£åŒ–è·¯ç”±ç³»ç»Ÿ**ï¼šåŸºäºNext.js App Routerçš„æ–‡ä»¶ç³»ç»Ÿè·¯ç”±
- **é«˜æ•ˆçŠ¶æ€ç®¡ç†**ï¼šä½¿ç”¨Zustandå®ç°è½»é‡çº§çŠ¶æ€ç®¡ç†
- **ç»Ÿä¸€APIå±‚**ï¼šå°è£…Axioså®ç°ç»Ÿä¸€çš„APIè°ƒç”¨å’Œé”™è¯¯å¤„ç†
- **å“åº”å¼UIè®¾è®¡**ï¼šåŸºäºAnt Designçš„ç»„ä»¶åº“
- **äº‘ç«¯é›†æˆ**ï¼šé›†æˆè…¾è®¯äº‘COSå­˜å‚¨æœåŠ¡
- **å¯è®¿é—®æ€§æ”¯æŒ**ï¼šç¬¦åˆWCAG 2.1æ ‡å‡†ï¼ŒLighthouseå¯è®¿é—®æ€§å¾—åˆ†â‰¥90
- **å›½é™…åŒ–æ”¯æŒ**ï¼šä¸­è‹±æ–‡åŒè¯­åˆ‡æ¢ï¼Œè·¯ç”±å›½é™…åŒ–
- **å®‰å…¨é˜²æŠ¤**ï¼šXSSã€CSRFç­‰å®‰å…¨æªæ–½

## æŠ€æœ¯æ ˆæ¶æ„

```mermaid
graph TB
subgraph "å‰ç«¯æ¶æ„"
NextJS[Next.js 14<br/>App Router]
React[React 18.2]
Zustand[Zustand<br/>çŠ¶æ€ç®¡ç†]
AntD[Ant Design<br/>UIç»„ä»¶åº“]
Axios[Axios<br/>HTTPå®¢æˆ·ç«¯]
end
subgraph "æ„å»ºå·¥å…·"
TS[TypeScript]
ESLint[ESLint]
TailwindCSS[Tailwind CSS]
end
subgraph "ç¬¬ä¸‰æ–¹æœåŠ¡"
TencentCloud[è…¾è®¯äº‘<br/>COSå­˜å‚¨]
Payment[æ”¯ä»˜æœåŠ¡]
end
subgraph "æ–°åŠŸèƒ½æ¨¡å—"
A11y[å¯è®¿é—®æ€§ä¼˜åŒ–]
I18n[å›½é™…åŒ–æ”¯æŒ]
Security[å®‰å…¨é˜²æŠ¤]
end
NextJS --> React
NextJS --> Zustand
NextJS --> AntD
NextJS --> Axios
NextJS --> TS
NextJS --> ESLint
Axios --> TencentCloud
Axios --> Payment
NextJS --> A11y
NextJS --> I18n
NextJS --> Security
```

**å›¾è¡¨æ¥æº**
- [package.json](file://frontend/package.json#L10-L20)
- [next.config.js](file://frontend/next.config.js#L1-L21)
- [A11Y-P2-ACCESS-206-å¯è®¿é—®æ€§æŒ‡å—.md](file://frontend/A11Y-P2-ACCESS-206-å¯è®¿é—®æ€§æŒ‡å—.md)
- [I18N-P2-LOCALE-209-ä½¿ç”¨æŒ‡å—.md](file://frontend/I18N-P2-LOCALE-209-ä½¿ç”¨æŒ‡å—.md)

**ç« èŠ‚æ¥æº**
- [package.json](file://frontend/package.json#L1-L32)
- [next.config.js](file://frontend/next.config.js#L1-L21)

## Next.js App Router è·¯ç”±ç³»ç»Ÿ

### è·¯ç”±ç»“æ„è®¾è®¡

Next.js App Routeré‡‡ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯ç”±ï¼Œæ¯ä¸ªç›®å½•å¯¹åº”ä¸€ä¸ªè·¯ç”±è·¯å¾„ï¼Œæ”¯æŒåŠ¨æ€è·¯ç”±å’ŒåµŒå¥—è·¯ç”±ã€‚

```mermaid
graph TD
Root["/"] --> Home["é¦–é¡µ<br/>page.tsx"]
Root --> Login["ç™»å½•<br/>login/page.tsx"]
Root --> Workspace["å·¥ä½œå°<br/>workspace/page.tsx"]
Root --> Membership["ä¼šå‘˜<br/>membership/page.tsx"]
Root --> Task["ä»»åŠ¡ç®¡ç†<br/>task/"]
Task --> Basic["åŸºç¡€ä¿®å›¾<br/>basic/page.tsx"]
Task --> Model["AIæ¨¡ç‰¹<br/>model/page.tsx"]
Task --> History["å†å²è®°å½•<br/>history/page.tsx"]
Task --> Detail["ä»»åŠ¡è¯¦æƒ…<br/>[taskId]/page.tsx"]
Root --> Layout["å¸ƒå±€<br/>layout.tsx"]
Root --> Styles["å…¨å±€æ ·å¼<br/>globals.css"]
```

**å›¾è¡¨æ¥æº**
- [layout.tsx](file://frontend/src/app/layout.tsx#L1-L26)
- [login/page.tsx](file://frontend/src/app/login/page.tsx#L1-L210)
- [workspace/page.tsx](file://frontend/src/app/workspace/page.tsx#L1-L332)

### åŠ¨æ€è·¯ç”±å®ç°

åŠ¨æ€è·¯ç”±é€šè¿‡æ–¹æ‹¬å·è¯­æ³•å®ç°ï¼Œä¾‹å¦‚ `[taskId]` è¡¨ç¤ºåŠ¨æ€å‚æ•°ã€‚

**ç« èŠ‚æ¥æº**
- [task/[taskId]/page.tsx](file://frontend/src/app/task/[taskId]/page.tsx#L1-L364)

### è·¯ç”±å®ˆå«æœºåˆ¶

é¡¹ç›®å®ç°äº†åŸºäºçŠ¶æ€ç®¡ç†çš„è·¯ç”±å®ˆå«ï¼Œåœ¨é¡µé¢ç»„ä»¶ä¸­æ£€æŸ¥ç”¨æˆ·è®¤è¯çŠ¶æ€ï¼š

```mermaid
flowchart TD
PageLoad["é¡µé¢åŠ è½½"] --> CheckAuth["æ£€æŸ¥è®¤è¯çŠ¶æ€"]
CheckAuth --> IsLoggedIn{"æ˜¯å¦å·²ç™»å½•?"}
IsLoggedIn --> |æ˜¯| AllowAccess["å…è®¸è®¿é—®"]
IsLoggedIn --> |å¦| RedirectLogin["é‡å®šå‘åˆ°ç™»å½•é¡µ"]
AllowAccess --> RenderPage["æ¸²æŸ“é¡µé¢å†…å®¹"]
RedirectLogin --> LoginPage["ç™»å½•é¡µé¢"]
```

**å›¾è¡¨æ¥æº**
- [workspace/page.tsx](file://frontend/src/app/workspace/page.tsx#L40-L50)
- [page.tsx](file://frontend/src/app/page.tsx#L10-L20)

**ç« èŠ‚æ¥æº**
- [workspace/page.tsx](file://frontend/src/app/workspace/page.tsx#L40-L50)
- [page.tsx](file://frontend/src/app/page.tsx#L10-L20)

## çŠ¶æ€ç®¡ç†æ¶æ„

### Zustand Store è®¾è®¡

é¡¹ç›®ä½¿ç”¨Zustandå®ç°è½»é‡çº§çŠ¶æ€ç®¡ç†ï¼Œä¸»è¦ç®¡ç†ç”¨æˆ·è®¤è¯çŠ¶æ€å’Œå…¨å±€æ•°æ®ã€‚

```mermaid
classDiagram
class AuthState {
+User user
+string token
+setAuth(user, token) void
+clearAuth() void
+updateUser(userData) void
}
class AuthStore {
+useAuthStore Hook
+persist middleware
+localStorage storage
}
AuthStore --> AuthState : "ç®¡ç†"
AuthState --> User : "åŒ…å«"
```

**å›¾è¡¨æ¥æº**
- [authStore.ts](file://frontend/src/store/authStore.ts#L5-L15)

### çŠ¶æ€ç®¡ç†æ¨¡å¼

çŠ¶æ€ç®¡ç†éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š
1. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªstoreä¸“æ³¨ç‰¹å®šé¢†åŸŸ
2. **æŒä¹…åŒ–**ï¼šä½¿ç”¨persistä¸­é—´ä»¶å®ç°æœ¬åœ°å­˜å‚¨
3. **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
4. **å“åº”å¼æ›´æ–°**ï¼šè‡ªåŠ¨è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“

**ç« èŠ‚æ¥æº**
- [authStore.ts](file://frontend/src/store/authStore.ts#L1-L43)

## APIè°ƒç”¨å±‚è®¾è®¡

### APIClient æ¶æ„

APIè°ƒç”¨å±‚é‡‡ç”¨ç±»å°è£…æ¨¡å¼ï¼Œæä¾›ç»Ÿä¸€çš„æ¥å£å’Œé”™è¯¯å¤„ç†ã€‚

```mermaid
classDiagram
class APIClient {
-AxiosInstance client
+constructor()
+auth AuthEndpoints
+membership MembershipEndpoints
+task TaskEndpoints
+media MediaEndpoints
+admin AdminEndpoints
}
class AuthEndpoints {
+sendCode(phone) Promise
+login(phone, code) Promise
+me() Promise
}
class TaskEndpoints {
+create(data) Promise
+get(taskId) Promise
+list(params) Promise
}
class MediaEndpoints {
+getSTS(taskId) Promise
}
APIClient --> AuthEndpoints : "åŒ…å«"
APIClient --> TaskEndpoints : "åŒ…å«"
APIClient --> MediaEndpoints : "åŒ…å«"
```

**å›¾è¡¨æ¥æº**
- [api.ts](file://frontend/src/lib/api.ts#L10-L50)

### è¯·æ±‚æ‹¦æˆªå™¨è®¾è®¡

```mermaid
sequenceDiagram
participant Component as "Reactç»„ä»¶"
participant API as "APIClient"
participant Interceptor as "è¯·æ±‚æ‹¦æˆªå™¨"
participant Backend as "åç«¯API"
Component->>API : å‘èµ·APIè¯·æ±‚
API->>Interceptor : è¯·æ±‚æ‹¦æˆª
Interceptor->>Interceptor : ä»localStorageè·å–token
Interceptor->>Interceptor : è®¾ç½®Authorizationå¤´
Interceptor->>Backend : å‘é€å¸¦tokençš„è¯·æ±‚
Backend-->>Interceptor : è¿”å›å“åº”
Interceptor-->>API : è¿”å›å¤„ç†åçš„å“åº”
API-->>Component : è¿”å›æœ€ç»ˆç»“æœ
```

**å›¾è¡¨æ¥æº**
- [api.ts](file://frontend/src/lib/api.ts#L25-L40)

### é”™è¯¯å¤„ç†æœºåˆ¶

APIå±‚å®ç°äº†å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

1. **401æœªæˆæƒå¤„ç†**ï¼šè‡ªåŠ¨æ¸…é™¤tokenå¹¶é‡å®šå‘åˆ°ç™»å½•é¡µ
2. **ç½‘ç»œé”™è¯¯å¤„ç†**ï¼šæä¾›å‹å¥½çš„é”™è¯¯æç¤º
3. **ä¸šåŠ¡é”™è¯¯å¤„ç†**ï¼šè¿”å›å…·ä½“çš„é”™è¯¯ç å’Œæ¶ˆæ¯

**ç« èŠ‚æ¥æº**
- [api.ts](file://frontend/src/lib/api.ts#L1-L118)

## é¡µé¢ç»„ä»¶æ¶æ„

### ç»„ä»¶å±‚æ¬¡ç»“æ„

```mermaid
graph TD
Layout["RootLayout<br/>æ ¹å¸ƒå±€"] --> Page["å…·ä½“é¡µé¢ç»„ä»¶"]
Page --> AuthGuard["è®¤è¯å®ˆå«"]
Page --> BusinessLogic["ä¸šåŠ¡é€»è¾‘"]
Page --> UIComponents["UIç»„ä»¶"]
AuthGuard --> Login["ç™»å½•é¡µé¢"]
AuthGuard --> Workspace["å·¥ä½œå°é¡µé¢"]
AuthGuard --> TaskDetail["ä»»åŠ¡è¯¦æƒ…é¡µé¢"]
BusinessLogic --> API["APIè°ƒç”¨"]
BusinessLogic --> Store["çŠ¶æ€ç®¡ç†"]
UIComponents --> AntD["Ant Designç»„ä»¶"]
UIComponents --> Custom["è‡ªå®šä¹‰ç»„ä»¶"]
```

**å›¾è¡¨æ¥æº**
- [layout.tsx](file://frontend/src/app/layout.tsx#L15-L25)
- [login/page.tsx](file://frontend/src/app/login/page.tsx#L15-L30)

### é¡µé¢ç»„ä»¶è®¾è®¡æ¨¡å¼

æ¯ä¸ªé¡µé¢ç»„ä»¶éƒ½éµå¾ªä»¥ä¸‹è®¾è®¡æ¨¡å¼ï¼š

1. **å®¢æˆ·ç«¯ç»„ä»¶æ ‡è®°**ï¼šä½¿ç”¨ `'use client'` å£°æ˜
2. **çŠ¶æ€ç®¡ç†é›†æˆ**ï¼šé€šè¿‡hooksè®¿é—®å…¨å±€çŠ¶æ€
3. **APIè°ƒç”¨å°è£…**ï¼šç»Ÿä¸€çš„APIè°ƒç”¨å…¥å£
4. **é”™è¯¯è¾¹ç•Œå¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶

**ç« èŠ‚æ¥æº**
- [login/page.tsx](file://frontend/src/app/login/page.tsx#L1-L210)
- [task/[taskId]/page.tsx](file://frontend/src/app/task/[taskId]/page.tsx#L1-L364)

## å¯å¤ç”¨UIç»„ä»¶è®¾è®¡

### ImageUploader ç»„ä»¶æ¶æ„

ImageUploaderæ˜¯ä¸€ä¸ªé«˜åº¦å¯é…ç½®çš„å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ï¼Œæ”¯æŒå¤šç§åŠŸèƒ½ï¼š

```mermaid
classDiagram
class ImageUploader {
+string taskId
+function onUploadSuccess
+function onUploadError
+number maxSize
+string[] accept
+useState uploading
+useState progress
+useState fileList
+beforeUpload(file) boolean
+customUpload(options) Promise
+handleChange(info) void
}
class COS {
+putObject(config, callback) void
+getAuthorization(options, callback) void
}
ImageUploader --> COS : "ä½¿ç”¨"
ImageUploader --> Upload : "ä¾èµ–Ant Design"
```

**å›¾è¡¨æ¥æº**
- [ImageUploader.tsx](file://frontend/src/components/ImageUploader.tsx#L15-L50)

### ç»„ä»¶è®¾è®¡åŸåˆ™

1. **é…ç½®åŒ–**ï¼šé€šè¿‡propsæä¾›çµæ´»çš„é…ç½®é€‰é¡¹
2. **äº‹ä»¶é©±åŠ¨**ï¼šæä¾›ä¸Šä¼ æˆåŠŸçš„å›è°ƒå‡½æ•°
3. **çŠ¶æ€ç®¡ç†**ï¼šå†…éƒ¨ç»´æŠ¤ä¸Šä¼ çŠ¶æ€å’Œè¿›åº¦
4. **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯æ•è·å’Œç”¨æˆ·åé¦ˆ

**ç« èŠ‚æ¥æº**
- [ImageUploader.tsx](file://frontend/src/components/ImageUploader.tsx#L1-L198)

## æ ·å¼ç³»ç»Ÿä¸å¸ƒå±€

### å…¨å±€æ ·å¼è®¾è®¡

å…¨å±€æ ·å¼é‡‡ç”¨æœ€å°åŒ–ç­–ç•¥ï¼Œä»…å®šä¹‰åŸºç¡€çš„å­—ä½“å’Œç›’æ¨¡å‹è®¾ç½®ï¼š

```css
/* åŸºç¡€æ ·å¼è§„åˆ™ */
body {
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

* {
  box-sizing: border-box;
}
```

**ç« èŠ‚æ¥æº**
- [globals.css](file://frontend/src/app/globals.css#L1-L14)

### å¸ƒå±€ç³»ç»Ÿ

å¸ƒå±€ç³»ç»Ÿé‡‡ç”¨Ant Designçš„æ …æ ¼ç³»ç»Ÿï¼Œé…åˆFlexboxå®ç°å“åº”å¼è®¾è®¡ï¼š

```mermaid
graph LR
Container["å®¹å™¨å¸ƒå±€"] --> Grid["æ …æ ¼ç³»ç»Ÿ"]
Grid --> Responsive["å“åº”å¼æ–­ç‚¹"]
Responsive --> Flex["Flexboxå¸ƒå±€"]
Container --> Spacing["é—´è·ç³»ç»Ÿ"]
Spacing --> Theme["ä¸»é¢˜å˜é‡"]
Theme --> Consistency["ä¸€è‡´æ€§è®¾è®¡"]
```

**å›¾è¡¨æ¥æº**
- [workspace/page.tsx](file://frontend/src/app/workspace/page.tsx#L150-L200)

## è®¤è¯ä¸æƒé™æ§åˆ¶

### è®¤è¯æµç¨‹è®¾è®¡

```mermaid
sequenceDiagram
participant User as "ç”¨æˆ·"
participant Login as "ç™»å½•é¡µé¢"
participant API as "APIæœåŠ¡"
participant Store as "çŠ¶æ€ç®¡ç†"
participant Protected as "å—ä¿æŠ¤é¡µé¢"
User->>Login : è¾“å…¥æ‰‹æœºå·
User->>Login : ç‚¹å‡»è·å–éªŒè¯ç 
Login->>API : å‘é€éªŒè¯ç è¯·æ±‚
API-->>Login : éªŒè¯ç å‘é€æˆåŠŸ
Login->>Login : å¯åŠ¨å€’è®¡æ—¶
User->>Login : è¾“å…¥éªŒè¯ç 
User->>Login : æäº¤ç™»å½•è¡¨å•
Login->>API : éªŒè¯ç™»å½•è¯·æ±‚
API-->>Login : è¿”å›ç”¨æˆ·ä¿¡æ¯å’Œtoken
Login->>Store : æ›´æ–°å…¨å±€çŠ¶æ€
Login->>Protected : é‡å®šå‘åˆ°å·¥ä½œå°
```

**å›¾è¡¨æ¥æº**
- [login/page.tsx](file://frontend/src/app/login/page.tsx#L30-L80)
- [authStore.ts](file://frontend/src/store/authStore.ts#L15-L35)

### æƒé™æ§åˆ¶æœºåˆ¶

1. **è·¯ç”±çº§åˆ«ä¿æŠ¤**ï¼šé€šè¿‡çŠ¶æ€ç®¡ç†æ£€æŸ¥ç”¨æˆ·è®¤è¯çŠ¶æ€
2. **åŠŸèƒ½çº§åˆ«æ§åˆ¶**ï¼šæ ¹æ®ä¼šå‘˜çŠ¶æ€é™åˆ¶åŠŸèƒ½ä½¿ç”¨
3. **APIçº§åˆ«ä¿æŠ¤**ï¼šé€šè¿‡tokenéªŒè¯ç¡®ä¿æ¥å£å®‰å…¨

**ç« èŠ‚æ¥æº**
- [login/page.tsx](file://frontend/src/app/login/page.tsx#L30-L80)
- [workspace/page.tsx](file://frontend/src/app/workspace/page.tsx#L40-L60)

## å¼€å‘æœ€ä½³å®è·µ

### ç±»å‹å®‰å…¨è®¾è®¡

é¡¹ç›®é‡‡ç”¨å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰ï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡ï¼š

```mermaid
graph TD
Types["ç±»å‹å®šä¹‰"] --> Interfaces["æ¥å£å®šä¹‰"]
Types --> Enums["æšä¸¾ç±»å‹"]
Types --> Unions["è”åˆç±»å‹"]
Interfaces --> User["Useræ¥å£"]
Interfaces --> Task["Taskæ¥å£"]
Interfaces --> Membership["MembershipStatusæ¥å£"]
Enums --> TaskStatus["ä»»åŠ¡çŠ¶æ€æšä¸¾"]
Enums --> TaskType["ä»»åŠ¡ç±»å‹æšä¸¾"]
Unions --> APIResponse["APIå“åº”è”åˆç±»å‹"]
```

**å›¾è¡¨æ¥æº**
- [index.ts](file://frontend/src/types/index.ts#L1-L43)

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

1. **ç»„ä»¶æ‡’åŠ è½½**ï¼šåˆ©ç”¨Next.jsçš„è‡ªåŠ¨ä»£ç åˆ†å‰²
2. **çŠ¶æ€ç®¡ç†ä¼˜åŒ–**ï¼šä½¿ç”¨Zustandå‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“
3. **å›¾ç‰‡ä¼˜åŒ–**ï¼šé…ç½®Next.jså›¾ç‰‡ä¼˜åŒ–åŠŸèƒ½
4. **APIç¼“å­˜**ï¼šåˆç†ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜å’ŒCDN

### å¼€å‘ç¯å¢ƒé…ç½®

é¡¹ç›®é…ç½®äº†å®Œå–„çš„å¼€å‘ç¯å¢ƒï¼š

- **TypeScript**ï¼šæä¾›ç±»å‹å®‰å…¨ä¿éšœ
- **ESLint**ï¼šä»£ç è´¨é‡æ£€æŸ¥
- **Prettier**ï¼šä»£ç æ ¼å¼åŒ–
- **Next.js DevTools**ï¼šå¼€å‘è°ƒè¯•å·¥å…·

**ç« èŠ‚æ¥æº**
- [package.json](file://frontend/package.json#L15-L32)
- [next.config.js](file://frontend/next.config.js#L1-L21)

## å¯è®¿é—®æ€§ä¼˜åŒ–æŒ‡å—

### æ¦‚è¿°

é¡¹ç›®å·²å®æ–½å…¨é¢çš„å¯è®¿é—®æ€§ä¼˜åŒ–ï¼Œç›®æ ‡æ˜¯å…³é”®è·¯å¾„Lighthouseå¯è®¿é—®æ€§å¾—åˆ†â‰¥90ã€‚

**ç« èŠ‚æ¥æº**
- [A11Y-P2-ACCESS-206-å¯è®¿é—®æ€§æŒ‡å—.md](file://frontend/A11Y-P2-ACCESS-206-å¯è®¿é—®æ€§æŒ‡å—.md)

### ESLintå¯è®¿é—®æ€§æ£€æŸ¥

å·²é…ç½® `eslint-plugin-jsx-a11y` æ’ä»¶ï¼Œè‡ªåŠ¨æ£€æŸ¥å¯è®¿é—®æ€§é—®é¢˜ã€‚

**æ£€æŸ¥å‘½ä»¤**:
```bash
npm run lint          # æ£€æŸ¥ä»£ç 
npm run lint:fix      # è‡ªåŠ¨ä¿®å¤éƒ¨åˆ†é—®é¢˜
```

**ä¸»è¦è§„åˆ™**:
- âœ… å›¾ç‰‡å¿…é¡»æœ‰ alt å±æ€§
- âœ… æŒ‰é’®å’Œé“¾æ¥å¿…é¡»æœ‰å¯è®¿é—®çš„å†…å®¹
- âœ… è¡¨å•å…ƒç´ å¿…é¡»æœ‰å…³è”çš„æ ‡ç­¾
- âœ… ARIA å±æ€§å¿…é¡»æ­£ç¡®ä½¿ç”¨
- âœ… äº¤äº’å…ƒç´ å¿…é¡»æ”¯æŒé”®ç›˜æ“ä½œ
- âœ… é¢œè‰²å¯¹æ¯”åº¦å¿…é¡»ç¬¦åˆæ ‡å‡†

**ç« èŠ‚æ¥æº**
- [A11Y-P2-ACCESS-206-å¯è®¿é—®æ€§æŒ‡å—.md](file://frontend/A11Y-P2-ACCESS-206-å¯è®¿é—®æ€§æŒ‡å—.md#L11-L30)

### å¯è®¿é—®æ€§å·¥å…·åº“

**ä½ç½®**: `src/lib/accessibility/index.ts`

#### é”®ç›˜å¯¼èˆªé’©å­
```tsx
import { useKeyboardNavigation } from '@/lib/accessibility';

function MyComponent() {
  const { handleKeyDown } = useKeyboardNavigation({
    onUp: () => console.log('ä¸Š'),
    onDown: () => console.log('ä¸‹'),
    onEnter: () => console.log('ç¡®è®¤'),
    onEscape: () => console.log('å–æ¶ˆ'),
  });

  return <div onKeyDown={handleKeyDown}>å¯é”®ç›˜æ“ä½œçš„ç»„ä»¶</div>;
}
```

#### ç„¦ç‚¹é™·é˜± (Focus Trap)
```tsx
import { useFocusTrap } from '@/lib/accessibility';
import { useRef, useEffect } from 'react';

function Modal() {
  const modalRef = useRef<HTMLDivElement>(null);
  const { trapFocus } = useFocusTrap(modalRef);

  useEffect(() => {
    const cleanup = trapFocus();
    return cleanup;
  }, []);

  return (
    <div ref={modalRef} role="dialog" aria-modal="true">
      <h2>æ¨¡æ€æ¡†æ ‡é¢˜</h2>
      <button>æŒ‰é’®1</button>
      <button>æŒ‰é’®2</button>
    </div>
  );
}
```

**ç« èŠ‚æ¥æº**
- [src/lib/accessibility/index.tsx](file://frontend/src/lib/accessibility/index.tsx#L6-L100)

### å¯è®¿é—®æ€§æ ·å¼

**ä½ç½®**: `src/styles/accessibility.css`

#### å±å¹•é˜…è¯»å™¨ä¸“ç”¨æ ·å¼
```css
/* è§†è§‰éšè—ï¼Œä½†å±å¹•é˜…è¯»å™¨å¯è¯» */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* è·å¾—ç„¦ç‚¹æ—¶æ˜¾ç¤ºï¼ˆç”¨äº"è·³è¿‡å¯¼èˆª"é“¾æ¥ï¼‰ */
.sr-only-focusable:focus {
  position: static;
  width: auto;
  height: auto;
  padding: var(--spacing-sm) var(--spacing-md);
  margin: 0;
  overflow: visible;
  clip: auto;
  white-space: normal;
  background-color: var(--color-primary);
  color: white;
  z-index: 9999;
}
```

#### ç»Ÿä¸€ç„¦ç‚¹æ ·å¼
- 2px è“è‰²è¾¹æ¡†
- 2px åç§»é‡
- 4px è“è‰²åŠé€æ˜é˜´å½±

**ç« èŠ‚æ¥æº**
- [src/styles/accessibility.css](file://frontend/src/styles/accessibility.css#L6-L32)

### Lighthouseè‡ªåŠ¨åŒ–æ£€æŸ¥

**è„šæœ¬ä½ç½®**: `scripts/lighthouse-a11y.js`

#### è¿è¡Œæ£€æŸ¥
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œæ£€æŸ¥
npm run a11y:check
```

#### æŸ¥çœ‹æŠ¥å‘Š
æ£€æŸ¥å®Œæˆåï¼Œè¯¦ç»†æŠ¥å‘Šä¿å­˜åœ¨ `lighthouse-reports/` ç›®å½•ã€‚

**ç« èŠ‚æ¥æº**
- [scripts/lighthouse-a11y.js](file://frontend/scripts/lighthouse-a11y.js#L1-L200)

### è·³è¿‡å¯¼èˆªé“¾æ¥

å·²åœ¨æ ¹å¸ƒå±€ä¸­æ·»åŠ "è·³è¿‡å¯¼èˆª"é“¾æ¥ï¼š

```tsx
// src/app/layout.tsx
<a href="#main-content" className="sr-only-focusable">
  è·³è¿‡å¯¼èˆªï¼Œç›´è¾¾ä¸»å†…å®¹
</a>

<main id="main-content" tabIndex={-1}>
  {children}
</main>
```

**ç« èŠ‚æ¥æº**
- [layout.tsx](file://frontend/src/app/layout.tsx#L47-L50)

## å›½é™…åŒ–ä½¿ç”¨æŒ‡å—

### æ¦‚è¿°

é¡¹ç›®å·²é›†æˆ `next-intl` åº“ï¼Œæ”¯æŒä¸­è‹±æ–‡åŒè¯­åˆ‡æ¢å’Œè·¯ç”±å›½é™…åŒ–ã€‚

**ç« èŠ‚æ¥æº**
- [I18N-P2-LOCALE-209-ä½¿ç”¨æŒ‡å—.md](file://frontend/I18N-P2-LOCALE-209-ä½¿ç”¨æŒ‡å—.md)

### åŠŸèƒ½ç‰¹æ€§

- **åŒè¯­æ”¯æŒ**ï¼šä¸­æ–‡ï¼ˆç®€ä½“ï¼‰å’Œè‹±æ–‡
- **è‡ªåŠ¨æ£€æµ‹**ï¼šæ ¹æ®æµè§ˆå™¨è¯­è¨€è‡ªåŠ¨é€‰æ‹©
- **è·¯ç”±å›½é™…åŒ–**ï¼šURL åŒ…å«è¯­è¨€ä»£ç ï¼ˆ/zhã€/enï¼‰
- **æŒä¹…åŒ–**ï¼šè¯­è¨€é€‰æ‹©ä¿å­˜åˆ° localStorage
- **ç±»å‹å®‰å…¨**ï¼šTypeScript æ”¯æŒ
- **SSR æ”¯æŒ**ï¼šæœåŠ¡ç«¯æ¸²æŸ“å‹å¥½

**ç« èŠ‚æ¥æº**
- [I18N-P2-LOCALE-209-ä½¿ç”¨æŒ‡å—.md](file://frontend/I18N-P2-LOCALE-209-ä½¿ç”¨æŒ‡å—.md#L24-L32)

### ç¿»è¯‘æ–‡ä»¶ç»“æ„

**ä¸­æ–‡ç¿»è¯‘**: `src/i18n/messages/zh.json`
**è‹±æ–‡ç¿»è¯‘**: `src/i18n/messages/en.json`

```json
{
  "common": {
    "appName": "AIè¡£æŸœ",
    "appDescription": "ä¸“ä¸šçš„æœè£…å›¾ç‰‡AIå¤„ç†æœåŠ¡"
  },
  "nav": {
    "home": "é¦–é¡µ",
    "workspace": "å·¥ä½œå°"
  }
}
```

**ç« èŠ‚æ¥æº**
- [src/i18n/messages/zh.json](file://frontend/src/i18n/messages/zh.json#L1-L204)

### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

#### å®¢æˆ·ç«¯ç»„ä»¶
```tsx
'use client';

import { useTranslations } from 'next-intl';

export default function LoginForm() {
  const t = useTranslations('auth');

  return (
    <form>
      <label>{t('username')}</label>
      <input placeholder={t('username')} />
      <label>{t('password')}</label>
      <input type="password" placeholder={t('password')} />
      <button>{t('login')}</button>
    </form>
  );
}
```

#### æœåŠ¡ç«¯ç»„ä»¶
```tsx
import { getTranslations } from 'next-intl/server';

export default async function HomePage() {
  const t = await getTranslations('common');

  return (
    <div>
      <h1>{t('appName')}</h1>
      <p>{t('appDescription')}</p>
    </div>
  );
}
```

**ç« èŠ‚æ¥æº**
- [I18N-P2-LOCALE-209-ä½¿ç”¨æŒ‡å—.md](file://frontend/I18N-P2-LOCALE-209-ä½¿ç”¨æŒ‡å—.md#L172-L210)

### è¯­è¨€åˆ‡æ¢å™¨

```tsx
'use client';

import { useLocale } from 'next-intl';
import { useRouter, usePathname } from 'next/navigation';
import { Select } from 'antd';
import { GlobalOutlined } from '@ant-design/icons';

const languages = [
  { value: 'zh', label: 'ç®€ä½“ä¸­æ–‡', flag: 'ğŸ‡¨ğŸ‡³' },
  { value: 'en', label: 'English', flag: 'ğŸ‡ºğŸ‡¸' },
];

export default function LanguageSwitcher() {
  const locale = useLocale();
  const router = useRouter();
  const pathname = usePathname();

  const handleChange = (newLocale: string) => {
    // ä¿å­˜åˆ° localStorage
    if (typeof window !== 'undefined') {
      localStorage.setItem('locale', newLocale);
    }

    // æ›¿æ¢ URL ä¸­çš„è¯­è¨€ä»£ç 
    const newPathname = pathname.replace(`/${locale}`, `/${newLocale}`);
    router.push(newPathname);
  };

  return (
    <Select
      value={locale}
      onChange={handleChange}
      style={{ width: 150 }}
      suffixIcon={<GlobalOutlined />}
      options={languages.map((lang) => ({
        value: lang.value,
        label: (
          <span>
            {lang.flag} {lang.label}
          </span>
        ),
      }))}
    />
  );
}
```

**ç« èŠ‚æ¥æº**
- [src/components/LanguageSwitcher.tsx](file://frontend/src/components/LanguageSwitcher.tsx#L1-L53)

### è·¯ç”±å›½é™…åŒ–

```text
/zh/                       # ä¸­æ–‡é¦–é¡µ
/zh/workspace              # ä¸­æ–‡å·¥ä½œå°
/zh/templates              # ä¸­æ–‡æ¨¡æ¿ä¸­å¿ƒ

/en/                       # è‹±æ–‡é¦–é¡µ
/en/workspace              # è‹±æ–‡å·¥ä½œå°
/en/templates              # è‹±æ–‡æ¨¡æ¿ä¸­å¿ƒ
```

**ç« èŠ‚æ¥æº**
- [I18N-P2-LOCALE-209-ä½¿ç”¨æŒ‡å—.md](file://frontend/I18N-P2-LOCALE-209-ä½¿ç”¨æŒ‡å—.md#L348-L359)

## å®‰å…¨é˜²æŠ¤æŒ‡å—

### æ¦‚è¿°

é¡¹ç›®å·²å®æ–½å…¨é¢çš„å®‰å…¨é˜²æŠ¤æªæ–½ï¼ŒåŒ…æ‹¬XSSã€CSRFç­‰é˜²æŠ¤ã€‚

**ç« èŠ‚æ¥æº**
- [docs/security.md](file://frontend/docs/security.md)

### XSSé˜²æŠ¤

1. **è¾“å…¥éªŒè¯**ï¼šå¯¹æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡ŒéªŒè¯å’Œæ¸…ç†
2. **è¾“å‡ºç¼–ç **ï¼šåœ¨æ¸²æŸ“å‰å¯¹åŠ¨æ€å†…å®¹è¿›è¡ŒHTMLç¼–ç 
3. **Content Security Policy**ï¼šé…ç½®ä¸¥æ ¼çš„CSPç­–ç•¥

### CSRFé˜²æŠ¤

1. **CSRF Token**ï¼šåœ¨è¡¨å•å’ŒAPIè¯·æ±‚ä¸­åŒ…å«CSRF token
2. **SameSite Cookie**ï¼šè®¾ç½®Cookieçš„SameSiteå±æ€§ä¸ºStrictæˆ–Lax
3. **Refereræ£€æŸ¥**ï¼šéªŒè¯è¯·æ±‚æ¥æº

### å…¶ä»–å®‰å…¨æªæ–½

1. **HTTPSå¼ºåˆ¶**ï¼šæ‰€æœ‰è¯·æ±‚å¿…é¡»é€šè¿‡HTTPS
2. **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**ï¼šä¸åœ¨å®¢æˆ·ç«¯å­˜å‚¨æ•æ„Ÿä¿¡æ¯
3. **é”™è¯¯å¤„ç†**ï¼šä¸æš´éœ²æ•æ„Ÿé”™è¯¯ä¿¡æ¯

**ç« èŠ‚æ¥æº**
- [docs/security.md](file://frontend/docs/security.md)

## æ€»ç»“

æœ¬å‰ç«¯æ¶æ„è®¾è®¡ä½“ç°äº†ç°ä»£Webå¼€å‘çš„æœ€ä½³å®è·µï¼š

### æ ¸å¿ƒä¼˜åŠ¿

1. **æ¶æ„æ¸…æ™°**ï¼šé‡‡ç”¨åˆ†å±‚æ¶æ„ï¼ŒèŒè´£åˆ†æ˜
2. **æŠ€æœ¯å…ˆè¿›**ï¼šä½¿ç”¨æœ€æ–°çš„Next.js App Routerå’ŒTypeScript
3. **å¼€å‘é«˜æ•ˆ**ï¼šå®Œå–„çš„ç±»å‹ç³»ç»Ÿå’ŒçŠ¶æ€ç®¡ç†
4. **ç”¨æˆ·ä½“éªŒ**ï¼šæµç•…çš„äº¤äº’å’Œå“åº”å¼è®¾è®¡
5. **å¯ç»´æŠ¤æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡å’Œè‰¯å¥½çš„ä»£ç ç»„ç»‡
6. **å¯è®¿é—®æ€§**ï¼šç¬¦åˆWCAG 2.1æ ‡å‡†ï¼Œæ”¯æŒå±å¹•é˜…è¯»å™¨å’Œé”®ç›˜å¯¼èˆª
7. **å›½é™…åŒ–**ï¼šä¸­è‹±æ–‡åŒè¯­æ”¯æŒï¼Œè·¯ç”±å›½é™…åŒ–
8. **å®‰å…¨æ€§**ï¼šå…¨é¢çš„XSSã€CSRFç­‰å®‰å…¨é˜²æŠ¤

### æŠ€æœ¯ç‰¹è‰²

- **å£°æ˜å¼ç¼–ç¨‹**ï¼šReactå’ŒZustandçš„ç»„åˆ
- **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
- **å¼‚æ­¥å¤„ç†**ï¼šPromiseå’Œasync/awaitçš„è§„èŒƒä½¿ç”¨
- **é”™è¯¯å¤„ç†**ï¼šå¤šå±‚æ¬¡çš„é”™è¯¯å¤„ç†æœºåˆ¶
- **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆç†çš„çŠ¶æ€ç®¡ç†å’Œèµ„æºåŠ è½½ç­–ç•¥
- **å¯è®¿é—®æ€§**ï¼šESLintæ£€æŸ¥ã€å·¥å…·åº“ã€Lighthouseè‡ªåŠ¨åŒ–æµ‹è¯•
- **å›½é™…åŒ–**ï¼šnext-intlé›†æˆï¼Œç¿»è¯‘æ–‡ä»¶ç»“æ„æ¸…æ™°
- **å®‰å…¨é˜²æŠ¤**ï¼šXSSã€CSRFç­‰å…¨é¢é˜²æŠ¤æªæ–½

### æ‰©å±•æ€§è€ƒè™‘

æ¶æ„è®¾è®¡å……åˆ†è€ƒè™‘äº†æœªæ¥çš„æ‰©å±•éœ€æ±‚ï¼š
- **æ¨¡å—åŒ–**ï¼šæ˜“äºæ·»åŠ æ–°çš„åŠŸèƒ½æ¨¡å—
- **æ’ä»¶åŒ–**ï¼šå¯æ’å…¥æ–°çš„ä¸­é—´ä»¶å’ŒæœåŠ¡
- **é…ç½®åŒ–**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†ä¸åŒç¯å¢ƒ
- **æµ‹è¯•å‹å¥½**ï¼šæ¸…æ™°çš„ä¾èµ–å…³ç³»ä¾¿äºå•å…ƒæµ‹è¯•
- **å¯è®¿é—®æ€§æ‰©å±•**ï¼šæ”¯æŒæ·»åŠ æ›´å¤šè¯­è¨€å’Œå¯è®¿é—®æ€§åŠŸèƒ½
- **å›½é™…åŒ–æ‰©å±•**ï¼šæ˜“äºæ·»åŠ æ–°çš„è¯­è¨€æ”¯æŒ
- **å®‰å…¨æ‰©å±•**ï¼šå¯é›†æˆæ›´å¤šå®‰å…¨æ£€æµ‹å·¥å…·

è¿™å¥—å‰ç«¯æ¶æ„ä¸ºAIæœè£…å¤„ç†å¹³å°æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ï¼Œèƒ½å¤Ÿæ”¯æ’‘ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•å’ŒåŠŸèƒ½çš„æŒç»­è¿­ä»£ã€‚