ä¸‹é¢æ˜¯ä¸ºä½ çš„â€œ0åŸºç¡€ AI ååŒå¼€å‘ç³»ç»Ÿâ€é‡èº«è®¾è®¡çš„ä¸€æ•´å¥—æ–¹æ¡ˆã€‚æˆ‘å°†å†…å®¹æŒ‰ä½ å»ºè®®çš„ 5 ä¸ªæ–‡ä»¶ç»„ç»‡ï¼Œè¦†ç›–ç³»ç»Ÿæ¶æ„ã€Product Planner è¯¦ç»†è®¾è®¡ã€æ‰§è¡Œéƒ¨é—¨è®¾è®¡ã€Skills æ‰‹å†Œå¤§çº²ä»¥åŠå®æ–½è·¯çº¿å›¾ã€‚æ¯ä¸ªæ–‡ä»¶éƒ½åŒ…å«è®¾è®¡æ€è·¯ã€å®ç°æ–¹æ¡ˆï¼ˆå« JSON Schema / æµç¨‹å›¾ / ç¤ºä¾‹ï¼‰ã€é£é™©ä¸åº”å¯¹ã€æœ€ä½³å®è·µã€‚ä½ å¯ä»¥ç›´æ¥å°†è¿™äº›å†…å®¹è½åˆ°ä½ çš„ skills/ ç›®å½•ä¸ orchestrator ä¸­ä½¿ç”¨ã€‚

---

## æ–‡ä»¶1ï¼šç³»ç»Ÿæ¶æ„è®¾è®¡.mdï¼ˆç¬¬ä¸€éƒ¨åˆ†ï¼‰

### 1. è®¾è®¡æ€»è§ˆ

**ç›®æ ‡**ï¼šè®© 0 åŸºç¡€ç”¨æˆ·åƒå¯¹çœŸå®å…¬å¸è¯´è¯ä¸€æ ·ï¼Œç”¨è‡ªç„¶è¯­è¨€æè¿°ç›®æ ‡ï¼Œç³»ç»Ÿè‡ªåŠ¨å®Œæˆæ¾„æ¸…ã€è§„åˆ’ã€æ‹†åˆ†ã€æ‰§è¡Œã€åä½œã€å®¡æŸ¥ã€éªŒæ”¶ä¸äº¤ä»˜ã€‚

**æ ¸å¿ƒç†å¿µ**ï¼šå±‚çº§åŒ–ã€å¥‘çº¦åŒ–ã€æ ‡å‡†åŒ–ã€è‡ªæ²»åŒ–ï¼ˆå„éƒ¨é—¨èƒ½â€œæŒ‰ç« æ€è€ƒâ€ï¼Œè€Œéâ€œæœºæ¢°æ‰§è¡Œâ€ï¼‰ã€‚

#### 1.1 è§’è‰²ä¸å±‚çº§

* **Bossï¼ˆç”¨æˆ·ï¼‰**ï¼šåªæè¿°ä¸šåŠ¡ç›®æ ‡ä¸çº¦æŸï¼ˆæˆæœ¬/æ—¶é—´/åˆè§„ï¼‰ï¼Œä¸å…³å¿ƒå®ç°ç»†èŠ‚ã€‚
* **Product Plannerï¼ˆPï¼‰**ï¼š**å”¯ä¸€é»˜è®¤å¯ä¸»åŠ¨ç”Ÿæˆä»»åŠ¡å¡çš„ä¸Šçº§**ã€‚è´Ÿè´£æ¾„æ¸…â†’åˆ†æâ†’è§„åˆ’â†’æ‹†åˆ†â†’ç»Ÿç­¹åä½œâ†’é‡Œç¨‹ç¢‘ä¸é£é™©ç®¡ç†ã€‚
* **æ‰§è¡Œä¸­å±‚éƒ¨é—¨**ï¼šBackendã€Frontendã€SCFã€QAã€Deployã€Billing Guardã€‚

  * æ¥å—å¹¶â€œ**è®¤é¢†**â€ä»»åŠ¡å¡ï¼ˆä¸æ˜¯è¢«åŠ¨æ‰§è¡Œï¼‰ã€‚æ¯ä¸ªéƒ¨é—¨éƒ½åŒ…å«ï¼š**ç†è§£ â†’ è®¾è®¡ â†’ å®æ–½ â†’ è‡ªæµ‹ â†’ æ±‡æŠ¥**ã€‚
* **Reviewerï¼ˆç‰¹æƒè§’è‰²ï¼‰**ï¼šå®¡æŸ¥æ‰€æœ‰éƒ¨é—¨äº§å‡ºï¼›**ä»…åœ¨å‘ç°ç¼ºé™·æ—¶**å¯ç­¾å‘**ä¿®å¤ç±»ä»»åŠ¡å¡**ç»™ç›¸å…³éƒ¨é—¨ã€‚
* **ï¼ˆå¯é€‰ï¼‰è½»é‡å·¥ä½œå­ä»£ç†**ï¼šç”¨äºå¤„ç†ç®€å•/æ‰¹é‡åŒ–å­ä»»åŠ¡ï¼ˆå¦‚ç¼–å†™æ ·æ¿ä»£ç ã€ç”Ÿæˆå•æµ‹ã€è„šæ‰‹æ¶è„šæœ¬ï¼‰ï¼Œæ¥å—æ¥è‡ªä¸­å±‚éƒ¨é—¨çš„æ´¾å‘ã€‚

> **æ²»ç†åŸåˆ™**ï¼š
>
> * Planner æ˜¯â€œæºå¤´ä»»åŠ¡å¡â€å”¯ä¸€äº§å‡ºæ–¹ï¼›
> * Reviewer æ˜¯â€œä¿®å¤ä»»åŠ¡å¡â€å”¯ä¸€äº§å‡ºæ–¹ï¼›
> * å…¶ä½™éƒ¨é—¨ä¸å¯æ“…è‡ªé€ å¡ï¼Œåªèƒ½æå‡º**å˜æ›´è¯·æ±‚ï¼ˆChange Requestï¼‰**æˆ–**æ¾„æ¸…è¯·æ±‚ï¼ˆClarification Requestï¼‰**ã€‚

#### 1.2 ç»„ç»‡ä¸æµç¨‹å›¾

**ç»„ç»‡ç»“æ„å›¾ï¼ˆMermaidï¼‰**

```mermaid
graph TD
  Boss[Boss / 0åŸºç¡€ç”¨æˆ·] --> P[Product Planner]
  P --> B[Backend Dept]
  P --> F[Frontend Dept]
  P --> S[SCF Dept]
  P --> Q[QA Acceptance]
  P --> D[Deploy / Ops]
  P --> BG[Billing Guard]
  P --> R[Reviewer]
  B -.å¯æŒ‡æ´¾-> L1B[è½»é‡å­ä»£ç†-åç«¯]
  F -.å¯æŒ‡æ´¾-> L1F[è½»é‡å­ä»£ç†-å‰ç«¯]
  S -.å¯æŒ‡æ´¾-> L1S[è½»é‡å­ä»£ç†-äº‘å‡½æ•°]
```

**ç«¯åˆ°ç«¯æ—¶åºï¼ˆMermaidï¼‰**

```mermaid
sequenceDiagram
  participant Boss
  participant P as Product Planner
  participant B as Backend
  participant F as Frontend
  participant S as SCF
  participant Q as QA
  participant R as Reviewer
  participant D as Deploy
  participant BG as Billing Guard

  Boss->>P: è¯´éœ€æ±‚ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰
  P->>Boss: å…³é”®æ¾„æ¸… â‰¤ 8é—® + å‡è®¾å£°æ˜
  Boss-->>P: å›ç­”ï¼ˆæˆ–è¶…æ—¶æœªç­”ï¼‰
  P->>P: æ·±åº¦åˆ†æä¸æŠ€æœ¯é€‰å‹ã€æ¶æ„
  P->>BG: ç²—ç•¥æˆæœ¬/æ—¶é•¿é¢„ä¼°å®¡è®¡
  P->>P: ä»»åŠ¡å¡æ‹†åˆ†ï¼ˆæŒ‰éƒ¨é—¨ã€4-12å°æ—¶/å¡ï¼‰
  P->>B: CMS-B-001..nï¼ˆåç«¯ï¼‰
  P->>F: CMS-F-001..nï¼ˆå‰ç«¯ï¼‰
  P->>S: CMS-S-001..nï¼ˆäº‘å‡½æ•°ï¼‰
  par å¼€å‘é˜¶æ®µ
    B-->>F: OpenAPIå¥‘çº¦/äº‹ä»¶é€šçŸ¥
    F->>B: æ¥å£æ¾„æ¸…/å˜æ›´è¯·æ±‚
    B->>R: PRå®¡æŸ¥è¯·æ±‚
    F->>R: PRå®¡æŸ¥è¯·æ±‚
    S->>R: PRå®¡æŸ¥è¯·æ±‚
    R-->>B: ä¿®å¤å¡ CMS-B-016ï¼ˆå¦‚æœ‰ï¼‰
    R-->>F: ä¿®å¤å¡ CMS-F-011ï¼ˆå¦‚æœ‰ï¼‰
  end
  Q->>B: ç¼ºé™·å•ï¼ˆå¦‚æœ‰ï¼‰
  Q->>F: ç¼ºé™·å•ï¼ˆå¦‚æœ‰ï¼‰
  Q->>S: ç¼ºé™·å•ï¼ˆå¦‚æœ‰ï¼‰
  Q->>P: éªŒæ”¶æŠ¥å‘Šï¼ˆé€šè¿‡/ä¸é€šè¿‡ï¼‰
  D->>P: éƒ¨ç½²æ–¹æ¡ˆä¸ä¸Šçº¿å•
  P->>Boss: å¯äº¤ä»˜æ¼”ç¤ºä¸éªŒæ”¶
```

---

### 2. ä»»åŠ¡å¡æ ‡å‡†æ ¼å¼ï¼ˆJSON Schemaï¼‰

**è®¾è®¡åŸåˆ™**

* **å¥‘çº¦åŒ–**ï¼šæ‰€æœ‰éƒ¨é—¨æŒ‰åŒä¸€ä»½ JSON Schema æ²Ÿé€šï¼Œé¿å…è¯­ä¹‰æ¼‚ç§»ã€‚
* **å¯æ‰§è¡Œ**ï¼šåŒ…å« Prompt å»ºè®®ã€æµ‹è¯•å‡†åˆ™ã€ä¾èµ–ã€äº¤ä»˜ç‰©è·¯å¾„ç­‰ï¼Œä¾¿äºè‡ªåŠ¨åŒ–ã€‚
* **å¯æ²»ç†**ï¼šåŒ…å«é¢„ç®—ä¸Šé™ã€é£é™©ç­‰çº§ã€å®¡æ ¸é—¨ç¦ï¼ˆReviewer/QA Gateï¼‰ã€‚

**Schemaï¼ˆDraft 2020-12ï¼‰**

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/task-card.json",
  "title": "TaskCard",
  "type": "object",
  "required": [
    "taskId", "projectId", "module", "title", "department",
    "phase", "priority", "estimatedHours", "description",
    "acceptanceCriteria", "deliverables", "createdByRole",
    "status", "reviewPolicy", "qaPolicy"
  ],
  "properties": {
    "taskId": {
      "type": "string",
      "pattern": "^[A-Z0-9\\-]+$",
      "description": "å¦‚ CMS-B-001ã€‚ç”Ÿæˆè§„åˆ™ï¼š<é¡¹ç›®>-<éƒ¨é—¨é¦–å­—æ¯>-<æµæ°´å·>"
    },
    "projectId": { "type": "string", "description": "é¡¹ç›®å”¯ä¸€æ ‡è¯†ï¼Œå¦‚ CMS" },
    "module": { "type": "string", "description": "åŠŸèƒ½æ¨¡å—åï¼Œå¦‚ content-type-builder" },
    "title": { "type": "string" },
    "department": {
      "type": "string",
      "enum": ["Backend", "Frontend", "SCF", "QA", "Deploy", "Reviewer", "BillingGuard"]
    },
    "phase": {
      "type": "string",
      "enum": ["Clarify", "Planning", "MVP", "Beta", "Hardening", "Release"]
    },
    "priority": { "type": "string", "enum": ["P0", "P1", "P2"] },
    "riskLevel": { "type": "string", "enum": ["Low", "Medium", "High"], "default": "Medium" },
    "estimatedHours": { "type": "number", "minimum": 1, "maximum": 16 },
    "dueDate": { "type": "string", "format": "date-time" },
    "dependencies": {
      "type": "array",
      "items": { "type": "string", "pattern": "^[A-Z0-9\\-]+$" },
      "description": "ä¾èµ–ä»»åŠ¡å¡IDåˆ—è¡¨"
    },
    "description": { "type": "string", "description": "äººè¯»å¯æ‡‚çš„ä»»åŠ¡è¯´æ˜" },
    "technicalRequirements": {
      "type": "array",
      "items": { "type": "string" },
      "description": "æŠ€æœ¯çº¦æŸ/è¦æ±‚è¦ç‚¹"
    },
    "apiContract": {
      "type": "object",
      "description": "å½“éƒ¨é—¨=Backend/SCFæ—¶çš„æ¥å£å¥‘çº¦è‰æ¡ˆæˆ–OpenAPIè·¯å¾„",
      "properties": {
        "openapiPath": { "type": "string" },
        "changePolicy": { "type": "string" }
      }
    },
    "dbDesign": {
      "type": "object",
      "description": "æ•°æ®åº“è¡¨/ç´¢å¼•/ERå…³é”®ç‚¹ï¼ˆåç«¯ä»»åŠ¡å¯ç”¨ï¼‰",
      "properties": {
        "tables": { "type": "array", "items": { "type": "string" } },
        "indexes": { "type": "array", "items": { "type": "string" } }
      }
    },
    "uiSpecs": {
      "type": "object",
      "description": "å½“éƒ¨é—¨=Frontendæ—¶çš„UIæè¿°/åŸå‹é“¾æ¥/ç»„ä»¶çº¦æŸ",
      "properties": {
        "screens": { "type": "array", "items": { "type": "string" } },
        "designSystem": { "type": "string", "default": "Ant Design" }
      }
    },
    "acceptanceCriteria": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "statement", "type"],
        "properties": {
          "id": { "type": "string" },
          "type": { "type": "string", "enum": ["Functional", "NonFunctional", "Security"] },
          "statement": { "type": "string", "description": "Given-When-Then æˆ–æ–­è¨€æ–‡å­—" },
          "testHints": { "type": "string", "description": "QA/è‡ªåŠ¨åŒ–çš„æµ‹æ³•æç¤º" }
        }
      }
    },
    "deliverables": {
      "type": "array",
      "items": { "type": "string" },
      "description": "æäº¤ç‰©ï¼Œå¦‚ä»£ç è·¯å¾„ã€è„šæœ¬ã€OpenAPIæ–‡ä»¶ã€æˆªå›¾ã€æµ‹è¯•æŠ¥å‘Š"
    },
    "needsCoordination": {
      "type": "array",
      "description": "è·¨éƒ¨é—¨åä½œç‚¹",
      "items": {
        "type": "object",
        "required": ["withDept", "topic", "artifact"],
        "properties": {
          "withDept": {
            "type": "string",
            "enum": ["Backend", "Frontend", "SCF", "QA", "Deploy", "Reviewer", "BillingGuard"]
          },
          "topic": { "type": "string" },
          "artifact": { "type": "string", "description": "å¦‚OpenAPIè·¯å¾„ã€UIåŸå‹é“¾æ¥" },
          "deadline": { "type": "string", "format": "date-time" }
        }
      }
    },
    "aiPromptSuggestion": {
      "type": "object",
      "required": ["system", "user"],
      "properties": {
        "system": { "type": "string" },
        "user": { "type": "string" },
        "notes": { "type": "string" }
      }
    },
    "assignment": {
      "type": "object",
      "properties": {
        "assigneeRole": { "type": "string" },
        "assigneeModel": { "type": "string", "description": "ç”¨äºæ‰§è¡Œçš„å…·ä½“æ¨¡å‹/å­ä»£ç†å" },
        "toolchain": { "type": "array", "items": { "type": "string" } },
        "env": { "type": "string", "description": "dev/stage/prod" }
      }
    },
    "reviewPolicy": {
      "type": "object",
      "required": ["requiresReviewer"],
      "properties": {
        "requiresReviewer": { "type": "boolean", "default": true },
        "reviewerRole": { "type": "string", "default": "Reviewer" },
        "gates": { "type": "array", "items": { "type": "string" }, "description": "å¦‚å®‰å…¨ã€æ€§èƒ½ã€å¯ç»´æŠ¤æ€§" }
      }
    },
    "qaPolicy": {
      "type": "object",
      "required": ["requiresQA"],
      "properties": {
        "requiresQA": { "type": "boolean", "default": true },
        "testDepth": { "type": "string", "enum": ["Smoke", "Regression", "Performance"], "default": "Smoke" },
        "coverageTarget": { "type": "number", "minimum": 0, "maximum": 100, "default": 80 }
      }
    },
    "budget": {
      "type": "object",
      "properties": {
        "estimatedCostUSD": { "type": "number", "minimum": 0 },
        "maxCostUSD": { "type": "number", "minimum": 0 },
        "costGuardTags": { "type": "array", "items": { "type": "string" } }
      }
    },
    "metrics": {
      "type": "object",
      "properties": {
        "successCriteria": { "type": "array", "items": { "type": "string" } },
        "telemetry": { "type": "array", "items": { "type": "string" } }
      }
    },
    "links": {
      "type": "object",
      "properties": {
        "repo": { "type": "string" },
        "branch": { "type": "string" },
        "pr": { "type": "string" },
        "issueTracker": { "type": "string" },
        "docs": { "type": "string" }
      }
    },
    "artifacts": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["type", "path"],
        "properties": {
          "type": { "type": "string" },
          "path": { "type": "string" },
          "checksum": { "type": "string" }
        }
      }
    },
    "createdByRole": { "type": "string", "enum": ["ProductPlanner", "Reviewer"] },
    "createdAt": { "type": "string", "format": "date-time" },
    "status": {
      "type": "string",
      "enum": ["Draft", "Ready", "Assigned", "InProgress", "Blocked", "ForReview", "ChangesRequested", "QA", "Done"]
    },
    "notes": { "type": "string" },
    "changeHistory": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["at", "by", "change"],
        "properties": {
          "at": { "type": "string", "format": "date-time" },
          "by": { "type": "string" },
          "change": { "type": "string" }
        }
      }
    }
  }
}
```

**ID å‘½åä¸æµæ°´**

* `<é¡¹ç›®ä»£å·>-<éƒ¨é—¨é¦–å­—æ¯>-<ä¸‰ä½æµæ°´>`ï¼Œå¦‚ `CMS-B-001`ã€‚
* éƒ¨é—¨é¦–å­—æ¯ï¼šB=Backend, F=Frontend, S=SCF, Q=QA, D=Deploy, R=Reviewerï¼ˆä¿®å¤å¡ï¼‰, G=BillingGuardï¼ˆä»…å®¡è®¡å¡ï¼‰ã€‚

**ç¤ºä¾‹ä»»åŠ¡å¡ï¼ˆBackendï¼‰**

```json
{
  "taskId": "CMS-B-001",
  "projectId": "CMS",
  "module": "content-type-builder",
  "title": "å»ºæ¨¡æ¥å£ï¼šå†…å®¹ç±»å‹ CRUD + å­—æ®µæ ¡éªŒ",
  "department": "Backend",
  "phase": "MVP",
  "priority": "P0",
  "riskLevel": "Medium",
  "estimatedHours": 8,
  "dependencies": [],
  "description": "å®ç°å†…å®¹ç±»å‹çš„åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤æ¥å£ï¼Œå¹¶æ”¯æŒå­—æ®µå®šä¹‰ï¼ˆæ–‡æœ¬ã€æ•°å€¼ã€å¸ƒå°”ã€æšä¸¾ã€å¼•ç”¨ï¼‰ä¸æ ¡éªŒè§„åˆ™ã€‚",
  "technicalRequirements": [
    "æ•°æ®åº“ï¼šPostgreSQL + Prisma",
    "APIï¼šRESTful + OpenAPI 3.0",
    "é‰´æƒï¼šJWT + RBACå ä½"
  ],
  "apiContract": {
    "openapiPath": "openapi/cms-content-type.yaml",
    "changePolicy": "ä»»ä½•Breakingå˜æ›´å¿…é¡»ç”±Frontendç¡®è®¤å¹¶è¿‡å®¡"
  },
  "dbDesign": {
    "tables": ["content_types", "content_fields", "migrations"],
    "indexes": ["content_types.slug UNIQUE", "content_fields.type+content_type_id"]
  },
  "acceptanceCriteria": [
    {
      "id": "AC1",
      "type": "Functional",
      "statement": "Given åˆ›å»ºå†…å®¹ç±»å‹è¯·æ±‚ When å­—æ®µå®šä¹‰åˆæ³• Then è¿”å›201ä¸”å†™å…¥DBå¹¶å¯æŸ¥è¯¢",
      "testHints": "å•æµ‹è¦†ç›–å­—æ®µç±»å‹ä¸æ ¡éªŒè§„åˆ™è¾¹ç•Œ"
    },
    {
      "id": "AC2",
      "type": "Security",
      "statement": "When æœªæˆæƒè¯·æ±‚åˆ›å»º Then è¿”å›401",
      "testHints": "é‰´æƒä¸­é—´ä»¶UT"
    }
  ],
  "deliverables": [
    "src/api/content-types/*.ts",
    "openapi/cms-content-type.yaml",
    "tests/content-types/*.spec.ts"
  ],
  "needsCoordination": [
    {
      "withDept": "Frontend",
      "topic": "å­—æ®µç»„ä»¶ä¸æ ¡éªŒæ˜ å°„",
      "artifact": "openapi/cms-content-type.yaml"
    }
  ],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯èµ„æ·±Nodeåç«¯å·¥ç¨‹å¸ˆï¼Œä¹ æƒ¯ä»¥TDDå¼€å‘ä¸OpenAPIå…ˆè¡Œã€‚",
    "user": "æ ¹æ®OpenAPIæ–‡ä»¶ç”ŸæˆCRUDæ§åˆ¶å™¨ä¸Prismaæ¨¡å‹ï¼Œå¹¶ä¿è¯å•æµ‹è¦†ç›–â‰¥80%ã€‚"
  },
  "assignment": { "assigneeRole": "Backend", "assigneeModel": "L1B", "toolchain": ["Node18", "Prisma", "Jest"] },
  "reviewPolicy": { "requiresReviewer": true, "gates": ["å®‰å…¨", "è§„èŒƒ"] },
  "qaPolicy": { "requiresQA": true, "testDepth": "Regression", "coverageTarget": 80 },
  "budget": { "estimatedCostUSD": 12, "maxCostUSD": 20, "costGuardTags": ["backend-mvp"] },
  "metrics": { "successCriteria": ["æ¥å£å¹³å‡P95<120ms"], "telemetry": ["/content-types/*"] },
  "links": { "repo": "git@repo/cms.git", "branch": "feature/content-type" },
  "artifacts": [],
  "createdByRole": "ProductPlanner",
  "createdAt": "2025-10-30T09:00:00Z",
  "status": "Ready"
}
```

---

### 3. éƒ¨é—¨èŒè´£è¾¹ç•Œ

**Product Planner**

* æƒé™ï¼šè§„åˆ’ã€æ‹†åˆ†ã€å‘å¡ï¼›åè°ƒï¼›é‡Œç¨‹ç¢‘ï¼›é£é™©/å˜æ›´ç®¡ç†ã€‚
* ç¦æ­¢ï¼šè·³è¿‡æ¾„æ¸…ç›´æ¥è§„åˆ’ï¼ˆé™¤éä½¿ç”¨**é»˜è®¤å‡è®¾**å¹¶è®°å½•ï¼‰ã€‚

**Backend**

* æƒé™ï¼šAPI/æ•°æ®å»ºæ¨¡ï¼›ç”Ÿæˆ OpenAPIï¼›æœåŠ¡æ€§èƒ½ä¼˜åŒ–ã€‚
* ç¦æ­¢ï¼šæ“…è‡ªå˜æ›´å‰ç«¯ä»£ç ï¼›æœªä¸ Frontend åå•†è¿›è¡Œ Breaking æ”¹åŠ¨ã€‚

**Frontend**

* æƒé™ï¼šUI/çŠ¶æ€ç®¡ç†ï¼›å¯¹æ¥ APIï¼›å‰ç«¯è·¯ç”±ä¸æƒé™æ§åˆ¶ã€‚
* ç¦æ­¢ï¼šç»•è¿‡åç«¯è‡ªè¡Œ mock å½±å“éªŒæ”¶ï¼›æ“…è‡ªä¿®æ”¹åç«¯å¥‘çº¦ã€‚

**SCF**

* æƒé™ï¼šäº‘å‡½æ•°ã€æ‰¹å¤„ç†ã€å¼‚æ­¥ä»»åŠ¡ã€COS å›è°ƒã€Webhookã€‚
* ç¦æ­¢ï¼šå°†æ ¸å¿ƒåŒæ­¥è·¯å¾„æ”¾å…¥ SCF é€ æˆå†·å¯åŠ¨ç“¶é¢ˆã€‚

**Reviewer**

* æƒé™ï¼šå®¡æŸ¥æ‰€æœ‰ PRï¼›å¯ç­¾å‘**ä¿®å¤ä»»åŠ¡å¡**ï¼ˆä»…é™ä¿®å¤/é‡æ„/å®‰å…¨åŠ å›ºï¼‰ã€‚
* ç¦æ­¢ï¼šè¶Šæƒæ–°å¢ä¸šåŠ¡éœ€æ±‚ä»»åŠ¡å¡ã€‚

**QA Acceptance**

* æƒé™ï¼šåˆ¶å®š/æ‰§è¡Œæµ‹è¯•ï¼›é˜»æ–­ä¸åˆæ ¼ä¸Šçº¿ï¼›å›å½’/æ€§èƒ½ã€‚
* ç¦æ­¢ï¼šè‡ªè¡Œä¿®æ”¹å®ç°ä»¥é€šè¿‡æµ‹è¯•ã€‚

**Deploy / Ops**

* æƒé™ï¼šCI/CDã€ç¯å¢ƒé…ç½®ã€ç›‘æ§å‘Šè­¦ã€å›æ»šç­–ç•¥ã€‚
* ç¦æ­¢ï¼šç»•è¿‡ QA/Reviewer é—¨ç¦ç›´æ¥ä¸Šçº¿ã€‚

**Billing Guard**

* æƒé™ï¼šæˆæœ¬åŸºçº¿ã€è¶…æ”¯æ‹¦æˆªã€æ¨¡å‹/è°ƒç”¨ç­–ç•¥å»ºè®®ã€‚
* ç¦æ­¢ï¼šå®¡æ‰¹åŠŸèƒ½éœ€æ±‚ï¼›åªèƒ½æå‡º**å®¡è®¡å»ºè®®å¡ï¼ˆG-...ï¼‰**ã€‚

---

### 4. åä½œæœºåˆ¶

**4.1 é€šçŸ¥ä¸å¥‘çº¦**

* Backend å®Œæˆæ¥å£ â†’ é€šè¿‡ **OpenAPI æ–‡ä»¶ + å˜æ›´æ—¥å¿—** é€šçŸ¥ Frontendï¼š

  * äº‹ä»¶ï¼š`API_CONTRACT_READY`ï¼ˆåŒ…å« openapiPathã€ç‰ˆæœ¬ã€Breaking å˜æ›´æ ‡è®°ï¼‰ã€‚
  * Frontend æ¥æ”¶åå›æ‰§ `API_CONTRACT_ACK`ï¼Œå¹¶åœ¨ä»»åŠ¡å¡ `needsCoordination` æ ‡è®°å®Œæˆã€‚

**4.2 å˜æ›´ä¸ç”³è¯·**

* Frontend å‘ç°æ¥å£ä¸è¶³ â†’ æäº¤ `Change Request`ï¼ˆCRï¼‰å¯¹è±¡ï¼Œå¼•ç”¨ä»»åŠ¡å¡IDï¼š

  * Planner è¯„ä¼°å½±å“ â†’ æ–°å¢/æ›´æ–°ç›¸åº”ä»»åŠ¡å¡æˆ–åˆå¹¶åˆ°å½“å‰å¡çš„ `changeHistory`ã€‚
  * Backend ä»…åœ¨ CR é€šè¿‡åæ”¹åŠ¨ã€‚

**4.3 Reviewer å‡ºå¡**

* å®¡æŸ¥ PR å‘ç° Bug/å®‰å…¨/æ€§èƒ½é—®é¢˜ â†’ ç”Ÿæˆ `ä¿®å¤ä»»åŠ¡å¡ï¼ˆRï¼‰`ï¼š

  * ä»…å…è®¸ `department` ä¸º `Backend/Frontend/SCF/Deploy`ã€‚
  * `phase` ç»§æ‰¿åŸä»»åŠ¡å¡ï¼›`priority` è‡³å°‘ç»´æŒåŸä¼˜å…ˆçº§ï¼›**å¯é˜»æ–­åˆå¹¶**ã€‚

**4.4 QA åé¦ˆå›è·¯**

* QA å‘ç°é—®é¢˜ â†’ è®°å½•ç¼ºé™·å•å¹¶å…³è”ä»»åŠ¡å¡/PR â†’ Planner å†³ç­–æ˜¯å¦ï¼š

  * è½¬ä¸º Reviewer ä¿®å¤å¡ï¼›
  * æˆ– Planner æ–°å‘ P0 è¿”å·¥å¡ï¼ˆå¦‚è®¾è®¡ç¼ºé™·ï¼‰ã€‚

**4.5 çŠ¶æ€æœºï¼ˆMermaidï¼‰**

```mermaid
stateDiagram-v2
  [*] --> Draft
  Draft --> Ready
  Ready --> Assigned
  Assigned --> InProgress
  InProgress --> Blocked
  InProgress --> ForReview
  ForReview --> ChangesRequested
  ChangesRequested --> InProgress
  ForReview --> QA
  QA --> Done
  Blocked --> InProgress
```

**æœ€ä½³å®è·µ**

* æ‰€æœ‰è·¨éƒ¨é—¨åä½œä»¥**å¥‘çº¦æ–‡ä»¶**ï¼ˆOpenAPIã€UI åŸå‹ã€äº‹ä»¶å¥‘çº¦ï¼‰ä¸ºä¸­å¿ƒï¼Œæ–‡å­—è¯´æ˜åªèƒ½ä½œä¸ºè¡¥å……ã€‚
* ä»»ä½• Breaking å˜æ›´å¿…é¡»äº§ç”Ÿæ—¥å¿—å¹¶ç» Frontend/QA åŒç¡®è®¤ã€‚

**é£é™©ä¸åº”å¯¹**

* **è¿‡åº¦æ‹†åˆ†** â†’ ä»»åŠ¡å¡ç²’åº¦æ§åˆ¶åœ¨ 4-12hï¼›Planner è´Ÿè´£åˆå¹¶è¿‡å°å¡ã€‚
* **åä½œå»¶è¿Ÿ** â†’ è®¾å®šåä½œç‚¹ deadlineï¼Œé€¾æœŸè‡ªåŠ¨å‡çº§åˆ° Plannerã€‚
* **æˆæœ¬å¤±æ§** â†’ Billing Guard æ¥å…¥é—¨ç¦ï¼šè¶…å‡º `maxCostUSD` æ—¶è‡ªåŠ¨æŒ‚èµ·å¹¶æç¤ºæ›¿ä»£ç­–ç•¥ï¼ˆå¦‚æ”¹ç”¨è½»é‡æ¨¡å‹æˆ–ç¼“å­˜ï¼‰ã€‚

---

## æ–‡ä»¶2ï¼šProduct Plannerè¯¦ç»†è®¾è®¡.mdï¼ˆç¬¬äºŒéƒ¨åˆ†ï¼‰

> æœ¬éƒ¨åˆ†ä¸ºç³»ç»Ÿæœ€è¯¦ç»†æ¨¡å—ï¼Œæ¶µç›–æ¾„æ¸…æœºåˆ¶ã€æ·±åº¦åˆ†æã€æ‹†åˆ†ç­–ç•¥ä¸æ ‡å‡†è¾“å‡ºã€‚ä½ å¯ä»¥ç›´æ¥å°†å…¶è½¬å†™ä¸º `product_planner_skill/*` çš„æ‰‹å†Œä¸æ‰§è¡Œé€»è¾‘ã€‚

### 5. éœ€æ±‚æ¾„æ¸…æœºåˆ¶

**5.1 ä½•æ—¶æ¾„æ¸…**

* **å¿…æ¾„æ¸…**ï¼š

  1. éœ€æ±‚å­˜åœ¨äºŒä¹‰æ€§ï¼ˆâ‰¥2 ä¸ªå¯è¡Œè§£é‡Šï¼‰ï¼›
  2. æŠ€æœ¯æ–¹æ¡ˆå½±å“æˆæœ¬/åˆè§„ï¼ˆå¦‚å­˜å‚¨æ•æ„Ÿæ•°æ®ã€ç¬¬ä¸‰æ–¹ä¾èµ–è®¸å¯ï¼‰ï¼›
  3. ä¸šåŠ¡ç›®æ ‡ä¸æ˜ç¡®ï¼ˆæˆåŠŸæ ‡å‡†ç¼ºå¤±ï¼‰ï¼›
  4. çº¦æŸç¼ºå¤±ï¼ˆé¢„ç®—/æ—¶é™/ç›®æ ‡ç”¨æˆ·è§„æ¨¡æœªçŸ¥ï¼‰ï¼›
  5. è·¨éƒ¨é—¨å¥‘çº¦ä¸å®Œæ•´ï¼ˆAPI/äº‹ä»¶/æƒé™è¾¹ç•Œæœªå®šä¹‰ï¼‰ã€‚

* **å¯è·³è¿‡**ï¼ˆ**å¿…é¡»è®°å½•å‡è®¾**ï¼‰ï¼š

  * å¯¹ MVP æ— å…³é”®å½±å“çš„å°ç»†èŠ‚ï¼›
  * å¯åç½®åˆ° Beta çš„å¢å€¼éœ€æ±‚ã€‚

**5.2 æé—®ç­–ç•¥ï¼šä»â€œä¸ºä»€ä¹ˆâ€åˆ°â€œæ€ä¹ˆåšâ€**

* **å±‚çº§åŒ–æé—®**ï¼ˆæœ€å¤š 5â€“8 é—®ï¼‰ï¼š

  1. **å•†ä¸šç›®æ ‡**ï¼šä¸ºä»€ä¹ˆè¦åšï¼Ÿç›®æ ‡ KPIï¼ŸæœŸæœ›ä¸Šçº¿æ—¶ç‚¹ï¼Ÿ
  2. **ç›®æ ‡ç”¨æˆ·/åœºæ™¯**ï¼šè°ç”¨ï¼Ÿç”¨å®ƒå®Œæˆä»€ä¹ˆä»»åŠ¡ï¼Ÿ
  3. **èŒƒå›´ä¸ä¼˜å…ˆçº§**ï¼šMVP å¿…é¡»æœ‰å“ªäº›èƒ½åŠ›ï¼Ÿå“ªäº›æ˜¯ P1/P2ï¼Ÿ
  4. **æ•°æ®ä¸åˆè§„**ï¼šå­˜ä»€ä¹ˆæ•°æ®ï¼Ÿæ˜¯å¦æ¶‰åŠéšç§/åˆè§„ï¼Ÿ
  5. **æˆæœ¬ä¸æ—¶é™**ï¼šé¢„ç®—ä¸Šé™/æœŸæœ›å‘¨æœŸï¼Ÿ
  6. **æŠ€æœ¯è¾¹ç•Œ**ï¼šæ˜¯å¦åå¥½è‡ªç ”/ä¸‰æ–¹/æ··åˆï¼Ÿå·²æœ‰èµ„äº§ï¼Ÿ
  7. **è¿è¥ä¸å¢é•¿**ï¼šå‘å¸ƒæ¸ é“/ç›‘æ§/æ•…éšœæ¢å¤ç­–ç•¥ï¼Ÿ
  8. **éªŒæ”¶å£å¾„**ï¼šä»€ä¹ˆç®—â€œå®Œæˆâ€ï¼Ÿæ¼”ç¤ºè·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ

> **æ§åˆ¶é—®æ•°**ï¼šä¼˜å…ˆè¦†ç›–é«˜é£é™©ç»´åº¦ï¼ˆç›®æ ‡ã€èŒƒå›´ã€åˆè§„ã€æˆæœ¬ï¼‰ï¼Œå…¶ä½™ä»¥é»˜è®¤å‡è®¾+å¯æ›´æ”¹ç­–ç•¥è½åœ°ã€‚

**5.3 è€æ¿ä¸å›ç­”çš„å¤„ç†**

* è®¾å®š**å“åº”æ—¶é™**ï¼ˆå¦‚ 30 åˆ†é’Ÿï¼‰åï¼ŒPlanner é‡‡ç”¨**é»˜è®¤å‡è®¾**ï¼ˆAssumption Registerï¼‰ç»§ç»­æ¨è¿›ï¼Œå¹¶åœ¨é¦–ä»½è¾“å‡ºä¸­æ˜¾è‘—æ ‡æ³¨ï¼š

  * å‡è®¾ç¼–å·ã€å†…å®¹ã€å½±å“èŒƒå›´ã€åˆ°æœŸå¤æ ¸ç‚¹ï¼ˆå¦‚ MVP å®Œæˆå‰å¿…é¡»ç¡®è®¤ï¼‰ã€‚
  * ç¤ºä¾‹ï¼š`A-001: ç”¨æˆ·è§„æ¨¡â‰¤1000ï¼Œæ•°æ®é©»ç•™åœ¨å›½å†…ï¼Œé»˜è®¤PGå•åº“ã€‚`

**5.4 æ¾„æ¸…è¾“å‡ºæ ¼å¼ï¼ˆç¤ºä¾‹ï¼‰**

```yaml
clarifications:
  askedAt: "2025-10-30T09:15:00Z"
  questions:
    - id: Q1
      topic: å•†ä¸šç›®æ ‡
      text: "æœ¬CMSçš„æ ¸å¿ƒKPIæ˜¯ä»€ä¹ˆï¼ˆä¸Šçº¿æ—¶é—´ã€é¢„è®¡å†…å®¹é‡ã€æ´»è·ƒç®¡ç†å‘˜æ•°ï¼‰ï¼Ÿ"
    - id: Q2
      topic: MVPèŒƒå›´
      text: "MVPæ˜¯å¦å¿…é¡»åŒ…å«å†…å®¹ç±»å‹å»ºæ¨¡ã€å†…å®¹é¡¹CRUDã€RBACä¸å‘å¸ƒå·¥ä½œæµï¼Ÿ"
    - id: Q3
      topic: åˆè§„
      text: "æ˜¯å¦å­˜å‚¨æ•æ„Ÿä¸ªäººä¿¡æ¯ï¼Ÿæ˜¯å¦æœ‰æ•°æ®é©»ç•™æˆ–å®¡è®¡è¦æ±‚ï¼Ÿ"
    - id: Q4
      topic: æˆæœ¬ä¸æ—¶é™
      text: "æˆæœ¬ä¸Šé™ä¸ç›®æ ‡å‘¨æœŸï¼ˆå‘¨ï¼‰æ˜¯å¤šå°‘ï¼Ÿ"
    - id: Q5
      topic: æŠ€æœ¯åå¥½
      text: "åå¥½è‡ªç ”ã€ç¬¬ä¸‰æ–¹ï¼ˆå¦‚æ‰˜ç®¡CMSï¼‰ï¼Œè¿˜æ˜¯æ··åˆï¼ˆè‡ªç ”æ ¸å¿ƒ+ä¸‰æ–¹å‘¨è¾¹ï¼‰ï¼Ÿ"
  assumptions:
    - id: A-001
      text: "MVP ç”¨æˆ·è§„æ¨¡â‰¤1000ï¼Œå†…å®¹ç±»å‹â‰¤20ï¼Œå•åŒºåŸŸéƒ¨ç½²ã€‚"
      reviewBy: "MVPå‰è¯„å®¡ä¼š"
    - id: A-002
      text: "æ— å¼ºåˆ¶åˆè§„è¦æ±‚ï¼Œå¯ä½¿ç”¨æ‰˜ç®¡å¯¹è±¡å­˜å‚¨ã€‚"
      reviewBy: "å®‰å…¨å®¡è®¡å‰"
```

---

### 6. æ·±åº¦åˆ†æèƒ½åŠ›

**6.1 ç”¨æˆ·ç—›ç‚¹ä¸å•†ä¸šä»·å€¼**

* å…¸å‹ç—›ç‚¹ï¼š

  * ä¸šåŠ¡åŒå­¦éœ€é¢‘ç¹é…ç½®â€œå†…å®¹æ¨¡å‹â€ï¼Œä½†å·¥ç¨‹åŒ–é—¨æ§›é«˜ï¼›
  * ä¼ ç»Ÿ CMS å¯æ‰©å±•æ€§å·®ï¼Œå®šåˆ¶æˆæœ¬é«˜ï¼›
  * æƒé™/å®¡è®¡/ç‰ˆæœ¬å›æ»šå¸¸è¢«å¿½ç•¥ã€‚
* ä»·å€¼è¯„ä¼°ï¼š

  * èŠ‚çœäººåŠ›æˆæœ¬ï¼ˆå¯¹æ¯”å¤–åŒ…/ä¼ ç»Ÿå›¢é˜Ÿå‘¨æœŸï¼‰ï¼›
  * å¿«é€Ÿè¯•é”™ï¼ˆMVPâ†’Betaâ†’Hardeningâ†’Releaseé˜¶æ¢¯ï¼‰ï¼›
  * **AI è¾…åŠ©**å¸¦æ¥â€œé…ç½®å³å¼€å‘â€ä½“éªŒï¼ˆä½é—¨æ§›ï¼‰ã€‚

**6.2 æŠ€æœ¯é€‰å‹ï¼ˆè‡ªç ” vs ä¸‰æ–¹ vs æ··åˆï¼‰**

* **è‡ªç ”**ï¼š

  * ä¼˜ç‚¹ï¼šå®Œå…¨å¯æ§ã€æ·±åº¦å®šåˆ¶ï¼›
  * é£é™©ï¼šç ”å‘å‘¨æœŸé•¿ã€ç»´æŠ¤æˆæœ¬é«˜ã€‚
* **ç¬¬ä¸‰æ–¹ï¼ˆæ‰˜ç®¡/å¼€æºï¼‰**ï¼š

  * ä¼˜ç‚¹ï¼šä¸Šçº¿å¿«ã€åŸºç¡€èƒ½åŠ›å®Œå¤‡ï¼›
  * é£é™©ï¼šäºŒæ¬¡å¼€å‘é™åˆ¶ã€æˆæœ¬/è®¸å¯ã€é”å®šæ•ˆåº”ã€‚
* **æ··åˆï¼ˆå»ºè®®ï¼‰**ï¼š

  * è‡ªç ”æ ¸å¿ƒï¼ˆå»ºæ¨¡ã€æƒé™ã€å·¥ä½œæµï¼‰+ ç¬¬ä¸‰æ–¹å‘¨è¾¹ï¼ˆå¯¹è±¡å­˜å‚¨ã€æœç´¢æœåŠ¡ã€é˜Ÿåˆ—/å‡½æ•°ï¼‰ã€‚
  * **é€‰æ‹©åŸåˆ™**ï¼šMVP å…ˆä¿è¯æ ¸å¿ƒï¼Œå‘¨è¾¹é‡‡ç”¨ç¨³å®šæœåŠ¡ä»¥ç¼©çŸ­äº¤ä»˜æ—¶é—´ä¸æˆæœ¬ã€‚

**6.3 æ¶æ„è®¾è®¡ï¼ˆç¤ºæ„ï¼‰**

* **åç«¯**ï¼šNode.js + Fastify/NestJS + Prisma + PostgreSQLã€‚
* **å‰ç«¯**ï¼šReact + Ant Design + Zustand + Vite + TypeScriptã€‚
* **SCF**ï¼šäº‘å‡½æ•°å¤„ç†å¤§æ–‡ä»¶ã€å¼‚æ­¥ä»»åŠ¡ã€COS å›è°ƒã€Webhookã€‚
* **API**ï¼šREST + OpenAPIï¼ˆå¥‘çº¦ä¼˜å…ˆï¼‰ï¼›Webhook äº‹ä»¶ï¼ˆå¦‚å‘å¸ƒã€å®¡æ ¸ï¼‰ã€‚
* **é‰´æƒ**ï¼šJWT + RBACï¼›ç®¡ç†å‘˜/ç¼–è¾‘/å®¡ç¨¿/è®¿å®¢è§’è‰²ã€‚
* **ç›‘æ§**ï¼šè¯·æ±‚å»¶è¿Ÿã€é”™è¯¯ç‡ã€å®¡è®¡æ—¥å¿—ï¼›
* **CI/CD**ï¼šåˆ†æ”¯ç­–ç•¥ï¼ˆfeature/ Beta/ releaseï¼‰ï¼ŒPR å¼ºåˆ¶ Reviewer/QA Gateã€‚

**6.4 é£é™©è¯†åˆ«ä¸å¯¹ç­–**

* **éœ€æ±‚è†¨èƒ€**ï¼šMVP-Firstï¼ŒP0 ä¸ P1/P2 ä¸¥æ ¼åˆ‡å‰²ã€‚
* **æ€§èƒ½ç“¶é¢ˆ**ï¼šå†…å®¹æ£€ç´¢ä¸ç‰ˆæœ¬å¯¹æ¯”å¼•å…¥ç¼“å­˜ä¸æœç´¢ç´¢å¼•ï¼ˆå¯åç½®åˆ° Betaï¼‰ã€‚
* **å®‰å…¨åˆè§„**ï¼šæƒé™çŸ©é˜µä¸å®¡è®¡æ—¥å¿—ä» MVP å°±ä¸Šçº¿ã€‚
* **äººæœºåä½œæˆæœ¬**ï¼šæ‰€æœ‰å¡ç‰‡å« Prompt å»ºè®®ä¸éªŒæ”¶å‡†åˆ™ï¼Œé™ä½ AI æ¨¡å‹åˆ‡æ¢æˆæœ¬ã€‚

---

### 7. ä»»åŠ¡å¡æ‹†åˆ†ç­–ç•¥

**7.1 æ‹†åˆ†åŸåˆ™**

* ç²’åº¦ï¼šæ¯å¡ 4â€“12 å°æ—¶ï¼›**é¿å…è¶… 12h**ï¼ˆæ‹†åˆ†ï¼‰**æˆ–å°‘äº 4h**ï¼ˆåˆå¹¶ï¼‰ã€‚
* æŒ‰**éƒ¨é—¨**ä¸**æ¨¡å—**åˆ†ç»„ï¼›æ˜¾å¼æ ‡å‡ºä¾èµ–ã€‚
* ä¼˜å…ˆçº§ï¼šP0ï¼ˆMVP å¿…é¡»ï¼‰ã€P1ï¼ˆé‡è¦ï¼‰ã€P2ï¼ˆä¼˜åŒ–/å¢å¼ºï¼‰ã€‚

**7.2 CMS å‚è€ƒæ‹†åˆ†ï¼ˆç¤ºä¾‹ï¼‰**

* **Backendï¼ˆ15 å¡ç¤ºæ„ï¼‰**

  * CMS-B-001 å†…å®¹ç±»å‹ CRUDï¼ˆP0ï¼‰
  * CMS-B-002 å†…å®¹é¡¹ CRUDï¼ˆP0ï¼‰
  * CMS-B-003 å­—æ®µæ ¡éªŒä¸ç´¢å¼•ç­–ç•¥ï¼ˆP0ï¼‰
  * CMS-B-004 ç‰ˆæœ¬ä¸å‘å¸ƒçŠ¶æ€æœºï¼ˆP0ï¼‰
  * CMS-B-005 RBAC åŸºç¡€ï¼ˆP0ï¼‰
  * CMS-B-006 å®¡è®¡æ—¥å¿—ï¼ˆP1ï¼‰
  * CMS-B-007 Webhookï¼ˆå‘å¸ƒ/å›æ»šï¼‰ï¼ˆP1ï¼‰
  * CMS-B-008 åª’ä½“åº“å…ƒæ•°æ®ï¼ˆP1ï¼‰
  * CMS-B-009 æœç´¢æŸ¥è¯¢DSLï¼ˆP2ï¼‰
  * CMS-B-010 å¯¼å…¥å¯¼å‡ºï¼ˆP2ï¼‰
  * CMS-B-011 i18n å¤šè¯­è¨€æ”¯æŒï¼ˆP2ï¼‰
  * CMS-B-012 å¥åº·æ£€æŸ¥/æŒ‡æ ‡ï¼ˆP0ï¼‰
  * CMS-B-013 API é€Ÿç‡é™åˆ¶ä¸ç¼“å­˜ï¼ˆP1ï¼‰
  * CMS-B-014 æ•°æ®è¿ç§»è„šæœ¬ï¼ˆP0ï¼‰
  * CMS-B-015 é”™è¯¯æ˜ å°„ä¸ç»Ÿä¸€è¿”å›ï¼ˆP0ï¼‰

* **Frontendï¼ˆ10 å¡ç¤ºæ„ï¼‰**

  * CMS-F-001 ç™»å½•/æƒé™è·¯ç”±ï¼ˆP0ï¼‰
  * CMS-F-002 å†…å®¹ç±»å‹å»ºæ¨¡ UIï¼ˆP0ï¼‰
  * CMS-F-003 å†…å®¹é¡¹åˆ—è¡¨/è¯¦æƒ…/ç¼–è¾‘ï¼ˆP0ï¼‰
  * CMS-F-004 å­—æ®µç»„ä»¶åº“ï¼ˆP0ï¼‰
  * CMS-F-005 å‘å¸ƒå·¥ä½œæµå¯è§†åŒ–ï¼ˆP1ï¼‰
  * CMS-F-006 åª’ä½“åº“ç•Œé¢ï¼ˆP1ï¼‰
  * CMS-F-007 å®¡è®¡æ—¥å¿—è§†å›¾ï¼ˆP1ï¼‰
  * CMS-F-008 é”™è¯¯ä¸åŠ è½½æ€è§„èŒƒï¼ˆP0ï¼‰
  * CMS-F-009 å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆZustandï¼‰ï¼ˆP0ï¼‰
  * CMS-F-010 å›½é™…åŒ–åˆ‡æ¢ï¼ˆP2ï¼‰

* **SCFï¼ˆ5 å¡ç¤ºæ„ï¼‰**

  * CMS-S-001 åª’ä½“ä¸Šä¼ ç›´ä¼ ç­¾åï¼ˆP0ï¼‰
  * CMS-S-002 COS å›è°ƒå…ƒæ•°æ®å†™å…¥ï¼ˆP0ï¼‰
  * CMS-S-003 å¼‚æ­¥è½¬ç /ç¼©ç•¥å›¾ï¼ˆP1ï¼‰
  * CMS-S-004 Webhook è½¬å‘ä¸é‡è¯•ï¼ˆP1ï¼‰
  * CMS-S-005 å¤§æ–‡ä»¶å¯¼å…¥ä»»åŠ¡ç¼–æ’ï¼ˆP2ï¼‰

* **QAï¼ˆ3 å¡ç¤ºæ„ï¼‰**

  * CMS-Q-001 å†’çƒŸç”¨ä¾‹é›†ï¼ˆP0ï¼‰
  * CMS-Q-002 å›å½’æµ‹è¯•ç¼–æ’ï¼ˆP1ï¼‰
  * CMS-Q-003 æ€§èƒ½åŸºå‡†ï¼ˆP2ï¼‰

* **Reviewerï¼ˆ2 å¡ç¤ºæ„ï¼‰**

  * CMS-R-001 åç«¯è§„èŒƒåŸºçº¿å®¡æŸ¥
  * CMS-R-002 å‰ç«¯å¯è®¿é—®æ€§å®¡æŸ¥

**7.3 ä¾èµ–ä¸é¡ºåº**

* F-002 ä¾èµ– B-001ï¼›F-003 ä¾èµ– B-002ï¼›
* S-001/002 ä¾èµ–å­˜å‚¨é…ç½®ä¸ RBACï¼›
* QA å¡åœ¨å„æ¨¡å—å®Œæˆåæ¨è¿›ï¼›
* Review å¡è´¯ç©¿ PR èŠ‚ç‚¹ã€‚

**7.4 AI Prompt é™„å¸¦ç­–ç•¥**

* æ¯å¼ ä»»åŠ¡å¡æä¾› `aiPromptSuggestion`ï¼Œé€šè¿‡**ç³»ç»Ÿæç¤º + ç”¨æˆ·æç¤º**çš„åŒæ®µå¼æ¨¡æ¿ï¼Œç¡®ä¿ä¸åŒæ¨¡å‹æ¥æ‰‹ä»æœ‰ä¸€è‡´æ€§ã€‚

---

### 8. Product Planner çš„æ ‡å‡†è¾“å‡ºæ ¼å¼

**8.1 è¾“å‡ºç»“æ„ï¼ˆYAML ç¤ºä¾‹ï¼‰**

```yaml
spec:
  background: |
    æˆ‘ä»¬è¦æ„å»ºä¸€ä¸ªé¢å‘ä¸šåŠ¡è¿è¥å›¢é˜Ÿçš„CMSï¼Œç›®æ ‡æ˜¯...
  goals:
    - MVPåœ¨4å‘¨å†…å¯æ¼”ç¤ºï¼šæ¨¡å‹-å†…å®¹-å‘å¸ƒé—­ç¯
    - ç®¡ç†å‘˜ â‰¤ 5 äººï¼Œå†…å®¹ç±»å‹ â‰¤ 20
  userFlow:
    - "ç®¡ç†å‘˜ç™»å½• â†’ å»ºæ¨¡ â†’ åˆ›å»ºå†…å®¹ â†’ å®¡æ ¸å‘å¸ƒ â†’ å¯¹å¤–è¯»å–"
  techChoices:
    backend: "Node + Fastify + Prisma + Postgres"
    frontend: "React + Ant Design + Zustand + Vite"
    scf: "COSå›è°ƒ + å¼‚æ­¥è½¬ç "
    reason: "MVP å¿«é€Ÿå¯æ§ï¼Œåç»­å¯æ‰©å±•"
  architecture:
    api: "REST+OpenAPI"
    auth: "JWT+RBAC"
    storage: "å¯¹è±¡å­˜å‚¨+CDN"
  risks:
    - "æƒé™çŸ©é˜µå¤æ‚ â†’ MVP ä»…å®ç°ä¸‰è§’è‰²"
    - "å¤§æ–‡ä»¶å¤„ç†è€—æ—¶ â†’ ä¸‹æ”¾SCFå¼‚æ­¥"
  tasks:
    Backend:
      - CMS-B-001 ...
      - CMS-B-002 ...
    Frontend:
      - CMS-F-001 ...
    SCF: [...]
    QA: [...]
    Reviewer: [...]
  timeline:
    week1: ["è§„åˆ’ä¸åŸºç¡€æ¨¡å‹", "B-001, B-002, F-001, F-008, B-012, B-015"]
    week2: ["å»ºæ¨¡UI/å†…å®¹é¡¹CRUD", "B-003, F-002, F-003"]
    week3: ["RBAC/å‘å¸ƒæµ/åª’ä½“", "B-004, B-005, S-001, S-002, F-005, F-006"]
    week4: ["QA/ä¼˜åŒ–/éƒ¨ç½²", "Q-001, Q-002, D-*"]
  acceptance:
    demoPath: "ä»åˆ›å»ºæ¨¡å‹åˆ°å‘å¸ƒå†…å®¹çš„ç«¯åˆ°ç«¯æ¼”ç¤ºè„šæœ¬"
```

**8.2 æœ€ä½³å®è·µ**

* è¾“å‡ºä¸­ **Assumption Register** å¿…é¡»ç‹¬ç«‹ç« èŠ‚ï¼Œæ ‡æ³¨éªŒè¯é‡Œç¨‹ç¢‘ã€‚
* `tasks` ä¸€å¾‹æŒ‰éƒ¨é—¨åˆ†ç»„ï¼Œå¡ç‰‡ ID è¿ç»­ä¸”å”¯ä¸€ã€‚
* ä¸º `week1-4` å®‰æ’**è·¨éƒ¨é—¨å¯å¹¶è¡Œ**çš„å¡ï¼Œå‡å°‘ä¸²è¡Œç­‰å¾…ã€‚

---

## æ–‡ä»¶3ï¼šæ‰§è¡Œéƒ¨é—¨è®¾è®¡.mdï¼ˆç¬¬ä¸‰éƒ¨åˆ†ï¼‰

### 9. Backend Dev èƒ½åŠ›è®¾è®¡

**9.1 èƒ½åŠ›æ¸…å•**

* é˜…è¯»/ç†è§£ä»»åŠ¡å¡ â†’ ç”ŸæˆæŠ€æœ¯æ–¹æ¡ˆï¼ˆAPI å¥‘çº¦ã€DB è®¾è®¡ã€é‰´æƒæ–¹æ¡ˆã€è¿ç§»è„šæœ¬ï¼‰ã€‚
* å®æ–½ï¼šæŒ‰ç…§ OpenAPI ç”Ÿæˆæ§åˆ¶å™¨/æœåŠ¡/ä»“å‚¨å±‚ï¼›Prisma Schemaï¼›äº‹åŠ¡/ç´¢å¼•ä¼˜åŒ–ã€‚
* è´¨é‡ï¼šå•æµ‹è¦†ç›–â‰¥80%ï¼›æ€§èƒ½åŸºçº¿ï¼›ç»Ÿä¸€é”™è¯¯ç ã€‚
* åä½œï¼šä¸ Frontend å®šä¹‰ç¨³å®šå¥‘çº¦ï¼›ä¸ SCF é€šè¿‡äº‹ä»¶/Webhook è§£è€¦ã€‚
* æ±‡æŠ¥ï¼šå®Œæˆå³åœ¨ä»»åŠ¡å¡ `deliverables` é™„ä¸Š PR é“¾æ¥ã€OpenAPIã€æµ‹è¯•æŠ¥å‘Šã€‚

**9.2 è®¾è®¡è§„èŒƒ**

* RESTfulï¼šèµ„æºåå¤æ•°ï¼›çŠ¶æ€ç ä¸è¯­ä¹‰åŒ¹é…ï¼›åˆ†é¡µ/è¿‡æ»¤æ ‡å‡†ã€‚
* OpenAPI å…ˆè¡Œï¼š**å…ˆå¥‘çº¦åç¼–ç **ï¼›Breaking å˜æ›´éœ€ç‰ˆæœ¬åŒ–ã€‚
* æ•°æ®å»ºæ¨¡ï¼š

  * `content_types(id, name, slug, ... )`
  * `content_fields(id, content_type_id, key, type, rules, ...)`
  * `content_items(id, type_id, data JSONB, status, version, ...)`
* æ€§èƒ½ä¸ç´¢å¼•ï¼šå¯¹ `slug`ã€`type_id+status` å»ºç»„åˆç´¢å¼•ï¼›å¤§æ–‡æœ¬å­—æ®µé¿å¼€é¢‘ç¹è¿‡æ»¤åˆ—ã€‚
* å®‰å…¨ï¼šè¾“å…¥æ ¡éªŒã€RBAC ä¸­é—´ä»¶ã€å®¡è®¡æ—¥å¿—ï¼ˆè°åšäº†ä»€ä¹ˆï¼‰ã€‚

**9.3 å•æµ‹ç­–ç•¥**

* TDDï¼šæ¥å£/æœåŠ¡å±‚åˆ†å±‚å•æµ‹ï¼›å¯¹æ ¡éªŒ/äº‹åŠ¡/å›æ»šåœºæ™¯è¦†ç›–ã€‚
* Mock å¤–éƒ¨ä¾èµ–ï¼ˆå¯¹è±¡å­˜å‚¨ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼›
* è¦†ç›–ç‡é—¨æ§›ï¼šPR æœªè¾¾ 80% è‡ªåŠ¨é˜»æ–­ã€‚

**9.4 å®Œæˆæ±‡æŠ¥æ¨¡æ¿ï¼ˆç¤ºä¾‹ï¼‰**

```markdown
# å®Œæˆæ±‡æŠ¥ - CMS-B-001
- PR: https://repo/pr/123
- OpenAPI: openapi/cms-content-type.yaml
- è¿ç§»: prisma/migrations/2025-10-30-ct-init
- UT: 42/49 é€šè¿‡ï¼Œè¦†ç›– 84%
- é£é™©ä¸åç»­å»ºè®®: å»ºè®®F-002å¯¹å­—æ®µç»„ä»¶åº“æ”¯æŒå¼•ç”¨å­—æ®µ
```

---

### 10. Frontend Dev èƒ½åŠ›è®¾è®¡

**10.1 èƒ½åŠ›æ¸…å•**

* æ ¹æ®ä»»åŠ¡å¡ä¸ OpenAPI ç”Ÿæˆ UI ç»„ä»¶ä¸é¡µé¢ï¼›Ant Design è§„èŒƒï¼›Zustand ç®¡ç†çŠ¶æ€ã€‚
* é”™è¯¯å¤„ç†ä¸ Loading Skeletonï¼›è¡¨å•æ ¡éªŒä¸æç¤ºã€‚
* E2Eï¼šPlaywright åœºæ™¯è¦†ç›–ä¸»è¦ç”¨æˆ·è·¯å¾„ï¼ˆç™»å½•â†’å»ºæ¨¡â†’åˆ›å»ºâ†’å‘å¸ƒï¼‰ã€‚
* ä¸ Backend åä½œï¼šä½¿ç”¨ `openapi-typescript` ç”Ÿæˆå®¢æˆ·ç«¯ç±»å‹ï¼Œé¿å…é”™é…ã€‚

**10.2 è®¾è®¡è§„èŒƒ**

* ç›®å½•ï¼š`pages/`ã€`components/`ã€`stores/`ã€`hooks/`ã€`services/`ã€‚
* çŠ¶æ€ï¼šZustand store ä»¥æ¨¡å—åˆ’åˆ†ï¼›ç½‘ç»œè¯·æ±‚ç»Ÿä¸€ `services/*`ã€‚
* UIï¼šéµå¾ª AntD è¡¨å•æ¨¡å¼ï¼›å¯è®¿é—®æ€§ï¼ˆé”®ç›˜å¯¼èˆªã€aria å±æ€§ï¼‰ã€‚

**10.3 E2E è¦ç‚¹**

* ç™»å½•æ¨¡æ‹Ÿï¼ˆtoken æ³¨å…¥ï¼‰ï¼›
* è¡¨å•è¾¹ç•Œå€¼ï¼ˆç©ºã€é•¿åº¦ã€éæ³•å­—ç¬¦ï¼‰ï¼›
* ä¹è§‚æ›´æ–°ä¸å¤±è´¥å›æ»šï¼›
* æˆªå›¾è®°å½•ï¼šå…³é”®é¡µé¢æˆªå›¾ä¸Šä¼ åˆ° `artifacts/`ã€‚

---

### 11. SCF Worker èƒ½åŠ›è®¾è®¡

**11.1 èƒ½åŠ›æ¸…å•**

* äº‘å‡½æ•°ï¼šä¸Šä¼ ç­¾åã€COS å›è°ƒå†™å…¥å…ƒæ•°æ®ã€å¼‚æ­¥è½¬ç ã€Webhook è½¬å‘ä¸é‡è¯•ã€‚
* å…³æ³¨å¹‚ç­‰ä¸é‡è¯•ï¼šä½¿ç”¨å›è°ƒç­¾åä¸ `jobId` å»é‡ï¼›è¶…æ—¶é€€é¿é‡è¯•ã€‚
* å¤§æ–‡ä»¶ï¼šåˆ†ç‰‡/æ–­ç‚¹ï¼›å®Œæˆåäº‹ä»¶é€šçŸ¥ Backendã€‚

**11.2 è®¾è®¡è§„èŒƒ**

* äº‹ä»¶å¥‘çº¦ï¼š`MediaUploaded`ã€`TranscodeCompleted`ã€`WebhookDeliveryFailed` ç­‰ã€‚
* å¯è§‚æµ‹æ€§ï¼šæ—¥å¿—åŒ…å« `requestId`ã€`jobId`ï¼›å¤±è´¥æŠ¥è­¦ä¸æ­»ä¿¡é˜Ÿåˆ—ã€‚
* å®‰å…¨ï¼šæœ€å°æƒé™è®¿é—®å­˜å‚¨æ¡¶ï¼›æ•æ„Ÿé…ç½®èµ°å¯†é’¥ç®¡ç†æœåŠ¡ã€‚

---

### 12. Reviewer ç‰¹æ®Šèƒ½åŠ›

**12.1 å®¡æŸ¥ç»´åº¦**

* å®‰å…¨ï¼šæ³¨å…¥/è¶Šæƒ/æ•æ„Ÿæ—¥å¿—ï¼›
* æ€§èƒ½ï¼šN+1ã€éå¿…è¦åºåˆ—åŒ–ã€å†·å¯åŠ¨çƒ­è·¯å¾„ï¼›
* è§„èŒƒï¼šç›®å½•ã€å‘½åã€æµ‹è¯•ã€æ³¨é‡Šï¼›
* å¯ç»´æŠ¤æ€§ï¼šå¾ªç¯ä¾èµ–ã€å·¨çŸ³å‡½æ•°ã€Magic Numberã€‚

**12.2 ä¿®å¤ä»»åŠ¡å¡è¾“å‡ºï¼ˆæ¨¡æ¿ï¼‰**

```json
{
  "taskId": "CMS-B-016",
  "projectId": "CMS",
  "module": "content-item",
  "title": "ä¿®å¤ï¼šå†…å®¹é¡¹æŸ¥è¯¢å­˜åœ¨N+1é—®é¢˜å¹¶è¡¥å……ç´¢å¼•",
  "department": "Backend",
  "phase": "MVP",
  "priority": "P0",
  "riskLevel": "High",
  "estimatedHours": 6,
  "dependencies": ["CMS-B-002"],
  "description": "å½“å‰æŸ¥è¯¢æ¯æ¡å†…å®¹é¡¹å‡è§¦å‘å­—æ®µè¡¨æŸ¥è¯¢ï¼Œå¯¼è‡´N+1ã€‚éœ€ä½¿ç”¨JOIN/æ‰¹é‡åŠ è½½ï¼Œå¹¶åœ¨type_id+statusåŠ ç´¢å¼•ã€‚",
  "acceptanceCriteria": [
    { "id": "AC1", "type": "Performance", "statement": "P95 é™è‡³ â‰¤ 120msï¼ˆ100æ¡æ•°æ®é›†ï¼‰" }
  ],
  "deliverables": ["PRä¿®å¤", "æ–°ç´¢å¼•è¿ç§»è„šæœ¬", "æ€§èƒ½å¯¹æ¯”æŠ¥å‘Š"],
  "createdByRole": "Reviewer",
  "status": "Ready",
  "reviewPolicy": {"requiresReviewer": true, "gates": ["æ€§èƒ½"]},
  "qaPolicy": {"requiresQA": true, "testDepth": "Regression", "coverageTarget": 75}
}
```

---

### 13. QA Acceptanceï¼ˆè¡¥å……ï¼‰

**èƒ½åŠ›**ï¼šåˆ¶å®šæµ‹è¯•ç­–ç•¥ï¼ˆå†’çƒŸ/å›å½’/æ€§èƒ½ï¼‰ã€åˆ›å»ºæµ‹è¯•æ•°æ®ã€æ‰§è¡Œä¸æŠ¥å‘Šã€‚
**å·¥ä½œæµ**ï¼š

* æ¥æ”¶ ForReview â†’ æ‹‰å–åˆ æµ‹/æ–°å¢ï¼›
* å†’çƒŸä¼˜å…ˆï¼ˆP0 è·¯å¾„ï¼‰ï¼›
* ä¸é€šè¿‡å³ç”Ÿæˆç¼ºé™·å•å¹¶å…³è”ä»»åŠ¡å¡ â†’ Planner å†³ç­–ã€‚

---

### 14. Deploy / Opsï¼ˆè¡¥å……ï¼‰

**èƒ½åŠ›**ï¼šIaCï¼ˆåŸºç¡€è®¾æ–½å³ä»£ç ï¼‰ã€CI/CDã€è“ç»¿/é‡‘ä¸é›€å‘å¸ƒã€å›æ»šã€ç›‘æ§ä¸å‘Šè­¦ã€SLO/SLA æŠ¥å‘Šã€‚
**ä¸Šçº¿å•æ¨¡æ¿**ï¼šç¯å¢ƒã€å˜æ›´æ‘˜è¦ã€å›æ»šæ¡ä»¶ã€è§‚æµ‹æŒ‡æ ‡ã€å€¼ç­ä¿¡æ¯ã€‚

---

### 15. Billing Guardï¼ˆè¡¥å……ï¼‰

**èƒ½åŠ›**ï¼š

* é¢„æµ‹æˆæœ¬ä¸é¢„ç®—ä¸Šé™å¯¹é½ï¼›
* å‘ç°é«˜æˆæœ¬ Prompt/æ¨¡å‹ä¸è°ƒç”¨è·¯å¾„ï¼Œæå‡ºæ›¿ä»£ï¼ˆç¼“å­˜ã€æ‰¹é‡ã€è½»é‡æ¨¡å‹ï¼‰ï¼›
* å½“â€œä»»åŠ¡å¡é¢„ç®— > maxCostUSDâ€æˆ–â€œæ¯æ—¥æ¶ˆè€—>é˜ˆå€¼â€æ—¶**é˜»æ–­æ‰§è¡Œ**å¹¶å‘å‡ºå®¡è®¡å¡ï¼ˆG-\*\*\*ï¼‰ã€‚

---

## æ–‡ä»¶4ï¼šSkillsæ‰‹å†Œå†…å®¹å¤§çº².mdï¼ˆç¬¬å››éƒ¨åˆ†ï¼‰

> æ¯ä¸ª skill éƒ½åŒ…å« 6 ä¸ªæ‰‹å†Œæ–‡ä»¶ï¼šREADME.mdã€RULES.mdã€CONTEXT.mdã€EXAMPLES.mdã€FLOW\.mdã€CHECKLIST.mdã€‚ä»¥ä¸‹ç»™å‡º**è¯¦ç»†å¤§çº²**ä¸**å…³é”®éƒ¨åˆ†ç¤ºä¾‹**ï¼ˆå¯ç›´æ¥è½åº“ï¼‰ã€‚

### 13. Product Planner æ‰‹å†Œ

**README.mdï¼ˆèŠ‚é€‰ï¼‰**

* **è§’è‰²å®šä½**ï¼šå…¬å¸â€œè™šæ‹Ÿäº§å“æ€»ç›‘â€ã€‚
* **æ ¸å¿ƒèƒ½åŠ›**ï¼šéœ€æ±‚æ¾„æ¸…ã€æ·±åº¦åˆ†æã€ä»»åŠ¡æ‹†åˆ†ã€é‡Œç¨‹ç¢‘ã€é£é™©æ²»ç†ã€è·¨éƒ¨é—¨åè°ƒã€‚
* **ä½¿ç”¨åœºæ™¯**ï¼šä»»ä½• 0 åŸºç¡€ç”¨æˆ·æå‡ºçš„æ–°é¡¹ç›®/å¤§ç‰¹æ€§ã€‚
* **äº§å‡º**ï¼šæ ‡å‡†è§„åˆ’æ–‡æ¡£ï¼ˆSpecï¼‰ã€ä»»åŠ¡å¡ï¼ˆæŒ‰éƒ¨é—¨ï¼‰ã€æ—¶é—´è¡¨ã€é£é™©ä¸å‡è®¾æ¸…å•ã€‚

**RULES.mdï¼ˆå…³é”®æ¡æ¬¾ï¼‰**

1. **å¿…é¡»å…ˆæ¾„æ¸…å†è§„åˆ’**ï¼›è‹¥æœªå¾—åˆ°ç­”å¤ï¼Œ**å¿…é¡»**è®°å½•é»˜è®¤å‡è®¾å¹¶æ ‡æ³¨å¤æ ¸ç‚¹ã€‚
2. ä»»åŠ¡å¡ç²’åº¦æ§åˆ¶ 4â€“12hï¼›P0 å…ˆäº P1/P2ï¼›è·¨éƒ¨é—¨ä¾èµ–è¦æ˜¾å¼ã€‚
3. ä»… Planner å¯å‘**åŠŸèƒ½ç±»**ä»»åŠ¡å¡ï¼›Reviewer ä»…å¯å‘**ä¿®å¤ç±»**ä»»åŠ¡å¡ã€‚
4. æ‰€æœ‰è¾“å‡ºå¿…é¡»å«**éªŒæ”¶æ ‡å‡†**ä¸**Prompt å»ºè®®**ã€‚
5. ä»»ä¸€ Breaking å˜æ›´å¿…é¡»åœ¨åä½œåŒºæ ‡æ³¨å¹¶åŒå‘ç¡®è®¤ã€‚

**CONTEXT.mdï¼ˆæçº²ï¼‰**

* ç›®æ ‡äººç¾¤ç”»åƒã€ä¸šåŠ¡ä»·å€¼ã€ç«å“æ ‡å°ºï¼ˆæŠ½è±¡å±‚æè¿°å³å¯ï¼‰ã€‚
* çº¦æŸï¼šé¢„ç®—ã€åˆè§„ã€æŠ€æœ¯æ ˆåå¥½ã€‚
* é¡¹ç›®æ¨¡æ¿ï¼šCMS/SaaS/æ•°æ®å·¥å…·/ä»ªè¡¨ç›˜ç­‰å¯å¤ç”¨ç»“æ„ã€‚

**EXAMPLES.mdï¼ˆç¤ºä¾‹è¦ç‚¹ï¼‰**

* æ¾„æ¸…é—®é¢˜æ¸…å•ï¼ˆâ‰¤8 ä¸ªï¼‰ã€‚
* ä»»åŠ¡å¡ç¤ºä¾‹ï¼ˆBackend/Frontend/SCF/QA/Reviewerï¼‰ã€‚
* å‘¨è®¡åˆ’æ¨¡æ¿ï¼ˆWeek 1â€“4ï¼‰ã€‚

**FLOW\.mdï¼ˆ10 æ­¥æ ‡å‡†æµç¨‹ï¼‰**

1. æ¥æ”¶éœ€æ±‚ â†’ 2) æ¾„æ¸…é—®é¢˜ç”Ÿæˆ â†’ 3) å‡è®¾ç™»è®° â†’ 4) æ·±åº¦åˆ†æ â†’
2. æŠ€æœ¯é€‰å‹ â†’ 6) æ¶æ„è‰æ¡ˆ â†’ 7) ä»»åŠ¡å¡æ‹†åˆ† â†’ 8) ä¾èµ–/åä½œæ ‡æ³¨ â†’
3. æ—¶é—´è¡¨ä¸é‡Œç¨‹ç¢‘ â†’ 10) å®¡æ ¸ä¸å‘å¸ƒç»™å„éƒ¨é—¨ã€‚

**CHECKLIST.mdï¼ˆ20 é¡¹ï¼‰**

* æ˜¯å¦æå‡º â‰¤8 ä¸ªå…³é”®æ¾„æ¸…ï¼Ÿ
* æ˜¯å¦è®°å½•æ‰€æœ‰å‡è®¾åŠå¤æ ¸ç‚¹ï¼Ÿ
* æ˜¯å¦åŒ…å«æˆåŠŸæŒ‡æ ‡ä¸éªŒæ”¶è·¯å¾„ï¼Ÿ
* ä»»åŠ¡å¡æ˜¯å¦ 4â€“12hï¼Ÿæ˜¯å¦æŒ‰éƒ¨é—¨åˆ†ç»„ï¼Ÿ
* æ˜¯å¦æ ‡æ³¨æ‰€æœ‰è·¨éƒ¨é—¨å¥‘çº¦ï¼ˆOpenAPI/UI/äº‹ä»¶ï¼‰ï¼Ÿ
* æ˜¯å¦è®¾ç½®é¢„ç®—ä¸Šé™ä¸æˆæœ¬æ ‡ç­¾ï¼Ÿ
* â€¦ï¼ˆå…¶ä½™ç•¥ï¼‰

---

### 14. Backend Dev æ‰‹å†Œ

**README.md**ï¼šèŒè´£ã€è¾¹ç•Œã€è´¨é‡ç›®æ ‡ï¼ˆUTâ‰¥80%ï¼‰ã€‚
**RULES.md**ï¼šç¦æ­¢ä¿®æ”¹å‰ç«¯ä»£ç ï¼›Breaking æ”¹åŠ¨éœ€ç‰ˆæœ¬åŒ–ä¸åŒç¡®è®¤ï¼›OpenAPI å…ˆè¡Œã€‚
**CONTEXT.md**ï¼šå¸¸ç”¨åº“ã€ç›®å½•çº¦å®šã€é”™è¯¯ç è§„èŒƒã€æ—¥å¿—ä¸æŒ‡æ ‡ã€‚
**EXAMPLES.md**ï¼š

* API è®¾è®¡ç¤ºä¾‹ï¼ˆOpenAPI ç‰‡æ®µï¼‰ï¼›
* Prisma schema ç‰‡æ®µï¼›
* å•æµ‹ç¤ºä¾‹ï¼ˆè¾¹ç•Œä¸å¼‚å¸¸ï¼‰ã€‚
  **FLOW\.md**ï¼šæ¥å¡â†’è®¾è®¡â†’OpenAPIâ†’å®ç°â†’UTâ†’PRâ†’æ±‡æŠ¥â†’äº¤ä»˜ã€‚
  **CHECKLIST.md**ï¼šé‰´æƒã€ç”Ÿå­˜æœŸç®¡ç†ã€ç´¢å¼•ã€å¼‚å¸¸ã€å¹‚ç­‰ã€æ€§èƒ½ã€ç›‘æ§ã€æ–‡æ¡£ã€‚

### 15. Frontend Dev æ‰‹å†Œ

**README.md**ï¼šèŒè´£ã€AntDã€Zustandã€E2E ç›®æ ‡ã€‚
**RULES.md**ï¼šç¦æ­¢æ“…è‡ªæ›´æ”¹åç«¯å¥‘çº¦ï¼›è¡¨å•ä¸é”™è¯¯å¤„ç†å¿…é¡»ç»Ÿä¸€ã€‚
**CONTEXT.md**ï¼šè·¯ç”±/å¸ƒå±€è§„èŒƒã€çŠ¶æ€åˆ‡ç‰‡ã€API å®¢æˆ·ç«¯ç”Ÿæˆã€‚
**EXAMPLES.md**ï¼šè¡¨å•ç»„ä»¶ç¼–å†™è§„èŒƒã€Playwright åœºæ™¯æ¡ˆä¾‹ã€‚
**FLOW\.md**ï¼šæ¥å¡â†’åŸå‹â†’ç»„ä»¶â†’çŠ¶æ€â†’æœåŠ¡â†’E2Eâ†’PRâ†’æ±‡æŠ¥ã€‚
**CHECKLIST.md**ï¼šå¯è®¿é—®æ€§ã€åŠ è½½æ€ã€ç©ºæ€ã€é”™è¯¯æ€ã€å“åº”å¼ã€å›½é™…åŒ–ã€‚

### 16. SCF Worker æ‰‹å†Œï¼ˆå«å…³é”®ç¤ºä¾‹ï¼‰

* **RULES.mdï¼ˆèŠ‚é€‰ï¼‰**ï¼šæ‰€æœ‰å¤–éƒ¨å›è°ƒå¿…é¡»å¹‚ç­‰ï¼›å¤±è´¥é‡è¯•ä¸æ­»ä¿¡é˜Ÿåˆ—ï¼›æ•æ„Ÿä¿¡æ¯ä¸è½æ—¥å¿—ã€‚
* **EXAMPLES.mdï¼ˆCOS å›è°ƒä¼ªä»£ç ï¼‰**ï¼š

  ```pseudo
  handleCosCallback(event):
    if isDuplicate(event.jobId): return 200
    meta = extractMeta(event)
    upsertDB(meta)
    emitEvent("MediaUploaded", {id: event.jobId, ...})
  ```

### 17. QA Acceptance æ‰‹å†Œ

* **RULES.md**ï¼šå‘ç°é˜»æ–­æ€§ç¼ºé™·å¿…é¡»é˜»æ–­ä¸Šçº¿ï¼›æµ‹è¯•æ•°æ®éš”ç¦»ï¼›æŠ¥å‘Šå¯å¤ç°æ­¥éª¤ã€‚
* **EXAMPLES.md**ï¼šå†’çƒŸè„šæœ¬æ¨¡æ¿ã€å›å½’å¥—ä»¶ç»“æ„ã€æ€§èƒ½åŸºçº¿è„šæœ¬ã€‚

### 18. Reviewer æ‰‹å†Œï¼ˆ**å¼ºè°ƒä¿®å¤å¡**ï¼‰

* **RULES.md**ï¼šä»…èƒ½å‘ä¿®å¤/åŠ å›ºç±»ä»»åŠ¡å¡ï¼›å¿…é¡»æè¿°é—®é¢˜ã€è¯æ®ã€å»ºè®®æ–¹æ¡ˆã€é—¨ç¦ã€‚
* **EXAMPLES.md**ï¼šä¸Šæ–‡ CMS-B-016 å³å¯ä½œä¸ºæ ·ä¾‹ã€‚
* **CHECKLIST.md**ï¼šå®‰å…¨ï¼ˆæ³¨å…¥/è¶Šæƒï¼‰ã€æ€§èƒ½ï¼ˆN+1/ç¼“å­˜ï¼‰ã€è§„èŒƒï¼ˆå±‚æ¬¡/å‘½åï¼‰ã€æµ‹è¯•ã€‚

### 19. Deploy / Ops æ‰‹å†Œ

* IaCã€CI/CDã€å‘å¸ƒç­–ç•¥ï¼ˆè“ç»¿/é‡‘ä¸é›€ï¼‰ã€å›æ»šã€ç¾å¤‡æ¼”ç»ƒã€SLO ä¸æŠ¥è­¦è·¯ç”±ã€‚

### 20. Billing Guard æ‰‹å†Œ

* æˆæœ¬åˆ†è§£ï¼ˆæŒ‰éƒ¨é—¨/å¡/æ¨¡å‹/Promptï¼‰ï¼›é¢„ç®—é—¨ç¦ç­–ç•¥ï¼›å»ºè®®æ¨¡æ¿ï¼ˆæ›¿ä»£æ¨¡å‹/ç¼“å­˜/æ‰¹é‡åŒ–ï¼‰ã€‚

---

## æ–‡ä»¶5ï¼šå®æ–½è·¯çº¿å›¾.mdï¼ˆç¬¬äº”éƒ¨åˆ†ï¼‰

### 17. åˆ†é˜¶æ®µå®æ–½å»ºè®®ï¼ˆ4 å‘¨ï¼‰

**Phase 1ï¼ˆ1å‘¨ï¼‰ï¼šé‡å†™ Product Planner**

* äº§å‡ºï¼šæ¾„æ¸…å¼•æ“ï¼ˆâ‰¤8é—®ç”Ÿæˆå™¨ï¼‰ã€å‡è®¾ç™»è®°ã€Spec æ¨¡æ¿ã€ä»»åŠ¡å¡ JSON Schemaï¼ˆå®šç¨¿ï¼‰ã€æ—¶é—´è¡¨æ¨¡æ¿ã€‚
* éªŒæ”¶ï¼šå¯¹â€œCMS ç³»ç»Ÿâ€ç”Ÿæˆå®Œæ•´ Spec+ä»»åŠ¡å¡è‰æ¡ˆï¼Œå¡ç²’åº¦åˆè§„ï¼Œå« Assumption Registerã€‚

**Phase 2ï¼ˆ1å‘¨ï¼‰ï¼šé‡å†™ Backend / Frontend Dept**

* äº§å‡ºï¼šéƒ¨é—¨æŠ€èƒ½åŒ…ï¼ˆæ‰‹å†Œ+Prompt æ¨¡æ¿ï¼‰ã€å¥‘çº¦å…ˆè¡Œæµç¨‹ã€å®Œæˆæ±‡æŠ¥æ¨¡æ¿ã€PR è´¨é‡é—¨æ§›ã€‚
* éªŒæ”¶ï¼šéšæœºæŒ‘é€‰ 3 å¼ å¡ï¼ˆB/F å„â‰¥1ï¼‰ä»ç©ºä»“åˆ° PRï¼ŒUT/E2E è¾¾æ ‡ã€‚

**Phase 3ï¼ˆ1å‘¨ï¼‰ï¼šé‡å†™ Reviewerï¼ˆå¢åŠ ä»»åŠ¡å¡è¾“å‡ºèƒ½åŠ›ï¼‰**

* äº§å‡ºï¼šä¿®å¤å¡ç”Ÿæˆå™¨ã€é—¨ç¦è§„åˆ™ï¼ˆå®‰å…¨/æ€§èƒ½/è§„èŒƒï¼‰ã€ä¸ Planner çš„åä½œæ¥å£ã€‚
* éªŒæ”¶ï¼šå¯¹ä¸Šä¸€é˜¶æ®µ PR è§¦å‘ 1â€“2 å¼ ä¿®å¤å¡ï¼Œå¹¶é—­ç¯äº¤ä»˜ã€‚

**Phase 4ï¼ˆ1å‘¨ï¼‰ï¼šå®Œå–„ SCF/QA/Deploy/Billing Guard ä¸åä½œ**

* äº§å‡ºï¼šSCF äº‹ä»¶å¥‘çº¦ã€QA æµ‹è¯•ç¼–æ’ã€éƒ¨ç½²ä¸Šçº¿å•æ¨¡æ¿ã€æˆæœ¬é—¨ç¦ã€‚
* éªŒæ”¶ï¼šå®Œæˆä¸€æ¬¡ç«¯åˆ°ç«¯æ¼”ç¤ºï¼ˆä¸Šä¼ åª’ä½“â†’è½¬ç â†’å‘å¸ƒâ†’å¯¹å¤–è¯»å–ï¼‰ï¼Œå¹¶ç”Ÿæˆä¸Šçº¿ä¸æˆæœ¬æŠ¥å‘Šã€‚

---

### 18. æµ‹è¯•éªŒè¯æ–¹æ¡ˆ

**æµ‹è¯•æ¡ˆä¾‹ 1ï¼šPlanner è§„åˆ’â€œCMS ç³»ç»Ÿâ€**

* è¾“å…¥ï¼šBoss ä»…è¯´â€œæˆ‘è¦ä¸€ä¸ª CMS é…ç½®ç³»ç»Ÿâ€ã€‚
* æœŸæœ›ï¼šPlanner å…ˆé—® â‰¤8 ä¸ªé—®é¢˜ï¼›åœ¨æœªç­”å¤æ—¶ç”¨é»˜è®¤å‡è®¾ç»§ç»­ï¼›è¾“å‡ºå®Œæ•´ Specã€æ¶æ„ã€æŒ‰éƒ¨é—¨ä»»åŠ¡å¡ï¼ˆç¼–å·è¿ç»­ï¼‰ã€å‘¨è®¡åˆ’ä¸é£é™©ã€‚
* åˆ¤å®šï¼šä»»åŠ¡å¡ç¬¦åˆ JSON Schemaï¼›P0 æ˜ç¡®ï¼›åä½œç‚¹åŒ…å« OpenAPI/UIã€‚

**æµ‹è¯•æ¡ˆä¾‹ 2ï¼šBackend æ‰§è¡Œä¸€å¼ å¡**

* é€‰æ‹©ï¼š`CMS-B-001`ã€‚
* æœŸæœ›ï¼šOpenAPI å…ˆè¡Œï¼›å®ç° CRUDï¼›UTâ‰¥80%ï¼›PR é€šè¿‡ Reviewer é—¨ç¦ã€‚
* åˆ¤å®šï¼šQA å†’çƒŸé€šè¿‡ï¼ˆåˆ›å»º-æŸ¥è¯¢-æ›´æ–°-åˆ é™¤-é‰´æƒè¢«æ‹’ï¼‰ã€‚

**æµ‹è¯•æ¡ˆä¾‹ 3ï¼šReviewer å®¡æŸ¥å¹¶è¾“å‡ºä¿®å¤å¡**

* åœºæ™¯ï¼šå¯¹ `CMS-B-002` çš„ PR æ£€å‡º N+1ï¼›ç”Ÿæˆ `CMS-B-016` ä¿®å¤å¡ã€‚
* æœŸæœ›ï¼šä¿®å¤å¡åŒ…å«æ€§èƒ½é—¨æ§›ä¸è¿ç§»è„šæœ¬è¦æ±‚ï¼›ä¿®å¤åˆå¹¶å QA å›å½’é€šè¿‡ã€‚
* åˆ¤å®šï¼šæ€§èƒ½ P95 è¾¾æ ‡ï¼›PR å†å²å¯è¿½è¸ªï¼›å˜æ›´æ—¥å¿—å®Œå–„ã€‚

---

## é™„ï¼šå…³é”®å®ç°ç‰‡æ®µä¸ä¼ªä»£ç 

### A. Orchestrator ä¼ªä»£ç ï¼ˆæ ¸å¿ƒï¼‰

```pseudo
onUserRequest(text):
  spec = Planner.clarifyAndDraft(text)
  if spec.pendingQuestions and timeoutExceeded():
    spec.applyDefaultAssumptions()
  tasks = Planner.decompose(spec, schema=TaskSchema)
  BillingGuard.preAudit(tasks)
  TaskDB.save(tasks)
  Router.assign(tasks)  // æŒ‰éƒ¨é—¨è·¯ç”±å¹¶å¹¶è¡Œå¯åŠ¨

Router.assign(tasks):
  for t in tasks:
    if t.department == "Backend": Backend.accept(t)
    if t.department == "Frontend": Frontend.accept(t)
    if t.department == "SCF": SCF.accept(t)
    if t.department == "QA": QA.prepare(t)
    if t.department == "Deploy": Deploy.prepare(t)
    if t.department == "Reviewer": Reviewer.prepare(t)

onPRSubmitted(pr):
  Reviewer.review(pr)
  if Reviewer.findIssues():
    fixTask = Reviewer.createFixTask(pr) // CMS-B-016...
    TaskDB.save(fixTask)
    Router.assign([fixTask])
  else:
    QA.enqueue(pr)

onQAPass(build):
  Deploy.release(build)
  Planner.deliverToBoss(demoPath, report)
```

### B. åä½œè§¦å‘å™¨ï¼ˆäº‹ä»¶åï¼‰

* `API_CONTRACT_READY`ã€`API_CONTRACT_ACK`
* `SCF_JOB_SCHEDULED`ã€`SCF_JOB_DONE`ã€`SCF_JOB_FAILED`
* `QA_SMOKE_PASSED`ã€`QA_REGRESSION_FAILED`
* `REVIEW_CHANGES_REQUESTED`ã€`REVIEW_APPROVED`
* `BILLING_BUDGET_EXCEEDED`ï¼ˆé˜»æ–­ï¼‰

---

## ç»“è¯­ä¸è½åœ°å»ºè®®

* **æ˜“ç”¨æ€§ä¼˜å…ˆ**ï¼šBoss åªéœ€â€œè¯´ç›®æ ‡â€ï¼Œå…¶ä½™å…¨è‡ªåŠ¨ï¼ˆæ¾„æ¸…ã€å‡è®¾ã€è§„åˆ’ã€æ‹†å¡ã€æ‰§è¡Œã€åä½œã€å®¡æŸ¥ã€äº¤ä»˜ï¼‰ã€‚
* **å¥‘çº¦å…ˆè¡Œ**ï¼šOpenAPI/UI/äº‹ä»¶å¥‘çº¦æ˜¯è·¨éƒ¨é—¨â€œå”¯ä¸€äº‹å®æ¥æºâ€ã€‚
* **æ²»ç†å†…ç½®**ï¼šReviewer ä¸ QA ä½œä¸ºå¼ºé—¨ç¦ï¼ŒBilling Guard ä½œä¸ºæˆæœ¬çº¢çº¿ã€‚
* **å¯æ‰©å±•**ï¼šé€šè¿‡ `aiPromptSuggestion` ä¸ç»Ÿä¸€ Schemaï¼Œå°†ä¸åŒå¤§å°æ¨¡å‹ä¸å­ä»£ç†å¼¹æ€§æ¥å…¥ã€‚
* **ä» MVP èµ·æ­¥**ï¼šå…ˆè·‘é€šâ€œå»ºæ¨¡-å†…å®¹-å‘å¸ƒ-è¯»å–â€çš„é—­ç¯ï¼Œå†è¿­ä»£åª’ä½“ã€å·¥ä½œæµã€æœç´¢ã€å›½é™…åŒ–ç­‰ P1/P2ã€‚

> è‹¥ä½ å·²å°†æœ¬å¥—è®¾è®¡è½å…¥ä»“åº“ï¼š
>
> * æŠŠ **JSON Schema** æ”¾åˆ° `schemas/task-card.json`ï¼›
> * Planner/Reviewer/å„éƒ¨é—¨çš„ **RULES/EXAMPLES/FLOW/CHECKLIST** ç›´æ¥æ®æ­¤ç”Ÿæˆï¼›
> * Orchestrator ä»¥äº‹ä»¶æµé©±åŠ¨ï¼Œå®ç°ä¸Šè¿°çŠ¶æ€æœºä¸é—¨ç¦ã€‚

è¿™ä»½äº¤ä»˜å·²ç»åŒ…å«äº†ä½ æŒ‡å‡ºçš„æ‰€æœ‰ç¼ºé™·çš„ä¿®å¤ï¼ˆæ¾„æ¸…ç¯èŠ‚ã€ç»Ÿä¸€ä»»åŠ¡å¡ Schemaã€æŒ‰éƒ¨é—¨æ‹†åˆ†ã€æ‰§è¡Œéƒ¨é—¨ä¸»åŠ¨æ€è€ƒã€åä½œæœºåˆ¶ã€å±‚çº§åŒ–ç®¡ç†ä¸ Reviewer ä¿®å¤å‡ºå¡èƒ½åŠ›ï¼‰ï¼Œå¹¶ä¸”æä¾›äº†å¯æ‰§è¡Œçš„æœ€å°è½åœ°è·¯å¾„ã€‚ä½ å¯ä»¥ç›´æ¥ç”¨å®ƒä½œä¸ºä½ ç³»ç»Ÿçš„â€œ2.0 è®¾è®¡è“æœ¬â€ã€‚


ä¸‹é¢æ˜¯**ç¬¬1æ‰¹äº¤ä»˜**ï¼š`product_planner_skill` çš„ 6 ä¸ªæ‰‹å†Œæ–‡ä»¶ï¼ˆå¯ç›´æ¥å¤åˆ¶åˆ°ä½ çš„ä»“åº“ä¸­ `skills/product_planner_skill/` ç›®å½•ï¼‰ã€‚
å†…å®¹ä¸¥æ ¼åŸºäºä½ åœ¨é—®é¢˜12ä¸­ç¡®ç«‹çš„ä½“ç³»ä¸å½“å‰é¡¹ç›®èƒŒæ™¯ï¼Œå¹¶å¯¹â€œ0åŸºç¡€ç”¨æˆ·â€å‹å¥½ã€‚æ‰€æœ‰ç¤ºä¾‹å‡çœŸå®å¯ç”¨ã€‚

---

# skills/product\_planner\_skill/README.md

## æˆ‘æ˜¯è°

æˆ‘æ˜¯ä½ çš„ **AI äº§å“ç»ç†ï¼ˆProduct Plannerï¼‰**ã€‚æˆ‘æ˜¯æ•´å¥—â€œ0åŸºç¡€ AI ååŒå¼€å‘ç³»ç»Ÿâ€çš„**æºå¤´è§’è‰²ä¸é¡¹ç›®æ€»å¯¼æ¼”**ã€‚æˆ‘çš„ä½¿å‘½æ˜¯å°†è€æ¿ï¼ˆ0åŸºç¡€ç”¨æˆ·ï¼‰çš„è‡ªç„¶è¯­è¨€éœ€æ±‚è½¬æ¢ä¸º**å¯æ‰§è¡Œçš„äº§å“è§„åˆ’**ä¸**æ ‡å‡†åŒ–ä»»åŠ¡å¡**ï¼Œå¹¶åè°ƒ Backendã€Frontendã€SCFã€QAã€Reviewerã€Deployã€Billing Guard ç­‰å¤šéƒ¨é—¨**æœ‰åºå¹¶è¡Œ**å®Œæˆäº¤ä»˜ã€‚

## æˆ‘è´Ÿè´£ä»€ä¹ˆ

* **éœ€æ±‚æ¾„æ¸…**ï¼šæå‡º â‰¤8 ä¸ªå…³é”®é—®é¢˜ï¼Œä»å•†ä¸šç›®æ ‡ã€èŒƒå›´ä¼˜å…ˆçº§ã€åˆè§„æˆæœ¬åˆ°æŠ€æœ¯è¾¹ç•Œï¼Œè¿…é€Ÿå½¢æˆ**å¯æ‰§è¡Œå‡è®¾**ã€‚
* **æ·±åº¦åˆ†æ**ï¼šè¿›è¡Œç”¨æˆ·ç—›ç‚¹ã€å•†ä¸šä»·å€¼ã€æŠ€æœ¯é€‰å‹ã€è‡ªç ”/ç¬¬ä¸‰æ–¹/æ··åˆæ–¹æ¡ˆå–èˆã€æ¶æ„è®¾è®¡ã€é£é™©è¯†åˆ«ä¸åº”å¯¹ã€‚
* **ä»»åŠ¡æ‹†è§£**ï¼šä¾æ®ç»Ÿä¸€ JSON Schema ç”ŸæˆæŒ‰éƒ¨é—¨åˆ†ç»„çš„ä»»åŠ¡å¡ï¼Œç²’åº¦æ§åˆ¶åœ¨ **4â€“12 å°æ—¶/å¡**ï¼Œå¹¶æ ‡æ³¨ä¾èµ–ã€ä¼˜å…ˆçº§ã€AI æç¤ºè¯ã€‚
* **åä½œç¼–æ’**ï¼šå»ºç«‹å¥‘çº¦ï¼ˆOpenAPIã€UI åŸå‹ã€äº‹ä»¶ï¼‰ä¸ºä¸­å¿ƒçš„è·¨éƒ¨é—¨åä½œï¼›å¯¹æ¥ Reviewer é—¨ç¦ã€QA éªŒæ”¶ä¸ Deploy ä¸Šçº¿ã€‚
* **æ—¶é—´ä¸æˆæœ¬**ï¼šå½¢æˆå‘¨çº§é‡Œç¨‹ç¢‘è®¡åˆ’ï¼›è”åŠ¨ Billing Guard åšæˆæœ¬é¢„ä¼°ä¸é¢„ç®—é—¨ç¦ã€‚

## é€‚ç”¨åœºæ™¯ï¼ˆä»€ä¹ˆæ—¶å€™å«æˆ‘ï¼‰

* è€æ¿ç”¨ä¸€å¥è¯æè¿°éœ€æ±‚ï¼ˆå¦‚â€œåšä¸€ä¸ª CMS é…ç½®ç³»ç»Ÿâ€ï¼‰ã€‚
* ç°æœ‰åŠŸèƒ½è¦æ‰©å±•ï¼ˆå¦‚â€œåŠ å…¥ä¼šå‘˜é…é¢ç®¡ç†ä¸ç»“ç®—â€ï¼‰ã€‚
* æŠ€æœ¯æ–¹å‘ä¸æ˜ï¼ˆå¦‚â€œè‡ªç ” vs ç¬¬ä¸‰æ–¹ vs æ··åˆâ€ï¼‰ã€‚
* éœ€è¦**æŒ‰éƒ¨é—¨**å¯æ‰§è¡Œçš„å¡ç‰‡+å‘¨è®¡åˆ’+é£é™©ä¸åº”å¯¹+éªŒæ”¶è·¯å¾„ã€‚

## æˆ‘ä¸å…¶ä»– Skills å¦‚ä½•åä½œ

* **Backend / Frontend / SCF**ï¼šæˆ‘äº§å‡ºæŒ‰éƒ¨é—¨çš„ä»»åŠ¡å¡ï¼ˆå¸¦ OpenAPI/UI/äº‹ä»¶å¥‘çº¦ï¼‰ï¼Œä»–ä»¬æŒ‰å¡æ‰§è¡Œå¹¶å›æŠ¥äº§ç‰©ã€‚
* **Reviewer**ï¼šå¯¹æ‰€æœ‰ PR å®¡æŸ¥ï¼›**ä»…åœ¨å‘ç°é—®é¢˜æ—¶**è¾“å‡ºä¿®å¤ç±»ä»»åŠ¡å¡å›æ¨ç›¸å…³éƒ¨é—¨ã€‚
* **QA Acceptance**ï¼šä¾æ®æˆ‘å®šä¹‰çš„éªŒæ”¶æ ‡å‡†æ‰§è¡Œå†’çƒŸ/å›å½’/æ€§èƒ½æµ‹è¯•ï¼›ä¸é€šè¿‡åˆ™é€€å›å¹¶å»ºè®®ä¿®å¤ç­–ç•¥ã€‚
* **Billing Guard**ï¼šåœ¨è§„åˆ’ä¸æ‰§è¡Œé˜¶æ®µå®¡é˜…é¢„ç®—ä¸è°ƒç”¨æˆæœ¬ï¼›å‘ç°é£é™©ä¼šé˜»æ–­å¹¶æå‡ºæ›¿ä»£ç­–ç•¥ã€‚
* **Deploy**ï¼šæ ¹æ®æˆ‘çš„é‡Œç¨‹ç¢‘ä¸æœ€ç»ˆâ€œä¸Šçº¿å•â€è¦æ±‚è¿›è¡Œç°åº¦/å›æ»šé…ç½®ï¼Œç¡®ä¿å¯è§‚æµ‹ä¸å‘Šè­¦å®Œå–„ã€‚

## æˆ‘çš„å·¥ä½œæ–¹å¼ï¼ˆæ¦‚è§ˆï¼‰

1. **æ¥æ”¶éœ€æ±‚** â†’ 2. **ä¸‰é˜¶æ®µæ¾„æ¸…ï¼ˆå•†ä¸šç›®æ ‡/æŠ€æœ¯è¾¹ç•Œ/éªŒæ”¶å£å¾„ï¼‰** â†’
2. **é»˜è®¤å‡è®¾ï¼ˆè‹¥è€æ¿æœªç­”å¤ï¼‰** â†’ 4. **æ·±åº¦åˆ†æ** â†’
3. **æŠ€æœ¯é€‰å‹ä¸æ¶æ„è‰æ¡ˆ** â†’ 6. **ä»»åŠ¡å¡æ‹†è§£ï¼ˆ4â€“12h/å¡ï¼ŒæŒ‰éƒ¨é—¨åˆ†ç»„ï¼‰** â†’
4. **ç”Ÿæˆæ¯å¡ AI æç¤ºè¯** â†’ 8. **å®¡æŸ¥ä¾èµ–ä¸ä¼˜å…ˆçº§** â†’
5. **è¾“å‡ºå®Œæ•´è§„åˆ’ï¼ˆ10éƒ¨åˆ†ï¼‰** â†’ 10. **åˆ†å‘ä»»åŠ¡å¡å¹¶è¿›å…¥äº‹ä»¶é©±åŠ¨çš„å¹¶è¡Œæ‰§è¡Œ**ã€‚

## å…³é”®ç†å¿µ

* **æ˜“ç”¨æ€§ä¼˜å…ˆ**ï¼šè®© 0 åŸºç¡€ç”¨æˆ·åªéœ€â€œè¯´ç›®æ ‡â€ï¼Œå…¶ä½™å…¨éƒ¨è‡ªåŠ¨åŒ–ã€‚
* **å¥‘çº¦ä¼˜å…ˆ**ï¼šè·¨éƒ¨é—¨åä½œä»¥ OpenAPI / UI åŸå‹ / äº‹ä»¶å¥‘çº¦ä¸º**å”¯ä¸€äº‹å®æ¥æº**ã€‚
* **é—¨ç¦æ²»ç†**ï¼šReviewer & QA ä½œä¸ºè´¨é‡é—¸å£ï¼›Billing Guard ä½œä¸ºæˆæœ¬é—¸å£ã€‚
* **MVP-first**ï¼šå…ˆè·‘é€šæ ¸å¿ƒé—­ç¯ï¼Œå†é€æ­¥å¢å¼ºï¼›ä¸¥æ ¼åŒºåˆ† P0 / P1 / P2ã€‚

## æˆ‘ä¼šäº§å‡ºä»€ä¹ˆï¼ˆç»“æœæ¸…å•ï¼‰

* `clarifications.yaml`ï¼šâ‰¤8 ä¸ªå…³é”®é—®é¢˜ + é»˜è®¤å‡è®¾æ¸…å•ï¼ˆAssumption Registerï¼‰ã€‚
* `product_spec.md`ï¼šå®Œæ•´è§„åˆ’ï¼ˆ10 éƒ¨åˆ†ï¼Œå«ç”¨æˆ·æµç¨‹ã€æ¶æ„ã€æŠ€æœ¯é€‰å‹ã€é£é™©ä¸åº”å¯¹ï¼‰ã€‚
* `tasks/*.json`ï¼šæŒ‰éƒ¨é—¨åˆ†ç»„çš„ä»»åŠ¡å¡ï¼ˆç¬¦åˆç»Ÿä¸€ JSON Schemaï¼‰ã€‚
* `timeline.md`ï¼šWeek1â€“4 çš„é‡Œç¨‹ç¢‘æ’æœŸä¸å¹¶è¡Œç­–ç•¥ã€‚
* `handoff.md`ï¼šäº¤ä»˜å£å¾„ï¼ˆç»™è€æ¿æ¼”ç¤ºè·¯å¾„ã€ç»™å„éƒ¨é—¨åä½œå¥‘çº¦ã€QA/Reviewer/Deploy çš„é—¨ç¦è¦æ±‚ï¼‰ã€‚

> ğŸŒŸ **ä½ å¯ä»¥åƒå¯¹ä¸€ä¸ªäº§å“æ€»ç›‘è¯´è¯**ï¼šâ€œæˆ‘æƒ³åšä¸€ä¸ª CMS é…ç½®ç³»ç»Ÿï¼Œ4 å‘¨å¯æ¼”ç¤ºï¼Œé¢„ç®— 1500 ç¾é‡‘ã€‚â€ å…¶ä½™å·¥ä½œæˆ‘å…¨åŒ…ã€‚

---

# skills/product\_planner\_skill/RULES.md

> æœ¬æ–‡æ˜¯äº§å“ç»ç†çš„**è¡Œä¸ºçº¢çº¿ä¸çº¦æŸ**ã€‚ä»»ä½•è¿åæœ¬è§„åˆ™çš„äº§å‡ºå°†è¢«é€€å›æˆ–é˜»æ–­ã€‚

## æ€»åˆ™

* âœ… å¿…é¡»å…ˆè¿›è¡Œ**ä¸‰é˜¶æ®µæ¾„æ¸…**ï¼ˆå•†ä¸šç›®æ ‡ã€æŠ€æœ¯è¾¹ç•Œã€éªŒæ”¶å£å¾„ï¼‰åæ‰èƒ½è¿›å…¥è§„åˆ’ã€‚

* âœ… è‹¥è€æ¿åœ¨æ—¶é™å†…æœªç­”å¤ï¼Œå¿…é¡»è®°å½•**é»˜è®¤å‡è®¾**ï¼Œå¹¶æ ‡æ³¨**å¤æ ¸é‡Œç¨‹ç¢‘**ã€‚

* âœ… ä»»åŠ¡å¡å¿…é¡»ç¬¦åˆç»Ÿä¸€ **JSON Schema**ï¼Œ**æ ¸å¿ƒå¿…å¡« 18 å­—æ®µ**é½å…¨ï¼ˆè§ä¸‹ï¼‰ã€‚

* âœ… æ¯å¼ ä»»åŠ¡å¡**å·¥ä½œé‡ 4â€“12 å°æ—¶**ï¼›è¶…å‡ºéœ€æ‹†åˆ†ï¼Œä¸è¶³éœ€åˆå¹¶ã€‚

* âœ… æ‰€æœ‰è·¨éƒ¨é—¨åä½œå¿…é¡»ä»¥**å¥‘çº¦æ–‡ä»¶**ï¼ˆOpenAPI/UI/äº‹ä»¶ï¼‰ä¸ºä¸­å¿ƒï¼›æ–‡å­—è¯´æ˜ä»…ä½œè¡¥å……ã€‚

* âœ… Reviewer ä»…èƒ½å‘**ä¿®å¤ä»»åŠ¡å¡**ï¼ˆR/Fix ç±»ï¼‰ï¼›**åŠŸèƒ½ç±»ä»»åŠ¡å¡**åªç”± Product Planner å‘èµ·ã€‚

* âœ… æ‰€æœ‰è¾“å‡ºå¿…é¡»åŒ…å«**éªŒæ”¶æ ‡å‡†**ä¸**AI æ‰§è¡Œæç¤ºè¯**ï¼ˆaiPromptSuggestionï¼‰ã€‚

* âœ… ä¸¥æ ¼åŒºåˆ† P0ï¼ˆMVP å¿…é¡»ï¼‰/P1ï¼ˆé‡è¦ï¼‰/P2ï¼ˆä¼˜åŒ–ï¼‰ï¼Œå¹¶ä½“ç°åœ¨æ—¶é—´è¡¨ä¸­ã€‚

* âŒ ç¦æ­¢è·³è¿‡æ¾„æ¸…ç›´æ¥ç»™å‡ºè§„åˆ’ä¸ä»»åŠ¡å¡ã€‚

* âŒ ç¦æ­¢è¾“å‡ºæœªåˆ†éƒ¨é—¨çš„â€œæ··åˆå¡â€æˆ–ç¼ºå°‘éªŒæ”¶æ ‡å‡†çš„å¡ã€‚

* âŒ ç¦æ­¢ä¼°ç®— >12h ä»ä¸æ‹†åˆ†ï¼›æˆ– <4h ä»å•ç‹¬æˆå¡ã€‚

* âŒ ç¦æ­¢åœ¨å¡å†…éšå«è·¨éƒ¨é—¨ä¾èµ–å´ä¸æ ‡æ³¨ `needsCoordination`ã€‚

* âŒ ç¦æ­¢ Planner è‡ªè¡Œä¸‹åœºå†™ä»£ç ï¼ˆåº”äº¤ç»™ç›¸åº”éƒ¨é—¨ï¼‰ã€‚

* âŒ ç¦æ­¢ Planner å‘èµ·â€œä¿®å¤å¡â€ï¼ˆé‚£æ˜¯ Reviewer çš„æƒè´£ï¼‰ã€‚

## ç»Ÿä¸€ä»»åŠ¡å¡æ ¸å¿ƒå¿…å¡« 18 å­—æ®µ

> ä¸ºç®€åŒ– 0 åŸºç¡€ä½¿ç”¨è€…ç†è§£ï¼Œæœ¬æ‰‹å†Œå®šä¹‰**æ ¸å¿ƒå¿…å¡« 18 å­—æ®µ**ï¼›å…¶ä½™ä¸ºå¯é€‰æ‰©å±•å­—æ®µã€‚

1. `taskId`
2. `projectId`
3. `module`
4. `title`
5. `department`ï¼ˆBackend/Frontend/SCF/QA/Deploy/Reviewer/BillingGuardï¼‰
6. `phase`ï¼ˆClarify/Planning/MVP/Beta/Hardening/Releaseï¼‰
7. `priority`ï¼ˆP0/P1/P2ï¼‰
8. `estimatedHours`ï¼ˆ4â€“12ï¼‰
9. `dependencies`ï¼ˆæ•°ç»„ï¼Œä»»åŠ¡IDï¼‰
10. `description`ï¼ˆäººç±»å¯è¯»ï¼‰
11. `technicalRequirements`ï¼ˆæ•°ç»„ï¼‰
12. `acceptanceCriteria`ï¼ˆæ•°ç»„ï¼ŒGiven/When/Then æˆ–æ–­è¨€å¥ï¼‰
13. `deliverables`ï¼ˆäº¤ä»˜ç‰©è·¯å¾„æ¸…å•ï¼‰
14. `needsCoordination`ï¼ˆè·¨éƒ¨é—¨å¥‘çº¦ï¼šå¯¹è±¡æ•°ç»„ï¼‰
15. `aiPromptSuggestion`ï¼ˆsystem/user åŒæ®µå¼æç¤ºï¼‰
16. `reviewPolicy`ï¼ˆæ˜¯å¦éœ€è¦ Reviewerã€å®¡æŸ¥é—¨ç±»ï¼‰
17. `qaPolicy`ï¼ˆQAè¦æ±‚ï¼šå†’çƒŸ/å›å½’/è¦†ç›–ç‡ï¼‰
18. `status`ï¼ˆDraft/Ready/Assigned/InProgress/ForReview/QA/Doneï¼‰

> **å…è®¸ä½†éå¿…å¡«ï¼ˆå»ºè®®ï¼‰**ï¼š`dbDesign`ã€`apiContract`ã€`uiSpecs`ã€`budget`ã€`metrics`ã€`links`ã€`artifacts`ã€`createdAt`ã€`createdByRole`ã€`riskLevel`ã€`dueDate`ã€`notes` ç­‰ã€‚

## è¾“å‡ºæ ¼å¼å¿…é¡»åŒ…å«çš„ **10 ä¸ªéƒ¨åˆ†**

1. èƒŒæ™¯ä¸ç›®æ ‡ï¼ˆå« KPIï¼‰
2. ç”¨æˆ·ç”»åƒä¸å…³é”®åœºæ™¯
3. èŒƒå›´ä¸ä¼˜å…ˆçº§ï¼ˆP0/P1/P2ï¼‰
4. æŠ€æœ¯é€‰å‹ï¼ˆè‡ªç ”/ç¬¬ä¸‰æ–¹/æ··åˆï¼‰ä¸ç†ç”±
5. æ¶æ„ä¸å¥‘çº¦ï¼ˆåç«¯/å‰ç«¯/SCF/äº‹ä»¶ï¼‰
6. æ•°æ®ä¸æƒé™ï¼ˆæ¨¡å‹ã€RBACã€å®¡è®¡ï¼‰
7. é£é™©ä¸åº”å¯¹ï¼ˆå«é»˜è®¤å‡è®¾æ¸…å•ï¼‰
8. ä»»åŠ¡å¡æ¸…å•ï¼ˆæŒ‰éƒ¨é—¨åˆ†ç»„ï¼Œå« 18 å­—æ®µï¼‰
9. å‘¨è®¡åˆ’ï¼ˆé‡Œç¨‹ç¢‘ï¼‰
10. éªŒæ”¶ä¸äº¤ä»˜ï¼ˆæ¼”ç¤ºè„šæœ¬ã€æ–‡æ¡£ã€é—¨ç¦ï¼‰

> åä¾‹ï¼š
>
> * âŒ åªç»™â€œåŠŸèƒ½ç‚¹åˆ—è¡¨â€ï¼Œç¼ºå°‘ KPIã€å¥‘çº¦ã€é£é™©ä¸éªŒæ”¶ã€‚
> * âŒ ä»»åŠ¡å¡æ²¡æœ‰ `acceptanceCriteria` æˆ–æ²¡æœ‰ `aiPromptSuggestion`ã€‚
> * âŒ å‘¨è®¡åˆ’æœªä½“ç°å¹¶è¡Œç­–ç•¥ä¸ä¾èµ–å…³ç³»ã€‚

## æ‹†åˆ†ä¸ä¾èµ–è§„åˆ™

* âœ… **ç²’åº¦**ï¼šæ¯å¡ 4â€“12hï¼›è¶…å‡ºå¿…é¡»æ‹†åˆ†ï¼›ä¸è¶³åˆå¹¶ã€‚

* âœ… **ç»´åº¦**ï¼šæŒ‰éƒ¨é—¨ï¼ˆBackend/Frontend/SCF/QA/Reviewer/Deployï¼‰+ æ¨¡å—ï¼ˆå¦‚ content-type-builderï¼‰ã€‚

* âœ… **ä¾èµ–**ï¼šç”¨ `dependencies` æ˜ç¡®å¼•ç”¨ï¼›è·¨éƒ¨é—¨ä¾èµ–åŒæ­¥æ ‡æ³¨ `needsCoordination` å¹¶æŒ‡å®šå¥‘çº¦æ–‡ä»¶è·¯å¾„ã€‚

* âœ… **ä¼˜å…ˆçº§**ï¼šP0 ä¸º MVP å¿…é¡»ï¼›P1 ä¸ºé‡è¦å¢å¼ºï¼›P2 ä¸ºä¼˜åŒ–ä¸å·¥å…·åŒ–ã€‚

* âœ… **é‡Œç¨‹ç¢‘**ï¼šWeek1â€“4 åˆ†å‘¨ï¼Œä¿è¯ä¸²å¹¶è¡Œåˆç†ï¼Œé¿å…å•ç‚¹é˜»å¡ã€‚

* âŒ ç”¨â€œç»¼åˆå¡â€åŒ…å«å¤šä¸ªéƒ¨é—¨å·¥ä½œã€‚

* âŒ æ²¡æœ‰ä»»ä½•ä¾èµ–æ ‡æ³¨å¯¼è‡´å‰ç«¯å…ˆäºåç«¯å¥‘çº¦å¯åŠ¨ã€‚

* âŒ P0 ä¸ P1/P2 ä¸åŒºåˆ†ï¼Œå¯¼è‡´ MVP å¤±ç„¦ã€‚

## åä½œä¸äº‹ä»¶é©±åŠ¨

* âœ… Backend å®Œæˆæ¥å£ â†’ è§¦å‘ `API_CONTRACT_READY`ï¼ˆæºå¸¦ OpenAPI è·¯å¾„ä¸ç‰ˆæœ¬ï¼‰â†’ Frontend `API_CONTRACT_ACK`ã€‚

* âœ… SCF å›è°ƒ/å¼‚æ­¥ä½œä¸š â†’ `SCF_JOB_DONE/FAILED` äº‹ä»¶ï¼Œåç«¯/QA è®¢é˜…å¤„ç†ã€‚

* âœ… Reviewer å®¡æŸ¥ PR â†’ `REVIEW_APPROVED` æˆ– `REVIEW_CHANGES_REQUESTED`ï¼›å¦‚éœ€ä¿®å¤ï¼Œ**Reviewer è¾“å‡ºä¿®å¤å¡**å¹¶å›æ¨éƒ¨é—¨ã€‚

* âœ… QA éªŒæ”¶ â†’ `QA_SMOKE_PASSED/REGRESSION_FAILED` é©±åŠ¨æ˜¯å¦å¯è¿›å…¥éƒ¨ç½²ã€‚

* âœ… Billing Guard è¶…é¢„ç®— â†’ `BILLING_BUDGET_EXCEEDED` é˜»æ–­æ‰§è¡Œå¹¶è¦æ±‚è°ƒæ•´æ–¹æ¡ˆã€‚

* âŒ ä»¥å£å¤´è¯´æ˜æ›¿ä»£å¥‘çº¦æ–‡ä»¶ï¼›å¿…é¡»æœ‰æ–‡ä»¶è·¯å¾„ï¼ˆOpenAPI/UI/äº‹ä»¶ï¼‰ã€‚

* âŒ è¶Šæƒå‘å¡ï¼šPlanner ä¸å¾—å‘ä¿®å¤å¡ï¼›Reviewer ä¸å¾—å‘åŠŸèƒ½å¡ã€‚

---

# skills/product\_planner\_skill/CONTEXT.md

æœ¬æ–‡ä»¶æ±‡æ€»**é¡¹ç›®èƒŒæ™¯çŸ¥è¯†**ä¸**æ ‡å‡†åŒ–è§„èŒƒå¼•ç”¨**ï¼Œä¾›æˆ‘åœ¨è§„åˆ’ä¸æ‹†å¡ä¸­ä½¿ç”¨ã€‚

## 1. æŠ€æœ¯æ ˆä¸è¿è¡Œç¯å¢ƒ

* **å‰ç«¯**ï¼šNext.js 14 + React 18 + TypeScript + Ant Design

  * æ„å»ºï¼šViteï¼ˆå¦‚å…¼å®¹ Next æ„å»ºé“¾åˆ™ä½¿ç”¨ Next åŸç”Ÿå·¥å…·é“¾ï¼‰
  * çŠ¶æ€ç®¡ç†ï¼šZustand
  * æµ‹è¯•ï¼šPlaywrightï¼ˆE2Eï¼‰
* **åç«¯**ï¼šExpress.js + Knex.js + MySQL 8.0 + Redis

  * é‰´æƒï¼šJWT + RBAC
  * æ•°æ®è®¿é—®ï¼šKnexï¼ˆè¿ç§»/ç§å­ï¼‰
  * ç¼“å­˜ï¼šRedisï¼ˆçƒ­ç‚¹æ•°æ®/é™æµï¼‰
  * æµ‹è¯•ï¼šJest + Supertest
* **éƒ¨ç½²**ï¼š4æ ¸4G äº‘æœåŠ¡å™¨ + PM2 é›†ç¾¤ï¼ˆ3 è¿›ç¨‹ï¼‰+ å®å¡”é¢æ¿ï¼ˆNginx/é˜²ç«å¢™/æ–‡ä»¶ç®¡ç†ï¼‰
* **äº‘å‡½æ•°**ï¼šè…¾è®¯äº‘ SCFï¼ˆå¼‚æ­¥ä»»åŠ¡ã€COS å›è°ƒã€Webhook è½¬å‘ï¼‰
* **å­˜å‚¨**ï¼šè…¾è®¯äº‘ COSï¼ˆç›´ä¼ ã€CDNï¼‰

## 2. æ ¸å¿ƒä¸šåŠ¡æ¶æ„

### 2.1 Pipeline æ‰§è¡Œå¼•æ“

* ç‰¹æ€§ï¼šå¤šæ­¥éª¤ä¸²è¡Œæ‰§è¡Œã€**è¶…æ—¶/é‡è¯•/é™çº§**ï¼›å¯æ’å…¥å¼‚æ­¥æ­¥éª¤ï¼ˆSCFï¼‰
* å…ƒæ•°æ®ï¼š`pipeline_schemas`ï¼ˆJSONï¼‰å®šä¹‰æ­¥éª¤åç§°ã€è¾“å…¥/è¾“å‡ºã€é‡è¯•ç­–ç•¥ã€é™çº§ç­–ç•¥
* å…³é”®ç‚¹ï¼š**å¯è§‚æµ‹æ€§**ï¼ˆtraceIdã€stepIdï¼‰ã€å¹‚ç­‰ã€å¤±è´¥å›é€€ç­–ç•¥

### 2.2 Provider ä¾›åº”å•†ä½“ç³»

* å·²é›†æˆï¼šRunningHubã€æ··å…ƒ(Hunyuan)ã€è…¾è®¯äº‘
* ç»Ÿä¸€æŠ½è±¡ï¼š`ProviderAdapter` æ¥å£ï¼›é…ç½®åœ¨ `feature_definitions` æˆ– `pipeline_schemas` ä¸­å¼•ç”¨
* å…³é”®ç‚¹ï¼š**é…é¢ä¸è®¡è´¹**è€¦åˆã€**æ¨¡å‹åˆ‡æ¢å®¹é”™**ã€**é™æµä¸ç†”æ–­**

### 2.3 åŠ¨æ€é…ç½®ç³»ç»Ÿ

* `form_schemas`ï¼šç”¨äºå‰ç«¯åŠ¨æ€è¡¨å•æ¸²æŸ“ï¼ˆAntD ç»„ä»¶æ˜ å°„ï¼‰
* `pipeline_schemas`ï¼šæè¿° pipeline å„æ­¥éª¤å¥‘çº¦
* `feature_definitions`ï¼šæè¿°åŠŸèƒ½å¼€å…³ã€ç°åº¦ã€äººç¾¤ç­–ç•¥ã€é»˜è®¤ providerã€è°ƒç”¨é…é¢ç­‰

### 2.4 é…é¢ç®¡ç†ç³»ç»Ÿï¼ˆå•†ä¸šæ¨¡å‹ï¼‰

* ä¼šå‘˜ç­‰çº§ + é…é¢ç‚¹æ•°ï¼ˆè°ƒç”¨æ¬¡æ•°/Token æ•°/æ—¶é•¿ï¼‰
* æ‰£å‡ç­–ç•¥ï¼š**å…ˆæ£€ä½™é¢åè°ƒç”¨**ï¼Œå¤±è´¥å›æ»šï¼›
* å……å€¼/å‘æ”¾ï¼šæ‰‹å·¥/è‡ªåŠ¨ï¼›
* ç»Ÿè®¡ï¼šæŒ‰ç”¨æˆ·/åŠŸèƒ½/æ—¶é—´ç»´åº¦ï¼›
* å…³é”®è¡¨ï¼š`memberships`ã€`quota_ledger`ã€`quota_products`ã€‚

## 3. ç”¨æˆ·ç”»åƒï¼ˆç¤ºä¾‹ï¼‰

* **Cç«¯å°å•†å®¶**ï¼šéœ€è¦å¿«é€Ÿæ­å»ºè¥é”€é¡µä¸å†…å®¹ç®¡ç†ï¼›é¢„ç®—æœ‰é™ï¼Œå€¾å‘å¼€ç®±å³ç”¨ã€‚
* **Bç«¯æ‘„å½±å·¥ä½œå®¤**ï¼šç»´æŠ¤ä½œå“é›†ã€æ‰¹é‡å¯¼å…¥åª’ä½“ã€å‘å¸ƒå®¡æ ¸ä¸å›æ»šï¼›é‡è§†æƒé™ä¸å®¡è®¡ã€‚
* **å†…éƒ¨è¿è¥**ï¼šé…ç½® pipeline ä¸è¡¨å• schemaï¼Œå¿«é€Ÿä¸Šçº¿æ–°â€œåŠŸèƒ½å¡ç‰‡â€ã€‚

## 4. é‡è¦ SPEC å¼•ç”¨ï¼ˆå»ºè®®åœ¨ä»“åº“ä¸­æä¾›ï¼‰

* **FEATURE\_DEFINITION\_SPEC**ï¼ˆå»ºè®®/ç¤ºä¾‹ç‰‡æ®µï¼‰

  ```json
  {
    "$id": "feature-definition",
    "featureKey": "cms.core",
    "enabled": true,
    "defaultProvider": "hunyuan",
    "quotaPolicy": { "unit": "call", "costPerCall": 1 },
    "rollout": { "strategy": "all" }
  }
  ```
* **FORM\_SCHEMA\_SPEC**ï¼ˆAntD æ˜ å°„çº¦å®šï¼‰

  ```json
  {
    "$id": "form-schema",
    "title": "å†…å®¹ç±»å‹å»ºæ¨¡",
    "fields": [
      { "name": "name", "label": "åç§°", "type": "input", "rules": ["required"] },
      { "name": "slug", "label": "æ ‡è¯†", "type": "input", "rules": ["required","slug"] },
      { "name": "fields", "label": "å­—æ®µå®šä¹‰", "type": "list", "itemType": {
        "type": "group",
        "fields": [
          {"name":"key","type":"input","rules":["required"]},
          {"name":"type","type":"select","options":["text","number","boolean","enum","ref"]},
          {"name":"required","type":"switch"}
        ]
      }}
    ]
  }
  ```
* **PIPELINE\_SCHEMA\_SPEC**ï¼ˆè¶…æ—¶/é‡è¯•/é™çº§ï¼‰

  ```json
  {
    "$id": "pipeline-schema",
    "name": "media.ingest",
    "steps": [
      { "id": "precheck", "timeoutMs": 2000 },
      { "id": "enqueueTranscode", "retry": {"times": 3, "backoffMs": 1000}, "fallback": "notifyManual" }
    ]
  }
  ```

## 5. ç»Ÿä¸€ä»»åŠ¡å¡ JSON Schemaï¼ˆæ‘˜è¦ï¼‰

> ä½¿ç”¨é—®é¢˜12ä¸­å®šä¹‰çš„ Schemaï¼›æœ¬æ‰‹å†Œå¼ºè°ƒ**æ ¸å¿ƒå¿…å¡« 18 å­—æ®µ**ï¼ˆè§ RULES.mdï¼‰ï¼Œå¹¶å…è®¸æ‰©å±•å­—æ®µã€‚
> ç”Ÿæˆå¡æ—¶éœ€å¸¦ä¸Š `aiPromptSuggestion`ï¼ˆsystem/user åŒæ®µå¼ï¼‰ï¼Œä¸”æ ‡æ˜ `reviewPolicy` / `qaPolicy`ã€‚

## 6. åä½œå¥‘çº¦ä¸äº‹ä»¶

* **OpenAPI**ï¼šåç«¯/SCF è¾“å‡ºå¥‘çº¦è·¯å¾„ï¼ˆå¦‚ `openapi/cms-content-type.yaml`ï¼‰
* **UI åŸå‹**ï¼šå‰ç«¯æä¾› Figma/æˆªå›¾è·¯å¾„
* **äº‹ä»¶**ï¼šç³»ç»Ÿç»Ÿä¸€ä¸»é¢˜ï¼š

  * `API_CONTRACT_READY`ã€`API_CONTRACT_ACK`
  * `SCF_JOB_SCHEDULED/SCF_JOB_DONE/SCF_JOB_FAILED`
  * `REVIEW_APPROVED/REVIEW_CHANGES_REQUESTED`
  * `QA_SMOKE_PASSED/QA_REGRESSION_FAILED`
  * `BILLING_BUDGET_EXCEEDED`

---

# skills/product\_planner\_skill/EXAMPLES.md

æœ¬æ–‡ä»¶æä¾›**çœŸå®å¯ç”¨**çš„æ ‡å‡†è¾“å‡ºç¤ºä¾‹ï¼Œä¾¿äºå¤åˆ¶è½åœ°ã€‚

## ç¤ºä¾‹1ï¼šä¸‰é˜¶æ®µéœ€æ±‚æ¾„æ¸…å¯¹è¯

**èƒŒæ™¯**ï¼šè€æ¿è¯´ï¼šâ€œæˆ‘è¦ä¸€ä¸ª CMS é…ç½®ç³»ç»Ÿï¼Œ4 å‘¨å¯æ¼”ç¤ºã€‚â€

**é˜¶æ®µAï¼šå•†ä¸šç›®æ ‡ï¼ˆ3â€“5é—®ï¼‰**

1. ç›®æ ‡ KPI æ˜¯ä»€ä¹ˆï¼Ÿä¾‹å¦‚**ä¸Šçº¿æ—¶é—´**ã€é¢„è®¡**å†…å®¹ç±»å‹æ•°é‡**ã€**ç®¡ç†å‘˜äººæ•°**ã€**æ¯æ—¥å†…å®¹é¡¹ CRUD é‡çº§**ï¼Ÿ
2. é¢„ç®—ä¸Šé™æ˜¯å¤šå°‘ï¼Ÿæ˜¯å¦å¸Œæœ›**æˆæœ¬æœ€å°åŒ–**ä¼˜å…ˆï¼Ÿ
3. ç”¨æˆ·æ˜¯è°ï¼Ÿæ˜¯**å†…éƒ¨è¿è¥**è¿˜æ˜¯**å¤–éƒ¨å•†å®¶**ï¼Ÿæ˜¯å¦å­˜åœ¨**åˆè§„è¦æ±‚**ï¼ˆæ•°æ®é©»ç•™/å®¡è®¡ï¼‰ï¼Ÿ

**é˜¶æ®µBï¼šæŠ€æœ¯è¾¹ç•Œï¼ˆ2â€“3é—®ï¼‰**
4\. æŠ€æœ¯åå¥½ï¼š**è‡ªç ”**ä¸ºä¸»è¿˜æ˜¯**ç¬¬ä¸‰æ–¹/æ··åˆ**ï¼Ÿæ˜¯å¦å…è®¸ä½¿ç”¨ COSã€SCFã€Redisï¼Ÿ
5\. æ˜¯å¦å·²æœ‰åŸŸåã€æœåŠ¡å™¨èµ„æºï¼ˆ4æ ¸4G + PM2 + å®å¡”é¢æ¿ï¼‰å¯å¤ç”¨ï¼Ÿ
6\. æ˜¯å¦è¦æ±‚**å‰åç«¯åˆ†ç¦»**ï¼Œä»¥åŠæ˜¯å¦çº¦å®š **Next.js 14 / Express + Knex + MySQL 8** æ ‡é…ï¼Ÿ

**é˜¶æ®µCï¼šéªŒæ”¶æ ‡å‡†ï¼ˆ2â€“3é—®ï¼‰**
7\. MVP æ¼”ç¤ºè·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆä¾‹å¦‚ï¼šå»ºä¸€ä¸ªâ€œæ–‡ç« â€ç±»å‹ â†’ æ–°å»ºæ–‡ç«  â†’ å®¡æ ¸å‘å¸ƒ â†’ å‰å° API å¯è¯»å–ï¼‰
8\. éªŒæ”¶ä»¥**å¯æ¼”ç¤ºè·¯å¾„è·‘é€š**ä¸ºå‡†ï¼Œè¿˜æ˜¯éœ€è¦**UTâ‰¥80%/E2E** ä¹Ÿè¾¾æ ‡ï¼Ÿ
9\. æ˜¯å¦éœ€è¦**å®¡è®¡æ—¥å¿—**ä¸**RBAC**åœ¨ MVP ä¸€å¹¶ä¸Šçº¿ï¼Ÿ

**è‹¥è€æ¿æœªç­”å¤ï¼ˆé»˜è®¤å‡è®¾ç¤ºä¾‹ï¼‰**

* A-001ï¼šç®¡ç†å‘˜â‰¤5ï¼Œå†…å®¹ç±»å‹â‰¤20ï¼Œæ—¥ CRUD â‰¤ 2000ã€‚
* A-002ï¼šå…è®¸ä½¿ç”¨ COS å­˜å‚¨ã€å¤šåŒºåŸŸæ— å¼ºåˆ¶è¦æ±‚ã€å›½å†…å•åŒºå³ MVPã€‚
* A-003ï¼šMVP åªè¦æ±‚**æ¼”ç¤ºè·¯å¾„**ä¸**æ ¸å¿ƒ UT â‰¥ 70%**ï¼ŒE2E åœ¨ Beta å®Œæˆã€‚

---

## ç¤ºä¾‹2ï¼šå®Œæ•´äº§å“è§„åˆ’è¾“å‡ºï¼ˆ10éƒ¨åˆ†ï¼‰

> é¡¹ç›®ï¼š**CMS**ï¼›ç›®æ ‡ï¼š4 å‘¨å¯æ¼”ç¤ºï¼›é¢„ç®—ï¼š1500 ç¾é‡‘ï¼ˆè½¯ä¸Šé™ï¼‰

1. **èƒŒæ™¯ä¸ç›®æ ‡**

* å¸®åŠ©è¿è¥åœ¨ 4 å‘¨å†…ä¸Šçº¿å¯æ¼”ç¤º CMSï¼šå»ºæ¨¡â†’å†…å®¹â†’å®¡æ ¸å‘å¸ƒâ†’å‰å°è¯»å–ã€‚
* KPIï¼šMVP æ¼”ç¤ºè·¯å¾„å¯è·‘é€šï¼›ç®¡ç†å‘˜â‰¤5ï¼›å†…å®¹ç±»å‹â‰¤20ï¼›å¹³å‡å“åº” P95 â‰¤ 200msã€‚

2. **ç”¨æˆ·ç”»åƒä¸å…³é”®åœºæ™¯**

* è¿è¥åˆ›å»ºå†…å®¹ç±»å‹ï¼ˆæ–‡ç« /ä½œå“/é¡µé¢ï¼‰ï¼Œç¼–è¾‘å†…å®¹ï¼Œå®¡æ ¸å‘å¸ƒï¼ŒæŸ¥çœ‹å†å²ç‰ˆæœ¬ä¸å›æ»šã€‚
* å°å•†å®¶é…ç½®è¥é”€é¡µï¼›æ‘„å½±å·¥ä½œå®¤æ‰¹é‡ç®¡ç†ä½œå“ä¸åª’èµ„ã€‚

3. **èŒƒå›´ä¸ä¼˜å…ˆçº§**

* **P0**ï¼šå†…å®¹ç±»å‹å»ºæ¨¡ã€å†…å®¹é¡¹ CRUDã€RBACï¼ˆ3 è§’è‰²ï¼‰ã€å‘å¸ƒçŠ¶æ€æœºã€åª’ä½“ç›´ä¼ ç­¾åã€å®¡è®¡æ—¥å¿—ï¼ˆç®€ç‰ˆï¼‰ã€å¥åº·æ£€æŸ¥ã€é”™è¯¯ç»Ÿä¸€ã€‚
* **P1**ï¼šåª’ä½“å…ƒæ•°æ®ã€å‘å¸ƒ Webhookã€åˆ—è¡¨é«˜çº§ç­›é€‰ã€E2E æµ‹è¯•é›†ã€‚
* **P2**ï¼šæœç´¢ DSLã€å›½é™…åŒ–ã€å¯¼å…¥å¯¼å‡ºã€‚

4. **æŠ€æœ¯é€‰å‹ï¼ˆæ··åˆï¼‰**

* è‡ªç ”ï¼šæ ¸å¿ƒå»ºæ¨¡/å†…å®¹/æƒé™/å‘å¸ƒï¼›
* ç¬¬ä¸‰æ–¹ï¼šCOSï¼ˆå­˜å‚¨ï¼‰ã€SCFï¼ˆè½¬ç /å›è°ƒï¼‰ã€Redisï¼ˆç¼“å­˜ï¼‰ã€‚
* æ ˆï¼šNext.js 14 + AntD + Zustandï¼›Express + Knex + MySQL 8 + Redisï¼›PM2 ä¸‰è¿›ç¨‹ã€‚

5. **æ¶æ„ä¸å¥‘çº¦**

* APIï¼šREST + OpenAPIï¼ˆå¥‘çº¦å…ˆè¡Œï¼‰
* å‰ç«¯ï¼šåŸºäº AntD çš„å»ºæ¨¡ UI ä¸å†…å®¹ç®¡ç†å°
* äº‹ä»¶ï¼š`API_CONTRACT_READY/ACK`ã€`SCF_JOB_*`ã€`REVIEW_*`ã€`QA_*`
* é‰´æƒï¼šJWT + RBACï¼ˆAdmin/Editor/Viewerï¼‰

6. **æ•°æ®ä¸æƒé™**

* è¡¨ï¼š`content_types`ã€`content_fields`ã€`content_items`ã€`audit_logs`ã€`users`ã€`roles`ã€`role_bindings`
* ç´¢å¼•ï¼š`content_types.slug` å”¯ä¸€ï¼›`content_items(type_id,status)` å¤åˆç´¢å¼•
* æƒé™ï¼šAdminï¼ˆå…¨æƒï¼‰ã€Editorï¼ˆç¼–è¾‘ä¸æäº¤å®¡æ ¸ï¼‰ã€Viewerï¼ˆåªè¯»ï¼‰

7. **é£é™©ä¸åº”å¯¹ï¼ˆå«é»˜è®¤å‡è®¾ï¼‰**

* éœ€æ±‚è†¨èƒ€ â†’ ä¸¥æ ¼æ‰§è¡Œ P0 æ¸…å•ï¼›
* åª’ä½“å¤„ç†è€—æ—¶ â†’ ä¸‹æ”¾ SCF å¼‚æ­¥ + å›è°ƒï¼›
* æ€§èƒ½ç“¶é¢ˆ â†’ Redis ç¼“å­˜ + å¿…è¦ç´¢å¼•ï¼›
* A-001/A-002/A-003 é»˜è®¤å‡è®¾åœ¨ Week2 é‡Œç¨‹ç¢‘å‰å¤æ ¸ã€‚

8. **ä»»åŠ¡å¡æ¸…å•ï¼ˆæŒ‰éƒ¨é—¨ï¼‰**

> èŠ‚é€‰ï¼Œè¯¦è§ç¤ºä¾‹3

9. **å‘¨è®¡åˆ’**

* **Week1**ï¼šB-001/002/012/015ã€F-001/008ã€è§„åˆ’è½åº“
* **Week2**ï¼šB-003ã€F-002/003ã€S-001/002
* **Week3**ï¼šB-004/005ã€F-005/006ã€S-003ã€QA-Q-001
* **Week4**ï¼šQA-Q-002/003ã€ä¼˜åŒ–ä¸éƒ¨ç½²ã€æ¼”ç¤ºè„šæœ¬

10. **éªŒæ”¶ä¸äº¤ä»˜**

* æ¼”ç¤ºè„šæœ¬ï¼šåˆ›å»ºâ€œæ–‡ç« â€ç±»å‹ â†’ æ–°å»ºæ–‡ç«  â†’ å®¡æ ¸å‘å¸ƒ â†’ å‰å°æŸ¥è¯¢
* æ–‡æ¡£ï¼šOpenAPIã€UI åŸå‹ã€äº‹ä»¶å¥‘çº¦ã€æµ‹è¯•æŠ¥å‘Šã€ä¸Šçº¿å•
* é—¨ç¦ï¼šReviewer é€šè¿‡ã€QA å†’çƒŸ/å¿…è¦å›å½’é€šè¿‡ã€Billing Guard é¢„ç®—æœªè¶…

---

## ç¤ºä¾‹3ï¼šä»»åŠ¡å¡æ¸…å•ï¼ˆJSONï¼ŒçœŸå®å¯ç”¨ï¼‰

> ä»¥ä¸‹ 8 å¼ å¡è¦†ç›– Backend/Frontend/SCF/QA/Reviewer/Deploy æ ¸å¿ƒè·¯å¾„ï¼Œå­—æ®µéµå¾ª**æ ¸å¿ƒå¿…å¡« 18 é¡¹**ï¼Œå¹¶ç¤ºä¾‹è‹¥å¹²å¯é€‰å­—æ®µã€‚

### CMS-B-001ï¼ˆBackendï¼‰

```json
{
  "taskId": "CMS-B-001",
  "projectId": "CMS",
  "module": "content-type-builder",
  "title": "å†…å®¹ç±»å‹ CRUD ä¸å­—æ®µæ ¡éªŒï¼ˆOpenAPI å…ˆè¡Œï¼‰",
  "department": "Backend",
  "phase": "MVP",
  "priority": "P0",
  "estimatedHours": 8,
  "dependencies": [],
  "description": "å®ç° content_types ä¸ content_fields çš„ CRUDï¼Œæ”¯æŒå­—æ®µç±»å‹(text/number/boolean/enum/ref)ä¸åŸºç¡€æ ¡éªŒï¼›æä¾› OpenAPI å¥‘çº¦ã€‚",
  "technicalRequirements": [
    "Express + Knex + MySQL 8",
    "é‰´æƒï¼šJWT + RBAC å ä½",
    "æ•°æ®åº“è¿ç§» + ç´¢å¼•"
  ],
  "acceptanceCriteria": [
    { "id": "AC1", "type": "Functional", "statement": "åˆ›å»ºåˆæ³•å†…å®¹ç±»å‹è¿”å›201å¹¶å¯æŸ¥è¯¢" },
    { "id": "AC2", "type": "Security", "statement": "æœªæˆæƒè®¿é—®è¿”å›401/403" }
  ],
  "deliverables": [
    "openapi/cms-content-type.yaml",
    "src/api/content-types/*.ts",
    "migrations/2025-10-30-ct-init.sql",
    "tests/content-types/*.spec.ts"
  ],
  "needsCoordination": [
    { "withDept": "Frontend", "topic": "å­—æ®µç»„ä»¶æ˜ å°„", "artifact": "openapi/cms-content-type.yaml" }
  ],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯èµ„æ·±Nodeåç«¯å·¥ç¨‹å¸ˆï¼Œç†Ÿæ‚‰Express+Knex+MySQLä¸TDDã€‚",
    "user": "æ ¹æ®OpenAPIå¥‘çº¦å®ç°è·¯ç”±/æ§åˆ¶å™¨/æœåŠ¡/DAOä¸è¿ç§»è„šæœ¬ï¼ŒUTâ‰¥80%ï¼Œæä¾›ç¤ºä¾‹ç§å­æ•°æ®ã€‚"
  },
  "reviewPolicy": { "requiresReviewer": true, "gates": ["å®‰å…¨", "è§„èŒƒ"] },
  "qaPolicy": { "requiresQA": true, "testDepth": "Smoke", "coverageTarget": 80 },
  "status": "Ready"
}
```

### CMS-B-002ï¼ˆBackendï¼‰

```json
{
  "taskId": "CMS-B-002",
  "projectId": "CMS",
  "module": "content-item",
  "title": "å†…å®¹é¡¹ CRUDï¼ˆç‰ˆæœ¬ä¸çŠ¶æ€åŸºç¡€ï¼‰",
  "department": "Backend",
  "phase": "MVP",
  "priority": "P0",
  "estimatedHours": 10,
  "dependencies": ["CMS-B-001"],
  "description": "å®ç° content_items çš„ CRUDï¼Œå«åŸºæœ¬ç‰ˆæœ¬å·ä¸ status(draft/review/published)ï¼ŒæŸ¥è¯¢åˆ—è¡¨æ”¯æŒåˆ†é¡µä¸æŒ‰ type è¿‡æ»¤ã€‚",
  "technicalRequirements": [
    "åˆ†é¡µå‚æ•° page/limitï¼Œé»˜è®¤ limit=20",
    "status çŠ¶æ€æœºï¼šdraft->review->published"
  ],
  "acceptanceCriteria": [
    { "id": "AC1", "type": "Functional", "statement": "è‰ç¨¿æäº¤å®¡æ ¸åçŠ¶æ€=review" },
    { "id": "AC2", "type": "Functional", "statement": "å‘å¸ƒåå¯åœ¨å‰å°APIæŸ¥è¯¢åˆ°" }
  ],
  "deliverables": ["openapi/cms-content-item.yaml", "src/api/content-items/*.ts", "tests/content-items/*.spec.ts"],
  "needsCoordination": [{ "withDept": "Frontend", "topic": "åˆ—è¡¨/ç¼–è¾‘UI", "artifact": "openapi/cms-content-item.yaml" }],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯ç†Ÿç»ƒçš„Expressåç«¯å¼€å‘ï¼Œæ“…é•¿Knexä¸MySQLäº‹åŠ¡ã€‚",
    "user": "å®ç°å†…å®¹é¡¹CRUDä¸çŠ¶æ€æœºï¼Œæä¾›äº‹åŠ¡åŒ…è£…ä¸å¿…è¦ç´¢å¼•ï¼ŒUTè¦†ç›–è¾¹ç•Œåœºæ™¯ã€‚"
  },
  "reviewPolicy": { "requiresReviewer": true, "gates": ["æ€§èƒ½", "å®‰å…¨"] },
  "qaPolicy": { "requiresQA": true, "testDepth": "Regression", "coverageTarget": 80 },
  "status": "Ready"
}
```

### CMS-F-001ï¼ˆFrontendï¼‰

```json
{
  "taskId": "CMS-F-001",
  "projectId": "CMS",
  "module": "auth-and-routing",
  "title": "ç™»å½•é¡µä¸æƒé™è·¯ç”±ï¼ˆAntD + Zustandï¼‰",
  "department": "Frontend",
  "phase": "MVP",
  "priority": "P0",
  "estimatedHours": 6,
  "dependencies": [],
  "description": "å®ç°ç™»å½•è¡¨å•ã€è·å–JWTã€åŸºäºè§’è‰²çš„è·¯ç”±å®ˆå«ä¸ä¾§è¾¹èœå•è¿‡æ»¤ã€‚",
  "technicalRequirements": [
    "Next.js 14 App Router",
    "Ant Design Form + Message",
    "Zustand ç®¡ç†ç”¨æˆ·æ€"
  ],
  "acceptanceCriteria": [
    { "id": "AC1", "type": "Functional", "statement": "ç™»å½•æˆåŠŸåè·³è½¬æ§åˆ¶å°é¦–é¡µ" },
    { "id": "AC2", "type": "Security", "statement": "æœªç™»å½•è®¿é—®å—é™é¡µé¢è·³åˆ°ç™»å½•é¡µ" }
  ],
  "deliverables": ["app/(auth)/login/page.tsx", "lib/store/user.ts", "lib/withAuth.tsx", "tests/e2e/auth.spec.ts"],
  "needsCoordination": [{ "withDept": "Backend", "topic": "ç™»å½•API", "artifact": "openapi/auth.yaml" }],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯èµ„æ·±å‰ç«¯å·¥ç¨‹å¸ˆï¼Œç†Ÿæ‚‰ Next14/AntD/Zustandã€‚",
    "user": "å®ç°ç™»å½•ä¸åŸºäºè§’è‰²çš„è·¯ç”±å®ˆå«ï¼Œé”™è¯¯ä¸åŠ è½½æ€ç»Ÿä¸€ï¼Œæä¾›åŸºæœ¬E2Eç”¨ä¾‹ã€‚"
  },
  "reviewPolicy": { "requiresReviewer": true, "gates": ["å¯è®¿é—®æ€§", "UXä¸€è‡´æ€§"] },
  "qaPolicy": { "requiresQA": true, "testDepth": "Smoke" },
  "status": "Ready"
}
```

### CMS-F-002ï¼ˆFrontendï¼‰

```json
{
  "taskId": "CMS-F-002",
  "projectId": "CMS",
  "module": "content-type-builder-ui",
  "title": "å†…å®¹ç±»å‹å»ºæ¨¡ UIï¼ˆå­—æ®µç»„ä»¶åº“ï¼‰",
  "department": "Frontend",
  "phase": "MVP",
  "priority": "P0",
  "estimatedHours": 10,
  "dependencies": ["CMS-B-001"],
  "description": "åŸºäº AntD å®ç°å†…å®¹ç±»å‹ä¸å­—æ®µçš„å¯è§†åŒ–å»ºæ¨¡ï¼ŒåŒ…æ‹¬å­—æ®µå¢åˆ æ”¹æŸ¥ä¸æ ¡éªŒè§„åˆ™é…ç½®ã€‚",
  "technicalRequirements": [
    "å¯¹æ¥ openapi/cms-content-type.yaml è‡ªåŠ¨ç”Ÿæˆå®¢æˆ·ç«¯ç±»å‹",
    "è¡¨å•è”åŠ¨ä¸æ ¡éªŒæç¤º"
  ],
  "acceptanceCriteria": [
    { "id": "AC1", "type": "Functional", "statement": "å¯æ–°å¢å­—æ®µå¹¶å®æ—¶æ ¡éªŒå±•ç¤º" },
    { "id": "AC2", "type": "Functional", "statement": "ä¿å­˜æˆåŠŸååˆ·æ–°åˆ—è¡¨å¯è§æ–°ç±»å‹" }
  ],
  "deliverables": ["app/types/builder/*.tsx", "lib/services/contentType.ts", "tests/e2e/type-builder.spec.ts"],
  "needsCoordination": [{ "withDept": "Backend", "topic": "å­—æ®µæ˜ å°„è§„åˆ™", "artifact": "openapi/cms-content-type.yaml" }],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯ç†Ÿæ‚‰ AntD ä¸è¡¨å•äº¤äº’çš„é«˜çº§å‰ç«¯ã€‚",
    "user": "å®ç°å­—æ®µç»„ä»¶åº“ä¸å»ºæ¨¡UIï¼Œè¡¨å•è¾¹ç•Œæ ¡éªŒå®Œå–„ï¼ŒE2Eè¦†ç›–æ–°å¢/ä¿å­˜/å›æ˜¾ã€‚"
  },
  "reviewPolicy": { "requiresReviewer": true, "gates": ["å¯è®¿é—®æ€§", "ä¸€è‡´æ€§"] },
  "qaPolicy": { "requiresQA": true, "testDepth": "Regression" },
  "status": "Ready"
}
```

### CMS-S-001ï¼ˆSCFï¼‰

```json
{
  "taskId": "CMS-S-001",
  "projectId": "CMS",
  "module": "media-upload-sign",
  "title": "COS ç›´ä¼ ç­¾åäº‘å‡½æ•°",
  "department": "SCF",
  "phase": "MVP",
  "priority": "P0",
  "estimatedHours": 5,
  "dependencies": [],
  "description": "å®ç°è·å– COS ç›´ä¼ ä¸´æ—¶å‡­è¯çš„äº‘å‡½æ•°ï¼›æœ€å°æƒé™ï¼Œç­¾åæœ‰æ•ˆæœŸçŸ­ï¼Œé™åˆ¶æ–‡ä»¶ç±»å‹ä¸å¤§å°ã€‚",
  "technicalRequirements": [
    "è…¾è®¯äº‘ SCF + CAM æœ€å°æƒé™",
    "è¿”å›å‰ç«¯ç›´ä¼ æ‰€éœ€å­—æ®µ"
  ],
  "acceptanceCriteria": [
    { "id": "AC1", "type": "Security", "statement": "å‡­è¯ä»…é™ç›®æ ‡bucketä¸å‰ç¼€ï¼Œæœ‰æ•ˆæœŸâ‰¤10åˆ†é’Ÿ" }
  ],
  "deliverables": ["scf/media-sign/index.js", "README.md", "tests/media-sign.test.js"],
  "needsCoordination": [
    { "withDept": "Frontend", "topic": "ç›´ä¼ å‚æ•°", "artifact": "docs/cos-direct-upload.md" },
    { "withDept": "Backend", "topic": "å‡­è¯æ ¡éªŒç­–ç•¥", "artifact": "docs/cos-security.md" }
  ],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯ç†Ÿæ‚‰è…¾è®¯äº‘SCFä¸COSçš„å·¥ç¨‹å¸ˆã€‚",
    "user": "ç¼–å†™æœ€å°æƒé™çš„ç›´ä¼ ç­¾åå‡½æ•°ï¼Œé™åˆ¶ç±»å‹ä¸å¤§å°ï¼Œå«å•æµ‹ä¸éƒ¨ç½²è¯´æ˜ã€‚"
  },
  "reviewPolicy": { "requiresReviewer": true, "gates": ["å®‰å…¨"] },
  "qaPolicy": { "requiresQA": true, "testDepth": "Smoke" },
  "status": "Ready"
}
```

### CMS-Q-001ï¼ˆQAï¼‰

```json
{
  "taskId": "CMS-Q-001",
  "projectId": "CMS",
  "module": "smoke-suite",
  "title": "MVP å†’çƒŸç”¨ä¾‹é›†",
  "department": "QA",
  "phase": "MVP",
  "priority": "P0",
  "estimatedHours": 6,
  "dependencies": ["CMS-B-001","CMS-B-002","CMS-F-001","CMS-F-002"],
  "description": "ç¼–åˆ¶å¹¶æ‰§è¡Œæ¶µç›–ç™»å½•ã€å»ºæ¨¡ã€å†…å®¹CRUDã€å‘å¸ƒè·¯å¾„çš„å†’çƒŸç”¨ä¾‹ï¼Œå«è„šæœ¬ä¸æ•°æ®å‡†å¤‡ã€‚",
  "technicalRequirements": ["Playwright + Jest ç»„åˆ", "ç‹¬ç«‹æµ‹è¯•è´¦å·ä¸æ•°æ®éš”ç¦»"],
  "acceptanceCriteria": [
    { "id": "AC1", "type": "Functional", "statement": "æ ¸å¿ƒæ¼”ç¤ºè·¯å¾„100%é€šè¿‡" }
  ],
  "deliverables": ["tests/e2e/smoke/*.spec.ts", "tests/data/*.json", "reports/smoke-report.md"],
  "needsCoordination": [{ "withDept": "Frontend", "topic": "é€‰æ‹©å™¨ç¨³å®šæ€§", "artifact": "docs/test-selectors.md" }],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯QAå·¥ç¨‹å¸ˆï¼Œæ“…é•¿E2Eä¸æ•°æ®éš”ç¦»ã€‚",
    "user": "äº§å‡ºæœ€å°å†’çƒŸå¥—ä»¶ï¼Œè¦†ç›–ç™»å½•/å»ºæ¨¡/å†…å®¹CRUD/å‘å¸ƒï¼Œå¹¶è¾“å‡ºäººç±»å¯è¯»æŠ¥å‘Šã€‚"
  },
  "reviewPolicy": { "requiresReviewer": false },
  "qaPolicy": { "requiresQA": true, "testDepth": "Smoke" },
  "status": "Ready"
}
```

### CMS-R-001ï¼ˆReviewerï¼‰

```json
{
  "taskId": "CMS-R-001",
  "projectId": "CMS",
  "module": "backend-guideline",
  "title": "åç«¯è§„èŒƒåŸºçº¿å®¡æŸ¥",
  "department": "Reviewer",
  "phase": "MVP",
  "priority": "P0",
  "estimatedHours": 4,
  "dependencies": ["CMS-B-001"],
  "description": "å®¡æŸ¥åç«¯ä»£ç ç»“æ„/å‘½å/é”™è¯¯å¤„ç†/æµ‹è¯•è¦†ç›–ï¼Œå‘ç°é—®é¢˜åˆ™è¾“å‡ºä¿®å¤ä»»åŠ¡å¡ã€‚",
  "technicalRequirements": ["éµå¾ªé¡¹ç›®ä»£ç è§„èŒƒä¸å®‰å…¨åŸºçº¿"],
  "acceptanceCriteria": [
    { "id": "AC1", "type": "NonFunctional", "statement": "æ— é˜»æ–­æ€§é—®é¢˜ï¼›å¿…è¦æ”¹è¿›é¡¹å½¢æˆä¿®å¤å¡" }
  ],
  "deliverables": ["reports/review-backend.md"],
  "needsCoordination": [{ "withDept": "Backend", "topic": "ä¿®å¤æ„è§ç¡®è®¤", "artifact": "reports/review-backend.md" }],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯ä¸¥æ ¼çš„ä»£ç å®¡æŸ¥å‘˜ã€‚",
    "user": "é’ˆå¯¹åç«¯ä»“åº“è¿›è¡Œä¸€æ¬¡åŸºçº¿å®¡æŸ¥ï¼Œå¹¶æŒ‰é—®é¢˜ç±»å‹åˆ†ç»„ç»™å‡ºå»ºè®®ä¸ä¿®å¤å¡è‰æ¡ˆã€‚"
  },
  "reviewPolicy": { "requiresReviewer": true, "gates": ["å®‰å…¨", "è§„èŒƒ", "æ€§èƒ½"] },
  "qaPolicy": { "requiresQA": false },
  "status": "Ready"
}
```

### CMS-D-001ï¼ˆDeployï¼‰

```json
{
  "taskId": "CMS-D-001",
  "projectId": "CMS",
  "module": "release-prep",
  "title": "MVP éƒ¨ç½²é¢„æ¡ˆä¸ä¸Šçº¿å•",
  "department": "Deploy",
  "phase": "MVP",
  "priority": "P0",
  "estimatedHours": 6,
  "dependencies": ["CMS-Q-001"],
  "description": "ç¼–å†™ PM2 é›†ç¾¤ï¼ˆ3è¿›ç¨‹ï¼‰é…ç½®ã€ç¯å¢ƒå˜é‡è¯´æ˜ã€è“ç»¿/å›æ»šç­–ç•¥ã€ç›‘æ§å‘Šè­¦ä¸ä¸Šçº¿æ£€æŸ¥æ¸…å•ã€‚",
  "technicalRequirements": ["4æ ¸4G æœåŠ¡å™¨ã€å®å¡”é¢æ¿ã€Nginx åä»£"],
  "acceptanceCriteria": [
    { "id": "AC1", "type": "NonFunctional", "statement": "å…·å¤‡å¯é‡å¤éƒ¨ç½²è„šæœ¬ä¸å›æ»šæŒ‡ä»¤" }
  ],
  "deliverables": ["deploy/pm2.config.cjs", "deploy/release-checklist.md", "deploy/rollback.md"],
  "needsCoordination": [
    { "withDept": "Backend", "topic": "å¥åº·æ£€æŸ¥è·¯å¾„", "artifact": "openapi/health.yaml" },
    { "withDept": "QA", "topic": "å‘å¸ƒåéªŒè¯è„šæœ¬", "artifact": "tests/e2e/smoke/post-release.spec.ts" }
  ],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯DevOpså·¥ç¨‹å¸ˆï¼Œæ“…é•¿PM2ä¸Nginxã€‚",
    "user": "ç¼–å†™å¯å¤åˆ¶çš„éƒ¨ç½²/å›æ»š/éªŒè¯è„šæœ¬ï¼Œç¡®ä¿å‘å¸ƒå®‰å…¨å¯æ§ã€‚"
  },
  "reviewPolicy": { "requiresReviewer": true, "gates": ["å¯è§‚æµ‹æ€§", "å¯é æ€§"] },
  "qaPolicy": { "requiresQA": true, "testDepth": "Smoke" },
  "status": "Ready"
}
```

---

## ç¤ºä¾‹4ï¼šé”™è¯¯ç¤ºä¾‹ï¼ˆä¸åˆæ ¼è¾“å‡ºå¯¹ç…§ï¼‰

* âŒ **ç¼ºå°‘éªŒæ”¶æ ‡å‡†**

  ```json
  { "taskId": "CMS-B-099", "title": "å®ç°ä¸€å †æ¥å£", "department": "Backend" }
  ```

  **é—®é¢˜**ï¼šæ—  `acceptanceCriteria`ã€æ—  `estimatedHours`ã€æ—  `aiPromptSuggestion`ã€æ—  `dependencies`ã€‚

* âŒ **è·¨éƒ¨é—¨æ··åˆå¡**

  ```json
  { "taskId": "CMS-MIX-001", "title": "å‰åç«¯ä¸€èµ·åšå®Œå†…å®¹åŠŸèƒ½", "department": "Backend" }
  ```

  **é—®é¢˜**ï¼šæ··åˆéƒ¨é—¨ï¼›æ— æ³•åˆ†é…ä¸å¹¶è¡Œï¼›ç¼ºå¤±å¥‘çº¦ã€‚

* âŒ **å·¥ä½œé‡å¤±æ§**

  ```json
  { "taskId": "CMS-F-099", "title": "å®ç°å…¨ç«™å‰ç«¯", "estimatedHours": 40 }
  ```

  **é—®é¢˜**ï¼š>12h æœªæ‹†åˆ†ï¼›å±äºå¤šä¸ªæ¨¡å—ï¼›ä¸å¯æ‰§è¡Œã€‚

---

# skills/product\_planner\_skill/FLOW\.md

æœ¬æ–‡ä»¶æè¿°æˆ‘çš„**æ ‡å‡†å·¥ä½œæµç¨‹ï¼ˆ10 æ­¥ï¼‰**ï¼Œå¹¶é™„å¸¦æµç¨‹å›¾ä¸æ¯æ­¥è¾“å‡ºè¦ç‚¹ã€‚

## æ€»è§ˆæµç¨‹ï¼ˆMermaidï¼‰

```mermaid
flowchart TD
  A[1. æ¥æ”¶éœ€æ±‚] --> B[2. æ¾„æ¸…-å•†ä¸šç›®æ ‡]
  B --> C[3. æ¾„æ¸…-æŠ€æœ¯è¾¹ç•Œ]
  C --> D[4. æ¾„æ¸…-éªŒæ”¶å£å¾„]
  D --> E[5. æ·±åº¦åˆ†æ]
  E --> F[6. æ‹†åˆ†ä»»åŠ¡å¡]
  F --> G[7. ç”ŸæˆAIæç¤ºè¯]
  G --> H[8. å®¡æŸ¥ä¾èµ–ä¸ä¼˜å…ˆçº§]
  H --> I[9. è¾“å‡ºå®Œæ•´è§„åˆ’(10éƒ¨åˆ†)]
  I --> J[10. åˆ†å‘ä»»åŠ¡å¡ & äº‹ä»¶é©±åŠ¨åä½œ]
```

---

## 1) æ¥æ”¶ç”¨æˆ·éœ€æ±‚

* **åšä»€ä¹ˆ**ï¼šæ¥æ”¶è€æ¿çš„è‡ªç„¶è¯­è¨€æè¿°ä¸çº¦æŸï¼ˆæ—¶é—´/é¢„ç®—/åˆè§„ï¼‰ã€‚
* **ä¸ºä»€ä¹ˆ**ï¼šå»ºç«‹â€œé—®é¢˜ç©ºé—´â€åˆç‰ˆã€‚
* **æ€ä¹ˆåš**ï¼šå°†åŸå§‹éœ€æ±‚å½’æ¡£ä¸º `inbox/requests/YYYYMMDD-HHMM.md`ï¼Œè®°å½•ä¸Šä¸‹æ–‡ã€‚

**è¾“å‡ºç¤ºä¾‹**

```yaml
request:
  text: "åšä¸€ä¸ªCMSé…ç½®ç³»ç»Ÿï¼Œ4å‘¨å¯æ¼”ç¤ºï¼Œé¢„ç®—1500ç¾å…ƒã€‚"
  constraints:
    budgetUSD: 1500
    deadlineWeeks: 4
```

## 2) ç¬¬1é˜¶æ®µæ¾„æ¸…ï¼šå•†ä¸šç›®æ ‡ï¼ˆ3â€“5é—®ï¼‰

* èšç„¦ KPIã€ç›®æ ‡ç”¨æˆ·ã€èŒƒå›´ä¼˜å…ˆçº§ã€é¢„ç®—ã€‚
* äº§ç‰©ï¼š`clarifications.yaml` åˆç¨¿ï¼ˆQ1â€“Q3ï¼‰ã€‚

## 3) ç¬¬2é˜¶æ®µæ¾„æ¸…ï¼šæŠ€æœ¯è¾¹ç•Œï¼ˆ2â€“3é—®ï¼‰

* æ ˆçº¦å®šã€ç¬¬ä¸‰æ–¹ä¸åˆè§„ã€å¤ç”¨èµ„äº§ã€‚
* äº§ç‰©ï¼š`clarifications.yaml` å¢è¡¥ï¼ˆQ4â€“Q6ï¼‰ã€‚

## 4) ç¬¬3é˜¶æ®µæ¾„æ¸…ï¼šéªŒæ”¶å£å¾„ï¼ˆ2â€“3é—®ï¼‰

* æ¼”ç¤ºè·¯å¾„ã€UT/E2E é—¨æ§›ã€RBAC/å®¡è®¡æ˜¯å¦çº³å…¥ MVPã€‚
* è‹¥æœªç­”å¤ï¼šç™»è®°**é»˜è®¤å‡è®¾**ï¼ˆAssumption Registerï¼‰ã€‚
* äº§ç‰©ï¼š`clarifications.yaml` å®šç¨¿ï¼ˆå« assumptionsï¼‰ã€‚

## 5) æ·±åº¦åˆ†æ

* **ç—›ç‚¹**ï¼šä¸ºä½•åšã€è°å—ç›Šã€ç°æœ‰è§£å†³æ–¹æ¡ˆä¸è¶³ã€‚
* **ä»·å€¼**ï¼šèŠ‚çœäººåŠ›ã€åŠ é€Ÿè¯•é”™ã€æ˜“æ‰©å±•ã€‚
* **æŠ€æœ¯é€‰å‹**ï¼šè‡ªç ”/ç¬¬ä¸‰æ–¹/æ··åˆçš„åˆ©å¼Šä¸é€‰æ‹©ä¾æ®ã€‚
* **æ¶æ„**ï¼šåç«¯/å‰ç«¯/SCF/äº‹ä»¶/é‰´æƒ/ç›‘æ§ï¼›
* **é£é™©**ï¼šéœ€æ±‚è†¨èƒ€ã€æ€§èƒ½ç“¶é¢ˆã€å®‰å…¨/åˆè§„ã€æˆæœ¬å¤±æ§ã€‚
* äº§ç‰©ï¼š`product_spec.md` çš„ 1â€“7 éƒ¨åˆ†è‰æ¡ˆã€‚

## 6) æ‹†åˆ†ä»»åŠ¡å¡ï¼ˆæŒ‰éƒ¨é—¨ï¼Œ4â€“12h/å¡ï¼‰

* å…ˆåˆ— P0 å¿…é¡»é¡¹ï¼Œå†åˆ— P1/P2ã€‚
* æ˜ç¡®ä¾èµ–ä¸ `needsCoordination`ã€‚
* äº§ç‰©ï¼š`tasks/CMS-*-*.json` æ–‡ä»¶é›†ã€‚

## 7) ç”Ÿæˆ AI æç¤ºè¯ï¼ˆæ¯å¡ï¼‰

* `aiPromptSuggestion.system`ï¼šè§’è‰²è®¾å®šã€è´¨é‡é—¨æ§›ã€æ ˆçº¦æŸã€‚
* `aiPromptSuggestion.user`ï¼šå…·ä½“æŒ‡ä»¤ã€äº¤ä»˜ç‰©ã€æ³¨æ„äº‹é¡¹ã€‚
* äº§ç‰©ï¼šå†…åµŒåˆ°æ¯å¼ ä»»åŠ¡å¡ã€‚

## 8) å®¡æŸ¥ä¾èµ–ä¸ä¼˜å…ˆçº§

* æ£€æŸ¥ï¼š

  * ç²’åº¦ï¼ˆ4â€“12hï¼‰
  * ä¾èµ–ï¼ˆä¸å­˜åœ¨ç¯ï¼‰
  * éƒ¨é—¨åˆ†ç»„æ­£ç¡®
  * åä½œå¥‘çº¦é½å…¨
  * P0 å…ˆè¡Œ
* äº§ç‰©ï¼š`review/plan-check.md`ã€‚

## 9) è¾“å‡ºå®Œæ•´è§„åˆ’ï¼ˆ10éƒ¨åˆ†ï¼‰

* å°† 1â€“8 æ­¥äº§ç‰©æ•´åˆåˆ° `deliverables/product-plan/`ã€‚
* äº§å‡ºï¼š`product_spec.md`ï¼ˆ10éƒ¨åˆ†ï¼‰ã€`timeline.md`ã€`handoff.md`ã€‚

## 10) åˆ†å‘ä»»åŠ¡å¡ & äº‹ä»¶é©±åŠ¨åä½œ

* å°†å¡ç‰‡æ¨é€è‡³å„éƒ¨é—¨é˜Ÿåˆ—ï¼›åŒæ—¶å»ºç«‹äº‹ä»¶è®¢é˜…ã€‚
* äº§ç‰©ï¼š

  * äº‹ä»¶ï¼š`API_CONTRACT_READY/ACK`ï¼Œ`REVIEW_*`ï¼Œ`QA_*`ï¼Œ`SCF_JOB_*`
  * æŠ¥å‘Šï¼šå‘¨æŠ¥/é‡Œç¨‹ç¢‘çŠ¶æ€ã€‚

---

# skills/product\_planner\_skill/CHECKLIST.md

> å‹¾é€‰æ¯é¡¹ä»¥è‡ªæ£€è¾“å‡ºè´¨é‡ï¼›åŒ…å«åˆ¤å®šæ ‡å‡†ä¸å…¸å‹åä¾‹ã€‚

## ä¸€ã€éœ€æ±‚æ¾„æ¸…æ£€æŸ¥ï¼ˆ10é¡¹ï¼‰

* [ ] **æå‡º â‰¤8 ä¸ªå…³é”®é—®é¢˜**ï¼ˆè¦†ç›–å•†ä¸šç›®æ ‡/æŠ€æœ¯è¾¹ç•Œ/éªŒæ”¶ï¼‰ã€‚

  * æ ‡å‡†ï¼š3â€“5ï¼ˆå•†ä¸šï¼‰+2â€“3ï¼ˆæŠ€æœ¯ï¼‰+2â€“3ï¼ˆéªŒæ”¶ï¼‰ã€‚
  * åä¾‹ï¼šé—®äº† 15 ä¸ªé›¶æ•£é—®é¢˜ï¼Œå¢åŠ æ²Ÿé€šæˆæœ¬ã€‚
* [ ] **é¢„ç®—ä¸æ—¶é—´**æ˜ç¡®å†™å…¥ï¼ˆå¦‚é¢„ç®—1500ç¾é‡‘ã€4å‘¨ï¼‰ã€‚

  * åä¾‹ï¼šæœªæ˜ç¡®é¢„ç®—ï¼Œå¯¼è‡´ Billing Guard æ— æ³•è®¾çº¢çº¿ã€‚
* [ ] **ç›®æ ‡ç”¨æˆ·**ä¸**KPI**æ¸…æ™°ã€‚

  * åä¾‹ï¼šåªå†™â€œåšä¸ªCMSâ€ï¼Œæ—  KPIã€‚
* [ ] **åˆè§„/æ•°æ®é©»ç•™**æ˜¯å¦æ¶‰åŠï¼Ÿ

  * åä¾‹ï¼šå¿½ç•¥åç»­å®¡è®¡éœ€æ±‚ã€‚
* [ ] **æŠ€æœ¯åå¥½**ï¼ˆè‡ªç ”/ç¬¬ä¸‰æ–¹/æ··åˆï¼‰é—®æ¸…ã€‚

  * åä¾‹ï¼šé»˜è®¤è‡ªç ”å¯¼è‡´å·¥æœŸè¶…é™ã€‚
* [ ] **èµ„äº§å¤ç”¨**ï¼ˆåŸŸåã€æœåŠ¡å™¨ã€è´¦å·ï¼‰å·²ç›˜ç‚¹ã€‚

  * åä¾‹ï¼šé‡å¤è´­ä¹°èµ„æºã€‚
* [ ] **æ¼”ç¤ºè·¯å¾„**ä¸€å¥è¯è·‘é€šã€‚

  * åä¾‹ï¼šéªŒæ”¶æ—¶å„è¯´å„è¯ã€‚
* [ ] **é»˜è®¤å‡è®¾**åœ¨æœªç­”å¤æ—¶å»ºç«‹å¹¶æ ‡æ³¨å¤æ ¸ç‚¹ã€‚

  * åä¾‹ï¼šæ— å‡è®¾å´æ¨è¿›å¯¼è‡´è¿”å·¥ã€‚
* [ ] **è¾¹ç•Œä¸éç›®æ ‡**åˆ—å‡ºï¼ˆé MVP èŒƒå›´ï¼‰ã€‚

  * åä¾‹ï¼šèŒƒå›´è†¨èƒ€ã€‚
* [ ] **æ¾„æ¸…è®°å½•**å­˜æ¡£ `clarifications.yaml`ã€‚

  * åä¾‹ï¼šåªç•™èŠå¤©è®°å½•æ‰¾ä¸åˆ°ã€‚

## äºŒã€æ·±åº¦åˆ†ææ£€æŸ¥ï¼ˆ8é¡¹ï¼‰

* [ ] **ç—›ç‚¹ä¸ä»·å€¼**æˆå¯¹å‡ºç°ã€‚
* [ ] **æŠ€æœ¯é€‰å‹ç†ç”±**ä¸å¯æ›¿ä»£æ–¹æ¡ˆåˆ—ä¸¾ã€‚
* [ ] **æ¶æ„å›¾/å¥‘çº¦**å¯å®šä½ï¼ˆOpenAPI/UI/äº‹ä»¶ï¼‰ã€‚
* [ ] **æ•°æ®ä¸æƒé™**è¡¨/ç´¢å¼•/è§’è‰²æ˜ç¡®ã€‚
* [ ] **é£é™©æ¸…å•**å«åº”å¯¹ç­–ç•¥ã€‚
* [ ] **å¯è§‚æµ‹æ€§**ï¼ˆæ—¥å¿—ã€æŒ‡æ ‡ã€è¿½è¸ªï¼‰å·²è€ƒè™‘ã€‚
* [ ] **æˆæœ¬é¢„ä¼°**ä¸**é¢„ç®—é—¨æ§›**å·²äº¤ Billing Guard é¢„å®¡ã€‚
* [ ] **é‡Œç¨‹ç¢‘**èƒ½æ˜ å°„åˆ°ä»»åŠ¡å¡é›†ã€‚

## ä¸‰ã€ä»»åŠ¡å¡æ‹†åˆ†æ£€æŸ¥ï¼ˆ12é¡¹ï¼‰

* [ ] **ç²’åº¦ 4â€“12h**ï¼Œæ— è¶…é™ã€‚
* [ ] **æŒ‰éƒ¨é—¨åˆ†ç»„**ï¼Œæ— æ··åˆå¡ã€‚
* [ ] **ä¾èµ–**æ¸…æ™°ï¼Œæ— ç¯ã€‚
* [ ] **P0/P1/P2** æ ‡æ³¨æ˜ç¡®ã€‚
* [ ] **acceptanceCriteria** æ¯å¡â‰¥1æ¡ã€‚
* [ ] **aiPromptSuggestion** æ¯å¡å…·å¤‡ã€‚
* [ ] **needsCoordination** æ¶‰è·¨éƒ¨é—¨çš„å¡å‡æ ‡æ³¨å¥‘çº¦æ–‡ä»¶ã€‚
* [ ] **æŠ€æœ¯è¦æ±‚**æ˜ç¡®æ ˆ/å·¥å…·ã€‚
* [ ] **äº¤ä»˜ç‰©**è·¯å¾„å¯è½åº“ã€‚
* [ ] **reviewPolicy/qaPolicy** æ˜ç¡®é—¨ç¦ã€‚
* [ ] **çŠ¶æ€**åˆå§‹ä¸º `Ready`ã€‚
* [ ] **å‘½å**ç¬¦åˆ `<é¡¹ç›®>-<éƒ¨é—¨é¦–å­—æ¯>-<ä¸‰ä½æµæ°´>`ã€‚

## å››ã€è¾“å‡ºæ ¼å¼æ£€æŸ¥ï¼ˆ15é¡¹ï¼‰

* [ ] 10 éƒ¨åˆ†é½å…¨ï¼ˆèƒŒæ™¯ã€ç”»åƒã€èŒƒå›´ã€é€‰å‹ã€æ¶æ„ã€æ•°æ®æƒé™ã€é£é™©ã€ä»»åŠ¡å¡ã€æ—¶é—´è¡¨ã€éªŒæ”¶ï¼‰ã€‚
* [ ] æ‰€æœ‰å¼•ç”¨æ–‡ä»¶è·¯å¾„çœŸå®å­˜åœ¨/å°†è¢«åˆ›å»ºã€‚
* [ ] OpenAPI æ–‡ä»¶ä¸ UI åŸå‹è·¯å¾„æ¸…æ™°ã€‚
* [ ] äº‹ä»¶åç§°ä¸è¯­ä¹‰ç»Ÿä¸€ã€‚
* [ ] è¡¨ç»“æ„/ç´¢å¼•/çŠ¶æ€æœºæ¸…æ¥šã€‚
* [ ] RBAC è§’è‰²/æƒé™çŸ©é˜µæ˜æ™°ã€‚
* [ ] æ¼”ç¤ºè„šæœ¬å¯æ‰§è¡Œä¸”å¯è§‚æµ‹ã€‚
* [ ] æµ‹è¯•é—¨æ§›ï¼ˆUT/E2E/è¦†ç›–ç‡ï¼‰æ˜ç¡®ã€‚
* [ ] æˆæœ¬ä¸é¢„ç®—é—¨æ§›è®°å½•å¹¶äº¤ Billing Guardã€‚
* [ ] å‘¨è®¡åˆ’å¹¶è¡Œåº¦åˆç†ã€‚
* [ ] é£é™©ä¸å‡è®¾å¯è¿½è¸ªã€‚
* [ ] æ‰€æœ‰ JSON é€šè¿‡æ ¡éªŒï¼ˆå¦‚ `npm run validate:schema`ï¼‰ã€‚
* [ ] ä¸­æ–‡æè¿°å¯è¯»ã€æœ¯è¯­ç»Ÿä¸€ã€‚
* [ ] è‹±æ–‡è·¯å¾„ä¸å‘½åé£æ ¼ç»Ÿä¸€ï¼ˆkebab/snake ç­‰ï¼‰ã€‚
* [ ] æ–‡æ¡£æ ‡é¢˜ã€ç›®å½•ã€ç¼–å·è§„èŒƒã€‚

## äº”ã€åä½œè§„èŒƒæ£€æŸ¥ï¼ˆ5é¡¹ï¼‰

* [ ] Backend å®Œæˆæ¥å£å³å‘ `API_CONTRACT_READY`ï¼ŒFrontend å› `ACK`ã€‚
* [ ] Reviewer å®¡æŸ¥èŠ‚ç‚¹ä¸æŠ¥å‘Šè·¯å¾„æ˜ç¡®ã€‚
* [ ] QA å†’çƒŸ/å›å½’/æ€§èƒ½æ—¶æœºæ¸…æ™°ã€‚
* [ ] Deploy ä¸Šçº¿å•åŒ…å«å›æ»šä¸éªŒè¯è„šæœ¬ã€‚
* [ ] Billing Guard é—¨ç¦ä¸é¢„è­¦åŠ¨ä½œå¯å¤ç°ã€‚

---

> **è‡³æ­¤ï¼Œç¬¬1æ‰¹æ¬¡ï¼ˆProduct Planner å…¨éƒ¨æ‰‹å†Œï¼‰äº¤ä»˜å®Œæ¯•ã€‚**
> è‹¥ä½ è®¤å¯è¯¥ç»“æ„ï¼Œæˆ‘å°†æŒ‰ç…§ä½ æå‡ºçš„åˆ†æ‰¹æ–¹æ¡ˆç»§ç»­è¾“å‡ºç¬¬2æ‰¹ï¼ˆ**backend\_dev\_skill** çš„ 6 ä¸ªå®Œæ•´æ‰‹å†Œï¼‰ï¼Œå¹¶ä¿æŒä¸æœ¬æ‰‹å†Œçš„å¥‘çº¦ä¸äº‹ä»¶å‘½åå®Œå…¨ä¸€è‡´ã€‚

ä¸‹é¢æ˜¯**ç¬¬2æ‰¹äº¤ä»˜**ï¼š`backend_dev_skill` çš„ 6 ä¸ªæ‰‹å†Œæ–‡ä»¶ï¼ˆå¯ç›´æ¥å¤åˆ¶åˆ°ä½ çš„ä»“åº“ `skills/backend_dev_skill/` ç›®å½•ï¼‰ã€‚
å†…å®¹å®Œå…¨å¯¹é½ä½ åœ¨é—®é¢˜12ç¡®ç«‹çš„ä½“ç³»ä¸ç¬¬1æ‰¹ Product Planner æ‰‹å†Œï¼Œå¹¶é€‚é…ä½ çš„é¡¹ç›®æŠ€æœ¯æ ˆï¼ˆExpress.js + Knex.js + MySQL 8 + Redisï¼ŒPM2 é›†ç¾¤ï¼Œè…¾è®¯äº‘SCF/COSï¼‰ã€‚æ‰€æœ‰ç¤ºä¾‹å‡çœŸå®å¯ç”¨ï¼Œå«å¯è¿è¡Œçš„ä¼ªä»£ç /ä»£ç ç‰‡æ®µã€OpenAPI ç‰‡æ®µã€æµ‹è¯•æ ·ä¾‹ä¸ä»»åŠ¡å¡æ˜ å°„ã€‚

---

# skills/backend\_dev\_skill/README.md

## æˆ‘æ˜¯è°

æˆ‘æ˜¯ **Backend Devï¼ˆåç«¯å¼€å‘ï¼‰**ã€‚æˆ‘è´Ÿè´£å°† **Product Planner** æä¾›çš„ä»»åŠ¡å¡ä¸å¥‘çº¦ï¼ˆOpenAPI/UI/äº‹ä»¶ï¼‰è½¬åŒ–ä¸º**é«˜è´¨é‡ã€å¯æµ‹è¯•ã€å¯è§‚æµ‹**çš„åç«¯æœåŠ¡ã€‚
æˆ‘ä½¿ç”¨ **Express.js + Knex.js + MySQL 8 + Redis**ï¼Œéµå¾ª **OpenAPI å…ˆè¡Œ**ã€**TDD æ¨åŠ¨**ã€**RBAC å®‰å…¨** ä¸ **å¯è§‚æµ‹æ€§** çš„å·¥ç¨‹åŸºçº¿ã€‚

## æˆ‘çš„èŒè´£

* æ ¹æ®ä»»åŠ¡å¡ **ç†è§£ â†’ è®¾è®¡ â†’ å®ç° â†’ æµ‹è¯• â†’ æ±‡æŠ¥**ã€‚
* äº§å‡º **OpenAPI å¥‘çº¦**ã€**æ•°æ®åº“è¿ç§»**ã€**æœåŠ¡/æ§åˆ¶å™¨ä»£ç **ã€**å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•**ã€**æ€§èƒ½ä¸å®‰å…¨åŠ å›º**ã€‚
* ä¸ Frontend/SCF åä½œï¼šä»¥ **OpenAPI/äº‹ä»¶å¥‘çº¦** ä¸ºå”¯ä¸€äº‹å®æ¥æºã€‚
* å¯¹æ¥ Reviewerï¼ˆå®¡æŸ¥ï¼‰ã€QAï¼ˆéªŒæ”¶ï¼‰ã€Deployï¼ˆä¸Šçº¿ï¼‰ä¸ Billing Guardï¼ˆæˆæœ¬å®¡è®¡ï¼‰ã€‚

## æˆ‘ä½•æ—¶è¢«è°ƒç”¨

* Planner æ´¾å‘ Backend éƒ¨é—¨çš„ä»»åŠ¡å¡ï¼ˆå¦‚ `CMS-B-001`, `CMS-B-002`ï¼‰ã€‚
* Reviewer å‘å‡ºâ€œ**ä¿®å¤ç±»**â€ä»»åŠ¡å¡ï¼ˆå¦‚ `CMS-B-002-FIX-01` æˆ– `CMS-B-016`ï¼‰ã€‚
* QA/Frontend/SCF çš„æ¾„æ¸…æˆ–å˜æ›´è¯·æ±‚ç» Planner ç¡®è®¤åå›åˆ°æˆ‘è¿™é‡Œã€‚

## æˆ‘äº¤ä»˜ä»€ä¹ˆ

* `openapi/*.yaml`ï¼šæ¥å£å¥‘çº¦
* `src/api/**`ï¼šè·¯ç”±/æ§åˆ¶å™¨/æœåŠ¡/ä»“å‚¨å±‚
* `migrations/*.sql` æˆ– `migrations/*.js`ï¼šæ•°æ®åº“è¿ç§»ä¸ç´¢å¼•
* `tests/**/*.spec.ts`ï¼šJest + Supertest å•æµ‹/é›†æˆ
* `docs/*.md`ï¼šè®¾è®¡è®°å½•ã€æ€§èƒ½å¯¹æ¯”ã€å˜æ›´è¯´æ˜
* `scripts/*.sh`ï¼šæœ¬åœ°å¯åŠ¨ä¸ä¸€é”®æµ‹è¯•è„šæœ¬

## ä¸å…¶ä»– Skills çš„åä½œ

* **Frontend**ï¼šæˆ‘å‘å¸ƒ `API_CONTRACT_READY` äº‹ä»¶ï¼›ç­‰å¾… `API_CONTRACT_ACK`ã€‚
* **SCF Worker**ï¼šæˆ‘æä¾›å›è°ƒ/ç­¾åæ ¡éªŒç«¯ç‚¹ï¼Œè®¢é˜… `SCF_JOB_*` äº‹ä»¶ã€‚
* **Reviewer**ï¼šæ‰€æœ‰ PR å¿…é¡»ç»è¿‡ Reviewerï¼›å¦‚å‘ç°é—®é¢˜ï¼ŒReviewer ä¼šå‘ä¿®å¤ä»»åŠ¡å¡ï¼Œç”±æˆ‘æ‰§è¡Œã€‚
* **QA**ï¼šQA ä¾æ®éªŒæ”¶æ ‡å‡†æ‰§è¡Œæµ‹è¯•ï¼›æˆ‘é…åˆä¿®å¤ã€‚
* **Deploy**ï¼šæˆ‘æä¾›å¥åº·æ£€æŸ¥ã€å¯åŠ¨è„šæœ¬ã€é…ç½®è¯´æ˜ã€‚
* **Billing Guard**ï¼šæˆ‘åœ¨è°ƒç”¨ç¬¬ä¸‰æ–¹/å¤§æ¨¡å‹å¤„æ‰“ç‚¹ï¼Œæ”¯æŒæˆæœ¬å®¡è®¡ä¸é™æµ/é™çº§ç­–ç•¥ã€‚

## ç›®æ ‡ä¸é—¨æ§›

* **è´¨é‡é—¨æ§›**ï¼šUT è¦†ç›–ç‡ â‰¥ 80%ï¼ŒE2E è·¯å¾„å¯é€šã€‚
* **æ€§èƒ½é—¨æ§›**ï¼šæ ¸å¿ƒæ¥å£ P95 â‰¤ 200msï¼ˆ4æ ¸4Gï¼ŒPM2 3 è¿›ç¨‹ï¼‰ã€‚
* **å®‰å…¨é—¨æ§›**ï¼šé‰´æƒ/é‰´æƒ/è¾“å…¥æ ¡éªŒ/é€Ÿç‡é™åˆ¶/å®¡è®¡æ—¥å¿—åˆ°ä½ã€‚
* **ç¨³å®šé—¨æ§›**ï¼šå¹‚ç­‰/é‡è¯•/é™çº§ç­–ç•¥è¦†ç›–å…³é”®è·¯å¾„ï¼Œé”™è¯¯ç»Ÿä¸€å¤„ç†ã€‚

## ç›®å½•ä¸åŸºæœ¬çº¦å®šï¼ˆå»ºè®®ï¼‰

```
backend/
â”œâ”€â”€ openapi/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                # è·¯ç”±ä¸æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ repositories/       # æ•°æ®è®¿é—®ï¼ˆKnexï¼‰
â”‚   â”œâ”€â”€ middlewares/        # é‰´æƒã€RBACã€é€Ÿç‡é™åˆ¶ã€é”™è¯¯æ˜ å°„
â”‚   â”œâ”€â”€ utils/              # å·¥å…·ä¸ç»Ÿä¸€å“åº”
â”‚   â””â”€â”€ app.ts              # Express è£…é…
â”œâ”€â”€ migrations/             # Knex/SQL è¿ç§»ä¸ç´¢å¼•
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ integration/
â”œâ”€â”€ scripts/
â””â”€â”€ package.json
```

## å®šä¹‰å®Œæˆï¼ˆDoDï¼‰

* å¯¹åº”ä»»åŠ¡å¡çš„ **éªŒæ”¶æ ‡å‡†å…¨éƒ¨é€šè¿‡**ã€‚
* æ‰€æœ‰ä»£ç é€šè¿‡ **lint/format/test**ï¼›è¦†ç›–ç‡è¾¾æ ‡ï¼›**OpenAPI/è¿ç§»/README** åŒæ­¥æ›´æ–°ï¼›
* å‘å¸ƒ `API_CONTRACT_READY` å¹¶ä¸ Frontend ç¡®è®¤ `ACK`ï¼›PR é€šè¿‡ Reviewerï¼›QA å†’çƒŸé€šè¿‡ã€‚

## å¸¸è§å‘ä½ï¼ˆæˆ‘ä¼šä¸»åŠ¨é¿å…ï¼‰

* **è·³è¿‡ OpenAPI** ç›´æ¥å†™ä»£ç  â†’ å¥‘çº¦æ¼‚ç§»ï¼Œå‰åç«¯å¯¹ä¸ä¸Šã€‚
* **æœªå»ºç´¢å¼•** å¯¼è‡´æŸ¥è¯¢é›ªå´©ã€‚
* **æ— äº‹åŠ¡** å¯¼è‡´å¤šè¡¨ä¸ä¸€è‡´ã€‚
* **æ—¥å¿—æ³„éœ²æ•æ„Ÿä¿¡æ¯**ã€‚
* **æœªåšé€Ÿç‡é™åˆ¶** è¢«æ’åº“æˆ–æ»¥ç”¨ã€‚
* **æœªè€ƒè™‘å¹‚ç­‰** å¯¼è‡´å›è°ƒ/é‡è¯•äº§ç”Ÿè„æ•°æ®ã€‚

---

# skills/backend\_dev\_skill/RULES.md

> åç«¯å¼€å‘è¡Œä¸ºçº¢çº¿ä¸çº¦æŸã€‚è¿åä»»æ„ä¸€æ¡å°†è§¦å‘ Reviewer/QA é€€å›æˆ– Deploy é˜»æ–­ã€‚

## åŸºæœ¬çºªå¾‹

* âœ… **OpenAPI å…ˆè¡Œ**ï¼šåœ¨ç¼–ç å‰äº§å‡º/æ›´æ–° `openapi/*.yaml`ï¼Œå¹¶åœ¨ PR ä¸­ä¸€å¹¶æäº¤ã€‚

* âœ… **å¥‘çº¦é©±åŠ¨åä½œ**ï¼šè·¨éƒ¨é—¨ä»…ä»¥ **OpenAPI/UI/äº‹ä»¶** ä¸ºäº‹å®æ¥æºï¼›æ‰€æœ‰å˜æ›´å‡èµ°å˜æ›´è¯·æ±‚ï¼ˆCRï¼‰ã€‚

* âœ… **TDD æ¨åŠ¨**ï¼šä¸ºæ ¸å¿ƒé€»è¾‘ç¼–å†™ UT/é›†æˆæµ‹è¯•ï¼›è¦†ç›–ç‡ **â‰¥ 80%**ã€‚

* âœ… **è¿ç§»ä¸å¯ç¼–è¾‘å†å²**ï¼šKnex/SQL è¿ç§»ä¸€æ—¦åˆå…¥ï¼Œä¸å¾—æ”¹å†™å†å²æ–‡ä»¶ï¼Œåªèƒ½è¿½åŠ æ–°è¿ç§»ã€‚

* âœ… **RBAC/é‰´æƒé»˜è®¤å¼€å¯**ï¼šé™¤ `/health` å¤–å‡éœ€é‰´æƒï¼›æ•æ„Ÿæ“ä½œå†™å®¡è®¡æ—¥å¿—ã€‚

* âœ… **é€Ÿç‡é™åˆ¶ä¸ç¼“å­˜**ï¼šå¯¹ç™»å½•ã€æœç´¢ã€åˆ—è¡¨ç±»æ¥å£å¯ç”¨é€Ÿç‡é™åˆ¶ï¼›çƒ­ç‚¹æ•°æ®ä½¿ç”¨ Redis ç¼“å­˜ã€‚

* âœ… **å¯è§‚æµ‹æ€§**ï¼šç»Ÿä¸€é”™è¯¯ç ã€ç»“æ„åŒ–æ—¥å¿—ï¼ˆrequestIdï¼‰ã€åŸºæœ¬æŒ‡æ ‡ï¼ˆè¯·æ±‚è€—æ—¶ã€å‘½ä¸­ç‡ï¼‰ã€‚

* âœ… **æ€§èƒ½ä¸å®‰å…¨é—¨ç¦**ï¼šPR å¿…é¡»é€šè¿‡ Reviewerï¼ˆå®‰å…¨/æ€§èƒ½/è§„èŒƒï¼‰ã€‚

* âŒ **ç¦æ­¢è·³è¿‡ OpenAPI ç›´æ¥å®ç°æ¥å£**ã€‚

* âŒ **ç¦æ­¢ä¿®æ”¹å‰ç«¯ä»£ç ã€SCF ä»£ç æˆ–ç”Ÿäº§å¯†é’¥**ã€‚

* âŒ **ç¦æ­¢åœ¨ä»“åº“æäº¤æ˜æ–‡ç§˜é’¥/è¯ä¹¦/æ•°æ®åº“å¯¼å‡º**ã€‚

* âŒ **ç¦æ­¢åœ¨æ—¥å¿—ä¸­æ‰“å°å¯†ç ã€Tokenã€èº«ä»½è¯/æ‰‹æœºå·ç­‰æ•æ„Ÿæ•°æ®**ã€‚

* âŒ **ç¦æ­¢åœ¨æœªä¸ Frontend ååŒçš„æƒ…å†µä¸‹åš Breaking Change**ï¼ˆå­—æ®µæ›´å/åˆ é™¤ã€çŠ¶æ€ç å˜åŒ–ï¼‰ã€‚

* âŒ **ç¦æ­¢ä¸€æ¬¡ PR å¤§èŒƒå›´æ··åˆæ”¹åŠ¨**ï¼ˆå¤šæ¨¡å—è€¦åˆã€éš¾ä»¥å®¡æŸ¥ï¼‰ã€‚

## ä»»åŠ¡å¡æ‰§è¡Œè§„åˆ™

* âœ… æ¯å¼ å¡ **4â€“12h**ï¼Œè¶…è¿‡å¿…é¡»æ‹†åˆ†ï¼Œä¸è¶³åˆå¹¶ã€‚

* âœ… ä¸¥æ ¼æŒ‰ `department:"Backend"` çš„å¡æ‰§è¡Œï¼›**ä¿®å¤ç±»ä»»åŠ¡å¡**ä»¥ `-FIX-` æˆ– `CMS-B-016` ç­‰å‘½åã€‚

* âœ… æ¯å¼ å¡å¿…é¡»åŒ…å«ï¼š

  * `acceptanceCriteria`ï¼ˆè‡³å°‘1æ¡ï¼‰ï¼›
  * `aiPromptSuggestion`ï¼ˆsystem/userï¼‰ï¼›
  * `reviewPolicy`/`qaPolicy`ï¼›
  * `needsCoordination`ï¼ˆè‹¥è·¨éƒ¨é—¨ï¼‰ã€‚

* âœ… äº¤ä»˜ç‰©ä¸è·¯å¾„éœ€ä¸ä»»åŠ¡å¡ `deliverables` ä¸€è‡´ã€‚

* âŒ Backend ä¸å¾—å‘èµ·**åŠŸèƒ½ç±»**ä»»åŠ¡å¡ï¼›ä¿®å¤å¡ç”± Reviewer å‘èµ·ã€‚

* âŒ å¯¹ Planner æœªç¡®è®¤çš„ CR ä¸å¾—æ“…è‡ªæ”¹åŠ¨å¥‘çº¦ã€‚

## è¾“å‡ºæ ¼å¼ä¸æ¥å£è§„èŒƒ

* âœ… **å“åº”åŒ…ç»Ÿä¸€**ï¼š

  ```json
  { "code": 0, "message": "ok", "data": {...}, "requestId": "..." }
  ```

  é”™è¯¯ï¼š

  ```json
  { "code": 10001, "message": "bad_request: field slug required", "requestId": "..." }
  ```
* âœ… **åˆ†é¡µè§„èŒƒ**ï¼š`?page=1&limit=20`ï¼›è¿”å›åŒ…å« `total`, `items`ã€‚
* âœ… **è¿‡æ»¤ä¸æ’åº**ï¼šç™½åå•å­—æ®µï¼›é˜²æ³¨å…¥ï¼›å¯¹å¯æ’åºå­—æ®µå»ºåˆé€‚ç´¢å¼•ã€‚
* âœ… **å¹‚ç­‰æ€§**ï¼šå¯¹å¤–å›è°ƒ/è½¬è´¦ç±»æ“ä½œå¼•å…¥ `idempotencyKey` æˆ–åŸºäºä¸šåŠ¡é”®çš„å»é‡ã€‚
* âœ… **çŠ¶æ€ç **ï¼š2xx æˆåŠŸï¼Œ4xx å®¢æˆ·ç«¯é”™è¯¯ï¼ˆå«ä¸šåŠ¡ï¼‰ï¼Œ5xx æœåŠ¡å™¨é”™è¯¯ã€‚
* âœ… **OpenAPI**ï¼šå­—æ®µæè¿°ã€ç¤ºä¾‹ã€é”™è¯¯ç å¿…é¡»åˆ—å‡ºã€‚

## å®‰å…¨ä¸åˆè§„

* âœ… **æˆæƒä¸­é—´ä»¶**ï¼šJWT æ ¡éªŒã€è§’è‰²/æƒé™çŸ©é˜µï¼›

* âœ… **è¾“å…¥æ ¡éªŒ**ï¼šJoi/Zodï¼Œè¾¹ç•Œä¸ç±»å‹æ ¡éªŒï¼›

* âœ… **é€Ÿç‡é™åˆ¶**ï¼šåŸºäº IP + ç”¨æˆ· IDï¼›ç™»å½•/ç®¡ç†æ¥å£æ›´ä¸¥æ ¼ï¼›

* âœ… **CORS**ï¼šç™½åå•ï¼›

* âœ… **Helmet**ï¼šåŸºæœ¬å®‰å…¨å¤´ï¼›

* âœ… **SQL å®‰å…¨**ï¼šä¸€å¾‹ä½¿ç”¨ Knex å‚æ•°åŒ–ï¼›

* âœ… **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•å…³é”®æ“ä½œä¸æ“ä½œè€…ã€æ¥æº IPã€UAï¼›

* âœ… **å¤‡ä»½**ï¼šå…³é”®è¡¨æ¯æ—¥å¤‡ä»½ç­–ç•¥ï¼ˆç”± Deploy æ‰§è¡Œï¼Œä½†æˆ‘ä»¬é…åˆæä¾›è¿ç§»è„šæœ¬ä¸å¯¼å‡ºå·¥å…·ï¼‰ã€‚

* âŒ ç¦æ­¢åœ¨ `catch` ä¸­åæ‰é”™è¯¯ã€‚

* âŒ ç¦æ­¢åœ¨ `SELECT *` æˆ–æ— ç´¢å¼•æ¡ä»¶ä¸‹æ‰«æå¤§è¡¨ã€‚

* âŒ ç¦æ­¢å°†å†·å¯åŠ¨/é•¿è€—æ—¶é€»è¾‘æ”¾åœ¨åŒæ­¥è·¯å¾„ï¼ˆåº”äº¤ç»™ SCF/é˜Ÿåˆ—ï¼‰ã€‚

## åä¾‹è¯´æ˜

* **åä¾‹1**ï¼šæ¥å£ç›´æ¥è¿”å› ORM å¯¹è±¡ï¼Œç¼ºå°‘é”™è¯¯æ˜ å°„ â†’ å‰ç«¯è§£æä¸ä¸€è‡´ã€‚
* **åä¾‹2**ï¼šåˆ†é¡µæœªåŠ ç´¢å¼• â†’ P95 è¶… 2sã€‚
* **åä¾‹3**ï¼šæŠŠè½¬ç é€»è¾‘æ”¾åœ¨è¯·æ±‚çº¿ç¨‹é˜»å¡ 30s â†’ è¶…æ—¶/é›ªå´©ã€‚

---

# skills/backend\_dev\_skill/CONTEXT.md

> èƒŒæ™¯ä¸â€œå¯ç›´æ¥è½åœ°â€çš„å·¥ç¨‹çº¦å®š

## 1. æŠ€æœ¯æ ˆä¸ä¾èµ–

* **Runtime**ï¼šNode.js 18+
* **Web æ¡†æ¶**ï¼šExpress.js
* **DB**ï¼šMySQL 8.0ï¼ˆå­—ç¬¦é›† `utf8mb4`ï¼‰ï¼Œè¿æ¥æ±  `max=10~20`
* **ORM/Query**ï¼šKnex.jsï¼ˆè¿ç§»/ç§å­ + åŸç”Ÿ SQL æ··ç”¨ï¼‰
* **Cache/Queue**ï¼šRedisï¼ˆç¼“å­˜ä¸é€Ÿç‡é™åˆ¶ï¼‰ï¼›å¯é€‰ bullmqï¼ˆå¦‚éœ€é˜Ÿåˆ—ï¼‰
* **æµ‹è¯•**ï¼šJest + Supertest
* **æ–‡æ¡£**ï¼šOpenAPIï¼ˆyamlï¼‰ï¼Œå¯é€‰ `swagger-ui-express` æä¾›å¯è§†åŒ–
* **æ—¥å¿—**ï¼špinoï¼ˆç»“æ„åŒ–ï¼‰
* **é…ç½®**ï¼šdotenvï¼ˆ`.env`ï¼‰
* **éƒ¨ç½²**ï¼šPM2ï¼ˆ3 è¿›ç¨‹ï¼Œcluster æ¨¡å¼ï¼‰ï¼ŒNginx åä»£ï¼Œå®å¡”ç®¡ç†

## 2. ç›®å½•ä¸æ¨¡å—åˆ†å±‚

* `api/`ï¼šä»…å¤„ç†è·¯ç”±ä¸è¾“å…¥è¾“å‡ºæ˜ å°„ï¼Œä¸å«ä¸šåŠ¡é€»è¾‘
* `services/`ï¼šä¸šåŠ¡é€»è¾‘ï¼Œç»„åˆå¤šä¸ªä»“å‚¨ä¸å¤–éƒ¨æœåŠ¡
* `repositories/`ï¼šæ•°æ®è¯»å†™ï¼Œ**åªè¿”å›çº¯æ•°æ®ï¼Œä¸æºæ‚ Express å¯¹è±¡**
* `middlewares/`ï¼šé‰´æƒã€RBACã€é€Ÿç‡é™åˆ¶ã€é”™è¯¯å¤„ç†
* `utils/`ï¼šé€šç”¨å‡½æ•°ã€ç»Ÿä¸€å“åº”ä¸é”™è¯¯ç è¡¨

## 3. é…ç½®ä¸ç¯å¢ƒå˜é‡ï¼ˆç¤ºä¾‹ï¼‰

```
APP_PORT=8080
NODE_ENV=production
MYSQL_HOST=127.0.0.1
MYSQL_PORT=3306
MYSQL_USER=cms
MYSQL_PASSWORD=secure
MYSQL_DB=cms
REDIS_URL=redis://127.0.0.1:6379
JWT_SECRET=your_jwt_secret
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX=100
```

## 4. æ•°æ®åº“åŸºçº¿ï¼ˆCMS ç›¸å…³ï¼‰

* `content_types(id, name, slug UNIQUE, created_at, updated_at)`
* `content_fields(id, content_type_id FK, key, type, required, rules JSON, ... )`
* `content_items(id, type_id FK, version INT, status ENUM(draft,review,published), data JSON, created_by, created_at, updated_at)`
* **ç´¢å¼•**ï¼š

  * `content_types.slug UNIQUE`
  * `content_items(type_id, status)` å¤åˆç´¢å¼•
  * å¸¸ç”¨è¿‡æ»¤å­—æ®µå»º BTree ç´¢å¼•ï¼Œé¿å…å…¨è¡¨æ‰«æ

## 5. API çº¦å®š

* åŸºç¡€è·¯å¾„ï¼š`/api/v1`
* èµ„æºé£æ ¼ï¼šå¤æ•°åè¯ï¼ˆ`/content-types`, `/content-items`ï¼‰
* åˆ†é¡µï¼š`?page=1&limit=20`ï¼Œè¿”å› `{ total, items }`
* é”™è¯¯ç ï¼š`code`ï¼ˆæ•´å½¢ï¼‰ï¼Œ`message`ï¼ˆäººç±»å¯è¯»ï¼‰ï¼Œ`requestId`
* å¥åº·æ£€æŸ¥ï¼š`/health` è¿”å› `200 { status:"ok", ts }`

## 6. ç¼“å­˜ä¸é€Ÿç‡é™åˆ¶

* **ç¼“å­˜**ï¼šçƒ­ç‚¹ GET è¯·æ±‚ä½¿ç”¨ Redisï¼Œé”®è§„åˆ™ï¼š`cache:<route>:<hash(query)>`ï¼ŒTTL 30\~120s
* **å¤±æ•ˆ**ï¼šå¢åˆ æ”¹åæŒ‰ `type_id` æˆ– `slug` ç»´åº¦ç²¾ç¡®å¤±æ•ˆ
* **é€Ÿç‡é™åˆ¶**ï¼š`IP+userId` åŒå› å­ï¼Œçª—å£ 60sï¼Œé»˜è®¤ 100 æ¬¡ï¼›ç™»å½•æ¥å£æ›´ä¸¥ï¼ˆ20 æ¬¡ï¼‰

## 7. å®‰å…¨åŸºçº¿

* Helmet å®‰å…¨å¤´ï¼›CORS ç™½åå•ï¼›JWT é‰´æƒï¼›RBAC ä¸­é—´ä»¶ï¼›
* Joi/Zod å…¥å‚æ ¡éªŒï¼›Knex å‚æ•°åŒ–ï¼›å®¡è®¡æ—¥å¿—ï¼ˆè°åœ¨ä½•æ—¶å¯¹ä½•èµ„æºåšäº†ä»€ä¹ˆï¼‰ã€‚

## 8. å¯è§‚æµ‹æ€§

* **æ—¥å¿—**ï¼špinoï¼ˆåŒ…å« `requestId`ã€ç”¨æˆ·IDã€è·¯ç”±ã€è€—æ—¶ã€ç»“æœç ï¼‰
* **è®¡æ•°å™¨**ï¼šè¯·æ±‚æ•°ã€é”™è¯¯ç‡ã€ç¼“å­˜å‘½ä¸­ç‡ï¼ˆæŒ‰è·¯ç”±ï¼‰
* **Tracingï¼ˆé€‰ï¼‰**ï¼šå¯åŠ å…¥ open-telemetry ç®€åŒ–è¿½è¸ªï¼ˆé MVP å¿…é€‰ï¼‰

## 9. ä¸ SCF/COS çš„é›†æˆ

* ç›´ä¼ ç­¾åï¼šç”± SCF æä¾›ï¼ˆ`CMS-S-001`ï¼‰ï¼Œåç«¯åªè´Ÿè´£æ ¡éªŒ/è½åº“ç­–ç•¥è¯´æ˜ã€‚
* COS å›è°ƒï¼šæä¾› `/webhooks/cos` æ¥å£ï¼Œæ ¡éªŒç­¾åä¸å¹‚ç­‰ï¼Œå†™å…¥ `media` å…ƒæ•°æ®å¹¶è§¦å‘ä¸šåŠ¡äº‹ä»¶ã€‚

## 10. ä¸ Provider/Quota çš„å¯¹æ¥ï¼ˆå¦‚æœ‰ï¼‰

* å¯¹æ¥ Provider å‰æ£€æŸ¥ **é…é¢**ï¼š`quotaCheck(userId, featureKey)`ï¼›æˆåŠŸåå†è°ƒç”¨ï¼›å¤±è´¥è¿”å›ä¸šåŠ¡é”™è¯¯å¹¶è®°å½•å®¡è®¡ã€‚
* å¤±è´¥å›æ»šï¼šå¦‚è°ƒç”¨å¤±è´¥ï¼Œæ’¤é”€æœ¬æ¬¡æ‰£å‡ï¼ˆç”±é…é¢ç³»ç»Ÿæä¾›è¡¥å¿ APIï¼›å¦‚æ— åˆ™è®°å½•å¼‚å¸¸å¹¶äººå·¥å¯¹è´¦ï¼‰ã€‚

---

# skills/backend\_dev\_skill/EXAMPLES.md

> çœŸå®å¯ç”¨çš„ç¤ºä¾‹ï¼šOpenAPI ç‰‡æ®µã€è¿ç§»ã€è·¯ç”±/æœåŠ¡ã€æµ‹è¯•ã€ç¼“å­˜ã€å›è°ƒã€ä¿®å¤å¡æ‰§è¡Œç­‰ã€‚

## 1. OpenAPI ç‰‡æ®µï¼ˆå†…å®¹ç±»å‹ CRUDï¼‰

`openapi/cms-content-type.yaml`

```yaml
openapi: 3.0.3
info:
  title: CMS Content Type API
  version: 1.0.0
paths:
  /api/v1/content-types:
    get:
      summary: List content types
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: limit
          schema: { type: integer, default: 20, minimum: 1, maximum: 100 }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  code: { type: integer, example: 0 }
                  data:
                    type: object
                    properties:
                      total: { type: integer, example: 2 }
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/ContentType'
  /api/v1/content-types/{id}:
    get:
      summary: Get content type by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
components:
  schemas:
    ContentType:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        slug: { type: string, example: "article" }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
```

## 2. Knex è¿ç§»ï¼ˆMySQL 8ï¼‰

`migrations/2025-10-30-ct-init.js`

```js
exports.up = async function(knex) {
  await knex.schema.createTable('content_types', (t) => {
    t.increments('id').primary();
    t.string('name', 100).notNullable();
    t.string('slug', 100).notNullable().unique();
    t.timestamps(true, true);
  });

  await knex.schema.createTable('content_fields', (t) => {
    t.increments('id').primary();
    t.integer('content_type_id').unsigned().references('content_types.id').onDelete('CASCADE');
    t.string('key', 100).notNullable();
    t.enum('type', ['text','number','boolean','enum','ref']).notNullable();
    t.boolean('required').defaultTo(false);
    t.json('rules');
    t.timestamps(true, true);
    t.index(['content_type_id','key']);
  });
};

exports.down = async function(knex) {
  await knex.schema.dropTableIfExists('content_fields');
  await knex.schema.dropTableIfExists('content_types');
};
```

## 3. Express è·¯ç”±/æ§åˆ¶å™¨/æœåŠ¡/ä»“å‚¨

`src/api/content-types.route.ts`

```ts
import { Router } from 'express';
import * as ctrl from './content-types.ctrl';
import { auth, rbac, rateLimit } from '../middlewares';

const router = Router();
router.get('/', auth, rbac('content_type:read'), rateLimit('list'), ctrl.list);
router.get('/:id', auth, rbac('content_type:read'), ctrl.getById);
router.post('/', auth, rbac('content_type:write'), ctrl.create);
router.put('/:id', auth, rbac('content_type:write'), ctrl.update);
router.delete('/:id', auth, rbac('content_type:write'), ctrl.remove);
export default router;
```

`src/api/content-types.ctrl.ts`

```ts
import * as svc from '../services/content-types.svc';
import { ok, fail } from '../utils/response';

export async function list(req, res, next) {
  try {
    const page = Number(req.query.page || 1);
    const limit = Math.min(100, Number(req.query.limit || 20));
    const data = await svc.list({ page, limit });
    res.json(ok(data));
  } catch (e) { next(e); }
}

export async function create(req, res, next) {
  try {
    const { name, slug, fields } = req.body;
    const id = await svc.create({ name, slug, fields, actor: req.user.id });
    res.status(201).json(ok({ id }));
  } catch (e) { next(e); }
}
```

`src/services/content-types.svc.ts`

```ts
import * as repo from '../repositories/content-types.repo';
import { BadRequestError } from '../utils/errors';
import { audit } from '../utils/audit';

export async function list({ page, limit }) {
  return repo.list({ page, limit });
}

export async function create({ name, slug, fields, actor }) {
  if (!name || !slug) throw new BadRequestError('name/slug required');
  const exists = await repo.findBySlug(slug);
  if (exists) throw new BadRequestError('slug exists');

  const id = await repo.create({ name, slug, fields });
  await audit(actor, 'content_type.create', { id, slug });
  return id;
}
```

`src/repositories/content-types.repo.ts`

```ts
import knex from '../utils/knex';

export async function list({ page, limit }) {
  const [{ count }] = await knex('content_types').count({ count: '*' });
  const items = await knex('content_types')
    .select('id','name','slug','created_at','updated_at')
    .offset((page - 1) * limit)
    .limit(limit)
    .orderBy('id','desc');
  return { total: Number(count), items };
}

export async function findBySlug(slug: string) {
  return knex('content_types').where({ slug }).first();
}

export async function create({ name, slug, fields }) {
  return await knex.transaction(async (trx) => {
    const [id] = await trx('content_types').insert({ name, slug });
    if (Array.isArray(fields)) {
      for (const f of fields) {
        await trx('content_fields').insert({
          content_type_id: id,
          key: f.key,
          type: f.type,
          required: !!f.required,
          rules: JSON.stringify(f.rules || null)
        });
      }
    }
    return id;
  });
}
```

`src/utils/response.ts`

```ts
export const ok = (data:any, message='ok') => ({ code: 0, message, data, requestId: (global as any).requestId });
export const fail = (code:number, message:string) => ({ code, message, requestId: (global as any).requestId });
```

## 4. Jest + Supertest æµ‹è¯•ï¼ˆUT/é›†æˆï¼‰

`tests/integration/content-types.spec.ts`

```ts
import request from 'supertest';
import app from '../../src/app';
import knex from '../../src/utils/knex';

describe('Content Types', () => {
  beforeAll(async () => { /* seed data */ });
  afterAll(async () => { await knex.destroy(); });

  it('create -> list -> get', async () => {
    const token = await loginAsAdmin(request(app)); // helper
    const createRes = await request(app)
      .post('/api/v1/content-types')
      .set('Authorization', `Bearer ${token}`)
      .send({ name: 'æ–‡ç« ', slug: 'article', fields: [{ key:'title', type:'text', required:true }] })
      .expect(201);
    expect(createRes.body.code).toBe(0);

    const listRes = await request(app)
      .get('/api/v1/content-types?page=1&limit=10')
      .set('Authorization', `Bearer ${token}`)
      .expect(200);
    expect(listRes.body.data.items.length).toBeGreaterThan(0);
  });
});
```

## 5. Redis ç¼“å­˜ä¸é€Ÿç‡é™åˆ¶ï¼ˆç‰‡æ®µï¼‰

`src/middlewares/rateLimit.ts`

```ts
import { createClient } from 'redis';
const client = createClient({ url: process.env.REDIS_URL });

export function rateLimit(bucket='default') {
  return async (req, res, next) => {
    const key = `rl:${bucket}:${req.ip}:${req.user?.id || 'anon'}`;
    const ttl = Number(process.env.RATE_LIMIT_WINDOW_MS || 60000);
    const max = Number(process.env.RATE_LIMIT_MAX || 100);
    const now = Date.now();
    const windowKey = Math.floor(now / ttl);
    const counterKey = `${key}:${windowKey}`;

    const count = Number(await client.incr(counterKey));
    if (count === 1) await client.pexpire(counterKey, ttl);

    if (count > max) return res.status(429).json({ code: 10029, message: 'too_many_requests' });
    next();
  };
}
```

`src/services/cache.ts`

```ts
import { createClient } from 'redis';
import crypto from 'crypto';
const client = createClient({ url: process.env.REDIS_URL });

export async function cachedList(route: string, query: any, fetcher: () => Promise<any>, ttlSec=60) {
  const key = `cache:${route}:${crypto.createHash('md5').update(JSON.stringify(query)).digest('hex')}`;
  const cached = await client.get(key);
  if (cached) return JSON.parse(cached);
  const data = await fetcher();
  await client.setEx(key, ttlSec, JSON.stringify(data));
  return data;
}
```

## 6. COS/SCF å›è°ƒç¤ºä¾‹

`src/api/webhooks/cos.ctrl.ts`

```ts
import { verifyCosSignature } from '../../utils/cos';
import { audit } from '../../utils/audit';

export async function cosCallback(req, res, next) {
  try {
    if (!verifyCosSignature(req)) return res.status(403).json({ code: 10013, message: 'invalid_signature' });
    const event = req.body; // { jobId, bucket, object, size, mime }
    const ok = await upsertMediaMeta(event); // å¹‚ç­‰ï¼Œä¾æ® jobId æˆ– objectKey
    await audit(req.user?.id || 0, 'cos.callback', { jobId: event.jobId, ok });
    res.json({ code: 0, message: 'ok' });
  } catch (e) { next(e); }
}
```

## 7. ä¿®å¤ä»»åŠ¡å¡æ‰§è¡Œï¼ˆæ¥è‡ª Reviewerï¼‰

**ä¿®å¤å¡**ï¼š`CMS-B-002-FIX-01` â€” â€œä¿®å¤å†…å®¹é¡¹åˆ—è¡¨ N+1 æŸ¥è¯¢å¹¶è¡¥å……ç´¢å¼•â€
**å®æ–½è¦ç‚¹**ï¼š

* æŸ¥è¯¢æ‰¹é‡åŠ è½½å­—æ®µæˆ–ç”¨ JOINï¼›
* æ·»åŠ ç´¢å¼• `content_items(type_id,status)`ï¼›
* è¡¥å……æ€§èƒ½å¯¹æ¯”æŠ¥å‘Š `reports/perf-items.md`ï¼›
* æ›´æ–° UT/é›†æˆæµ‹è¯•ã€‚

**è¿ç§»è¿½åŠ **ï¼š`migrations/2025-11-02-items-index.js`

```js
exports.up = async (knex) => {
  await knex.schema.alterTable('content_items', t => {
    t.index(['type_id','status'], 'idx_items_type_status');
  });
};
exports.down = async (knex) => {
  await knex.schema.alterTable('content_items', t => {
    t.dropIndex(['type_id','status'], 'idx_items_type_status');
  });
};
```

---

# skills/backend\_dev\_skill/FLOW\.md

> æ ‡å‡†å·¥ä½œæµç¨‹ï¼š**æ¥å¡ â†’ è®¾è®¡ â†’ å¥‘çº¦ â†’ è¿ç§» â†’ å®ç° â†’ æµ‹è¯• â†’ è‡ªæ£€ â†’ PR â†’ äº‹ä»¶é€šçŸ¥ â†’ äº¤ä»˜**

## æµç¨‹å›¾ï¼ˆMermaidï¼‰

```mermaid
flowchart TD
  A[æ¥æ”¶ä»»åŠ¡å¡] --> B[é˜…è¯»ä¸æ¾„æ¸…]
  B --> C{æ˜¯å¦Breaking?}
  C -- æ˜¯ --> CR[æå‡ºå˜æ›´è¯·æ±‚å¹¶ç­‰å¾…Plannerç¡®è®¤]
  C -- å¦ --> D[ç¼–å†™/æ›´æ–°OpenAPI]
  D --> E[æ•°æ®åº“è®¾è®¡ä¸è¿ç§»è„šæœ¬]
  E --> F[ç¼–ç å®ç°(æœåŠ¡/æ§åˆ¶å™¨/ä»“å‚¨)]
  F --> G[ç¼–å†™UT/é›†æˆæµ‹è¯•]
  G --> H[æœ¬åœ°éªŒè¯ã€lintã€è¦†ç›–ç‡>=80%]
  H --> I[æäº¤PR, è¯·æ±‚Reviewer]
  I --> J{Revieweré€šè¿‡?}
  J -- å¦ --> FIX[æ”¶åˆ°ä¿®å¤å¡/ä¿®æ”¹PR] --> I
  J -- æ˜¯ --> K[å‘å¸ƒAPI_CONTRACT_READYäº‹ä»¶]
  K --> L[ç§»äº¤QAå†’çƒŸ/å›å½’]
  L --> M{QAé€šè¿‡?}
  M -- å¦ --> FIX2[ä¿®å¤åå›å½’] --> I
  M -- æ˜¯ --> N[äº¤ä»˜Deploy]
```

## 1) æ¥æ”¶ä»»åŠ¡å¡

* ç¡®è®¤ 18 ä¸ªæ ¸å¿ƒå­—æ®µé½å…¨ï¼ˆè§ Planner è§„åˆ™ï¼‰ã€‚
* å¯¹ä¸æ˜ç¡®ä¹‹å¤„æäº¤æ¾„æ¸…ï¼›å¯èƒ½éœ€è¦ Planner ç¡®è®¤é»˜è®¤å‡è®¾ã€‚

## 2) è®¾è®¡ä¸è¯„ä¼°

* æ£€æŸ¥æ˜¯å¦æ¶‰åŠ Breaking Changeï¼›å¦‚æœ‰ â†’ èµ° CRã€‚
* è¯„ä¼°æ€§èƒ½ä¸ç´¢å¼•éœ€æ±‚ã€ç¼“å­˜ç­–ç•¥ã€å¹‚ç­‰ä¸é‡è¯•ç­–ç•¥ã€‚

## 3) OpenAPI å…ˆè¡Œ

* äº§å‡ºæˆ–æ›´æ–° `openapi/*.yaml`ï¼›å­—æ®µæ³¨é‡Šä¸ç¤ºä¾‹é½å…¨ï¼›é”™è¯¯ç åˆ—å‡ºã€‚
* çº¦å®šå“åº”ç»Ÿä¸€æ ¼å¼ï¼ˆ`code/message/data/requestId`ï¼‰ã€‚

## 4) æ•°æ®åº“è¿ç§»

* è®¾è®¡è¡¨ç»“æ„ä¸ç´¢å¼•ï¼›éµå¾ªä¸å¯æ”¹å†™å†å²çš„åŸåˆ™ï¼›è¿½åŠ è¿ç§»ã€‚
* å¦‚ä¸ºä¿®å¤ä»»åŠ¡å¡ï¼Œç´¢å¼•/ç»“æ„ä¼˜åŒ–å•ç‹¬è¿ç§»æ–‡ä»¶ã€‚

## 5) å®ç°

* æ§åˆ¶å™¨è–„ã€æœåŠ¡åšã€ä»“å‚¨ä¸“æ³¨æ•°æ®ï¼›
* ä¸­é—´ä»¶ï¼šé‰´æƒã€RBACã€é€Ÿç‡é™åˆ¶ã€é”™è¯¯æ˜ å°„ï¼›
* æ—¥å¿—ï¼šç»“æ„åŒ– + requestIdï¼›
* ç¼“å­˜ï¼šåªç¼“å­˜ GETï¼Œå†™æ“ä½œæŒ‰é”®ç²¾ç¡®å¤±æ•ˆã€‚

## 6) æµ‹è¯•

* **UT**ï¼šæœåŠ¡å±‚è¾¹ç•Œä¸å¼‚å¸¸ï¼›
* **é›†æˆ**ï¼šAPI è·¯å¾„ï¼ˆSupertestï¼‰ï¼Œæ ¡éªŒé‰´æƒ/çŠ¶æ€ç /æ•°æ®ç»“æ„ï¼›
* è¦†ç›–ç‡å¿…é¡» â‰¥ 80%ã€‚

## 7) è‡ªæ£€ä¸ PR

* è¿è¡Œ `npm run lint && npm run test:cov`ï¼›
* å¡«å†™ PR æ¨¡æ¿ï¼ˆå˜æ›´è¯´æ˜ã€OpenAPI å˜æ›´ã€è¿ç§»æè¿°ã€é£é™©/å›æ»šï¼‰ï¼›
* æŒ‡å®š Reviewer ä¸ç›¸å…³éƒ¨é—¨ï¼ˆFrontend/QA/Deployï¼‰ã€‚

## 8) äº‹ä»¶é€šçŸ¥

* PR åˆå¹¶åï¼šå‘å¸ƒ `API_CONTRACT_READY`ï¼ˆåŒ…å« openapi è·¯å¾„ã€ç‰ˆæœ¬/å˜æ›´æ¦‚è¦ï¼‰ï¼›
* è®°å½•åœ¨ `changelog.md`ã€‚

## 9) äº¤ä»˜ä¸æ”¯æŒ

* æ”¯æŒ QA å†’çƒŸ/å›å½’ï¼›
* ä¸ Deploy å¯¹é½å¥åº·æ£€æŸ¥è·¯å¾„ã€å¯åŠ¨å‚æ•°ï¼›
* è‹¥ Billing Guard æŠ¥è­¦æˆæœ¬å¼‚å¸¸ï¼Œé…åˆåšç¼“å­˜ã€æ‰¹é‡åŒ–æˆ–é™çº§ã€‚

---

# skills/backend\_dev\_skill/CHECKLIST.md

> åœ¨æäº¤ PR å‰é€é¡¹å‹¾é€‰ã€‚æœªé€šè¿‡é¡¹è¯·å‹¿æäº¤ã€‚

## A. å¥‘çº¦ä¸æ–‡æ¡£

* [ ] å·²æ–°å¢/æ›´æ–° `openapi/*.yaml`ï¼Œå­—æ®µ/é”™è¯¯ç /ç¤ºä¾‹é½å…¨ã€‚
* [ ] è‹¥æœ‰ Breaking Changeï¼Œå·²é€šè¿‡ Planner CR å¹¶åœ¨å˜æ›´æ—¥å¿—ä¸­æ ‡æ³¨ã€‚
* [ ] `README/è®¾è®¡è¯´æ˜` ä¸ `deliverables` è·¯å¾„ä¸€è‡´ã€‚

## B. æ•°æ®åº“ä¸è¿ç§»

* [ ] è¿ç§»è„šæœ¬ **ä¸å¯æ”¹å†™å†å²**ï¼Œä»…è¿½åŠ æ–°è¿ç§»ã€‚
* [ ] æ‰€æœ‰ä¸»è·¯å¾„æŸ¥è¯¢å‡æœ‰åˆé€‚ç´¢å¼•ï¼ˆé¿å…å…¨è¡¨æ‰«æï¼‰ã€‚
* [ ] å¤–é”®/çº¦æŸåˆç†ï¼›äº‹åŠ¡è¦†ç›–å¤šè¡¨å†™å…¥ã€‚
* [ ] å­—æ®µç±»å‹/é•¿åº¦é€‚å½“ï¼ˆé¿å…è¿‡é•¿å­—ç¬¦ä¸²å­—æ®µç”¨äºç´¢å¼•ï¼‰ã€‚

## C. å®‰å…¨ä¸åˆè§„

* [ ] æ‰€æœ‰é `/health` è·¯å¾„å‡æœ‰é‰´æƒï¼›RBAC æƒé™ç‚¹æ­£ç¡®ã€‚
* [ ] è¾“å…¥æ ¡éªŒå®Œå¤‡ï¼ˆç±»å‹/é•¿åº¦/èŒƒå›´/æšä¸¾ï¼‰ã€‚
* [ ] æ— æ•æ„Ÿæ•°æ®æ³„éœ²åˆ°æ—¥å¿—ï¼›requestId å­˜åœ¨ã€‚
* [ ] é€Ÿç‡é™åˆ¶å·²å¯ç”¨å¹¶é…ç½®åˆç†ã€‚
* [ ] å®¡è®¡æ—¥å¿—è®°å½•å…³é”®ç®¡ç†æ“ä½œã€‚

## D. æ€§èƒ½ä¸ç¼“å­˜

* [ ] æ ¸å¿ƒ GET æ¥å£ä½¿ç”¨ Redis ç¼“å­˜ï¼›å†™æ“ä½œç²¾ç¡®å¤±æ•ˆã€‚
* [ ] æ—  N+1ï¼›å¿…è¦åœºæ™¯ä½¿ç”¨ JOIN/æ‰¹é‡åŠ è½½ã€‚
* [ ] P95 â‰¤ 200msï¼ˆåœ¨ 4c4gï¼ŒPM2 3 è¿›ç¨‹ä¸‹æœ¬åœ°/æµ‹è¯•æ•°æ®åŸºå‡†è¿‡å…³ï¼‰ã€‚

## E. æµ‹è¯•ä¸è´¨é‡

* [ ] Jest + Supertest è¦†ç›–ç‡ â‰¥ 80%ï¼›å¤±è´¥åœºæ™¯ä¸è¾¹ç•Œå€¼è¦†ç›–ã€‚
* [ ] æœ¬åœ° `lint` ä¸ `format` é€šè¿‡ï¼›æ—  `any` æ±¡æŸ“å…³é”®è·¯å¾„ã€‚
* [ ] E2Eï¼ˆå¦‚æ¶‰åŠï¼‰å·²ä¸ QA/Frontend å¯¹é½é€‰æ‹©å™¨ä¸è„šæœ¬ã€‚

## F. åä½œä¸äº¤ä»˜

* [ ] å·²å‘ Frontend å‘é€ `API_CONTRACT_READY`ï¼Œç­‰å¾… `ACK`ã€‚
* [ ] PR å·²è¯·æ±‚ Reviewer å®¡æŸ¥å¹¶æ ¹æ®æ„è§ä¿®æ­£æˆ–æ¥å—ä¿®å¤å¡ã€‚
* [ ] äº¤ä»˜ç‰©ä¸ä»»åŠ¡å¡ `deliverables` è·¯å¾„ä¸€è‡´ï¼›è‡ªè¿°æ–‡æ¡£æ¸…æ™°ã€‚
* [ ] è‹¥æ¶‰åŠæˆæœ¬è·¯å¾„ï¼Œå·²ä¸ Billing Guard è¯„å®¡ç¼“å­˜/æ‰¹é‡/é™çº§ç­–ç•¥ã€‚

## å…¸å‹åä¾‹

* [ ] âŒ æ—  OpenAPI â†’ ä¸å¯æ¥å—ã€‚
* [ ] âŒ è¿ç§»æ”¹å†™å†å² â†’ ä¸å¯æ¥å—ã€‚
* [ ] âŒ è¦†ç›–ç‡ < 80% â†’ ä¸å¯æ¥å—ã€‚
* [ ] âŒ æ— ç´¢å¼•å¯¼è‡´æ…¢æŸ¥è¯¢ â†’ ä¸å¯æ¥å—ã€‚
* [ ] âŒ è¿”å›åŸå§‹é”™è¯¯å †æ ˆåˆ°å®¢æˆ·ç«¯ â†’ ä¸å¯æ¥å—ã€‚

---

> **ç¬¬2æ‰¹æ¬¡ï¼ˆBackend Dev å…¨éƒ¨æ‰‹å†Œï¼‰äº¤ä»˜å®Œæ¯•ã€‚**
> æˆ‘å·²ç¡®ä¿ä¸ç¬¬1æ‰¹ Product Planner æ‰‹å†Œä¸­æ‰€æœ‰å¥‘çº¦/äº‹ä»¶å‘½åä¿æŒä¸€è‡´ï¼ˆOpenAPI å…ˆè¡Œã€ä»»åŠ¡å¡ 18 å­—æ®µã€äº‹ä»¶é©±åŠ¨åä½œã€Reviewer ä¿®å¤å¡æ‰¿æ¥ç­‰ï¼‰ã€‚
> å¦‚æœä½ ç¡®è®¤æ— è¯¯ï¼Œæˆ‘å¯ä»¥ç»§ç»­è¾“å‡º**ç¬¬3æ‰¹ï¼š`frontend_dev_skill` çš„ 6 ä¸ªå®Œæ•´æ‰‹å†Œ**ï¼Œå»¶ç»­åŒä¸€å¥—è§„èŒƒä¸ç¤ºä¾‹ä¸²è”ï¼ˆå« Next.js 14 + AntD + Zustand + Playwright çš„å¯ç›´æ¥ä½¿ç”¨ç¤ºä¾‹ï¼‰ã€‚

ä¸‹é¢æ˜¯**ç¬¬3æ‰¹äº¤ä»˜**ï¼š`frontend_dev_skill` çš„ 6 ä¸ªæ‰‹å†Œæ–‡ä»¶ï¼ˆå¯ç›´æ¥å¤åˆ¶åˆ°ä½ çš„ä»“åº“ `skills/frontend_dev_skill/` ç›®å½•ï¼‰ã€‚
å†…å®¹ä¸å‰ä¸¤æ‰¹ä¸¥æ ¼å¯¹é½ï¼ˆOpenAPI å¥‘çº¦å…ˆè¡Œã€äº‹ä»¶é©±åŠ¨åä½œã€ç»Ÿä¸€é”™è¯¯è¿”å›ã€ä»»åŠ¡å¡ 18 å­—æ®µã€Reviewer ä¿®å¤å¡æœºåˆ¶ï¼‰ï¼Œå¹¶è´´åˆä½ çš„æŠ€æœ¯æ ˆï¼š**Next.js 14 + React 18 + TypeScript + Ant Design + Zustand + Playwright**ã€‚

---

# skills/frontend\_dev\_skill/README.md

## æˆ‘æ˜¯è°

æˆ‘æ˜¯ä½ çš„ **å‰ç«¯å¼€å‘ï¼ˆFrontend Devï¼‰** ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»ã€‚
æˆ‘æŠŠ **Product Planner** çš„ä»»åŠ¡å¡ä¸ **Backend** å‘å¸ƒçš„ OpenAPI å¥‘çº¦ï¼Œè½¬åŒ–ä¸º**å¯ç”¨ã€å¥½ç”¨ã€ç¨³ç”¨**çš„ç®¡ç†å°ä¸é¡µé¢ã€‚æˆ‘æ“…é•¿ **Next.js 14 App Router**ã€**React 18**ã€**TypeScript**ã€**Ant Design**ã€**Zustand**ï¼Œå¹¶ç”¨ **Playwright** åšç«¯åˆ°ç«¯ï¼ˆE2Eï¼‰å›å½’éªŒè¯ã€‚

## æˆ‘åšä»€ä¹ˆ

* **å¥‘çº¦é©±åŠ¨å¼€å‘**ï¼šæ¥åˆ° `API_CONTRACT_READY` åï¼Œæ‹‰å–/ç”Ÿæˆå®¢æˆ·ç«¯ç±»å‹ï¼ˆå»ºè®®ï¼šopenapi-typescriptï¼‰ï¼Œæ®æ­¤å®ç°æœåŠ¡å±‚ä¸é¡µé¢ç»„ä»¶ã€‚
* **UI/äº¤äº’å®ç°**ï¼šåŸºäº Ant Design çš„**ç»Ÿä¸€è¡¨å•/è¡¨æ ¼/å¯¹è¯æ¡†æ¨¡å¼**ï¼Œæä¾›ä¸€è‡´çš„åŠ è½½æ€ã€ç©ºæ€ã€é”™è¯¯æ€ã€Skeletonã€‚
* **çŠ¶æ€ç®¡ç†**ï¼šä»¥ **Zustand** ä¸ºä¸­å¿ƒï¼ˆç”¨æˆ·æ€/å…¨å±€ UI æ€/åˆ†é¡µæŸ¥è¯¢æ€ï¼‰ï¼Œè½»é‡å¯æ§ã€‚
* **è®¿é—®æ§åˆ¶**ï¼šç™»å½•è·å– JWT â†’ åŸºäºè§’è‰²çš„**è·¯ç”±å®ˆå«**ä¸èœå•è¿‡æ»¤ã€‚
* **å¯æµ‹è¯•æ€§**ï¼šPlaywright è¦†ç›–â€œç™»å½• â†’ å»ºæ¨¡ â†’ å†…å®¹ CRUD â†’ å‘å¸ƒ â†’ å‰å°å¯è¯»â€çš„æ¼”ç¤ºè·¯å¾„ã€‚
* **åä½œä¸é—¨ç¦**ï¼šéµå®ˆ Review/QA é—¨ç¦ï¼›éµå¾ª `API_CONTRACT_ACK` æµç¨‹ï¼Œæ˜ç¡®å˜æ›´ä¸ä¾èµ–ã€‚

## ä»€ä¹ˆæ—¶å€™å«æˆ‘

* å½“ Planner ç»™å‡º Frontend éƒ¨é—¨çš„ä»»åŠ¡å¡ï¼ˆå¦‚ `CMS-F-001 ç™»å½•/æƒé™è·¯ç”±`, `CMS-F-002 å†…å®¹ç±»å‹å»ºæ¨¡ UI`ï¼‰ã€‚
* å½“ Backend å‘å¸ƒ `API_CONTRACT_READY`ï¼Œéœ€è¦æˆ‘ ACK å¹¶å¯¹é½å‰ç«¯è°ƒç”¨ã€‚
* å½“ Reviewer æŒ‡å‡ºå‰ç«¯é—®é¢˜å¹¶ç­¾å‘ä¿®å¤å¡ï¼ˆå¦‚ `CMS-F-003-FIX-01`ï¼‰ã€‚
* å½“ QA éœ€è¦æˆ‘é…åˆè°ƒæ•´é€‰æ‹©å™¨ã€å¯è®¿é—®æ€§ï¼ˆa11yï¼‰æˆ– E2E ç¨³å®šæ€§ã€‚

## æˆ‘å¦‚ä½•ä¸ä»–äººåä½œ

* **ä¸ Backend**ï¼š

  * æˆ‘ä»¥ OpenAPI å¥‘çº¦ä¸ºå”¯ä¸€äº‹å®æ¥æºã€‚
  * æˆ‘åœ¨å®Œæˆå¯¹æ¥åå‘é€ `API_CONTRACT_ACK`ï¼ˆåœ¨åä½œé¢æ¿/æœºå™¨äººä¸­æ‰“æ ‡ç­¾å³å¯ï¼‰ï¼Œå¹¶æ ‡æ³¨ä½¿ç”¨çš„å®¢æˆ·ç«¯ç±»å‹æ–‡ä»¶ã€‚
* **ä¸ SCF**ï¼š

  * å¯¹æ¥ç›´ä¼ ç­¾åå‚æ•°ä¸ COS å›è°ƒå‘ˆç°ï¼›å‰ç«¯åªæŒæœ‰**ä¸´æ—¶å‡­è¯**ï¼Œä¸ä¿å­˜é•¿æœŸç§˜é’¥ã€‚
* **ä¸ QA**ï¼š

  * æä¾›ç¨³å®šçš„ data-testid/role é€‰æ‹©å™¨ï¼Œä¿è¯ E2E è„šæœ¬å¥å£®ã€‚
* **ä¸ Reviewer**ï¼š

  * æäº¤ PR å‰è‡ªæ£€ a11y/æ€§èƒ½/ä¸€è‡´æ€§ï¼›æ ¹æ®ä¿®å¤å¡å¿«é€Ÿé—­ç¯ã€‚
* **ä¸ Billing Guard**ï¼š

  * å¦‚é¡µé¢å¯èƒ½è§¦å‘é«˜æˆæœ¬è°ƒç”¨ï¼ˆä¾‹å¦‚å¤§æ¨¡å‹å®æ—¶ç”Ÿæˆï¼‰ï¼Œé»˜è®¤å¢åŠ  throttle/debounceï¼Œæç¤ºç”¨æˆ·æ¶ˆè€—ï¼Œå¿…è¦æ—¶èµ°â€œé¢„ä¼°æˆæœ¬ç¡®è®¤â€ã€‚

## äº¤ä»˜ç‰©

* `app/` é¡µé¢ä¸ layoutï¼ˆApp Routerï¼‰
* `components/` å¤ç”¨ç»„ä»¶ï¼ˆè¡¨å•ã€è¡¨æ ¼ã€Modalã€ä¸Šä¼ ç­‰ï¼‰
* `lib/services/` ç»Ÿä¸€æœåŠ¡å±‚ï¼ˆfetch åŒ…è£…ã€é”™è¯¯æ‹¦æˆªã€è¶…æ—¶ã€å–æ¶ˆï¼‰
* `lib/stores/` Zustandï¼ˆç”¨æˆ·æ€/å…¨å±€ UI æ€/ç¼“å­˜ç­–ç•¥ï¼‰
* `tests/e2e/` Playwright ç”¨ä¾‹ï¼ˆç™»å½•/å»ºæ¨¡/CRUD/å‘å¸ƒï¼‰
* `docs/ui-specs/*.md` UI åŸå‹è¯´æ˜ã€å¯è®¿é—®æ€§å£°æ˜

## å¼€å‘å“²å­¦

* **æ˜“ç”¨ä¸€è‡´**ï¼šç»Ÿä¸€çš„ç©º/é”™/è½½æ€ï¼›ç»Ÿä¸€è¡¨å•æ ¡éªŒä¸æ¶ˆæ¯æç¤ºã€‚
* **å¥‘çº¦å…ˆè¡Œ**ï¼šæ— å¥‘çº¦ä¸ç¼–ç ï¼›æ‰€æœ‰è¯·æ±‚å‚æ•°/å“åº”ç»“æ„æœ‰æ®å¯ä¾ã€‚
* **æœ€å°‘çŠ¶æ€**ï¼šèƒ½ç®—çš„ä¸å­˜ï¼›å…¨å±€åªå­˜â€œè·¨é¡µå…±äº«ä¸”å˜åŠ¨é¢‘ç¹â€çš„çŠ¶æ€ï¼ˆå¦‚ç”¨æˆ·æ€ã€å…¨å±€æç¤ºï¼‰ã€‚
* **å¯è§‚æµ‹**ï¼šå‰ç«¯åŸ‹ç‚¹ï¼ˆpageViewã€API é”™è¯¯ï¼‰ã€æ§åˆ¶å°è­¦å‘Šä¸é—®é¢˜å®šä½ã€‚
* **å®‰å…¨**ï¼šJWT ä»…å­˜å‚¨åœ¨ `httpOnly` Cookieï¼ˆæ¨èï¼‰æˆ– `localStorage`ï¼ˆè‹¥åç«¯ä¸æ”¯æŒ Cookie åœºæ™¯åˆ™æƒè¡¡ï¼‰ï¼›å¯¹æ•æ„Ÿæ“ä½œä½œäºŒæ¬¡ç¡®è®¤ã€‚

## ç›®å½•ä¸è§„èŒƒï¼ˆå»ºè®®ï¼‰

```
frontend/
â”œâ”€ app/
â”‚  â”œâ”€ (auth)/login/page.tsx
â”‚  â”œâ”€ (dash)/layout.tsx
â”‚  â”œâ”€ (dash)/types/page.tsx
â”‚  â”œâ”€ (dash)/items/page.tsx
â”‚  â””â”€ globals.css
â”œâ”€ components/
â”‚  â”œâ”€ PageHeader.tsx
â”‚  â”œâ”€ DataTable.tsx
â”‚  â”œâ”€ FieldBuilder/
â”‚  â”‚  â”œâ”€ FieldEditor.tsx
â”‚  â”‚  â””â”€ FieldList.tsx
â”‚  â””â”€ Uploader/
â”œâ”€ lib/
â”‚  â”œâ”€ services/
â”‚  â”‚  â”œâ”€ client.ts        # fetch åŒ…è£…
â”‚  â”‚  â”œâ”€ auth.ts
â”‚  â”‚  â”œâ”€ contentType.ts
â”‚  â”‚  â””â”€ contentItem.ts
â”‚  â”œâ”€ stores/
â”‚  â”‚  â”œâ”€ user.ts
â”‚  â”‚  â””â”€ ui.ts
â”‚  â”œâ”€ hooks/
â”‚  â”‚  â”œâ”€ useAuthGuard.ts
â”‚  â”‚  â””â”€ usePagination.ts
â”‚  â””â”€ types/              # openapi-typescript ç”Ÿæˆ
â”œâ”€ tests/e2e/
â”‚  â”œâ”€ auth.spec.ts
â”‚  â””â”€ type-builder.spec.ts
â””â”€ package.json
```

## å®šä¹‰å®Œæˆï¼ˆDoDï¼‰

* å¯¹åº”ä»»åŠ¡å¡çš„ **éªŒæ”¶æ ‡å‡†å…¨éƒ¨é€šè¿‡**ï¼›
* å®Œæˆ `API_CONTRACT_ACK`ï¼›
* E2E é€šè¿‡ï¼›a11y å…³é”®è·¯å¾„å¯é”®ç›˜æ“ä½œï¼›
* é”™è¯¯/ç©º/åŠ è½½æ€ç¬¦åˆè§„èŒƒï¼›
* Reviewer/QA é—¨ç¦é€šè¿‡ã€‚

---

# skills/frontend\_dev\_skill/RULES.md

> å‰ç«¯å¼€å‘è¡Œä¸ºçº¢çº¿ä¸çº¦æŸã€‚è¿åå°†è§¦å‘ Reviewer/QA/Planner é€€å›ã€‚

## å¥‘çº¦ä¸åä½œ

* âœ… **å¿…é¡»**ä»¥ OpenAPI ä¸ºå”¯ä¸€äº‹å®æ¥æºï¼šæœªæ”¶åˆ° `API_CONTRACT_READY` ä¸å¾—å¼€å§‹å¯¹æ¥ï¼›å¯¹æ¥å®Œæˆå¿…é¡» `ACK`ã€‚

* âœ… ä¸ Backend çš„**ä»»ä½• Breaking å˜æ›´**å¿…é¡»èµ° Planner çš„ CR æµç¨‹å¹¶è®°å½•åœ¨å˜æ›´æ—¥å¿—ã€‚

* âœ… ä¸ SCF çš„å‚æ•°/å›è°ƒäº¤äº’ï¼Œå¿…é¡»é€šè¿‡æ–‡æ¡£ `docs/cos-direct-upload.md`/äº‹ä»¶å¥‘çº¦ç¡®è®¤ã€‚

* âŒ ä¸å¾—æ“…è‡ª Mock ä¸å¥‘çº¦ä¸ä¸€è‡´çš„å­—æ®µç»“æ„ç”¨äºè”è°ƒï¼›ä¸´æ—¶ Mock å¿…é¡»æ¥æºäº OpenAPI Example å¹¶æ¸…æ¥šæ ‡æ³¨â€œä¸´æ—¶â€ã€‚

## æŠ€æœ¯ä¸ç»“æ„

* âœ… é¡µé¢é»˜è®¤ Server Componentsï¼›**éœ€è¦äº¤äº’**ï¼ˆçŠ¶æ€/äº‹ä»¶/Effectï¼‰æ—¶ä½¿ç”¨ `use client`ã€‚

* âœ… ç»Ÿä¸€ä½¿ç”¨ **Ant Design** ç»„ä»¶ï¼›éµå®ˆè¡¨å•/è¡¨æ ¼/å¼¹çª—æ¨¡å¼ï¼›ç»Ÿä¸€ Message/Modal äº¤äº’ã€‚

* âœ… **Zustand** ç®¡ç†å…¨å±€çŠ¶æ€ï¼ˆç”¨æˆ·æ€ã€UI æ€ï¼‰ï¼Œé¡µé¢å±€éƒ¨çŠ¶æ€ä½¿ç”¨ React å±€éƒ¨ stateã€‚

* âœ… æœåŠ¡å±‚ç»Ÿä¸€ä½¿ç”¨ `lib/services/client.ts`ï¼ˆfetch åŒ…è£…ï¼šè¶…æ—¶ã€å–æ¶ˆã€é”™è¯¯ç ç»Ÿä¸€å¤„ç†ï¼‰ã€‚

* âœ… åˆ—è¡¨æŸ¥è¯¢éœ€æŠ½è±¡åˆ†é¡µ Hookï¼ˆ`usePagination`ï¼‰ï¼Œä¿æŒé€»è¾‘ä¸€è‡´ã€‚

* âœ… ç»Ÿä¸€é”™è¯¯å½¢æ€ï¼šåç«¯è¿”å› `{ code, message, data?, requestId }`ï¼Œå‰ç«¯å¼¹å‡º `message.error(message)` å¹¶åœ¨æ§åˆ¶å°æ‰“å° `requestId`ã€‚

* âŒ ç¦æ­¢åœ¨ç»„ä»¶å†…ç›´æ¥å†™ `fetch('/api')`ï¼›å¿…é¡»èµ°æœåŠ¡å±‚ã€‚

* âŒ ç¦æ­¢å…¨å±€ store æ»¥ç”¨ï¼ˆåªå­˜è·¨é¡µå¿…è¦çŠ¶æ€ï¼‰ã€‚

* âŒ ç¦æ­¢æŠŠé•¿è€—æ—¶/é«˜æˆæœ¬æ“ä½œç»‘å®šæŒ‰é’®è¿ç‚¹ï¼ˆéœ€ debounce/disable/loadingï¼‰ã€‚

## è®¿é—®æ§åˆ¶ä¸å®‰å…¨

* âœ… ç™»å½•æˆåŠŸåå†™å…¥ä»¤ç‰Œï¼ˆæ¨è httpOnly Cookieï¼›è‹¥ç”¨ localStorage å¿…é¡»åŒæ—¶åœ¨è¯·æ±‚å¤´ä¼ é€’å¹¶åœ¨é¡µé¢å¯è§†èŒƒå›´å¤–éšè—ï¼‰ã€‚

* âœ… åŸºäºè§’è‰²éšè—èœå•/ç¦ç”¨æŒ‰é’®ï¼›æ•æ„Ÿæ“ä½œäºŒæ¬¡ç¡®è®¤ï¼ˆModal.confirmï¼‰ã€‚

* âœ… è¡¨å•è¾“å…¥å‰ç«¯æ ¡éªŒï¼ˆé•¿åº¦ã€æ ¼å¼ã€é€‰é¡¹ï¼‰ï¼›ä¸Šä¼ æ–‡ä»¶æ£€æŸ¥ç±»å‹/å¤§å°ã€‚

* âœ… ç»Ÿä¸€ XSS é˜²æŠ¤ï¼ˆå±é™© HTML æ¸²æŸ“ä½¿ç”¨ `dangerouslySetInnerHTML` å‰å…ˆæ¸…æ´—ï¼›ä¸šåŠ¡å°½é‡é¿å…ï¼‰ã€‚

* âœ… è·¯ç”±å®ˆå«ï¼ˆ`useAuthGuard` æˆ–ä¸­é—´ä»¶ï¼‰æ‹¦æˆªæœªç™»å½•ç”¨æˆ·è·³è½¬åˆ°ç™»å½•é¡µã€‚

* âŒ ç¦æ­¢åœ¨æ—¥å¿—/æŠ¥é”™ä¸­æ‰“å°ç”¨æˆ·éšç§ï¼ˆé‚®ç®±ã€æ‰‹æœºå·ã€ä»¤ç‰Œï¼‰ã€‚

* âŒ ç¦æ­¢ä»¥ `eval`ã€å†…è”è„šæœ¬ç­‰å½¢å¼å¼•å…¥ç¬¬ä¸‰æ–¹ä¸å¯ä¿¡ä»£ç ã€‚

## æ€§èƒ½ä¸ä½“éªŒ

* âœ… åˆ—è¡¨å¤§æ•°æ®é‡‡ç”¨**åˆ†é¡µ**/**è™šæ‹Ÿæ»šåŠ¨**ï¼ˆAntD Table + virtualizationï¼‰ã€‚

* âœ… è¡¨å•æäº¤æ˜¾ç¤º Loadingï¼›ç½‘ç»œå¼‚å¸¸æä¾›é‡è¯•ï¼›

* âœ… å›¾ç‰‡ä¸åª’ä½“é‡‡ç”¨æ‡’åŠ è½½ã€‚

* âœ… ç»„ä»¶æ‹†åˆ† & æŒ‰éœ€åŠ è½½ï¼ˆ`next/dynamic`ï¼‰ï¼›å¤§ç»„ä»¶é¿å…ä¸å…¨å±€ store é¢‘ç¹è”åŠ¨ã€‚

* âŒ ç¦æ­¢ä¸€æ¬¡æ€§å¼•å…¥å…¨é‡å¤§åŒ…ï¼ˆä¾‹å¦‚åªéœ€è¦å°åŠŸèƒ½æ—¶å¼•å…¥æ•´ä¸ªå›¾è¡¨åº“ï¼‰ã€‚

* âŒ ç¦æ­¢åœ¨ render ä¸­åˆ›å»º**æœª memo**çš„é‡å¯¹è±¡æˆ–å‡½æ•°å¯¼è‡´å­æ ‘é‡å¤æ¸²æŸ“ã€‚

## æµ‹è¯•ä¸å¯è®¿é—®æ€§

* âœ… Playwright è¦†ç›–æ ¸å¿ƒè·¯å¾„ï¼›åŸºäº `data-testid` ä¸å¯è®¿é—®æ€§ role åšé€‰æ‹©å™¨ã€‚
* âœ… å…³é”®è¡¨å•ä¸æŒ‰é’®å…·å¤‡ label/aria å±æ€§ï¼Œé”®ç›˜å¯è¾¾ï¼›
* âœ… å›½é™…åŒ–ï¼ˆå¦‚å¯ç”¨ï¼‰æä¾›åŸºç¡€ en/zh ä¸¤ä»½ç¿»è¯‘æ–‡ä»¶å¹¶æœ‰è¯­è¨€åˆ‡æ¢å…¥å£ã€‚

## PR ä¸é—¨ç¦

* âœ… PR æ¨¡æ¿åŒ…å«ï¼šå˜æ›´ç‚¹ã€ç›¸å…³ä»»åŠ¡å¡ã€å½±å“èŒƒå›´ã€æˆªå›¾/çŸ­è§†é¢‘ã€OpenAPI ç‰ˆæœ¬ã€å›æ»šç­–ç•¥ã€‚
* âœ… Reviewer é—¨ç¦ï¼ša11yã€æ€§èƒ½ã€è§„èŒƒä¸€è‡´æ€§ã€‚
* âœ… QA é—¨ç¦ï¼šE2E é€šè¿‡ã€å†’çƒŸé€šè¿‡ã€‚
* âœ… å®Œæˆååœ¨åä½œé¢æ¿è®°å½• `API_CONTRACT_ACK` ä¸é¡µé¢è·¯å¾„ã€‚

---

# skills/frontend\_dev\_skill/CONTEXT.md

> èƒŒæ™¯èµ„æ–™ä¸ç»Ÿä¸€çº¦å®šï¼Œå¸®åŠ©å‰ç«¯å¿«é€Ÿé«˜è´¨é‡è½åœ°ã€‚

## 1. æŠ€æœ¯æ ˆä¸å…³é”®åº“

* **Next.js 14**ï¼ˆApp Routerï¼‰ï¼šå¸ƒå±€/è·¯ç”±ã€æœåŠ¡å™¨ç»„ä»¶ã€æ•°æ®è·å–ã€RSC ç¼“å­˜ã€‚
* **React 18**ï¼šå¹¶å‘ç‰¹æ€§ã€Suspenseã€useEffect/useMemo/useCallback åŸºç¡€ã€‚
* **TypeScript**ï¼šä¸¥æ ¼æ¨¡å¼ã€ç±»å‹å®‰å…¨ã€‚
* **Ant Design**ï¼šè¡¨å•ã€è¡¨æ ¼ã€Modalã€Messageï¼›ä¸»é¢˜å®šåˆ¶å¯é€‰ã€‚
* **Zustand**ï¼šè½»é‡å…¨å±€çŠ¶æ€ï¼ˆç”¨æˆ·æ€ã€UI æ€ã€ç¼“å­˜ç­–ç•¥ï¼‰ã€‚
* **Playwright**ï¼šE2Eï¼ˆ`tests/e2e`ï¼‰ã€‚
* **openapi-typescriptï¼ˆå»ºè®®ï¼‰**ï¼šä» OpenAPI ç”Ÿæˆ TS ç±»å‹ï¼Œæ”¾ç½®äº `lib/types/`ã€‚

## 2. è¿è¡Œä¸ç¯å¢ƒå˜é‡ï¼ˆç¤ºä¾‹ï¼‰

```
NEXT_PUBLIC_API_BASE=https://api.example.com
NEXT_PUBLIC_CDN_BASE=https://cdn.example.com
```

* **æ³¨æ„**ï¼š`NEXT_PUBLIC_` å‰ç¼€çš„å˜é‡ä¼šæš´éœ²åˆ°æµè§ˆå™¨ï¼Œè¯·å‹¿åŒ…å«æ•æ„Ÿä¿¡æ¯ã€‚

## 3. ç»Ÿä¸€æœåŠ¡å±‚ï¼ˆclient.tsï¼‰

* **è¶…æ—¶**ï¼šé»˜è®¤ 10sï¼Œä½¿ç”¨ `AbortController`ã€‚
* **é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€è§£æ `{ code, message, data?, requestId }`ï¼›é 2xx ä¹Ÿè§£æ bodyã€‚
* **Token**ï¼šä» store æˆ– cookie è¯»å–åŠ åˆ° `Authorization: Bearer`ã€‚
* **é‡è¯•**ï¼ˆå¯é€‰ï¼‰ï¼šå¹‚ç­‰ GET è¯·æ±‚å¤±è´¥å¯è½»é‡é‡è¯• 1 æ¬¡ã€‚
* **ç¤ºä¾‹è§ EXAMPLES.md**ã€‚

## 4. è¡¨å•/è¡¨æ ¼/å¼¹çª—è§„èŒƒ

* **è¡¨å•**ï¼šAntD `<Form>` + `<Form.Item>`ï¼›å¿…å¡«æ ¡éªŒ + è¾¹ç•Œæç¤ºï¼›æäº¤åç¦ç”¨æŒ‰é’® + loadingã€‚
* **è¡¨æ ¼**ï¼šåˆ†é¡µ/æ’åº/è¿‡æ»¤ç»Ÿä¸€å°è£…ï¼›ç©ºæ€ä¸é”™è¯¯æ€ã€‚
* **Modal**ï¼šç”¨äºç ´åæ€§æ“ä½œç¡®è®¤ï¼ˆåˆ é™¤/å‘å¸ƒï¼‰ã€‚

## 5. è®¿é—®æ§åˆ¶

* ç™»å½•é¡µä½äº `(auth)/login`ï¼›ç™»å½•åå†™ tokenï¼›
* `(dash)` åˆ†ç»„ä¸‹æ‰€æœ‰é¡µé¢é»˜è®¤éœ€è¦ç™»å½•ï¼ˆ`useAuthGuard`ï¼‰ï¼›
* èœå•ä¸æŒ‰é’®ä¾æ®è§’è‰²ä» `user.roles` åˆ¤æ–­æ˜¯å¦å±•ç¤ºæˆ–ç¦ç”¨ã€‚

## 6. ä¸ Backend/SCF åä½œ

* æ”¶åˆ° `API_CONTRACT_READY` åï¼š

  1. æ‹‰å– `openapi/*.yaml`ï¼›
  2. è¿è¡Œ `npx openapi-typescript ... -o lib/types/*.d.ts`ï¼›
  3. è°ƒæ•´æœåŠ¡å±‚ä¸é¡µé¢ï¼›
  4. åœ¨åä½œé¢æ¿æ ‡æ³¨ `API_CONTRACT_ACK`ã€‚
* ä¸ SCF ä¸Šä¼ ï¼šè°ƒç”¨ `CMS-S-001` çš„ç­¾åæ¥å£ï¼›ä½¿ç”¨ä¸´æ—¶å‡­è¯ç›´ä¼  COSï¼›å‡­è¯æœ‰æ•ˆæœŸçŸ­ï¼Œå‰ç«¯ä¸ç¼“å­˜ã€‚

## 7. form\_schemas ä¸åŠ¨æ€è¡¨å•

* form\_schemas çš„ `type` å¯¹åº” AntD ç»„ä»¶ï¼š`input/select/switch/list/group` ç­‰ï¼›
* å‰ç«¯æä¾› `SchemaForm` ç»„ä»¶å°† JSON schema â†’ AntD è¡¨å•ï¼›
* å¤æ‚è”åŠ¨ï¼ˆå¦‚å­—æ®µç±»å‹å˜åŒ–é‡ç½® rulesï¼‰ç”¨ `Form.Item dependencies` æˆ–è‡ªå®šä¹‰ Hookã€‚

## 8. E2E é€‰æ‹©å™¨ç­–ç•¥

* çº¦å®š `data-testid` ç”¨äºæ‰€æœ‰å…³é”®äº¤äº’å…ƒç´ ï¼ˆç™»å½•æŒ‰é’®ã€ä¿å­˜ã€æäº¤å®¡æ ¸ã€å‘å¸ƒã€åˆ é™¤ï¼‰ã€‚
* ç¦ç”¨è¿‡äºè„†å¼±çš„ `nth-child`/æ ·å¼ç±»åé€‰æ‹©å™¨ã€‚

---

# skills/frontend\_dev\_skill/EXAMPLES.md

> çœŸå®å¯ç”¨çš„ä»£ç ç‰‡æ®µä¸ä»»åŠ¡å¡æ‰§è¡Œç¤ºä¾‹ï¼Œå¼€ç®±å³å¯å¤ç”¨/æ”¹é€ ã€‚

## 1. æœåŠ¡å±‚ï¼š`lib/services/client.ts`

```ts
'use client';
export type ApiResponse<T=any> = { code: number; message: string; data?: T; requestId?: string };

const API_BASE = process.env.NEXT_PUBLIC_API_BASE!;
const DEFAULT_TIMEOUT = 10000;

export async function api<T>(path: string, options: RequestInit = {}): Promise<T> {
  const controller = new AbortController();
  const id = setTimeout(() => controller.abort(), options.signal ? 0 : DEFAULT_TIMEOUT);

  const token = typeof window !== 'undefined' ? localStorage.getItem('token') : null;
  const headers = new Headers(options.headers || {});
  headers.set('Content-Type', 'application/json');
  if (token) headers.set('Authorization', `Bearer ${token}`);

  try {
    const res = await fetch(`${API_BASE}${path}`, { ...options, headers, signal: controller.signal });
    const body: ApiResponse<T> = await res.json().catch(() => ({ code: 10000, message: 'invalid_json' } as any));
    if (!res.ok || body.code !== 0) {
      console.error('API_ERROR', { path, status: res.status, body });
      throw new Error(body.message || `HTTP_${res.status}`);
    }
    return body.data as T;
  } finally {
    clearTimeout(id);
  }
}

export const get = <T>(path: string) => api<T>(path, { method: 'GET' });
export const post = <T>(path: string, data?: any) => api<T>(path, { method: 'POST', body: JSON.stringify(data || {}) });
export const put =  <T>(path: string, data?: any) => api<T>(path, { method: 'PUT',  body: JSON.stringify(data || {}) });
export const del =  <T>(path: string) => api<T>(path, { method: 'DELETE' });
```

## 2. ç”¨æˆ·æ€ä¸è·¯ç”±å®ˆå«ï¼ˆZustand + Hookï¼‰

`lib/stores/user.ts`

```ts
'use client';
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

type Role = 'admin'|'editor'|'viewer';
type UserState = {
  token?: string;
  roles: Role[];
  profile?: { id: number; name: string; email: string };
  setToken: (t?: string) => void;
  setRoles: (r: Role[]) => void;
  setProfile: (p?: UserState['profile']) => void;
  logout: () => void;
};
export const useUser = create<UserState>()(persist((set) => ({
  token: undefined,
  roles: [],
  profile: undefined,
  setToken: (t) => set({ token: t }),
  setRoles: (r) => set({ roles: r }),
  setProfile: (p) => set({ profile: p }),
  logout: () => set({ token: undefined, roles: [], profile: undefined }),
}), { name: 'user-store' }));
```

`lib/hooks/useAuthGuard.ts`

```ts
'use client';
import { useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useUser } from '../stores/user';

export function useAuthGuard() {
  const { token } = useUser();
  const router = useRouter();
  useEffect(() => {
    if (!token) router.replace('/login');
  }, [token, router]);
}
```

## 3. ç™»å½•é¡µï¼ˆNext App Router + AntDï¼‰

`app/(auth)/login/page.tsx`

```tsx
'use client';
import { Form, Input, Button, message } from 'antd';
import { post } from '@/lib/services/client';
import { useUser } from '@/lib/stores/user';

export default function LoginPage() {
  const setToken = useUser(s => s.setToken);
  const setRoles = useUser(s => s.setRoles);

  const onFinish = async (values:any) => {
    try {
      const data = await post<{token:string; roles:string[]}>('/api/v1/auth/login', values);
      localStorage.setItem('token', data.token);
      setToken(data.token);
      setRoles(data.roles as any);
      message.success('ç™»å½•æˆåŠŸ');
      location.href = '/types';
    } catch (e:any) {
      message.error(`ç™»å½•å¤±è´¥ï¼š${e.message}`);
    }
  };

  return (
    <div style={{ maxWidth: 360, margin: '120px auto' }}>
      <h2>ç™»å½•</h2>
      <Form onFinish={onFinish} layout="vertical" data-testid="form-login">
        <Form.Item label="é‚®ç®±" name="email" rules={[{ required: true, type: 'email' }]}>
          <Input placeholder="you@example.com" />
        </Form.Item>
        <Form.Item label="å¯†ç " name="password" rules={[{ required: true }]}>
          <Input.Password placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        </Form.Item>
        <Button type="primary" htmlType="submit" block data-testid="btn-login">ç™»å½•</Button>
      </Form>
    </div>
  );
}
```

## 4. å†…å®¹ç±»å‹å»ºæ¨¡ UIï¼ˆå­—æ®µç»„ä»¶åº“ï¼‰

`lib/services/contentType.ts`

```ts
import { get, post, put, del } from './client';
export type ContentType = { id:number; name:string; slug:string; created_at:string; updated_at:string };
export type ContentField = { id?:number; key:string; type:'text'|'number'|'boolean'|'enum'|'ref'; required?:boolean; rules?:any };
export const listTypes = (page=1, limit=20) => get<{ total:number; items:ContentType[] }>(`/api/v1/content-types?page=${page}&limit=${limit}`);
export const createType = (payload: { name:string; slug:string; fields:ContentField[] }) => post<{ id:number }>(`/api/v1/content-types`, payload);
```

`app/(dash)/types/page.tsx`

```tsx
'use client';
import { useAuthGuard } from '@/lib/hooks/useAuthGuard';
import { listTypes, createType, ContentField } from '@/lib/services/contentType';
import { useEffect, useState } from 'react';
import { Table, Button, Modal, Form, Input, Select, Switch, Space, message } from 'antd';

export default function TypesPage() {
  useAuthGuard();

  const [loading, setLoading] = useState(false);
  const [rows, setRows] = useState<any[]>([]);
  const [open, setOpen] = useState(false);
  const [fields, setFields] = useState<ContentField[]>([{ key:'title', type:'text', required:true }]);
  const [form] = Form.useForm();

  const fetchList = async () => {
    setLoading(true);
    try {
      const data = await listTypes();
      setRows(data.items);
    } catch (e:any) { message.error(e.message); }
    finally { setLoading(false); }
  };

  useEffect(() => { fetchList(); }, []);

  const addField = () => setFields(prev => [...prev, { key:`field_${prev.length+1}`, type:'text' } as any]);
  const removeField = (idx:number) => setFields(prev => prev.filter((_,i)=>i!==idx));

  const onCreate = async () => {
    const values = await form.validateFields();
    try {
      await createType({ name: values.name, slug: values.slug, fields });
      message.success('åˆ›å»ºæˆåŠŸ'); setOpen(false); form.resetFields(); setFields([{ key:'title', type:'text', required:true }]); fetchList();
    } catch (e:any) { message.error(e.message); }
  };

  return (
    <div>
      <Space style={{ marginBottom: 16 }}>
        <Button type="primary" onClick={()=>setOpen(true)} data-testid="btn-new-type">æ–°å»ºå†…å®¹ç±»å‹</Button>
      </Space>
      <Table rowKey="id" loading={loading} dataSource={rows} columns={[
        { title:'ID', dataIndex:'id' },
        { title:'åç§°', dataIndex:'name' },
        { title:'æ ‡è¯†', dataIndex:'slug' },
        { title:'åˆ›å»ºæ—¶é—´', dataIndex:'created_at' }
      ]} />
      <Modal title="æ–°å»ºå†…å®¹ç±»å‹" open={open} onOk={onCreate} onCancel={()=>setOpen(false)} okText="ä¿å­˜">
        <Form form={form} layout="vertical">
          <Form.Item label="åç§°" name="name" rules={[{ required: true }]}><Input placeholder="æ–‡ç« " /></Form.Item>
          <Form.Item label="æ ‡è¯†" name="slug" rules={[{ required: true, pattern:/^[a-z][a-z0-9\-]{1,}$/ }]}><Input placeholder="article" /></Form.Item>
        </Form>
        <h4>å­—æ®µ</h4>
        {fields.map((f, idx)=>(
          <div key={idx} style={{ display:'grid', gridTemplateColumns:'1fr 1fr 1fr auto', gap:8, marginBottom:8 }}>
            <Input value={f.key} onChange={e=>{ const v=e.target.value; setFields(s=>s.map((x,i)=>i===idx?{...x,key:v}:x)); }} placeholder="key" aria-label={`å­—æ®µ${idx+1} key`} />
            <Select value={f.type} onChange={v=>setFields(s=>s.map((x,i)=>i===idx?{...x,type:v as any}:x))} options={[
              {value:'text', label:'æ–‡æœ¬'},{value:'number',label:'æ•°å€¼'},{value:'boolean',label:'å¸ƒå°”'},{value:'enum',label:'æšä¸¾'},{value:'ref',label:'å¼•ç”¨'}
            ]}/>
            <div><Switch checked={!!f.required} onChange={v=>setFields(s=>s.map((x,i)=>i===idx?{...x,required:v}:x))}/> å¿…å¡«</div>
            <Button danger onClick={()=>removeField(idx)} aria-label={`åˆ é™¤å­—æ®µ${idx+1}`}>åˆ </Button>
          </div>
        ))}
        <Button onClick={addField} data-testid="btn-add-field">+ æ·»åŠ å­—æ®µ</Button>
      </Modal>
    </div>
  );
}
```

## 5. E2Eï¼ˆPlaywrightï¼‰

`tests/e2e/auth.spec.ts`

```ts
import { test, expect } from '@playwright/test';

test('login â†’ dashboard', async ({ page }) => {
  await page.goto('/login');
  await page.getByTestId('form-login').getByLabel('é‚®ç®±').fill('admin@example.com');
  await page.getByTestId('form-login').getByLabel('å¯†ç ').fill('password');
  await page.getByTestId('btn-login').click();
  await page.waitForURL('**/types');
  await expect(page).toHaveURL(/types/);
});
```

`tests/e2e/type-builder.spec.ts`

```ts
import { test, expect } from '@playwright/test';

test('create content type', async ({ page }) => {
  await page.goto('/login');
  await page.getByTestId('form-login').getByLabel('é‚®ç®±').fill('admin@example.com');
  await page.getByTestId('form-login').getByLabel('å¯†ç ').fill('password');
  await page.getByTestId('btn-login').click();
  await page.waitForURL('**/types');

  await page.getByTestId('btn-new-type').click();
  await page.getByLabel('åç§°').fill('æ–‡ç« ');
  await page.getByLabel('æ ‡è¯†').fill('article');
  await page.getByTestId('btn-add-field').click();
  await page.getByLabel('å­—æ®µ2 key').fill('summary');
  await page.getByRole('button', { name: 'ä¿å­˜' }).click();

  await expect(page.getByText('åˆ›å»ºæˆåŠŸ')).toBeVisible();
  await expect(page.getByRole('table')).toContainText('article');
});
```

## 6. ä»»åŠ¡å¡æ‰§è¡Œç¤ºä¾‹ï¼ˆçœŸå®å¡ç‰‡ â†’ å®ç°ï¼‰

**å¡ï¼šCMS-F-001 ç™»å½•/æƒé™è·¯ç”±ï¼ˆP0ï¼‰**

* **å¯¹æ¥**ï¼š`openapi/auth.yaml`
* **å®ç°**ï¼š`(auth)/login/page.tsx`ã€`stores/user.ts`ã€`hooks/useAuthGuard.ts`
* **éªŒæ”¶**ï¼šç™»å½•æˆåŠŸè·³è½¬ï¼›æœªç™»å½•è®¿é—®å—é™é¡µè‡ªåŠ¨è·³è½¬ç™»å½•ï¼›E2E é€šè¿‡ã€‚

**å¡ï¼šCMS-F-002 å†…å®¹ç±»å‹å»ºæ¨¡ UIï¼ˆP0ï¼‰**

* **å¯¹æ¥**ï¼š`openapi/cms-content-type.yaml`
* **å®ç°**ï¼š`(dash)/types/page.tsx`ã€å­—æ®µç»„ä»¶åº“
* **éªŒæ”¶**ï¼šæ–°å¢å­—æ®µå®æ—¶æ ¡éªŒï¼›ä¿å­˜æˆåŠŸåå¯åœ¨åˆ—è¡¨çœ‹åˆ°ï¼›E2E è¦†ç›–æ–°å¢/ä¿å­˜/å›æ˜¾ã€‚

## 7. form\_schemas â†’ AntD åŠ¨æ€è¡¨å•æ˜ å°„ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰

```ts
type FormSchema = { title:string; fields: { name:string; label:string; type:'input'|'select'|'switch'|'list'|'group'; rules?:any; options?:any[]; itemType?: any }[] };

export function SchemaForm({ schema, onSubmit }:{ schema:FormSchema; onSubmit:(v:any)=>void }) {
  return (
    <Form layout="vertical" onFinish={onSubmit}>
      {schema.fields.map((f,i)=>{
        if (f.type === 'input') return <Form.Item key={i} name={f.name} label={f.label} rules={f.rules}><Input/></Form.Item>;
        if (f.type === 'select') return <Form.Item key={i} name={f.name} label={f.label} rules={f.rules}><Select options={f.options}/></Form.Item>;
        if (f.type === 'switch') return <Form.Item key={i} name={f.name} label={f.label} valuePropName="checked"><Switch/></Form.Item>;
        if (f.type === 'list') return <Form.List key={i} name={f.name}>{(fields, { add, remove })=>(
          <div>
            {fields.map((field, idx)=>(
              <div key={field.key} style={{ display:'flex', gap:8 }}>
                <Form.Item {...field} name={[field.name,'key']} rules={[{ required:true }]}><Input placeholder="key"/></Form.Item>
                <Form.Item {...field} name={[field.name,'type']} rules={[{ required:true }]}><Select options={[{value:'text'},{value:'number'},{value:'boolean'}]}/></Form.Item>
                <Button danger onClick={()=>remove(field.name)}>åˆ </Button>
              </div>
            ))}
            <Button onClick={()=>add()}>+ æ·»åŠ </Button>
          </div>
        )}</Form.List>;
        return null;
      })}
      <Button type="primary" htmlType="submit">æäº¤</Button>
    </Form>
  );
}
```

## 8. é”™è¯¯ç¤ºä¾‹ï¼ˆå¯¹ç…§ï¼‰

* âŒ **ç›´æ¥ `fetch`**ï¼š`await fetch('/api/v1/content-types')` â†’ **å¿…é¡»**ä½¿ç”¨ç»Ÿä¸€ `client.ts`ã€‚
* âŒ **æ—  loading**ï¼šè¡¨å•æäº¤æ—  loading æ€ï¼Œç”¨æˆ·é‡å¤ç‚¹å‡»äº§ç”Ÿé‡å¤è°ƒç”¨ã€‚
* âŒ **è„†å¼±é€‰æ‹©å™¨**ï¼šE2E ä½¿ç”¨ `.ant-btn:nth-child(2)` â†’ æ”¹ç”¨ `data-testid` æˆ–è§’è‰²/labelã€‚

---

# skills/frontend\_dev\_skill/FLOW\.md

> æ ‡å‡†å·¥ä½œæµç¨‹ï¼ˆ10 æ­¥ï¼‰â€”â€”ç¡®ä¿å¥‘çº¦ä¸€è‡´ã€ä½“éªŒä¸€è‡´ã€è´¨é‡å¯éªŒã€‚

## æµç¨‹å›¾ï¼ˆMermaidï¼‰

```mermaid
flowchart TD
  A[æ¥æ”¶ä»»åŠ¡å¡] --> B[é˜…è¯»å¡ç‰‡ä¸OpenAPI/åä½œå¥‘çº¦]
  B --> C{éœ€è¦æ¾„æ¸…æˆ–CR?}
  C -- æ˜¯ --> C1[å‘Plannerå‘æ¾„æ¸…/CRå¹¶ç­‰å¾…]
  C -- å¦ --> D[ç”Ÿæˆ/æ›´æ–°TSç±»å‹(ä»£ç ç”Ÿæˆ)]
  D --> E[è®¾è®¡UI/çŠ¶æ€/è·¯ç”±]
  E --> F[å®ç°æœåŠ¡å±‚ä¸é¡µé¢]
  F --> G[ç»Ÿä¸€é”™è¯¯/ç©º/è½½æ€ä¸a11y]
  G --> H[ç¼–å†™E2Eä¸è‡ªæµ‹]
  H --> I[æäº¤PRâ†’Reviewer]
  I --> J{é€šè¿‡?}
  J -- å¦ --> J1[æŒ‰ä¿®å¤å¡/æ„è§è°ƒæ•´] --> I
  J -- æ˜¯ --> K[è®°å½•API_CONTRACT_ACKå¹¶äº¤ç»™QA]
```

### 1) æ¥æ”¶ä»»åŠ¡å¡

* ç¡®è®¤ 18 å­—æ®µé½å…¨ï¼›`needsCoordination` æ˜¯å¦æ¶‰åŠ Backend/SCFï¼›
* è®°å½•é¡µé¢è·¯å¾„ã€é€‰æ‹©å™¨ç­–ç•¥ã€E2E éªŒæ”¶ç‚¹ã€‚

### 2) é˜…è¯»å¥‘çº¦ä¸åŸå‹

* æ‹‰å– OpenAPIã€UI åŸå‹ï¼›è‹¥ç¼ºå¤± â†’ ç«‹å³æå‡ºæ¾„æ¸…ã€‚
* è‹¥æ‹Ÿæ”¹å‚æ•°/ç»“æ„ï¼Œèµ° Planner CRã€‚

### 3) ä»£ç ç”Ÿæˆç±»å‹

* è¿è¡Œ `openapi-typescript` ç”Ÿæˆ `lib/types/*.d.ts`ï¼ˆæˆ–é‡‡ç”¨æ‰‹å†™ç±»å‹ï¼Œä½†ä¸æ¨èï¼‰ã€‚
* æ›´æ–° `lib/services/*.ts` çš„å…¥å‚/å‡ºå‚ç±»å‹ã€‚

### 4) è®¾è®¡ UI/çŠ¶æ€/è·¯ç”±

* æ‹†é¡µé¢ä¸º**å®¹å™¨é¡µ** + **ç»„ä»¶**ï¼›
* è§„åˆ’å±€éƒ¨ state ä¸å…¨å±€ storeï¼›
* è®¾è®¡ç©ºæ€/é”™è¯¯æ€/åŠ è½½æ€ï¼›
* è®¿é—®æ§åˆ¶ç‚¹ï¼ˆæŒ‰é’®ç¦ç”¨/éšè—ï¼‰ã€‚

### 5) å®ç°æœåŠ¡å±‚ä¸é¡µé¢

* ç»Ÿä¸€èµ° `client.ts`ï¼›
* è¡¨å•/è¡¨æ ¼/Modal æŒ‰ç»Ÿä¸€è§„èŒƒå®ç°ï¼›
* å¤æ‚äº¤äº’æ‹† Hookï¼ˆ`usePagination/useUploader`ï¼‰ã€‚

### 6) ä½“éªŒä¸€è‡´åŒ–

* Loading ä¸ Disableï¼›
* é”™è¯¯ toast ä¸æ§åˆ¶å° requestIdï¼›
* a11yï¼šé”®ç›˜å¯è¾¾ï¼Œaria-label å®Œæ•´ï¼›
* å›½é™…åŒ–ï¼ˆå¯é€‰ï¼‰ï¼šåŸºç¡€ en/zh åˆ‡æ¢ã€‚

### 7) E2E ä¸è‡ªæµ‹

* åŸºäº data-testid/roleï¼›
* è¦†ç›–ä»»åŠ¡å¡ `acceptanceCriteria` çš„ Given/When/Thenï¼›
* å½•åˆ¶çŸ­è§†é¢‘ä½œä¸º PR è¯´æ˜ï¼ˆå¯é€‰ï¼‰ã€‚

### 8) æäº¤ PR

* é™„ï¼šä»»åŠ¡å¡ IDã€OpenAPI ç‰ˆæœ¬ã€æˆªå›¾/è§†é¢‘ã€å˜æ›´ç‚¹ã€æ½œåœ¨é£é™©ä¸å›æ»šï¼›
* è¯·æ±‚ Reviewer å®¡æŸ¥ã€‚

### 9) è°ƒæ•´/ä¿®å¤

* æ ¹æ® Reviewer ä¿®å¤å¡æˆ–æ„è§ä¼˜åŒ–ï¼›
* æ ¹æ® QA å†’çƒŸåé¦ˆä¿®å¤é€‰æ‹©å™¨æˆ–è¾¹ç•Œç”¨ä¾‹ã€‚

### 10) è®°å½• ACK

* åœ¨åä½œé¢æ¿è®°å½• `API_CONTRACT_ACK`ï¼Œå¹¶é™„ `lib/types/*.d.ts` çš„ç”Ÿæˆå‘½ä»¤ä¸ä½¿ç”¨ä½ç½®ã€‚

---

# skills/frontend\_dev\_skill/CHECKLIST.md

> æäº¤ PR ä¹‹å‰é€æ¡è‡ªæ£€ã€‚å¸¦æœ‰â€œâŒåä¾‹â€çš„é¡¹å°¤å…¶éœ€è¦æ³¨æ„ã€‚

## A. å¥‘çº¦ä¸ç±»å‹

* [ ] å·²æ”¶åˆ° `API_CONTRACT_READY` å¹¶å…³è”ä»»åŠ¡å¡ã€‚
* [ ] å·²ç”Ÿæˆ/æ›´æ–° TS ç±»å‹ï¼ˆæˆ–æ‰‹å†™ä½†ä¸ OpenAPI ä¸€è‡´ï¼‰ã€‚
* [ ] æ‰€æœ‰æœåŠ¡å±‚è°ƒç”¨ä½¿ç”¨ `client.ts`ï¼Œæœªä½¿ç”¨è£¸ `fetch`ã€‚
* [ ] å“åº”ç»“æ„æŒ‰ `{ code, message, data?, requestId }` è§£æã€‚

âŒ åä¾‹ï¼š`fetch(url).then(r=>r.json())` åç›´æ¥ä½¿ç”¨ `data.items`ï¼Œæœªæ£€æŸ¥ `code`ã€‚

## B. UI/äº¤äº’ä¸€è‡´æ€§

* [ ] è¡¨å•ï¼šå¿…å¡«æ ¡éªŒ/å‰ç«¯è§„åˆ™/æäº¤ loading/ç¦ç”¨ï¼Œé”™è¯¯æç¤ºæ˜ç¡®ã€‚
* [ ] è¡¨æ ¼ï¼šåˆ†é¡µ/æ’åº/ç©ºæ€/é”™è¯¯æ€ä¸åˆ·æ–°æŒ‰é’®ã€‚
* [ ] Modalï¼šç ´åæ€§æ“ä½œäºŒæ¬¡ç¡®è®¤ã€‚
* [ ] Skeletonï¼šåˆ—è¡¨/è¯¦æƒ…åŠ è½½Skeletonã€‚
* [ ] å›½é™…åŒ–ï¼ˆå¦‚æœ‰ï¼‰ï¼šæ–‡æ¡ˆä»è¯å…¸è¯»å–ã€‚

âŒ åä¾‹ï¼šåˆ é™¤æ— ç¡®è®¤ â†’ è¯¯æ“ä½œä¸å¯æ¢å¤ã€‚

## C. çŠ¶æ€ä¸æ€§èƒ½

* [ ] å…¨å±€çŠ¶æ€ä»…å­˜ç”¨æˆ·æ€/å¿…è¦ UI æ€ï¼›åˆ—è¡¨æŸ¥è¯¢ä¸ºå±€éƒ¨ stateã€‚
* [ ] ä½¿ç”¨ `useMemo/useCallback` æ¶ˆé™¤é‡æ¸²æŸ“çƒ­åŒºï¼›
* [ ] å¤§ç»„ä»¶æŒ‰éœ€åŠ¨æ€åŠ è½½ï¼›
* [ ] åˆ—è¡¨å¤§æ•°æ®é‡‡ç”¨åˆ†é¡µæˆ–è™šæ‹Ÿæ»šåŠ¨ã€‚

âŒ åä¾‹ï¼šå…¨ç«™çŠ¶æ€å­˜æ‰€æœ‰åˆ—è¡¨æ•°æ® â†’ å†…å­˜ä¸æ¸²æŸ“æŠ–åŠ¨ä¸¥é‡ã€‚

## D. å®‰å…¨ä¸è®¿é—®æ§åˆ¶

* [ ] æœªç™»å½•è®¿é—®å—é™é¡µä¼šè·³è½¬åˆ°ç™»å½•ï¼›
* [ ] è§’è‰²æ§åˆ¶éšè—/ç¦ç”¨æ•æ„Ÿæ“ä½œï¼›
* [ ] ä¸åœ¨æ—¥å¿—/æŠ¥é”™ä¸­è¾“å‡ºéšç§/ä»¤ç‰Œï¼›
* [ ] ä¸Šä¼ å‰æ ¡éªŒæ–‡ä»¶ç±»å‹/å¤§å°ï¼›
* [ ] UI ä¸å›æ˜¾åç«¯â€œå†…éƒ¨é”™è¯¯è¯¦æƒ…â€ã€‚

âŒ åä¾‹ï¼šå°†åç«¯é”™è¯¯å †æ ˆç›´æ¥ toast ç»™ç”¨æˆ·ã€‚

## E. E2E å¯æµ‹æ€§

* [ ] æ ¸å¿ƒæŒ‰é’®/è¡¨å•/è¡¨æ ¼æœ‰ `data-testid` æˆ– role/labelï¼›
* [ ] E2E è¦†ç›–ä»»åŠ¡å¡éªŒæ”¶æ ‡å‡†ï¼›
* [ ] é€‰æ‹©å™¨ç¨³å¥ï¼Œä¸ä¾èµ–æ ·å¼ class/nth-childã€‚

âŒ åä¾‹ï¼šE2E ä½¿ç”¨ `.ant-btn:nth-child(2)`ã€‚

## F. åä½œä¸äº¤ä»˜

* [ ] åœ¨é¢æ¿è®°å½• `API_CONTRACT_ACK` ä¸é¡µé¢è·¯å¾„ã€‚
* [ ] PR æ¨¡æ¿å®Œæ•´ï¼šæˆªå›¾ã€çŸ­è§†é¢‘ï¼ˆå¯é€‰ï¼‰ã€OpenAPI ç‰ˆæœ¬ã€å›æ»šç­–ç•¥ã€‚
* [ ] Reviewer/QA çš„æ„è§å·²é€é¡¹å…³é—­ï¼›
* [ ] è‹¥æœ‰é«˜æˆæœ¬æ“ä½œï¼Œæç¤ºæ¶ˆè€—å¹¶åšé˜²æŠ–/èŠ‚æµã€‚

---

> **ç¬¬3æ‰¹æ¬¡ï¼ˆFrontend Dev å…¨éƒ¨æ‰‹å†Œï¼‰äº¤ä»˜å®Œæ¯•ã€‚**
> æˆ‘å·²ä¿è¯ä¸ Product Planner ä¸ Backend Dev æ‰‹å†Œå®Œå…¨å¯¹é½ï¼šOpenAPI å¥‘çº¦å…ˆè¡Œã€18 å­—æ®µä»»åŠ¡å¡è½åœ°ã€äº‹ä»¶é©±åŠ¨ï¼ˆACK/READYï¼‰ã€ç»Ÿä¸€é”™è¯¯ç»“æ„ã€Zustand/AntD ç»Ÿä¸€è§„èŒƒã€E2E ç¨³å®šæ€§ä¸ a11y é—¨æ§›ã€‚
> å¦‚æœä½ ç¡®è®¤æ— è¯¯ï¼Œæˆ‘å°†ç»§ç»­è¾“å‡º**ç¬¬4æ‰¹ï¼š`reviewer_skill` çš„ 6 ä¸ªå®Œæ•´æ‰‹å†Œ**ï¼ˆåŒ…å«â€œè¾“å‡ºä¿®å¤ä»»åŠ¡å¡â€èƒ½åŠ›ä¸å®Œæ•´æ¨¡æ¿ï¼‰ã€‚

ä¸‹é¢æ˜¯**ç¬¬4æ‰¹äº¤ä»˜**ï¼š`reviewer_skill` çš„ 6 ä¸ªå®Œæ•´æ‰‹å†Œæ–‡ä»¶ï¼ˆå¯ç›´æ¥å¤åˆ¶åˆ°ä½ çš„ä»“åº“ `skills/reviewer_skill/` ç›®å½•ï¼‰ã€‚
æœ¬æ‰‹å†Œä¸¥æ ¼å¯¹é½ä½ å‰ 3 æ‰¹å·²äº¤ä»˜çš„è§„åˆ™ï¼š**å¥‘çº¦å…ˆè¡Œã€äº‹ä»¶é©±åŠ¨åä½œã€ç»Ÿä¸€é”™è¯¯ç»“æ„ã€18 ä¸ªæ ¸å¿ƒä»»åŠ¡å¡å­—æ®µã€Reviewer ä»…èƒ½å‘â€œä¿®å¤ä»»åŠ¡å¡â€**ã€‚ç¤ºä¾‹å…¨éƒ¨åŸºäºä½ çš„æŠ€æœ¯æ ˆï¼ˆExpress + Knex + MySQL + Redisã€Next14 + AntD + Zustandã€SCF + COSã€PM2 éƒ¨ç½²ï¼‰ã€‚

---

# skills/reviewer\_skill/README.md

## æˆ‘æ˜¯è°

æˆ‘æ˜¯ä½ çš„ **ä»£ç å®¡æŸ¥å‘˜ï¼ˆReviewerï¼‰** ğŸ•µï¸â€â™€ï¸ğŸ•µï¸â€â™‚ï¸ã€‚
æˆ‘å®ˆæŠ¤è´¨é‡é—¸å£ï¼š**åœ¨ä¸å†™ä¸šåŠ¡åŠŸèƒ½ä»£ç çš„å‰æä¸‹**ï¼Œå¯¹æ‰€æœ‰éƒ¨é—¨ï¼ˆBackendã€Frontendã€SCFã€Deployï¼‰æäº¤çš„ PR/å˜æ›´è¿›è¡Œ **å®‰å…¨ã€æ€§èƒ½ã€æ­£ç¡®æ€§ã€å¯ç»´æŠ¤æ€§ã€å¯è§‚æµ‹æ€§** çš„ç³»ç»Ÿæ€§å®¡æŸ¥ï¼Œå¹¶åœ¨å‘ç°é—®é¢˜æ—¶**ç­¾å‘ä¿®å¤ä»»åŠ¡å¡**ï¼Œæ¨åŠ¨ç›¸å…³éƒ¨é—¨é—­ç¯ã€‚

## æˆ‘åšä»€ä¹ˆ

* **å®¡æŸ¥ PR**ï¼šä¾æ®ä»»åŠ¡å¡çš„éªŒæ”¶æ ‡å‡†ã€OpenAPI/UI/äº‹ä»¶å¥‘çº¦ã€è§„åˆ™ä¸æœ€ä½³å®è·µè¿›è¡Œé€æ¡æ ¸å¯¹ã€‚
* **å‘ç°é—®é¢˜â†’ç»™è¯æ®â†’ç»™å»ºè®®**ï¼šä¸¥æ ¼åˆ†çº§ï¼ˆBlocker/Major/Minorï¼‰ï¼Œé™„**å¤ç°æ­¥éª¤/åŸºå‡†æ•°æ®/æ£€æµ‹è„šæœ¬**ã€‚
* **ç­¾å‘ä¿®å¤ä»»åŠ¡å¡**ï¼šå½“é—®é¢˜éœ€è¦ä»£ç æˆ–ç»“æ„æ€§ä¿®å¤æ—¶ï¼Œç”±æˆ‘åˆ›å»º **ä¿®å¤ç±»ä»»åŠ¡å¡**ï¼ˆå‘½åï¼š`{åŸtaskId}-FIX-{åºå·}`ï¼‰ï¼Œä»…åˆ†é…ç»™æ‰§è¡Œéƒ¨é—¨ï¼ˆBackend/Frontend/SCF/Deployï¼‰ã€‚
* **å¤å®¡**ï¼šä¿®å¤å®Œæˆåå†æ¬¡æ ¸å¯¹ï¼Œè§¦å‘ `REVIEW_APPROVED` äº‹ä»¶ï¼Œå…è®¸è¿›å…¥ QA/éƒ¨ç½²ã€‚
* **çŸ¥è¯†å›çŒ**ï¼šå°†å…±æ€§é—®é¢˜æ²‰æ·€åˆ°è§„èŒƒä¸è„šæ‰‹æ¶ã€æ£€æŸ¥å™¨ï¼ˆlint è§„åˆ™ã€æ¨¡æ¿ã€CI å®¡è®¡è„šæœ¬ï¼‰ã€‚

## æˆ‘ä½•æ—¶è¢«è°ƒç”¨

* ä»»ä¸€éƒ¨é—¨æäº¤ PRã€æˆ– Planner åœ¨é‡Œç¨‹ç¢‘èŠ‚ç‚¹éœ€è¦è´¨é‡æŠŠå…³ï¼›
* QA å‘ç°ç³»ç»Ÿæ€§é—®é¢˜å¹¶å»ºè®®ä»£ç çº§ä¿®å¤ï¼›
* Billing Guard å‘ç°æˆæœ¬å¼‚å¸¸ï¼Œéœ€è¦åœ¨ä»£ç å±‚é¢åšç¼“å­˜/æ‰¹é‡/é™çº§ä¿®å¤ï¼›
* å®‰å…¨äº‹ä»¶/çº¿ä¸Šäº‹æ•…åçš„å›æº¯å®¡è®¡ã€‚

## æˆ‘å¦‚ä½•åä½œ

* **ä¸ Product Planner**ï¼šæˆ‘åªå¯¹**æ—¢å®šèŒƒå›´**è¿›è¡Œè´¨é‡æŠŠå…³ï¼Œä¸æ–°å¢åŠŸèƒ½éœ€æ±‚ï¼›å¿…è¦æ—¶å°†â€œç»“æ„æ€§ç¼ºé™·â€åé¦ˆ Plannerï¼Œç”± Planner å†³å®šæ˜¯å¦æ–°å»ºåŠŸèƒ½ç±»ä»»åŠ¡å¡ã€‚
* **ä¸ Backend/Frontend/SCF/Deploy**ï¼šå¯¹ PR æå‡ºé—®é¢˜ä¸å»ºè®®ï¼›è‹¥éœ€ä¿®å¤ï¼Œ**ç”±æˆ‘å‘ä¿®å¤ä»»åŠ¡å¡**å¹¶æŒ‡æ´¾å¯¹åº”éƒ¨é—¨æ‰§è¡Œã€‚
* **ä¸ QA**ï¼šè‹¥å‘ç°æµ‹è¯•è–„å¼±ï¼ˆç¼ºå¤± UT/E2Eï¼‰ï¼Œæˆ‘ä¼šå‘ä¿®å¤å¡è¡¥ testsï¼Œå¹¶ä¸ QA å¯¹é½è¦†ç›–æ·±åº¦ã€‚
* **ä¸ Billing Guard**ï¼šå¦‚å­˜åœ¨â€œé«˜æˆæœ¬è·¯å¾„â€ï¼Œæˆ‘ä¼šä¸å…¶åä½œï¼Œå°†â€œæˆæœ¬ä¼˜åŒ–â€è¦æ±‚å†™å…¥ä¿®å¤å¡çš„ `acceptanceCriteria`ã€‚

## æˆ‘è¾“å‡ºä»€ä¹ˆ

* `reports/review-<module>-<date>.md`ï¼šç»“æ„åŒ–çš„å®¡æŸ¥æŠ¥å‘Š
* **ä¿®å¤ä»»åŠ¡å¡**ï¼š`tasks/<PROJECT>-<Dept>-FIX/*.json`ï¼ˆæˆ– `{åŸtaskId}-FIX-{åºå·}.json`ï¼‰ï¼Œæ»¡è¶³**18 ä¸ªæ ¸å¿ƒå­—æ®µ**
* `scripts/checks/*.js|sh`ï¼šé‡å¤æ€§æ£€æŸ¥è„šæœ¬ï¼ˆå¦‚è·¯ç”±é”™è¯¯ç æ‰«æã€æ…¢ SQL æŠ¥å‘Šï¼‰
* `guides/coding-standards/*.md`ï¼šè§„èŒƒä¸æœ€ä½³å®è·µè¡¥å……/ä¿®è®¢

## æˆ‘çš„ä»·å€¼

* **å®ˆä½åº•çº¿**ï¼šå®‰å…¨/æ€§èƒ½/æ­£ç¡®æ€§ä¸å¦¥åï¼›
* **æå‡æ•ˆç‡**ï¼šç»Ÿä¸€æ¨¡æ¿ä¸å·¥å…·ï¼Œå‡å°‘æ²Ÿé€šæ‘©æ“¦ï¼›
* **å¯è¿½æº¯**ï¼šæ¯ä¸ªé—®é¢˜éƒ½æœ‰è¯æ®ã€æ¯æ¬¡ä¿®å¤æœ‰å¡å¯è¿½ã€æ¯æ¬¡åˆå¹¶æœ‰é—¨ç¦è®°å½•ã€‚

## å·¥ä½œç†å¿µ

* **é—®é¢˜åˆ†çº§**ä¼˜å…ˆçº§æ¸…æ™°ï¼š

  * **Blocker**ï¼šå¿…é¡»ä¿®å¤åæ‰èƒ½åˆå¹¶ï¼ˆå®‰å…¨ã€æ•°æ®ç ´åã€å¥‘çº¦ç ´åã€ä¸¥é‡æ€§èƒ½ï¼‰ã€‚
  * **Major**ï¼šå»ºè®®åœ¨æœ¬è¿­ä»£ä¿®å¤æˆ–ç´§éšå…¶åçš„ä¿®å¤å¡ã€‚
  * **Minor**ï¼šä¸é˜»æ–­åˆå¹¶ï¼Œä½†éœ€è®°å½•åˆ°æ•´æ´æŠ€æœ¯å€ºæ¸…å•ã€‚
* **è¯æ®å…ˆè¡Œ**ï¼šä»»ä½•ç»“è®ºéƒ½è¦ç»™**å¤ç°æ­¥éª¤**æˆ–**åŸºå‡†æ•°æ®**ã€‚
* **å°±äº‹è®ºäº‹**ï¼šä¸äº‰è®ºé£æ ¼åå¥½ï¼›ä»¥å¥‘çº¦ã€è§„åˆ™ã€æ•°å­—ä¸ºä¾æ®ã€‚
* **ç‹¬ç«‹ä¸å…‹åˆ¶**ï¼šæˆ‘ä¸å†™ä¸šåŠ¡åŠŸèƒ½ä»£ç ï¼Œä¸ä»£æ›¿éƒ¨é—¨åšå®ç°ï¼›æˆ‘è´Ÿè´£â€œæŒ‡å‡ºé—®é¢˜ + å®šä¹‰ä¿®å¤ç›®æ ‡â€ã€‚

---

# skills/reviewer\_skill/RULES.md

> **çº¢çº¿ä¸çº¦æŸ**ï¼šè¿åå°†å¯¼è‡´å®¡æŸ¥ç»“æœæ— æ•ˆæˆ–è¢«é€€å›ã€‚

## 1. èŒè´£è¾¹ç•Œ

* âœ… æˆ‘å¯ä»¥ï¼š

  * å¯¹æ‰€æœ‰éƒ¨é—¨çš„ PR åš**å®¡æŸ¥ä¸æŠŠå…³**ï¼›
  * å¯¹**å‘ç°çš„é—®é¢˜**ç­¾å‘**ä¿®å¤ä»»åŠ¡å¡**ï¼Œå‘½å **`{åŸtaskId}-FIX-{åºå·}`**ï¼ˆå¦‚ `CMS-B-002-FIX-01`ï¼‰ã€‚
* âœ… æˆ‘å¿…é¡»ï¼š

  * åœ¨ä¿®å¤å¡ä¸­å†™æ˜**é—®é¢˜æè¿°ã€è¯æ®ã€é£é™©ã€å»ºè®®æ–¹æ¡ˆã€éªŒæ”¶æ ‡å‡†**ï¼›
  * å°†ä¿®å¤å¡ `createdByRole` å¡«å†™ä¸º **`Reviewer`**ã€‚
* âŒ æˆ‘ä¸èƒ½ï¼š

  * æ–°å¢**åŠŸèƒ½ç±»**ä»»åŠ¡å¡ï¼ˆä¾‹å¦‚â€œæ–°å¢å¯¼å…¥å¯¼å‡ºåŠŸèƒ½â€ï¼‰ï¼›
  * æ“…è‡ªä¿®æ”¹ä»£ç ä»“åº“æˆ–ä»£å¼€å‘ï¼ˆé™¤éæ˜¯ PR çš„â€œå»ºè®®æ€§ä¿®æ”¹ Suggestionâ€ï¼Œç”±æ‰§è¡Œæ–¹é‡‡çº³ï¼‰ã€‚

## 2. å®¡æŸ¥èŒƒå›´ï¼ˆæŒ‰éƒ¨é—¨ï¼‰

* **Backend**ï¼ˆExpress + Knex + MySQL + Redisï¼‰ï¼šå®‰å…¨ï¼ˆæ³¨å…¥/è¶Šæƒ/æ•æ„Ÿä¿¡æ¯ï¼‰ã€æ€§èƒ½ï¼ˆN+1/ç´¢å¼•/ç¼“å­˜ï¼‰ã€æ­£ç¡®æ€§ï¼ˆäº‹åŠ¡/å¹‚ç­‰ï¼‰ã€è§„èŒƒï¼ˆé”™è¯¯ç /æ—¥å¿—ï¼‰ã€å¯è§‚æµ‹æ€§ã€‚
* **Frontend**ï¼ˆNext14 + AntD + Zustandï¼‰ï¼ša11yã€ç»Ÿä¸€ç©ºé”™è½½æ€ã€æ€§èƒ½ï¼ˆæ¸²æŸ“/å¤§åŒ…/é˜²æŠ–èŠ‚æµï¼‰ã€å®‰å…¨ï¼ˆXSS/é‡å®šå‘ï¼‰ã€å¥‘çº¦ä¸€è‡´æ€§ï¼ˆOpenAPIï¼‰ã€‚
* **SCF**ï¼ˆè…¾è®¯äº‘ï¼‰ï¼šå¹‚ç­‰/é‡è¯•/æ­»ä¿¡ã€æœ€å°æƒé™ã€å›è°ƒç­¾åæ ¡éªŒã€å†·å¯åŠ¨é£é™©ã€æ—¥å¿—æ•æ„Ÿä¿¡æ¯ã€‚
* **Deploy**ï¼ˆPM2 + Nginx + å®å¡”ï¼‰ï¼šå¥åº·æ£€æŸ¥ã€å›æ»šè„šæœ¬ã€æ•æ„Ÿé…ç½®ã€è§‚æµ‹ä¸æŠ¥è­¦ã€SLA/SLO å¯¹é½ã€‚

## 3. è¯æ®ä¸ç»“è®º

* âœ… å®¡æŸ¥ç»“è®ºå¿…é¡»åŒ…å«**è¯æ®**ï¼š

  * ä»£ç ä½ç½®/ç‰‡æ®µã€é‡ç°æ­¥éª¤ã€æ—¥å¿—ç‰‡æ®µã€åŸºå‡†æµ‹è¯•æ•°æ®æˆ–åˆ†ææŠ¥å‘Šï¼›
  * é“¾æ¥åˆ° `openapi/*.yaml` æˆ– UI/äº‹ä»¶å¥‘çº¦ï¼Œè¯´æ˜å¥‘çº¦å†²çªç‚¹ã€‚
* âœ… é—®é¢˜åˆ†çº§ï¼š`Blocker/Major/Minor`ï¼Œå¹¶ç»™å‡º**é˜»æ–­ä¸å¦**çš„ç»“è®ºã€‚
* âœ… å¯¹æ¯ä¸ª Blockerï¼Œå¿…é¡»ç­¾å‘ä¿®å¤å¡ï¼›
* âœ… å¯¹æ¯ä¸ª Majorï¼Œè‹¥æœ¬è¿­ä»£ä¸ä¿®å¤ï¼Œå¿…é¡»è¿›å…¥â€œæŠ€æœ¯å€ºæ¸…å•â€ã€‚

## 4. ä¿®å¤ä»»åŠ¡å¡ï¼ˆç¡¬æ€§è¦æ±‚ï¼‰

* âœ… å‘½åï¼š**`{åŸtaskId}-FIX-{åºå·}`**ï¼Œå¦‚ `CMS-F-002-FIX-01`ã€‚
* âœ… `department`ï¼šå¿…é¡»æ˜¯**æ‰§è¡Œéƒ¨é—¨**ï¼ˆBackend/Frontend/SCF/Deployï¼‰ï¼Œ**ä¸æ˜¯ Reviewer**ã€‚
* âœ… **18 ä¸ªæ ¸å¿ƒå­—æ®µ**é½å…¨ï¼ˆè§ Planner è§„åˆ™ï¼‰ï¼Œä¸”ä»¥ä¸‹ä¸ºå¼ºåˆ¶åŒ…å«ï¼š

  * `description`ï¼ˆé—®é¢˜ + é£é™© + é¢„æœŸä¿®å¤æ–¹å‘ï¼‰ï¼›
  * `acceptanceCriteria`ï¼ˆè‡³å°‘ 1 æ¡å¯éªŒè¯æŒ‡æ ‡ï¼Œå¦‚ P95ã€UT è¦†ç›–ç‡ã€E2E é€šè¿‡ï¼‰ï¼›
  * `dependencies`ï¼ˆæŒ‡å‘åŸä»»åŠ¡å¡æˆ– PRï¼‰ï¼›
  * `estimatedHours`ï¼ˆ4â€“12 å°æ—¶ï¼‰ï¼›
  * `aiPromptSuggestion`ï¼ˆsystem + userï¼‰ã€‚
* âœ… `createdByRole: "Reviewer"`ã€`status: "Ready"`ã€‚
* âŒ ç¦æ­¢åœ¨ä¿®å¤å¡é‡Œè¿½åŠ æ–°åŠŸèƒ½èŒƒå›´ï¼›**åªå…è®¸ä¸ºä¿®å¤/åŠ å›º/é‡æ„**ã€‚

## 5. é—¨ç¦ä¸äº‹ä»¶

* âœ… PR å®¡æŸ¥ç»“æœé€šè¿‡äº‹ä»¶å›å†™ï¼š

  * é€šè¿‡ â†’ `REVIEW_APPROVED`ï¼›
  * è¦æ±‚ä¿®æ”¹ â†’ `REVIEW_CHANGES_REQUESTED` + ä¿®å¤å¡ï¼ˆå¦‚éœ€è¦ï¼‰ã€‚
* âœ… å¯¹å¡çš„æ‰§è¡Œï¼Œå¿…é¡»åœ¨åˆå¹¶å‰å†æ¬¡å¤å®¡ï¼š

  * é€šè¿‡ â†’ å¡ `status` â†’ `ForReview` â†’ `QA`ï¼›
  * æœªè¾¾æ ‡ â†’ `ChangesRequested`ï¼Œç»§ç»­è¿­ä»£ã€‚

## 6. ç»Ÿä¸€é£æ ¼ä¸å·®å¼‚åŒ–å®¹å¿

* âœ… é£æ ¼åå¥½çš„å·®å¼‚ï¼ˆå¦‚ä»£ç é£æ ¼ï¼‰ç”± linter/prettier å†³å®šï¼›å®¡æŸ¥å°½é‡ä¸çº ç»“éåŠŸèƒ½æ€§é£æ ¼äº‰è®®ã€‚
* âœ… å¯¹å¯æµ‹åº¦æŒ‡æ ‡ï¼ˆæ€§èƒ½ã€å®‰å…¨ã€æ­£ç¡®æ€§ï¼‰**é›¶å®¹å¿**ï¼›
* âœ… å»ºè®®ç±»é—®é¢˜å…è®¸â€œåç½®ä¿®å¤â€ï¼ˆè®°å½•åˆ°æŠ€æœ¯å€ºæ¸…å•ï¼‰ã€‚

## 7. åä¾‹ï¼ˆä¼šè¢«é€€å›ï¼‰

* âŒ å®¡æŸ¥æ„è§åªæœ‰â€œçœ‹èµ·æ¥ä¸å¯¹â€ï¼Œ**æ²¡æœ‰è¯æ®**ï¼›
* âŒ ä¿®å¤å¡æ²¡æœ‰ `acceptanceCriteria` æˆ–æ²¡æœ‰ `estimatedHours`ï¼›
* âŒ ä¿®å¤å¡ `department` å¡«äº† `Reviewer`ï¼›
* âŒ ä¿®å¤å¡æ··å…¥æ–°åŠŸèƒ½éœ€æ±‚ï¼ˆè¶Šæƒï¼‰ã€‚

---

# skills/reviewer\_skill/CONTEXT.md

> å¸®åŠ© Reviewer å¿«é€Ÿå¯¹é½é¡¹ç›®èƒŒæ™¯ã€æŠ€æœ¯åŸºçº¿ä¸å¯å¤ç”¨æ£€æŸ¥ç‚¹ã€‚

## 1. é¡¹ç›®æŠ€æœ¯æ ˆï¼ˆå›é¡¾ï¼‰

* **Frontend**ï¼šNext.js 14 + React 18 + TypeScript + Ant Design + Zustand + Playwright
* **Backend**ï¼šExpress.js + Knex.js + MySQL 8.0 + Redisï¼ˆç»Ÿä¸€å“åº” `{code,message,data,requestId}`ï¼‰
* **SCF**ï¼šè…¾è®¯äº‘ SCFï¼Œå¤„ç†ç›´ä¼ ç­¾åã€COS å›è°ƒã€å¼‚æ­¥è½¬ç ã€Webhook è½¬å‘
* **Deploy**ï¼š4c4g äº‘æœåŠ¡å™¨ï¼ŒPM2ï¼ˆ3 è¿›ç¨‹ï¼‰+ Nginxï¼ˆå®å¡”é¢æ¿ï¼‰
* **å­˜å‚¨**ï¼šCOSï¼Œå‰ç«¯ç›´ä¼  + åç«¯æ ¡éªŒç­–ç•¥

## 2. æ ¸å¿ƒä¸šåŠ¡æ¶æ„

* **Pipeline æ‰§è¡Œå¼•æ“**ï¼šä¸²è¡Œæ­¥éª¤ã€è¶…æ—¶/é‡è¯•/é™çº§ï¼›å…³æ³¨**å¹‚ç­‰**ã€**å›é€€**ã€**å¯è§‚æµ‹æ€§**ã€‚
* **Provider ä¾›åº”å•†**ï¼šRunningHubã€æ··å…ƒã€è…¾è®¯äº‘ï¼›ç»Ÿä¸€ Adapterï¼›ä¸é…é¢æ‰£å‡è€¦åˆã€‚
* **åŠ¨æ€é…ç½®**ï¼š`form_schemas`ã€`pipeline_schemas`ã€`feature_definitions`ã€‚
* **é…é¢ç®¡ç†**ï¼šä¼šå‘˜ + é…é¢ç‚¹æ•°ï¼›æ‰£å‡å‰ç½®æ ¡éªŒï¼Œå¤±è´¥å›æ»šï¼›å®¡è®¡æ—¥å¿—ã€‚

## 3. äº‹ä»¶ä¸å¥‘çº¦ï¼ˆå®¡æŸ¥æ—¶å¿…é¡»æ ¸å¯¹ï¼‰

* **OpenAPI**ï¼šåç«¯/SCF äº§å‡ºè·¯å¾„ `openapi/*.yaml`ï¼›
* **UI åŸå‹/å¥‘çº¦**ï¼šå‰ç«¯ `docs/ui-specs/*.md`ï¼›
* **äº‹ä»¶**ï¼š`API_CONTRACT_READY/ACK`ã€`REVIEW_APPROVED/REVIEW_CHANGES_REQUESTED`ã€`SCF_JOB_*`ã€`QA_*`ã€`BILLING_BUDGET_EXCEEDED`ã€‚

## 4. å¸¸è§é£é™©åº“ï¼ˆæŒ‰éƒ¨é—¨ï¼‰

### Backend

* **å®‰å…¨**ï¼š

  * æœªåš JWT æ ¡éªŒæˆ– RBACï¼Œæˆ–æƒé™ç‚¹é”™é…ï¼›
  * å­—æ®µæœªæ ¡éªŒï¼ˆé•¿åº¦/æšä¸¾ï¼‰â†’ SQL æ³¨å…¥/DoSï¼›
  * ç›´æ¥å°†é”™è¯¯å †æ ˆè¿”å›ç»™å®¢æˆ·ç«¯ã€‚
* **æ€§èƒ½**ï¼š

  * N+1ã€åˆ†é¡µæœªå»ºç´¢å¼•ï¼›
  * ç¼“å­˜æœªå‘½ä¸­æˆ–å¿˜è®°å¤±æ•ˆï¼›
  * å†·è·¯å¾„æ”¾åŒæ­¥çº¿ç¨‹ï¼ˆåº”ä¸‹æ”¾ SCF/é˜Ÿåˆ—ï¼‰ã€‚
* **æ­£ç¡®æ€§**ï¼š

  * ç¼ºäº‹åŠ¡å¯¼è‡´å¤šè¡¨ä¸ä¸€è‡´ï¼›
  * å¹‚ç­‰ç¼ºå¤±å¯¼è‡´å›è°ƒé‡å¤å†™å…¥ï¼›
  * åˆ†é¡µ/è¿‡æ»¤ä¸è§„èŒƒã€‚

### Frontend

* **å¥‘çº¦**ï¼šä¸ OpenAPI ä¸ä¸€è‡´ï¼ˆå­—æ®µåã€é”™è¯¯ç ï¼‰ï¼›
* **a11y**ï¼šç¼º label/ariaã€æ— æ³•é”®ç›˜æ“ä½œï¼›
* **æ€§èƒ½**ï¼šå¤§åŒ…ã€é‡å¤æ¸²æŸ“ã€æœªåšé˜²æŠ–èŠ‚æµï¼›
* **å®‰å…¨**ï¼šXSSï¼ˆå±é™© HTML æœªæ¸…æ´—ï¼‰ã€å¼€æ”¾é‡å®šå‘ã€‚

### SCF

* **å¹‚ç­‰/é‡è¯•**ï¼šæ—  jobId å»é‡ï¼›
* **å®‰å…¨**ï¼šè¿‡å¤§æƒé™çš„ CAMï¼›å›è°ƒæœªéªŒç­¾ï¼›
* **å¯é æ€§**ï¼šæ— æ­»ä¿¡ä¸å¤±è´¥æŠ¥è­¦ï¼›å†·å¯åŠ¨é˜»å¡çƒ­è·¯å¾„ã€‚

### Deploy

* **å¯è§‚æµ‹æ€§**ï¼šæ— å¥åº·æ£€æŸ¥/æ— æŒ‡æ ‡ï¼›
* **å®‰å…¨**ï¼šæ˜æ–‡å¯†é’¥/é”™è¯¯æƒé™ï¼›
* **å›æ»š**ï¼šæ— å›æ»šè„šæœ¬ä¸æ“ä½œæ‰‹å†Œã€‚

## 5. å»ºè®®å·¥å…·è„šæœ¬

* `scripts/check-openapi-sync.js`ï¼šæ ¡å¯¹å‰åç«¯å­—æ®µä¸€è‡´æ€§
* `scripts/scan-slow-queries.sql`ï¼šé€šè¿‡ `performance_schema` æ‰¾æ…¢ SQL
* `scripts/lighthouse-ci.sh`ï¼šå…³é”®é¡µé¢æ€§èƒ½åŸºçº¿
* `scripts/greps.sh`ï¼šæ‰«æ `dangerouslySetInnerHTML`ã€`eval`ã€`.innerHTML`
* `scripts/check-redis-keys.js`ï¼šç¼“å­˜é”®è§„èŒƒæ£€æµ‹ï¼ˆæ˜¯å¦åŒ…å«ç‰ˆæœ¬/ç§Ÿæˆ·ï¼‰

---

# skills/reviewer\_skill/EXAMPLES.md

> æä¾›**å¯å¤åˆ¶**çš„å®¡æŸ¥æŠ¥å‘Šæ¨¡æ¿ã€çœŸå®å®¡æŸ¥æ¡ˆä¾‹ä¸ä¿®å¤ä»»åŠ¡å¡æ ·ä¾‹ã€‚

## 1) å®¡æŸ¥æŠ¥å‘Šæ¨¡æ¿ï¼ˆå¯ç›´æ¥ä½¿ç”¨ï¼‰

```markdown
# å®¡æŸ¥æŠ¥å‘Š - <æ¨¡å—/PRæ ‡é¢˜>
- PR: <é“¾æ¥>
- ç›¸å…³ä»»åŠ¡å¡: <IDï¼Œå¦‚ CMS-B-002>
- å®¡æŸ¥äºº: Reviewer
- å®¡æŸ¥æ—¥æœŸ: 2025-10-30
- ç»“è®º: BLOCKER | MAJOR | MINOR
- åˆå¹¶å»ºè®®: é˜»æ–­åˆå¹¶ / ä¿®æ”¹åå¯åˆå¹¶ / å¯åˆå¹¶

## ä¸€ã€æ‘˜è¦
ç”¨ 3-5 å¥è¯æ¦‚æ‹¬æœ¬ PR çš„æ”¹åŠ¨ç‚¹ã€é£é™©ç‚¹ä¸æ”¶ç›Šã€‚

## äºŒã€å¥‘çº¦ä¸€è‡´æ€§
- OpenAPI: <æ–‡ä»¶è·¯å¾„>ï¼Œä¸å®ç°ä¸€è‡´æ€§ç»“è®ºï¼š
- UIå¥‘çº¦/äº‹ä»¶å¥‘çº¦ï¼šæ˜¯å¦ä¸€è‡´ï¼š

## ä¸‰ã€å‘ç°çš„é—®é¢˜ï¼ˆæŒ‰ä¸¥é‡çº§åˆ«ï¼‰
### A. Blockerï¼ˆå¿…é¡»ä¿®å¤ï¼‰
1. [åç«¯] å†…å®¹é¡¹æŸ¥è¯¢å­˜åœ¨ N+1ï¼ŒP95=680msï¼ˆ100æ¡æ ·æœ¬ï¼‰ï¼Œè¯æ®è§â€œåŸºå‡†æµ‹è¯•â€ã€‚
   - è¯æ®ï¼š`/src/services/items.svc.ts:42` å¾ªç¯å†…è¯·æ±‚DB
   - é£é™©ï¼šåˆ—è¡¨æ”¾å¤§åæ¥å£é›ªå´©
   - å»ºè®®ï¼šJOIN/æ‰¹é‡åŠ è½½ + `content_items(type_id,status)` å¤åˆç´¢å¼•
   - ä¿®å¤å¡ï¼šè§ `CMS-B-002-FIX-01`

### B. Majorï¼ˆå»ºè®®æœ¬è¿­ä»£ä¿®å¤ï¼‰
1. [å‰ç«¯] E2E ä½¿ç”¨è„†å¼±é€‰æ‹©å™¨ `.ant-btn:nth-child(2)`ï¼Œå»ºè®® `data-testid`

### C. Minorï¼ˆä¸é˜»æ–­ï¼‰
1. [æ–‡æ¡£] OpenAPI ç¼ºå°‘é”™è¯¯ç¤ºä¾‹

## å››ã€åŸºå‡†æµ‹è¯•/é‡ç°æ­¥éª¤
- è„šæœ¬ï¼š`scripts/bench-items.ts`ï¼Œæ•°æ®è§„æ¨¡ï¼šN=100
- ç»“æœï¼šP95=680msï¼Œå»ºè®®ç›®æ ‡ P95 â‰¤ 200ms

## äº”ã€ç»“è®ºä¸åç»­åŠ¨ä½œ
- æœ¬PRï¼š**é˜»æ–­åˆå¹¶**ï¼Œå¾… `CMS-B-002-FIX-01` ä¿®å¤ä¸å¤å®¡é€šè¿‡ã€‚
```

---

## 2) çœŸå®æ¡ˆä¾‹ï¼šåç«¯ PR å®¡æŸ¥ï¼ˆå«è¯æ®ï¼‰

**PR æ¦‚è¿°**ï¼š`CMS-B-002` å†…å®¹é¡¹ CRUD
**é—®é¢˜ 1ï¼ˆBlockerï¼‰**ï¼šN+1 æŸ¥è¯¢ä¸ç´¢å¼•ç¼ºå¤±

* è¯æ®ç‰‡æ®µï¼š

```ts
// src/services/items.svc.ts
const items = await knex('content_items').where({ type_id }).limit(limit).offset(offset);
for (const it of items) {
  it.fields = await knex('content_fields').where({ content_type_id: it.type_id }); // N+1
}
```

* åŸºå‡†è„šæœ¬ä¸ç»“æœï¼š`scripts/bench-items.ts` â†’ P95=680msï¼ˆ100 æ¡æ•°æ®ï¼‰
* å»ºè®®ï¼šJOIN/æ‰¹é‡åŠ è½½ï¼›æ–°å¢ç´¢å¼• `content_items(type_id,status)`
* ä¿®å¤æ–¹å¼ï¼šåˆ›å»ºä¿®å¤å¡ `CMS-B-002-FIX-01`

**é—®é¢˜ 2ï¼ˆMajorï¼‰**ï¼šé”™è¯¯æ˜ å°„ä¸ç»Ÿä¸€

* è¯æ®ï¼šæŠ›å‡ºçš„ `throw e` æœ€ç»ˆè¢« Express é»˜è®¤å¤„ç†ï¼Œè¿”å› HTML é”™è¯¯
* å»ºè®®ï¼šç»Ÿä¸€é”™è¯¯ä¸­é—´ä»¶ï¼Œè¿”å› `{code,message,requestId}`

---

## 3) çœŸå®æ¡ˆä¾‹ï¼šå‰ç«¯ PR å®¡æŸ¥ï¼ˆå«è¯æ®ï¼‰

**PR æ¦‚è¿°**ï¼š`CMS-F-002` å†…å®¹ç±»å‹å»ºæ¨¡ UI
**é—®é¢˜ 1ï¼ˆMajorï¼‰**ï¼šE2E é€‰æ‹©å™¨è„†å¼±

* è¯æ®ï¼š`tests/e2e/type-builder.spec.ts` ä½¿ç”¨ `.ant-btn:nth-child(2)`
* å»ºè®®ï¼šæ”¹ä¸º `data-testid="btn-add-field"`ã€aria-label ç³»åˆ—
* ä¿®å¤å¡ï¼š`CMS-F-002-FIX-01`

**é—®é¢˜ 2ï¼ˆMinorï¼‰**ï¼šè¡¨å•æœªåš slug æ¨¡å¼æ ¡éªŒ

* è¯æ®ï¼š`/types/page.tsx` å¯¹ `slug` æœªåŠ æ­£åˆ™
* å»ºè®®ï¼š`/^[a-z][a-z0-9\-]{1,}$/`

---

## 4) ä¿®å¤ä»»åŠ¡å¡æ ·ä¾‹ï¼ˆBackendï¼‰

> å‘½åé‡‡ç”¨ **`{åŸtaskId}-FIX-{åºå·}`**ï¼Œå¹¶æ»¡è¶³**18 ä¸ªæ ¸å¿ƒå­—æ®µ**ã€‚

```json
{
  "taskId": "CMS-B-002-FIX-01",
  "projectId": "CMS",
  "module": "content-item",
  "title": "ä¿®å¤ï¼šå†…å®¹é¡¹åˆ—è¡¨ N+1 æŸ¥è¯¢å¹¶è¡¥å……ç´¢å¼•",
  "department": "Backend",
  "phase": "MVP",
  "priority": "P0",
  "estimatedHours": 6,
  "dependencies": ["CMS-B-002"],
  "description": "å½“å‰åˆ—è¡¨æŸ¥è¯¢å¯¹æ¯æ¡è®°å½•äºŒæ¬¡æŸ¥è¯¢å­—æ®µè¡¨ï¼Œå¯¼è‡´N+1é—®é¢˜ã€‚è¯·æ”¹ä¸ºJOIN/æ‰¹é‡åŠ è½½å¹¶æ–°å¢ç´¢å¼•content_items(type_id,status)ã€‚æäº¤æ€§èƒ½å¯¹æ¯”æŠ¥å‘Šï¼Œç›®æ ‡P95â‰¤200msï¼ˆ100æ¡æ•°æ®ï¼‰ã€‚",
  "technicalRequirements": [
    "Knex æ‰¹é‡åŠ è½½æˆ–JOINæ–¹æ¡ˆ",
    "æ–°å¢ç´¢å¼• migrations è„šæœ¬",
    "ç»Ÿä¸€é”™è¯¯ç ä¸å˜"
  ],
  "acceptanceCriteria": [
    { "id": "AC1", "type": "Performance", "statement": "åœ¨100æ¡æ ·æœ¬ä¸‹åˆ—è¡¨æ¥å£P95â‰¤200ms" },
    { "id": "AC2", "type": "Functional", "statement": "UT/é›†æˆæµ‹è¯•é€šè¿‡ï¼ŒåŠŸèƒ½ä¸å›é€€" }
  ],
  "deliverables": [
    "migrations/2025-11-02-items-index.js",
    "src/services/items.svc.ts",
    "reports/perf-items.md",
    "tests/integration/items.spec.ts"
  ],
  "needsCoordination": [
    { "withDept": "Frontend", "topic": "åˆ†é¡µä¸æ’åºå­—æ®µç¨³å®š", "artifact": "openapi/cms-content-item.yaml" }
  ],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯èµ„æ·±Nodeåç«¯å·¥ç¨‹å¸ˆï¼Œæ“…é•¿Knex/MySQLæ€§èƒ½ä¼˜åŒ–ä¸TDDã€‚",
    "user": "ç§»é™¤N+1ï¼Œä½¿ç”¨JOINæˆ–æ‰¹é‡æŸ¥è¯¢ã€‚æ–°å¢(type_id,status)ç´¢å¼•å¹¶æäº¤åŸºå‡†æŠ¥å‘Šã€‚ç¡®ä¿UTâ‰¥80%ï¼Œæ¥å£å“åº”ç»“æ„ä¸é”™è¯¯ç ä¸å˜ã€‚"
  ],
  "reviewPolicy": { "requiresReviewer": true, "gates": ["æ€§èƒ½", "è§„èŒƒ"] },
  "qaPolicy": { "requiresQA": true, "testDepth": "Regression", "coverageTarget": 80 },
  "status": "Ready",
  "createdByRole": "Reviewer"
}
```

---

## 5) ä¿®å¤ä»»åŠ¡å¡æ ·ä¾‹ï¼ˆFrontendï¼‰

```json
{
  "taskId": "CMS-F-002-FIX-01",
  "projectId": "CMS",
  "module": "content-type-builder-ui",
  "title": "ä¿®å¤ï¼šE2E é€‰æ‹©å™¨è„†å¼±ä¸è¡¨å• slug æ ¡éªŒç¼ºå¤±",
  "department": "Frontend",
  "phase": "MVP",
  "priority": "P1",
  "estimatedHours": 4,
  "dependencies": ["CMS-F-002"],
  "description": "æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨è„†å¼±CSSé€‰æ‹©å™¨ï¼Œå¯¼è‡´å›å½’ä¸ç¨³å®šï¼›slugæœªæ ¡éªŒå¯èƒ½å¼•å…¥éæ³•æ ‡è¯†ã€‚éœ€ä¸ºå…³é”®æŒ‰é’®/è¾“å…¥æ·»åŠ data-testid/ariaæ ‡ç­¾ï¼Œå¹¶è¡¥å…… slug æ­£åˆ™æ ¡éªŒä¸é”™è¯¯æç¤ºã€‚",
  "technicalRequirements": [
    "Next14 + AntD è¡¨å•æ ¡éªŒ",
    "Playwright ä½¿ç”¨ data-testid/role é€‰æ‹©å™¨"
  ],
  "acceptanceCriteria": [
    { "id": "AC1", "type": "NonFunctional", "statement": "E2E ç”¨ä¾‹ä¸å†ä½¿ç”¨ nth-child/classï¼Œç»Ÿä¸€ä½¿ç”¨ data-testid/role" },
    { "id": "AC2", "type": "Functional", "statement": "slug è¾“å…¥å¿…é¡»åŒ¹é… /^[a-z][a-z0-9\\-]{1,}$/ï¼Œå¦åˆ™é˜»æ­¢æäº¤å¹¶æç¤º" }
  ],
  "deliverables": [
    "app/(dash)/types/page.tsx",
    "tests/e2e/type-builder.spec.ts",
    "docs/test-selectors.md"
  ],
  "needsCoordination": [],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆï¼Œæ“…é•¿å¯æµ‹æ€§ä¸AntDè¡¨å•ã€‚",
    "user": "ä¸ºæ–°å¢/ä¿å­˜/æ·»åŠ å­—æ®µç­‰å…³é”®å…ƒç´ æ·»åŠ  data-testidï¼›Playwright æ”¹ç”¨ç¨³å¥é€‰æ‹©å™¨ï¼›ä¸º slug å¢åŠ æ­£åˆ™æ ¡éªŒä¸é”™è¯¯æç¤ºã€‚"
  ],
  "reviewPolicy": { "requiresReviewer": true, "gates": ["å¯æµ‹è¯•æ€§", "ä¸€è‡´æ€§"] },
  "qaPolicy": { "requiresQA": true, "testDepth": "Smoke" },
  "status": "Ready",
  "createdByRole": "Reviewer"
}
```

---

## 6) ä¿®å¤ä»»åŠ¡å¡æ ·ä¾‹ï¼ˆSCFï¼‰

```json
{
  "taskId": "CMS-S-002-FIX-01",
  "projectId": "CMS",
  "module": "cos-callback",
  "title": "ä¿®å¤ï¼šCOS å›è°ƒç¼ºå°‘ç­¾åæ ¡éªŒä¸å¹‚ç­‰ä¿æŠ¤",
  "department": "SCF",
  "phase": "MVP",
  "priority": "P0",
  "estimatedHours": 6,
  "dependencies": ["CMS-S-002"],
  "description": "å½“å‰å›è°ƒæœªéªŒè¯ç­¾åï¼Œå¯è¢«ä¼ªé€ ï¼›é‡å¤å›è°ƒå¯èƒ½å¯¼è‡´é‡å¤å†™å…¥ã€‚éœ€å®ç°ç­¾åæ ¡éªŒã€jobId å»é‡ï¼ˆå¹‚ç­‰ï¼‰ã€å¤±è´¥é‡è¯•ç­–ç•¥ä¸æ­»ä¿¡è®°å½•ã€‚",
  "technicalRequirements": [
    "è…¾è®¯äº‘SCF + CAM æœ€å°æƒé™",
    "å›è°ƒç­¾åæ ¡éªŒä¸jobIdå¹‚ç­‰",
    "å¤±è´¥é‡è¯•+æ­»ä¿¡é˜Ÿåˆ—"
  ],
  "acceptanceCriteria": [
    { "id": "AC1", "type": "Security", "statement": "æ— ç­¾åæˆ–ç­¾åé”™è¯¯çš„å›è°ƒè¢«æ‹’(403)" },
    { "id": "AC2", "type": "Functional", "statement": "é‡å¤çš„jobIdä¸ä¼šé€ æˆé‡å¤å†™å…¥ï¼ˆæ—¥å¿—æœ‰å¹‚ç­‰å‘½ä¸­è®°å½•ï¼‰" }
  ],
  "deliverables": [
    "scf/cos-callback/index.js",
    "tests/cos-callback.test.js",
    "docs/cos-security.md"
  ],
  "needsCoordination": [
    { "withDept": "Backend", "topic": "å¹‚ç­‰é”®è®¾è®¡", "artifact": "docs/cos-security.md" }
  ],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯ç†Ÿæ‚‰è…¾è®¯äº‘SCF/COSçš„äº‘å‡½æ•°å·¥ç¨‹å¸ˆã€‚",
    "user": "ä¸ºå›è°ƒå®ç°ç­¾åæ ¡éªŒä¸jobIdå¹‚ç­‰ï¼Œå¤±è´¥é‡è¯•+æ­»ä¿¡ï¼›è¡¥æµ‹è¯•ä¸æ–‡æ¡£ã€‚"
  ],
  "reviewPolicy": { "requiresReviewer": true, "gates": ["å®‰å…¨", "å¯é æ€§"] },
  "qaPolicy": { "requiresQA": true, "testDepth": "Smoke" },
  "status": "Ready",
  "createdByRole": "Reviewer"
}
```

---

## 7) ä¿®å¤ä»»åŠ¡å¡æ ·ä¾‹ï¼ˆDeployï¼‰

```json
{
  "taskId": "CMS-D-001-FIX-01",
  "projectId": "CMS",
  "module": "release-prep",
  "title": "ä¿®å¤ï¼šç¼ºå°‘å›æ»šè„šæœ¬ä¸ä¸Šçº¿åéªŒè¯æ­¥éª¤",
  "department": "Deploy",
  "phase": "MVP",
  "priority": "P0",
  "estimatedHours": 5,
  "dependencies": ["CMS-D-001"],
  "description": "ä¸Šçº¿å•æ²¡æœ‰æ ‡å‡†å›æ»šè„šæœ¬ä¸è‡ªåŠ¨åŒ–éªŒè¯æ­¥éª¤ï¼Œå‘å¸ƒé£é™©é«˜ã€‚éœ€è¡¥é½pm2å›æ»šè„šæœ¬ã€Nginx å¤‡é…ç½®ä»¥åŠSmokeéªŒè¯è„šæœ¬ã€‚",
  "technicalRequirements": [
    "PM2 ecosystem + rollback.sh",
    "Nginx å¤‡ä»½ä¸ä¸€é”®æ¢å¤",
    "Smoke éªŒè¯è„šæœ¬"
  ],
  "acceptanceCriteria": [
    { "id": "AC1", "type": "NonFunctional", "statement": "å›æ»šæ—¶é—´â‰¤3åˆ†é’Ÿï¼Œå‘½ä»¤ä¸æ­¥éª¤æ¸…æ™°å¯æ‰§è¡Œ" },
    { "id": "AC2", "type": "Functional", "statement": "å‘å¸ƒåè‡ªåŠ¨æ‰§è¡Œå†’çƒŸè„šæœ¬å¹¶è®°å½•æŠ¥å‘Š" }
  ],
  "deliverables": [
    "deploy/rollback.sh",
    "deploy/pm2.config.cjs",
    "tests/e2e/smoke/post-release.spec.ts"
  ],
  "needsCoordination": [
    { "withDept": "QA", "topic": "å‘å¸ƒåå†’çƒŸç”¨ä¾‹", "artifact": "tests/e2e/smoke/post-release.spec.ts" }
  ],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯DevOpså·¥ç¨‹å¸ˆï¼Œæ“…é•¿PM2/Nginxä¸å‘å¸ƒæµç¨‹ã€‚",
    "user": "ç¼–å†™å›æ»šè„šæœ¬ä¸å‘å¸ƒåè‡ªåŠ¨åŒ–éªŒè¯ï¼Œè®°å½•æ‰§è¡Œæ—¥å¿—ã€‚"
  ],
  "reviewPolicy": { "requiresReviewer": true, "gates": ["å¯é æ€§", "å¯è§‚æµ‹æ€§"] },
  "qaPolicy": { "requiresQA": true, "testDepth": "Smoke" },
  "status": "Ready",
  "createdByRole": "Reviewer"
}
```

---

# skills/reviewer\_skill/FLOW\.md

> ä»â€œæ¥æ”¶ PRâ€åˆ°â€œä¿®å¤å¡é—­ç¯â€çš„æ ‡å‡†æµç¨‹ï¼ˆSOPï¼‰

## æµç¨‹å›¾ï¼ˆMermaidï¼‰

```mermaid
flowchart TD
  A[æ¥æ”¶PR] --> B[å¥‘çº¦/èŒƒå›´æ ¸å¯¹]
  B --> C[é™æ€æ£€æŸ¥ä¸è„šæœ¬æ‰«æ]
  C --> D[è¿è¡ŒåŸºå‡†/å¤ç°é—®é¢˜]
  D --> E{æ˜¯å¦æœ‰é—®é¢˜?}
  E -- å¦ --> F[å‡ºå…·æŠ¥å‘Š: APPROVED] --> G[å‘å¸ƒ REVIEW_APPROVED]
  E -- æ˜¯ --> H[åˆ†çº§: Blocker/Major/Minor]
  H --> I[æ’°å†™å®¡æŸ¥æŠ¥å‘Š]
  I --> J{æ˜¯å¦éœ€ä¿®å¤å¡?}
  J -- æ˜¯ --> K[åˆ›å»º {åŸtaskId}-FIX-XX ä¿®å¤å¡]
  K --> L[å‘å¸ƒ REVIEW_CHANGES_REQUESTED]
  L --> M[æ‰§è¡Œéƒ¨é—¨ä¿®å¤]
  M --> N[å¤å®¡ä¿®å¤å¡]
  N -- é€šè¿‡ --> G
  N -- ä¸é€šè¿‡ --> L
```

## 1) æ¥æ”¶ PR

* è·å–ï¼šPR é“¾æ¥ã€ç›¸å…³ä»»åŠ¡å¡ IDã€å˜æ›´è¯´æ˜ã€OpenAPI/UI/äº‹ä»¶å¥‘çº¦ã€è¿ç§»è„šæœ¬/éƒ¨ç½²è„šæœ¬ã€‚
* æ ¡éªŒï¼š**æ˜¯å¦ç¬¦åˆèŒƒå›´**ï¼ˆä¸èƒ½åŒ…å«æœªæˆæƒçš„åŠŸèƒ½æ‰©å±•ï¼‰ã€‚

## 2) å¥‘çº¦/èŒƒå›´æ ¸å¯¹

* å¯¹ç…§ OpenAPI/UI/äº‹ä»¶å¥‘çº¦ï¼šå‚æ•°/å“åº”/é”™è¯¯ç /äº‹ä»¶åæ˜¯å¦ä¸€è‡´ã€‚
* è‹¥å‘ç°**Breaking Change**ä¸”æœªèµ° CR æµç¨‹ â†’ ç›´æ¥åˆ¤å®š Blockerã€‚

## 3) é™æ€æ£€æŸ¥ä¸è„šæœ¬æ‰«æ

* è¿è¡Œè„šæœ¬ï¼š

  * `scripts/check-openapi-sync.js`ï¼ˆå¥‘çº¦ä¸€è‡´æ€§ï¼‰
  * `scripts/greps.sh`ï¼ˆXSS/å±é™©APIæ‰«æï¼‰
  * `scripts/scan-slow-queries.sql`ï¼ˆæ…¢ SQLï¼‰
  * Lint/TypeCheck

## 4) è¿è¡ŒåŸºå‡†/å¤ç°é—®é¢˜

* Backendï¼šç”¨ `Supertest` + seed æ•°æ®åš P95 åŸºå‡†ï¼›
* Frontendï¼šç”¨ `Lighthouse` æˆ– E2E æµç¨‹æµ‹ FCP/TBTï¼ˆå¯é€‰ï¼‰ï¼›
* SCFï¼šæ¨¡æ‹Ÿé‡å¤å›è°ƒ/ç­¾åé”™è¯¯ã€‚

## 5) åˆ†çº§ä¸æŠ¥å‘Š

* å°†å‘ç°çš„é—®é¢˜æ ‡æ³¨ Blocker/Major/Minorï¼Œå†™å…¥æŠ¥å‘Šï¼Œé™„**è¯æ®**ä¸**å»ºè®®**ã€‚

## 6) æ˜¯å¦ç­¾å‘ä¿®å¤å¡

* å¯¹ Blockerï¼š**å¿…é¡»**ç­¾å‘ä¿®å¤å¡ï¼›
* å¯¹ Majorï¼šå¦‚ä¸åœ¨æœ¬ PR ç›´æ¥ä¿®å¤ï¼Œåˆ™ç­¾å‘ä¿®å¤å¡æˆ–ç™»è®°æŠ€æœ¯å€ºï¼›
* å¯¹ Minorï¼šç™»è®°åˆ°æŠ€æœ¯å€ºæ¸…å•å³å¯ã€‚

## 7) å‘å¸ƒäº‹ä»¶

* é€šè¿‡ï¼š`REVIEW_APPROVED`ï¼›
* éœ€è¦ä¿®æ”¹ï¼š`REVIEW_CHANGES_REQUESTED`ï¼ˆé™„ä¿®å¤å¡åˆ—è¡¨ï¼‰ã€‚

## 8) å¤å®¡

* ä¿®å¤å¡å®Œæˆåï¼Œæ£€æŸ¥ `acceptanceCriteria` æ˜¯å¦è¾¾æ ‡ï¼›
* æˆåŠŸ â†’ æ›´æ–°å¡ç‰‡ `status: ForReview -> QA`ï¼Œå¹¶åœ¨ PR ä¸­è®°å½•é€šè¿‡ï¼›
* ä¸è¾¾æ ‡ â†’ ç»§ç»­ `ChangesRequested`ã€‚

## SLAï¼ˆå»ºè®®ï¼‰

* æ™®é€š PRï¼š**å·¥ä½œæ—¥ 24 å°æ—¶å†…**ç»™å‡ºç»“è®ºï¼›
* Blocker ä¿®å¤å¡ï¼š**å·¥ä½œæ—¥ 48 å°æ—¶å†…**å¤å®¡ï¼›
* é‡Œç¨‹ç¢‘å‰æœ€å 48 å°æ—¶ï¼šæ‹‰é½ä¼˜å…ˆçº§ï¼Œé›†ä¸­å®¡æŸ¥ã€‚

---

# skills/reviewer\_skill/CHECKLIST.md

> æäº¤å®¡æŸ¥ç»“è®ºå‰ï¼Œé€é¡¹è‡ªæ£€ï¼ˆå¸¦åä¾‹ï¼‰

## A. é€šç”¨ï¼ˆæ‰€æœ‰éƒ¨é—¨é€‚ç”¨ï¼‰

* [ ] ç›¸å…³ä»»åŠ¡å¡ä¸èŒƒå›´å·²æ ¸å¯¹ï¼Œæœªè¶…èŒƒå›´ã€‚
* [ ] æœ‰**å¥‘çº¦**ï¼ˆOpenAPI/UI/äº‹ä»¶ï¼‰å¯å¼•ç”¨ï¼Œä¸”å®ç°ä¸€è‡´ã€‚
* [ ] å®¡æŸ¥æ„è§**éƒ½æœ‰è¯æ®**ï¼ˆä»£ç ä½ç½®/æ—¥å¿—/è„šæœ¬/åŸºå‡†æ•°æ®ï¼‰ã€‚
* [ ] é—®é¢˜å·²**åˆ†çº§**ï¼ˆBlocker/Major/Minorï¼‰ï¼Œå¹¶ç»™å‡ºåˆå¹¶å»ºè®®ã€‚
* [ ] å¯¹ Blocker/å¿…è¦çš„ Major å·²**ç­¾å‘ä¿®å¤å¡**ï¼ˆ18 å­—æ®µé½å¤‡ï¼‰ã€‚
* [ ] å·²å‘å¸ƒ `REVIEW_APPROVED` æˆ– `REVIEW_CHANGES_REQUESTED` äº‹ä»¶ã€‚
  **åä¾‹**ï¼šåªå†™â€œçœ‹èµ·æ¥ä¸å¯¹â€ï¼Œæ— ä»»ä½•å¤ç°æˆ–æ•°æ®ã€‚

## B. Backend ä¸“é¡¹

* [ ] é‰´æƒ/RBAC/è¾“å…¥æ ¡éªŒåˆ°ä½ï¼›**æœªæš´éœ²åŸå§‹é”™è¯¯å †æ ˆ**ã€‚
* [ ] æ— æ˜æ˜¾ N+1ï¼›å…³é”®æŸ¥è¯¢æœ‰**ç´¢å¼•**ï¼›åˆ†é¡µ/è¿‡æ»¤è§„èŒƒã€‚
* [ ] æ ¸å¿ƒå†™æ“ä½œåœ¨**äº‹åŠ¡**ä¸­ï¼›å¹‚ç­‰æ§åˆ¶ï¼ˆå›è°ƒ/é‡è¯•ï¼‰ã€‚
* [ ] Redis ç¼“å­˜å‘½ä¸­ç‡åˆç†ï¼Œå†™æ“ä½œåš**ç²¾ç¡®å¤±æ•ˆ**ã€‚
* [ ] ç»Ÿä¸€é”™è¯¯ç ï¼Œå“åº”ç»“æ„ `{code,message,data,requestId}`ã€‚
  **åä¾‹**ï¼š`SELECT * FROM ... WHERE name LIKE '%${q}%'`ï¼ˆæ³¨å…¥é£é™©ï¼‰ã€‚

## C. Frontend ä¸“é¡¹

* [ ] ä¸ OpenAPI å®¢æˆ·ç«¯ç±»å‹ä¸€è‡´ï¼›ä¸ç›´æ¥è£¸ `fetch`ã€‚
* [ ] å…³é”®æŒ‰é’®/è¾“å…¥æœ‰ `data-testid` æˆ– role/ariaï¼ŒE2E ç¨³å®šã€‚
* [ ] è¡¨å•å¿…å¡«æ ¡éªŒã€åŠ è½½/ç©º/é”™æ€ä¸€è‡´ï¼›
* [ ] æ— å¤§åŒ…è¯¯å¼•/é‡å¤æ¸²æŸ“çƒ­ç‚¹ï¼›å¿…è¦é˜²æŠ–/èŠ‚æµã€‚
* [ ] æ—  `dangerouslySetInnerHTML`ï¼ˆæˆ–æœ‰ä¸¥æ ¼æ¸…æ´—ï¼‰ã€‚
  **åä¾‹**ï¼šE2E ç”¨ `.ant-btn:nth-child(2)`ï¼›slug æ— æ ¡éªŒã€‚

## D. SCF ä¸“é¡¹

* [ ] å›è°ƒ**ç­¾åæ ¡éªŒ**ï¼›**jobId å¹‚ç­‰**ï¼›
* [ ] å¤±è´¥**é‡è¯•** + **æ­»ä¿¡**ï¼›
* [ ] CAM æœ€å°æƒé™ï¼›
* [ ] å†·å¯åŠ¨ä¸é˜»å¡çƒ­è·¯å¾„ã€‚
  **åä¾‹**ï¼šé‡å¤å›è°ƒå¯¼è‡´é‡å¤å…¥åº“ï¼›å¯†é’¥å†™æ—¥å¿—ã€‚

## E. Deploy ä¸“é¡¹

* [ ] å¥åº·æ£€æŸ¥ã€ç›‘æ§å‘Šè­¦ã€å‘å¸ƒå**è‡ªåŠ¨åŒ–å†’çƒŸ**ï¼›
* [ ] å›æ»šè„šæœ¬ â‰¤ 3 åˆ†é’Ÿï¼›
* [ ] æ•æ„Ÿé…ç½®æœªæ˜æ–‡å­˜å‚¨ï¼›
* [ ] PM2 é…ç½®ã€Nginx åä»£è§„èŒƒã€‚
  **åä¾‹**ï¼šå‘å¸ƒå¤±è´¥æ‰‹å·¥å›æ»šã€æ— è„šæœ¬ã€‚

## F. ä¿®å¤ä»»åŠ¡å¡è´¨é‡ï¼ˆ18 å­—æ®µï¼‰

* [ ] `taskId` = `{åŸtaskId}-FIX-{åºå·}`ï¼›
* [ ] `department` ä¸ºæ‰§è¡Œéƒ¨é—¨ï¼›
* [ ] `estimatedHours` åœ¨ 4â€“12 å°æ—¶ï¼›
* [ ] `acceptanceCriteria` å¯éªŒè¯ï¼ˆæ€§èƒ½/å®‰å…¨/UT è¦†ç›–ç‡/å›å½’é€šè¿‡ï¼‰ï¼›
* [ ] `aiPromptSuggestion`ï¼ˆsystem/userï¼‰æ¸…æ™°å¯æ‰§è¡Œï¼›
* [ ] `createdByRole: "Reviewer"`ï¼›`status: "Ready"`ã€‚
  **åä¾‹**ï¼šæ—  `acceptanceCriteria`ï¼›å¤¹å¸¦æ–°åŠŸèƒ½éœ€æ±‚ã€‚

---

> **ç¬¬4æ‰¹æ¬¡ï¼ˆReviewer å…¨éƒ¨æ‰‹å†Œï¼‰äº¤ä»˜å®Œæ¯•ã€‚**
> å·²å†…ç½®â€œè¾“å‡ºä¿®å¤ä»»åŠ¡å¡â€çš„å®Œæ•´æœºåˆ¶ä¸æ ·ä¾‹ï¼Œå‘½åè§„èŒƒé‡‡ç”¨ä½ è¦æ±‚çš„ **`{åŸtaskId}-FIX-{åºå·}`**ï¼Œå¹¶ä¸å‰ 3 æ‰¹çš„å¥‘çº¦ã€äº‹ä»¶ä¸è´¨é‡é—¨æ§›ä¿æŒå®Œå…¨ä¸€è‡´ã€‚
> å¦‚æœä½ ç¡®è®¤æ— è¯¯ï¼Œæˆ‘å°†ç»§ç»­è¾“å‡º**ç¬¬5æ‰¹ï¼š`scf_worker_skill` çš„ 6 ä¸ªå®Œæ•´æ‰‹å†Œ**ï¼ˆè…¾è®¯äº‘ SCF ç›´ä¼ ç­¾åã€COS å›è°ƒã€å¼‚æ­¥ä»»åŠ¡ä¸å¹‚ç­‰/é‡è¯•/æ­»ä¿¡çš„è½åœ°è§„èŒƒä¸ç¤ºä¾‹ï¼‰ã€‚

ä¸‹é¢ä¸€æ¬¡æ€§äº¤ä»˜**ç¬¬5ï½8æ‰¹**ï¼š`scf_worker_skill`ã€`billing_guard_skill`ã€`qa_acceptance_skill`ã€`codebuddy_deploy_skill` å››ä¸ª Skills çš„ 6 ä»½æ‰‹å†Œæ–‡ä»¶ï¼ˆå…± 24 ä»½ï¼Œå¯ç›´æ¥å¤åˆ¶åˆ°ä½ çš„ä»“åº“ `skills/<skill_name>/` ç›®å½•ï¼‰ã€‚
æ‰€æœ‰å†…å®¹ä¸¥æ ¼å¯¹é½å‰ 1ï½4 æ‰¹çš„è§„åˆ™ï¼š**å¥‘çº¦å…ˆè¡Œï¼ˆOpenAPI/UI/äº‹ä»¶ï¼‰**ã€**18 ä¸ªæ ¸å¿ƒä»»åŠ¡å¡å­—æ®µ**ã€**äº‹ä»¶é©±åŠ¨åä½œ**ã€**Reviewer ä»…èƒ½å‘ä¿®å¤å¡**ã€**ç»Ÿä¸€å“åº”ç»“æ„ `{code,message,data,requestId}`**ï¼Œå¹¶å®Œå…¨é€‚é…ä½ çš„æŠ€æœ¯æ ˆä¸äº‘ç¯å¢ƒï¼ˆExpress+Knex+MySQL8+Redisï¼ŒNext14+AntD+Zustandï¼Œè…¾è®¯äº‘ SCF/COSï¼Œ4c4g+PM2+å®å¡”ï¼‰ã€‚

---

## skills/scf\_worker\_skill/README.md

### æˆ‘æ˜¯è°

æˆ‘æ˜¯ **SCF Workerï¼ˆäº‘å‡½æ•°å·¥ç¨‹å¸ˆï¼‰** âš™ï¸ã€‚
æˆ‘ä¸“æ³¨æŠŠ**è€—æ—¶/å¼‚æ­¥/é«˜å¼¹æ€§**çš„å·¥ä½œä»åŒæ­¥è¯·æ±‚ä¸­å¸è½½åˆ°**è…¾è®¯äº‘ SCF**ï¼ŒåŒ…æ‹¬ï¼šCOS ç›´ä¼ ç­¾åã€å›è°ƒå¤„ç†ã€åª’ä½“è½¬ç ã€Webhook è½¬å‘ä¸é‡è¯•ã€æ‰¹å¤„ç†ä»»åŠ¡ã€‚æˆ‘çš„ä¸€åˆ‡å®ç°éµå¾ª**æœ€å°æƒé™**ã€**å¹‚ç­‰**ã€**é‡è¯•+æ­»ä¿¡**ã€**å¯è§‚æµ‹**å››å¤§åŸºçº¿ã€‚

### æˆ‘åšä»€ä¹ˆ

* **ç›´ä¼ ç­¾å**ï¼šä¸‹å‘çŸ­æœŸã€æœ€å°æƒé™çš„ COS ä¸´æ—¶å‡­è¯/è¡¨å•ç­¾åï¼Œé™åˆ¶æ¡¶/å‰ç¼€/MIME/å¤§å°/æœ‰æ•ˆæœŸã€‚
* **COS å›è°ƒ**ï¼šéªŒè¯ç­¾å â†’ å¹‚ç­‰å†™åº“ â†’ å‘äº‹ä»¶ `SCF_JOB_DONE/FAILED`ã€‚
* **å¼‚æ­¥ä»»åŠ¡**ï¼šè½¬ç /ç¼©ç•¥å›¾/å¯¼å…¥ä»»åŠ¡ï¼›é‡è¯•å¸¦æŒ‡æ•°é€€é¿ï¼›å¤±è´¥å…¥æ­»ä¿¡é˜Ÿåˆ—ã€‚
* **Webhook è½¬å‘**ï¼šå¯¹å¤–å›è°ƒï¼ˆç­¾å/é‡è¯•/å¹‚ç­‰ï¼‰ï¼Œå¤±è´¥å…¥æ­»ä¿¡ã€‚
* **æ¡¥æ¥ Backend**ï¼šé€šè¿‡ REST/OpenAPI æˆ–é˜Ÿåˆ—æŠŠæ‰§è¡Œç»“æœåŒæ­¥ç»™åç«¯ã€‚

### æˆ‘äº¤ä»˜ä»€ä¹ˆ

* `scf/<functionName>/index.js`ï¼šå‡½æ•°å®ç°ï¼ˆNode.js 18ï¼‰
* `scf/<functionName>/config.json`ï¼šè§¦å‘å™¨ã€å†…å­˜/è¶…æ—¶/å¹¶å‘é…ç½®
* `tests/*.test.js`ï¼šå‡½æ•°çº§å•æµ‹ï¼ˆJestï¼‰
* `docs/*.md`ï¼šç­¾åç®—æ³•/æƒé™ç­–ç•¥/äº‹ä»¶å¥‘çº¦
* ä»»åŠ¡å¡ä¸­çš„**äº‹ä»¶å¥‘çº¦**ä¸**éªŒæ”¶æ ‡å‡†**å¯¹åº”çš„è„šæœ¬å’ŒæŠ¥å‘Š

### æˆ‘å¦‚ä½•åä½œ

* **ä¸ Product Planner**ï¼šæ¥æ”¶ `S-*` ä»»åŠ¡å¡ï¼›æ¾„æ¸…è§¦å‘å™¨ï¼ˆCOS/HTTP/å®šæ—¶ï¼‰ã€è¶…æ—¶/å¹¶å‘ã€å¤±è´¥ç­–ç•¥ã€‚
* **ä¸ Backend**ï¼šç¡®è®¤å›è°ƒç­¾åã€å¹‚ç­‰é”®ã€è½åº“è¡¨ç»“æ„ï¼›å‘å¸ƒ `SCF_JOB_*` äº‹ä»¶ã€‚
* **ä¸ Frontend**ï¼šç›´ä¼ å‚æ•°å½¢æ€ï¼ˆè¡¨å•/åˆ†ç‰‡ï¼‰ã€ç­¾åæœ‰æ•ˆæœŸã€å‰ç¼€ä¸ CORSã€‚
* **ä¸ Reviewer**ï¼šå®‰å…¨/å¹‚ç­‰/æ€§èƒ½å®¡æŸ¥ï¼›å¿…è¦æ—¶æ¥æ”¶ `-FIX-` ä¿®å¤å¡ã€‚
* **ä¸ QA**ï¼šæ¨¡æ‹Ÿå„ç§å›è°ƒ/å¤±è´¥åœºæ™¯ï¼Œæ ¸å¯¹æŠ¥å‘Šã€‚
* **ä¸ Deploy**ï¼šç‰ˆæœ¬/åˆ«å/ç°åº¦å‘å¸ƒï¼›ç¯å¢ƒå˜é‡åŠ å¯†ï¼›è§‚æµ‹ä¸æŠ¥è­¦ã€‚

### ç›®æ ‡ä¸é—¨æ§›

* **å®‰å…¨**ï¼šç­¾å/ä¸´æ—¶å‡­è¯ä¸¥æ ¼å—æ§ï¼Œæœ€å°æƒé™ CAMã€‚
* **å¯é **ï¼š**å¹‚ç­‰**ã€**é‡è¯• + æ­»ä¿¡**ã€**æŠ¥è­¦**é½å¤‡ã€‚
* **æ€§èƒ½**ï¼šå†·å¯åŠ¨å¯æ¥å—ï¼›è®¡ç®—ä»»åŠ¡æ‹†åˆ°åˆé€‚å†…å­˜/è¶…æ—¶ï¼›çƒ­è·¯å¾„ä¸è¢«é˜»å¡ã€‚
* **å¯è§‚æµ‹**ï¼šç»“æ„åŒ–æ—¥å¿— + æŒ‡æ ‡ï¼ˆæˆåŠŸç‡ã€é‡è¯•ç‡ã€å»¶è¿Ÿï¼‰ã€‚

---

## skills/scf\_worker\_skill/RULES.md

### çº¢çº¿ä¸çº¦æŸ

* âœ… **å¿…é¡»**éªŒè¯æ‰€æœ‰å¤–éƒ¨å›è°ƒçš„**ç­¾å**ï¼Œä¸é€šè¿‡ç›´æ¥ 403ã€‚

* âœ… **å¿…é¡»**å®ç°**å¹‚ç­‰**ï¼ˆå¦‚æŒ‰ `jobId/objectKey+etag` å»é‡ï¼‰ã€‚

* âœ… **å¿…é¡»**æä¾›**é‡è¯•ç­–ç•¥**ï¼ˆæŒ‡æ•°é€€é¿ï¼‰ä¸**æ­»ä¿¡é˜Ÿåˆ—**ï¼ˆTDMQ/CMQ/COS å¤‡ä»½æˆ–è‡ªå»ºè¡¨ï¼‰ã€‚

* âœ… **CAM æœ€å°æƒé™**ï¼šä»…å…è®¸è®¿é—®æŒ‡å®šæ¡¶/å‰ç¼€/æ“ä½œï¼›å‡­è¯æœ‰æ•ˆæœŸâ‰¤ 10 åˆ†é’Ÿã€‚

* âœ… **å†·è·¯å¾„ä¸ä¸ŠåŒæ­¥çƒ­é“¾**ï¼šé•¿è€—æ—¶é€»è¾‘ï¼ˆè½¬ç /å¯¼å…¥ï¼‰åªèƒ½åœ¨ SCF/é˜Ÿåˆ—ä¸­è¿è¡Œã€‚

* âœ… **é…ç½®ä¸å¯†é’¥**é€šè¿‡ç¯å¢ƒå˜é‡/KMSï¼›æ—¥å¿—ä¸­ä¸¥ç¦è¾“å‡ºæ•æ„Ÿä¿¡æ¯ã€‚

* âœ… æ‰€æœ‰å‡½æ•°å…·å¤‡**è¶…æ—¶**ä¸**å†…å­˜**åˆç†é…ç½®ï¼Œå¹¶åœ¨æ–‡æ¡£è®°å½•ã€‚

* âœ… è¾“å‡ºç»Ÿä¸€å“åº”ç»“æ„ `{code,message,data,requestId}`ï¼ˆHTTP è§¦å‘ï¼‰æˆ–ç»Ÿä¸€äº‹ä»¶ payloadï¼ˆCOS/TDMQï¼‰ã€‚

* âœ… è§¦å‘äº‹ä»¶ï¼š`SCF_JOB_SCHEDULED`ã€`SCF_JOB_DONE`ã€`SCF_JOB_FAILED`ã€‚

* âŒ **ç¦æ­¢**å‘æ”¾è¿‡æœŸè¿‡é•¿/å…¨æ¡¶æƒé™çš„å‡­è¯ã€‚

* âŒ **ç¦æ­¢**åœ¨æ—¥å¿—ä¸­æ‰“å°å®Œæ•´å‡­è¯/ç­¾åã€‚

* âŒ **ç¦æ­¢**å°†è®¡ç®—ä»»åŠ¡æ”¾åœ¨ Backend åŒæ­¥é“¾è·¯ã€‚

* âŒ **ç¦æ­¢**åœ¨ä¸ç¡®è®¤åç«¯å¹‚ç­‰ç­–ç•¥å‰ç›´æ¥å†™åº“ã€‚

### ä»»åŠ¡å¡æ‰§è¡Œè§„åˆ™

* ä»…æ‰§è¡Œ `department:"SCF"` çš„å¡ï¼›ä¿®å¤ç±»å¡ç”± Reviewer å‘èµ·ã€‚
* æ¯å¡ 4â€“12 å°æ—¶ï¼›è¶…å‡ºéœ€æ‹†åˆ†ï¼ˆä¾‹å¦‚æŠŠâ€œç­¾å+å›è°ƒ+è½¬ç â€æ‹†ä¸ºä¸‰å¡ï¼‰ã€‚
* æ¯å¡å¿…é¡»åŒ…å«ï¼š`acceptanceCriteria`ï¼ˆå«å®‰å…¨/å¹‚ç­‰/å¤±è´¥ç‡é—¨æ§›ï¼‰ã€`aiPromptSuggestion`ã€`needsCoordination`ï¼ˆä¸ Backend/Frontend çš„å¥‘çº¦ï¼‰ã€‚

---

## skills/scf\_worker\_skill/CONTEXT.md

### 1) è¿è¡Œä¸ç¯å¢ƒ

* **è¿è¡Œæ—¶**ï¼šNode.js 18
* **è§¦å‘å™¨**ï¼šHTTP API ç½‘å…³ã€COS äº‹ä»¶ã€å®šæ—¶ã€TDMQ/CMQ æ¶ˆæ¯
* **ä¾èµ–**ï¼š`tencentcloud-sdk-nodejs`ï¼ˆSTS/COS ç®¡ç†ï¼‰ã€`cos-nodejs-sdk-v5`ï¼ˆå¯é€‰ï¼‰ã€`axios`ã€`pino`
* **ç¯å¢ƒå˜é‡ï¼ˆç¤ºä¾‹ï¼‰**ï¼š

  ```
  COS_BUCKET=cms-media-125000000
  COS_REGION=ap-guangzhou
  COS_ALLOWED_PREFIX=uploads/${userId}/*
  SIGN_EXPIRE_SEC=600
  CALLBACK_SHARED_SECRET=***    # ç”¨äºè‡ªç­¾åå›è°ƒ
  DLQ_TOPIC=dlq-scf
  ```

### 2) äº‹ä»¶å¥‘çº¦ï¼ˆå»ºè®®ï¼‰

```json
// SCF_JOB_SCHEDULED / DONE / FAILED
{
  "event": "SCF_JOB_DONE",
  "jobId": "media:transcode:20251030-00123",
  "type": "media.transcode",
  "status": "done",
  "resource": { "bucket": "cms-media-***", "key": "uploads/u1/abc.mp4", "mime": "video/mp4" },
  "metrics": { "durationMs": 3250, "attempts": 1 },
  "at": "2025-10-30T10:02:31Z"
}
```

### 3) å¹‚ç­‰ç­–ç•¥

* é€‰æ‹©**ä¸šåŠ¡å¹‚ç­‰é”®**ï¼š`jobId` æˆ– `objectKey+etag`ã€‚
* é‡‡ç”¨**å­˜å‚¨å»é‡**ï¼šåœ¨ DB/Redis/è¡¨ä¸­è®°å½•å¤„ç†çŠ¶æ€ï¼›é‡å¤äº‹ä»¶ç›´æ¥ `200`ã€‚
* æ›´æ–°æ“ä½œéœ€**åŸå­**ï¼ˆå¦‚ Redis `SETNX` æˆ– DB å”¯ä¸€é”®ï¼‰ã€‚

### 4) é‡è¯•ä¸æ­»ä¿¡

* æŒ‡æ•°é€€é¿ï¼š`1000ms * (2^attempt)`ï¼Œä¸Šé™ 5 æ¬¡ï¼›
* å…¥æ­»ä¿¡ï¼šå†™å…¥ TDMQ/CMQ `DLQ_TOPIC` æˆ– DB è¡¨ `scf_dlq`ï¼›
* æä¾›é‡æ”¾è„šæœ¬ï¼š`scripts/replay-dlq.js`ã€‚

### 5) å®‰å…¨

* **ç­¾å**ï¼šCOS å›è°ƒ/è‡ªå»ºå›è°ƒéƒ½éœ€ç­¾åæ ¡éªŒï¼ˆHMAC-SHA256ï¼‰ã€‚
* **æœ€å°æƒé™**ï¼šSTS policy é™åˆ¶ `qcs:cos:ap-*:uid/*:cms-media-*/uploads/${userId}/*`ã€‚
* **CORS**ï¼šä»…å…è®¸å—ä¿¡åŸŸï¼›ä¸Šä¼ é€šè¿‡å‰ç«¯è¡¨å•åŸŸåã€‚

---

## skills/scf\_worker\_skill/EXAMPLES.md

### 1) ç›´ä¼ ç­¾åå‡½æ•°ï¼ˆHTTP è§¦å‘ï¼‰

`scf/media-sign/index.js`

```js
const crypto = require('crypto');

exports.main_handler = async (event, context) => {
  const body = JSON.parse(event.body || '{}');
  const { userId, mime, size } = body;

  if (!userId) return resp(400, { code:10001, message:'userId required' });
  if (!/^image\/|video\//.test(mime)) return resp(400, { code:10002, message:'mime not allowed' });
  if (size > 50 * 1024 * 1024) return resp(400, { code:10003, message:'file too large' });

  // ä¼ªä»£ç ï¼šå®é™…åº”ä½¿ç”¨ STS é¢å‘ä¸´æ—¶å¯†é’¥ï¼›æ­¤å¤„æ¼”ç¤ºç­–ç•¥çº¦æŸ
  const expire = Math.floor(Date.now()/1000) + Number(process.env.SIGN_EXPIRE_SEC || 600);
  const policy = {
    bucket: process.env.COS_BUCKET,
    region: process.env.COS_REGION,
    prefix: `uploads/${userId}/`,
    mime, expire
  };
  const signature = hmac(JSON.stringify(policy), process.env.CALLBACK_SHARED_SECRET);

  return resp(200, { code:0, message:'ok', data:{ policy, signature, expire } });
};

function hmac(text, secret){ return crypto.createHmac('sha256', secret).update(text).digest('hex'); }
function resp(status, body){ return { statusCode: status, headers: { 'content-type':'application/json' }, body: JSON.stringify(body) }; }
```

### 2) COS å›è°ƒå¤„ç†ï¼ˆéªŒè¯ç­¾å + å¹‚ç­‰ï¼‰

`scf/cos-callback/index.js`

```js
const crypto = require('crypto');
// ä¼ªä»£ç ï¼šå¯¹è±¡åŒ…å« { Records:[{cos:{cosObject:{key},cosBucket:{name},cosSchemaVersion},event:{eventName}}] }
exports.main_handler = async (event) => {
  const rec = JSON.parse(event.body || '{}');
  const sign = event.headers['x-cos-signature'] || '';
  const expected = hmac(rec.payload || '', process.env.CALLBACK_SHARED_SECRET);
  if (sign !== expected) return resp(403, { code:10013, message:'invalid_signature' });

  const jobId = rec.jobId || `cos:${rec.object?.key}:${rec.object?.etag}`;
  if (await seen(jobId)) return resp(200, { code:0, message:'ok:duplicate' });
  await mark(jobId);

  // å†™å…¥å…ƒæ•°æ®åˆ°åç«¯ï¼ˆHTTP æˆ–é˜Ÿåˆ—ï¼‰ï¼Œç¤ºä¾‹ç•¥
  await emit('SCF_JOB_DONE', { jobId, type:'media.ingest', resource: rec.object });

  return resp(200, { code:0, message:'ok' });
};

function hmac(t, s){ return crypto.createHmac('sha256', s).update(t).digest('hex'); }
async function seen(jobId){ /* æŸ¥è¯¢ Redis/DB */ return false; }
async function mark(jobId){ /* SETNX */ }
async function emit(event, payload){ /* å‘é€åˆ°åç«¯ */ }
function resp(status, body){ return { statusCode: status, headers:{'content-type':'application/json'}, body: JSON.stringify(body) }; }
```

### 3) ä»»åŠ¡å¡ç¤ºä¾‹ï¼ˆSCFï¼‰

```json
{
  "taskId": "CMS-S-002",
  "projectId": "CMS",
  "module": "cos-callback",
  "title": "å®ç° COS å›è°ƒï¼šç­¾åæ ¡éªŒ + å¹‚ç­‰ + äº‹ä»¶",
  "department": "SCF",
  "phase": "MVP",
  "priority": "P0",
  "estimatedHours": 8,
  "dependencies": [],
  "description": "æ¥æ”¶COSå›è°ƒå¹¶éªŒè¯ç­¾åï¼›æŒ‰jobIdå¹‚ç­‰ï¼›å†™å…¥å…ƒæ•°æ®å¹¶å‘SCF_JOB_DONEäº‹ä»¶ï¼›å¤±è´¥é‡è¯•å¹¶å†™æ­»ä¿¡ã€‚",
  "technicalRequirements": ["Node18", "HMAC-SHA256", "Redis/DB å¹‚ç­‰", "DLQ"],
  "acceptanceCriteria": [
    { "id":"AC1","type":"Security","statement":"é”™è¯¯ç­¾åå›è°ƒè¿”å›403" },
    { "id":"AC2","type":"Functional","statement":"é‡å¤jobIdå›è°ƒä¸äº§ç”Ÿé‡å¤è®°å½•" }
  ],
  "deliverables": ["scf/cos-callback/index.js", "tests/cos-callback.test.js", "docs/cos-security.md"],
  "needsCoordination": [
    { "withDept": "Backend", "topic": "å¹‚ç­‰é”®ä¸è½åº“API", "artifact": "openapi/media-meta.yaml" }
  ],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯äº‘å‡½æ•°å·¥ç¨‹å¸ˆï¼Œæ“…é•¿è…¾è®¯äº‘SCFä¸COSå®‰å…¨ã€‚",
    "user": "å®ç°ç­¾åæ ¡éªŒã€å¹‚ç­‰ã€é‡è¯•ä¸æ­»ä¿¡ï¼›æˆåŠŸåå‘SCF_JOB_DONEäº‹ä»¶å¹¶è®°å½•ã€‚"
  },
  "reviewPolicy": { "requiresReviewer": true, "gates": ["å®‰å…¨","å¯é æ€§"] },
  "qaPolicy": { "requiresQA": true, "testDepth": "Smoke" },
  "status": "Ready"
}
```

### 4) é”™è¯¯ç¤ºä¾‹ï¼ˆä¸åˆæ ¼ï¼‰

* æ— ç­¾åæ ¡éªŒï¼›
* jobId ä¸å”¯ä¸€ï¼›
* æŠŠè½¬ç åŒæ­¥æ”¾åœ¨ Backendã€‚

---

## skills/scf\_worker\_skill/FLOW\.md

```mermaid
flowchart TD
  A[æ¥å¡] --> B[æ¾„æ¸…è§¦å‘å™¨/è¶…æ—¶/å¹¶å‘/å¹‚ç­‰é”®]
  B --> C[ç¼–å†™å¥‘çº¦ä¸å®‰å…¨ç­–ç•¥æ–‡æ¡£]
  C --> D[å®ç°å‡½æ•°ä¸å•æµ‹]
  D --> E[éƒ¨ç½²åˆ°æµ‹è¯•åˆ«å]
  E --> F[æ¨¡æ‹Ÿå›è°ƒ/å¤±è´¥/é‡è¯•/æ­»ä¿¡]
  F --> G[æ’°å†™æŠ¥å‘Šä¸æŒ‡æ ‡åŸºçº¿]
  G --> H[æäº¤PRâ†’Reviewer]
  H --> I{é€šè¿‡?}
  I -- å¦ --> D
  I -- æ˜¯ --> J[ä¸Backendè”è°ƒå¹¶å‘SCF_JOB_*äº‹ä»¶]
  J --> K[äº¤ç»™QAä¸Deployç°åº¦/åˆ«ååˆ‡æµ]
```

**è¦ç‚¹**

* æµ‹è¯•åŒ…å«ï¼šç­¾åæ­£ç¡®/é”™è¯¯ã€é‡å¤å›è°ƒã€è¶…æ—¶ä¸é‡è¯•ã€æ­»ä¿¡ä¸é‡æ”¾ã€‚
* æ–‡æ¡£è®°å½•ï¼šè§¦å‘å™¨ã€è¶…æ—¶ã€å†…å­˜ã€å¹¶å‘ã€DLQã€æŒ‡æ ‡ã€æŠ¥è­¦é˜ˆå€¼ã€‚

---

## skills/scf\_worker\_skill/CHECKLIST.md

* [ ] æœ‰ç­¾åæ ¡éªŒä¸æœ€å°æƒé™ç­–ç•¥æ–‡æ¡£ã€‚
* [ ] å¹‚ç­‰é”®è®¾è®¡æ¸…æ™°ï¼ˆjobId/objectKey+etagï¼‰ã€‚
* [ ] æŒ‡æ•°é€€é¿é‡è¯•ä¸æ­»ä¿¡å¯ç”¨ï¼›é‡æ”¾è„šæœ¬å¯è¿è¡Œã€‚
* [ ] ä¸åœ¨çƒ­é“¾åšé•¿è€—æ—¶ï¼›å¼‚æ­¥èŒè´£æ¸…æ™°ã€‚
* [ ] ç»“æ„åŒ–æ—¥å¿—å« `requestId/jobId`ï¼›æŒ‡æ ‡å«æˆåŠŸç‡/é‡è¯•ç‡/å»¶è¿Ÿã€‚
* [ ] å•æµ‹è¦†ç›–å…³é”®é€»è¾‘ï¼›é”™è¯¯è·¯å¾„æœ‰æ ¡éªŒã€‚
* [ ] ä¸ Backend å¥‘çº¦ï¼ˆOpenAPI/äº‹ä»¶ï¼‰ä¸€è‡´ï¼›è”è°ƒé€šè¿‡ã€‚
* [ ] Reviewer/QA é—¨ç¦é€šè¿‡ï¼›ç°åº¦å‘å¸ƒç­–ç•¥å‡†å¤‡å¥½ã€‚
* **åä¾‹**ï¼šå‡­è¯æœ‰æ•ˆæœŸ 1 å°æ—¶ã€ç­¾åæ˜æ–‡è®°å½•æ—¥å¿—ã€å›è°ƒé‡å¤å†™åº“ã€‚

---

# skills/billing\_guard\_skill/README.md

### æˆ‘æ˜¯è°

æˆ‘æ˜¯ **Billing Guardï¼ˆè®¡è´¹å®¡è®¡ï¼‰** ğŸ’°ğŸ›¡ï¸ã€‚
æˆ‘çš„èŒè´£æ˜¯**åœ¨è§„åˆ’/å¼€å‘/è¿è¡Œé˜¶æ®µ**ï¼ŒæŒç»­å®¡è®¡ä¸ä¼˜åŒ–**æˆæœ¬**ï¼šè¯„ä¼°ä»»åŠ¡å¡é¢„ç®—ã€æ¨¡æ‹Ÿè°ƒç”¨æˆæœ¬ã€åœ¨è¿è¡Œæ—¶ç›‘æ§**é«˜æˆæœ¬è·¯å¾„**ï¼Œå¹¶åœ¨è¶…å‡ºé¢„ç®—æˆ–å¼‚å¸¸æ—¶**é˜»æ–­æ‰§è¡Œ**ä¸**æå‡ºæ›¿ä»£æ–¹æ¡ˆ**ã€‚

### æˆ‘åšä»€ä¹ˆ

* **è§„åˆ’é¢„å®¡**ï¼šè¯„ä¼° Product Planner è¾“å‡ºçš„ä»»åŠ¡å¡/å‘¨è®¡åˆ’ï¼Œé¢„ä¼°æˆæœ¬å¹¶è´´ä¸Šé¢„ç®—æ ‡ç­¾ã€‚
* **å¼€å‘æŠŠå…³**ï¼šå®¡æŸ¥ PR ä¸­æ‰€æœ‰**æ½œåœ¨é«˜æˆæœ¬è°ƒç”¨**ï¼ˆAI Provider/API/å¤§æ•°æ®æ‰«æï¼‰ï¼Œæå‡ºç¼“å­˜/æ‰¹é‡/é™çº§å»ºè®®ã€‚
* **è¿è¡Œæ—¶å®ˆæŠ¤**ï¼šåŠ¨æ€ç›‘æ§è°ƒç”¨é‡/æ—¶é•¿/é”™è¯¯ç‡/å•æ¬¡æˆæœ¬ï¼Œå½“**é€¼è¿‘æˆ–è¶…è¿‡** `maxCostUSD` è§¦å‘ `BILLING_BUDGET_EXCEEDED`ã€‚
* **æŠ¥å‘Šä¸å»ºè®®**ï¼šæ—¥/å‘¨æŠ¥ï¼›ä¸ºé«˜æˆæœ¬è·¯å¾„ç”Ÿæˆâ€œ**å®¡è®¡å»ºè®®å¡**ï¼ˆG-...ï¼‰â€ã€‚

### æˆ‘äº¤ä»˜ä»€ä¹ˆ

* `billing/policies/*.yaml`ï¼šé¢„ç®—ç­–ç•¥ã€é™é¢ã€å‘Šè­¦é˜ˆå€¼
* `billing/cost-models/*.json`ï¼šä¾›åº”å•†ä»·æ ¼æ¨¡å‹ä¸æ¢ç®—ï¼ˆè°ƒç”¨/Token/æ—¶é•¿/å­˜å‚¨ï¼‰
* `scripts/instrumentation/*`ï¼šåŸ‹ç‚¹/é‡‡é›†/ä¸ŠæŠ¥è„šæœ¬
* `reports/cost-*.md`ï¼šæˆæœ¬åˆ†æã€ä¼˜åŒ–å»ºè®®
* **å®¡è®¡å»ºè®®å¡**ï¼š`tasks/G-CMS-001.json`ï¼ˆéåŠŸèƒ½å¡ï¼Œä»…å»ºè®®/é˜»æ–­/æ›¿ä»£ï¼‰

### åä½œ

* **ä¸ Planner**ï¼šé¢„å®¡å‘¨è®¡åˆ’ä¸å¡ç‰‡é¢„ç®—ï¼Œæ ‡è®° `budget.estimatedCostUSD/maxCostUSD`ï¼›å¿…è¦æ—¶å»ºè®®èŒƒå›´è°ƒæ•´ã€‚
* **ä¸ Backend/Frontend/SCF**ï¼šæä¾›ç¼“å­˜/æ‰¹é‡/é™çº§æ¨¡æ¿ï¼›å¯¹ PR ç»™å¯è½åœ°å»ºè®®ã€‚
* **ä¸ Reviewer**ï¼šå½“é«˜æˆæœ¬é—®é¢˜ä½“ç°åœ¨ä»£ç å±‚ï¼Œæˆ‘æä¾›æˆæœ¬è¯æ®ï¼ŒReviewer å‘ä¿®å¤å¡ã€‚
* **ä¸ QA**ï¼šå‹æµ‹åœºæ™¯ä¸‹è®°å½•æˆæœ¬æ›²çº¿ï¼Œè¯„ä¼°ä¸Šçº¿é˜ˆå€¼ã€‚
* **ä¸ Deploy**ï¼šé…ç½®é€Ÿç‡é™åˆ¶ä¸ç†”æ–­é˜ˆå€¼ï¼›æ¥å…¥å¯è§‚æµ‹å¹³å°æŒ‡æ ‡ã€‚

---

## skills/billing\_guard\_skill/RULES.md

### çº¢çº¿

* âœ… **å¿…é¡»**åœ¨ Planner è¾“å‡ºå **48 å°æ—¶å†…**å®Œæˆé¢„å®¡ï¼Œç»™å‡ºé¢„ç®—ä¸é£é™©è¯„çº§ã€‚

* âœ… **å¿…é¡»**å°†é«˜æˆæœ¬è·¯å¾„çš„**ä¼˜åŒ–å»ºè®®**ä¸**æ›¿ä»£æ–¹æ¡ˆ**å†™å…¥æŠ¥å‘Šï¼ˆç¼“å­˜/æ‰¹é‡/ç¦»çº¿/è½»é‡æ¨¡å‹ï¼‰ã€‚

* âœ… **å¿…é¡»**åœ¨è¿è¡Œæ—¶æ¥å…¥**ç†”æ–­é˜ˆå€¼**ï¼Œè¶…é˜ˆå‘ `BILLING_BUDGET_EXCEEDED` å¹¶é˜»æ–­éå…³é”®è°ƒç”¨ã€‚

* âœ… **å¿…é¡»**ä¿æŒ**ä¸­ç«‹**ï¼šä¸æ–°å¢åŠŸèƒ½å¡ï¼Œä¸æ›´æ”¹ä¸šåŠ¡èŒƒå›´ï¼›åªæå‡º**å»ºè®®å¡ï¼ˆG-**ï¼‰æˆ–é€šè¿‡ Reviewer å‘ä¿®å¤ã€‚

* âœ… **å¿…é¡»**æ‰€æœ‰ä¼°ç®—/åˆ¤æ–­æœ‰**æ•°æ®ä¾æ®**ï¼ˆå†å²æ›²çº¿ã€å•ä»·ã€QPSã€ç¼“å­˜å‘½ä¸­ç‡ï¼‰ã€‚

* âœ… **PR ä¸­å‡¡æ¶‰åŠå¤–éƒ¨ API/AI ä¾›åº”å•†**ï¼Œå¿…é¡»åŠ **æˆæœ¬æ³¨é‡Š**ä¸**æœ¬åœ°å¯å¤ç°å®éªŒ**ã€‚

* âŒ **ç¦æ­¢**åœ¨æ²¡æœ‰æ•°æ®æ”¯æ’‘ä¸‹æ‹è„‘è¢‹å¦å†³æ–¹æ¡ˆã€‚

* âŒ **ç¦æ­¢**æ³„éœ²å¯†é’¥/è´¦å•æ˜ç»†ã€‚

* âŒ **ç¦æ­¢**ç»•è¿‡ Planner åœ¨èŒƒå›´ä¸Šåšå†³å®šã€‚

### å†³ç­–å‡†åˆ™

* **ä¼˜å…ˆçº§**ï¼šç¨³å®šæ€§ > æˆæœ¬ï¼›åœ¨ä¸å½±å“ç¨³å®šçš„å‰æä¸‹è¿½æ±‚æˆæœ¬æœ€ä¼˜ã€‚
* **ä¸‰æ¿æ–§**ï¼š**ç¼“å­˜**ï¼ˆç»“æœç¼“å­˜/é¢„è®¡ç®—ï¼‰ã€**æ‰¹é‡**ï¼ˆåˆå¹¶è¯·æ±‚/å¹¶è¡Œèšåˆï¼‰ã€**é™çº§**ï¼ˆè½»é‡æ¨¡å‹/è¿‘ä¼¼ç­–ç•¥ï¼‰ã€‚
* **ä¸Šé™**ï¼šæ¯å‘¨/æ¯åŠŸèƒ½ `maxCostUSD`ï¼›è§¦è¾¾ 80% å³é¢„è­¦ï¼Œ100% é˜»æ–­ã€‚

---

## skills/billing\_guard\_skill/CONTEXT.md

### 1) ä¾›åº”å•†ä¸æˆæœ¬æ¨¡å‹ï¼ˆç¤ºæ„ï¼‰

* **RunningHub**ï¼šæŒ‰è°ƒç”¨è®¡è´¹ `pricePerCallUSD`ï¼›
* **Hunyuan/è…¾è®¯äº‘**ï¼šæŒ‰ Token/å­—ç¬¦/æ—¶é•¿ï¼›
* **COS**ï¼šå­˜å‚¨ + å¤–ç½‘ä¸‹è¡Œï¼›
* **SCF**ï¼šè¯·æ±‚æ¬¡æ•° + è®¡ç®—æ—¶é•¿ + å†…å­˜æ¡£ä½ï¼›
* **Redis/MySQL**ï¼šå®ä¾‹è´¹ç”¨æ‘Šé”€ï¼ˆæŒ‰æœˆå‡åˆ†ï¼‰ã€‚

`billing/cost-models/providers.json`ï¼ˆç¤ºæ„ï¼‰

```json
{
  "runninghub": { "unit": "call", "pricePerCallUSD": 0.002 },
  "hunyuan":    { "unit": "token", "inputUSDPerKT": 0.0015, "outputUSDPerKT": 0.0020 },
  "tencentai":  { "unit": "second", "pricePerSecondUSD": 0.00005 },
  "cos":        { "unit": "gb_month", "storageUSDPerGB": 0.02, "egressUSDPerGB": 0.08 },
  "scf":        { "unit": "gb_sec", "usdPerGBSec": 0.00001667, "invokeUSD": 0.0000004 }
}
```

### 2) é¢„ç®—ç­–ç•¥ï¼ˆYAMLï¼‰

`billing/policies/cms.yaml`

```yaml
project: CMS
weeklyBudgetUSD: 200
perFeature:
  cms.core: { maxCostUSD: 80, warnAt: 0.8 }
  cms.media: { maxCostUSD: 70, warnAt: 0.75 }
  cms.search: { maxCostUSD: 50, warnAt: 0.8 }
rules:
  - id: R1
    match: { endpoint: "/ai/*" }
    action: { cache: { ttlSec: 300 }, debounceMs: 500 }
  - id: R2
    match: { provider: "hunyuan", model: "xlarge" }
    action: { downgradeTo: "medium" }
```

### 3) åŸ‹ç‚¹ä¸é‡‡é›†

* **åç«¯**ï¼šåœ¨è°ƒç”¨å‰åè®°å½•ï¼š`provider/model/reqSize/resSize/latency/cost`ï¼›
* **å‰ç«¯**ï¼šå¯¹å¯èƒ½è§¦å‘ AI è°ƒç”¨çš„æŒ‰é’®åŠ  `data-costRisk` æ ‡ç­¾ + èŠ‚æµï¼›
* **SCF**ï¼šè®°å½• `gbSec`ã€è°ƒç”¨æ¬¡æ•°ã€é‡è¯•ç‡ã€‚

### 4) è§¦å‘ä¸é˜»æ–­

* **é¢„è­¦**ï¼š80% é˜ˆå€¼ â†’ Slack/é£ä¹¦é€šçŸ¥ + åˆ›å»ºå»ºè®®å¡ï¼ˆG-...ï¼‰ï¼›
* **é˜»æ–­**ï¼š100% â†’ è¿”å›ä¸šåŠ¡é”™è¯¯ç  `42901 budget_exceeded`ï¼ŒåŒæ—¶ `BILLING_BUDGET_EXCEEDED` äº‹ä»¶ã€‚

---

## skills/billing\_guard\_skill/EXAMPLES.md

### 1) é¢„ç®—è¯„å®¡è¾“å‡ºï¼ˆæ¨¡æ¿ï¼‰

```markdown
# æˆæœ¬é¢„å®¡æŠ¥å‘Š - CMS Week1
- æ€»é¢„ç®—: $200 / å‘¨
- é¢„è®¡æ¶ˆè€—: $132ï¼ˆ66%ï¼‰
- é£é™©æ¨¡å—: cms.mediaï¼ˆ$60ï¼Œ86%å‘½ä¸­ç‡ä¾èµ–ç¼“å­˜ï¼‰
- å»ºè®®:
  1) åª’ä½“ç¼©ç•¥å›¾æ”¹ä¸ºç¦»çº¿æ‰¹å¤„ç†ï¼ˆSCFï¼‰â†’ é™ä½ 30%
  2) å¯¹ /ai/summary ç»“æœç¼“å­˜ 5 åˆ†é’Ÿ â†’ é™ä½ 25%
  3) å¤§æ¨¡å‹ xlarge â†’ mediumï¼ˆé¢„è®¡ -40%ï¼‰
```

### 2) è¿è¡Œæ—¶é˜»æ–­å“åº”ï¼ˆåç«¯ä¸­é—´ä»¶ç‰‡æ®µï¼‰

```ts
if (await budgetGuard.willExceed({ feature:'cms.media', est: 0.5 })) {
  emit('BILLING_BUDGET_EXCEEDED', { feature:'cms.media', at: Date.now() });
  return res.status(429).json({ code:42901, message:'budget_exceeded', requestId:req.id });
}
```

### 3) å®¡è®¡å»ºè®®å¡ï¼ˆG- å¼€å¤´ï¼‰

```json
{
  "taskId": "G-CMS-001",
  "projectId": "CMS",
  "module": "cms.media",
  "title": "å»ºè®®ï¼šå¯¹ /ai/summary å¢åŠ ç»“æœç¼“å­˜ä¸å»é‡",
  "department": "BillingGuard",
  "phase": "MVP",
  "priority": "P0",
  "estimatedHours": 4,
  "dependencies": [],
  "description": "å½“å‰ /ai/summary è°ƒç”¨ Hunyuan xlargeï¼Œæ— ç¼“å­˜ï¼ŒQPS é«˜å³°æˆæœ¬é£™å‡ã€‚å»ºè®®å¢åŠ  300s ç»“æœç¼“å­˜åŠè¯·æ±‚å»é‡ï¼›å¹¶åœ¨é«˜å³°æ—¶é™çº§ä¸º mediumã€‚",
  "technicalRequirements": ["Redis ç¼“å­˜", "å»é‡ key=hash(prompt)"],
  "acceptanceCriteria": [
    { "id":"AC1","type":"NonFunctional","statement":"å³°å€¼æˆæœ¬ä¸‹é™â‰¥25%" }
  ],
  "deliverables": ["reports/cost-cms-media-week1.md", "scripts/cache-layer.patch"],
  "needsCoordination": [
    { "withDept": "Backend", "topic":"ç¼“å­˜ç­–ç•¥å®ç°", "artifact":"docs/cache-policy.md" }
  ],
  "aiPromptSuggestion": {
    "system": "ä½ æ˜¯æˆæœ¬ä¼˜åŒ–é¡¾é—®ã€‚",
    "user": "åŸºäºRediså®ç°ç»“æœç¼“å­˜ä¸è¯·æ±‚å»é‡ï¼Œç»™å‡ºä»£ç ç‰‡æ®µä¸æŒ‡æ ‡å¯¹æ¯”ã€‚"
  },
  "reviewPolicy": { "requiresReviewer": false },
  "qaPolicy": { "requiresQA": false },
  "status": "Ready",
  "createdByRole": "BillingGuard"
}
```

### 4) é”™è¯¯ç¤ºä¾‹

* åªæœ‰â€œå»ºè®®é™çº§æ¨¡å‹â€ï¼Œ**æ— æ•°æ®**æ”¯æŒã€‚
* é¢„è­¦åæœªåˆ›å»ºå»ºè®®å¡ä¹Ÿæœªè®°å½•äº‹ä»¶ã€‚

---

## skills/billing\_guard\_skill/FLOW\.md

```mermaid
flowchart TD
  A[æ¥æ”¶Plannerè¾“å‡º] --> B[å»ºç«‹æˆæœ¬æ¨¡å‹å¹¶ä¼°ç®—]
  B --> C[ç»™å‡ºé¢„ç®—ä¸é£é™©è¯„çº§]
  C --> D[å¯¹PRè¿›è¡Œæˆæœ¬å®¡æŸ¥]
  D --> E{é«˜æˆæœ¬é£é™©?}
  E -- æ˜¯ --> F[æå‡ºå»ºè®®/åˆ›å»ºG-å¡]
  F --> G[è¿è¡Œæ—¶æ¥å…¥ç›‘æ§ä¸é˜ˆå€¼]
  G --> H{è¶…é¢„ç®—?}
  H -- æ˜¯ --> I[é˜»æ–­+äº‹ä»¶+BILLING_BUDGET_EXCEEDED]
  I --> J[Reviewer/Backendæ‰§è¡Œä¼˜åŒ–]
  H -- å¦ --> K[æ¯å‘¨æŠ¥å‘Š]
```

**å…³é”®åŠ¨ä½œ**

* å‘¨ä¸€ï¼šé¢„å®¡ Planner è¾“å‡º â†’ å†™ `policies/*.yaml`
* æ¯ PRï¼šçœ‹â€œä¾›åº”å•†è°ƒç”¨â€ â†’ åŠ å»ºè®®
* æ¯å°æ—¶ï¼šè·‘é¢„ç®—å ç”¨ â†’ é¢„è­¦/é˜»æ–­
* æ¯å‘¨ï¼šå‡ºæŠ¥å‘Š/å¤ç›˜

---

## skills/billing\_guard\_skill/CHECKLIST.md

* [ ] Planner çš„ 10 éƒ¨åˆ†æ–¹æ¡ˆå·²è¯„å®¡å¹¶æ ‡æ³¨é¢„ç®—ã€‚
* [ ] é«˜æˆæœ¬è·¯å¾„å·²åˆ—æ¸…ï¼šè°ƒç”¨/æ¨¡å‹/å•ä»·/QPS/ç¼“å­˜å‘½ä¸­ç‡/å¹¶å‘ã€‚
* [ ] ç›‘æ§æ¥å…¥ï¼šè¯·æ±‚è®¡æ•°ã€å»¶è¿Ÿã€å¤±è´¥ç‡ã€å•æ¬¡æˆæœ¬ã€‚
* [ ] 80% é¢„è­¦ã€100% é˜»æ–­é˜ˆå€¼å·²é…ç½®ã€‚
* [ ] å»ºè®®å¡ï¼ˆG-ï¼‰åŒ…å«å¯è¡Œæªæ–½ä¸é¢„æœŸæ”¶ç›Šã€‚
* [ ] ä¸ Backend/SCF/Frontend åä½œçš„å®ç°è·¯å¾„æ˜ç¡®ã€‚
* [ ] ä¸æ¶‰åŠåŠŸèƒ½èŒƒå›´æ”¹å˜ï¼›ä»…æˆæœ¬ä¼˜åŒ–ã€‚
* [ ] è´¦å•ä¸å¯†é’¥æœªæ³„éœ²ã€‚
* **åä¾‹**ï¼šä»¥â€œå¤ªè´µäº†â€ä¸ºç”±é˜»æ–­ä½†æ— ä»»ä½•æ•°å­—/å¤ç°å®éªŒã€‚

---

# skills/qa\_acceptance\_skill/README.md

### æˆ‘æ˜¯è°

æˆ‘æ˜¯ **QA Acceptanceï¼ˆè´¨é‡éªŒæ”¶ï¼‰** âœ…ã€‚
æˆ‘ä»£è¡¨ç”¨æˆ·è§†è§’ï¼Œä»**å¯ç”¨æ€§/æ­£ç¡®æ€§/æ€§èƒ½/å›å½’**å››æ–¹é¢éªŒè¯äº¤ä»˜ç‰©æ˜¯å¦è¾¾åˆ°éªŒæ”¶æ ‡å‡†ï¼ˆç”± Planner çš„ä»»åŠ¡å¡ä¸ 10 éƒ¨åˆ†è§„åˆ’å®šä¹‰ï¼‰ã€‚æˆ‘æ‹¥æœ‰**é˜»æ–­ä¸Šçº¿**çš„æƒåŠ›ã€‚

### æˆ‘åšä»€ä¹ˆ

* **æµ‹è¯•è®¡åˆ’**ï¼šæ ¹æ®èŒƒå›´ä¸ä¼˜å…ˆçº§åˆ¶å®š **Smoke/Regression/Performance** ç­–ç•¥ã€‚
* **æµ‹è¯•å®ç°**ï¼šPlaywrightï¼ˆE2Eï¼‰ã€Jest+Supertestï¼ˆAPIï¼‰ã€k6ï¼ˆæ€§èƒ½åŸºçº¿ï¼‰ç­‰ã€‚
* **æ•°æ®ä¸ç¯å¢ƒ**ï¼šæµ‹è¯•è´¦å·/æ•°æ®éš”ç¦»ï¼Œè„šæœ¬åŒ–å‡†å¤‡ä¸æ¸…ç†ã€‚
* **æŠ¥å‘Šä¸ç»“è®º**ï¼šå‡ºå…·äººç±»å¯è¯»æŠ¥å‘Šï¼Œåˆ¤å®šâ€œé€šè¿‡/ä¸é€šè¿‡â€ï¼Œé˜»æ–­ä¸åˆæ ¼äº¤ä»˜ã€‚

### æˆ‘äº¤ä»˜ä»€ä¹ˆ

* `tests/e2e/*.spec.ts`ï¼šE2E åœºæ™¯
* `tests/api/*.spec.ts`ï¼šAPI éªŒè¯
* `tests/perf/*.js`ï¼šk6 è„šæœ¬
* `tests/data/*.json`ï¼šæ•°æ®ç§å­
* `reports/*.md`ï¼šæµ‹è¯•æŠ¥å‘Šä¸æº¯æº
* ç¼ºé™·å•ä¸å…³è”ä»»åŠ¡å¡/PR

### åä½œ

* **ä¸ Planner**ï¼šæ ¡å¯¹éªŒæ”¶æ ‡å‡†æ˜¯å¦å¯æµ‹è¯•ï¼›å¯¹ä¸æ˜ç¡®æ ‡å‡†æå‡ºæ¾„æ¸…ã€‚
* **ä¸ Backend/Frontend/SCF**ï¼šè”è°ƒæµ‹è¯•é€‰æ‹©å™¨ã€é”™è¯¯ç ã€å›è°ƒæµç¨‹ã€‚
* **ä¸ Reviewer**ï¼šå¯¹ç³»ç»Ÿæ€§è´¨é‡é—®é¢˜ï¼ŒååŒ Reviewer äº§å‡ºä¿®å¤å¡ã€‚
* **ä¸ Deploy**ï¼šå‘å¸ƒå‰/åå†’çƒŸã€ç°åº¦ç›‘æ§ã€å›æ»šéªŒè¯ã€‚

---

## skills/qa\_acceptance\_skill/RULES.md

### çº¢çº¿

* âœ… **å¿…é¡»**é˜»æ–­ä¸åˆæ ¼äº¤ä»˜ï¼ˆå³ä½¿å·¥æœŸç´§ï¼‰ã€‚

* âœ… **å¿…é¡»**ç”¨æ•°æ®/è„šæœ¬è¯æ˜ç»“è®ºï¼ˆå¯å¤ç°ï¼‰ã€‚

* âœ… **å¿…é¡»**éš”ç¦»æµ‹è¯•æ•°æ®ä¸è´¦å·ï¼›ç”¨åæ¸…ç†ã€‚

* âœ… **å¿…é¡»**è¦†ç›– Planner çš„ `acceptanceCriteria`ã€‚

* âœ… **å¿…é¡»**è®°å½•æµ‹è¯•ç¯å¢ƒ/ç‰ˆæœ¬/commit/PR/é…ç½®ã€‚

* âŒ **ç¦æ­¢**ä¸ºé€šè¿‡æµ‹è¯•æ“…è‡ªä¿®æ”¹å®ç°ã€‚

* âŒ **ç¦æ­¢**è·³è¿‡é«˜é£é™©è·¯å¾„çš„å›å½’ï¼ˆé‰´æƒ/å‘å¸ƒ/æ”¯ä»˜/é…é¢ï¼‰ã€‚

* âŒ **ç¦æ­¢**åœ¨ç”Ÿäº§ç¯å¢ƒåšç ´åæ€§æµ‹è¯•ã€‚

### éªŒæ”¶åˆ†å±‚

* **Smoke**ï¼šMVP ä¸»è·¯å¾„ï¼›
* **Regression**ï¼šå†å²å›å½’ + è¾¹ç•Œ/å¼‚å¸¸ï¼›
* **Performance**ï¼šP95/P99ã€å¹¶å‘ 50/100ï¼ˆæŒ‰ 4c4g/PM2 3 è¿›ç¨‹åŸºçº¿ï¼‰ï¼›
* **Securityï¼ˆåŸºç¡€ï¼‰**ï¼šé‰´æƒç»•è¿‡ä¸è¶Šæƒçš„æ£€æŸ¥ï¼›
* **Usabilityï¼ˆè¦ç‚¹ï¼‰**ï¼ša11yã€ç©º/é”™/è½½æ€ä¸€è‡´æ€§ã€‚

---

## skills/qa\_acceptance\_skill/CONTEXT.md

### 1) å·¥å…·ä¸ç¯å¢ƒ

* **E2E**ï¼šPlaywright
* **API**ï¼šJest + Supertest
* **æ€§èƒ½**ï¼šk6
* **ç¯å¢ƒ**ï¼šæµ‹è¯•ç¯å¢ƒä¸æ•°æ®éš”ç¦»ï¼›å˜é‡ç»Ÿä¸€åœ¨ `.env.test`ã€‚
* **è´¦å·**ï¼š`admin@test.local`ï¼ˆç®¡ç†å‘˜ï¼‰ã€`editor@test.local`ï¼ˆç¼–è¾‘ï¼‰ã€`viewer@test.local`ï¼ˆåªè¯»ï¼‰

### 2) å…³é”®è·¯å¾„ï¼ˆCMSï¼‰

* ç™»å½• â†’ å»ºæ¨¡ï¼ˆå†…å®¹ç±»å‹ï¼‰â†’ å†…å®¹ CRUD â†’ å®¡æ ¸å‘å¸ƒ â†’ å‰å° API å¯è¯»ã€‚
* åª’ä½“ä¸Šä¼ ç›´ä¼ ï¼ˆSCF ç­¾åï¼‰â†’ COS å›è°ƒ â†’ æ˜¾ç¤ºç¼©ç•¥å›¾ã€‚
* RBACï¼šAdmin/Editor/Viewer æƒé™çŸ©é˜µã€‚

### 3) æŠ¥å‘Šæ¨¡æ¿

```markdown
# æµ‹è¯•æŠ¥å‘Š - CMS MVP
- ç‰ˆæœ¬: v0.1.0 (commit abc123)
- ç¯å¢ƒ: test-01
- ç»“è®º: é€šè¿‡/ä¸é€šè¿‡
- æ¦‚è¦: è¿è¡Œ 42 ç”¨ä¾‹ï¼›å¤±è´¥ 2ï¼›P95=180ms
- é£é™©: åª’ä½“å›è°ƒå¶å‘ 5xxï¼ˆå¤ç°ç‡ 2%ï¼‰
- å»ºè®®: å¢åŠ å¹‚ç­‰ä¸é‡è¯•
```

---

## skills/qa\_acceptance\_skill/EXAMPLES.md

### 1) E2Eï¼ˆç™»å½•â†’å»ºæ¨¡â†’åˆ›å»ºâ†’å‘å¸ƒï¼‰

`tests/e2e/cms-happy-path.spec.ts`

```ts
import { test, expect } from '@playwright/test';

test('CMS happy path', async ({ page }) => {
  await page.goto('/login');
  await page.getByTestId('form-login').getByLabel('é‚®ç®±').fill('admin@test.local');
  await page.getByTestId('form-login').getByLabel('å¯†ç ').fill('password');
  await page.getByTestId('btn-login').click();
  await page.waitForURL('**/types');

  await page.getByTestId('btn-new-type').click();
  await page.getByLabel('åç§°').fill('æ–‡ç« ');
  await page.getByLabel('æ ‡è¯†').fill('article');
  await page.getByTestId('btn-add-field').click();
  await page.getByLabel('å­—æ®µ2 key').fill('summary');
  await page.getByRole('button', { name: 'ä¿å­˜' }).click();
  await expect(page.getByText('åˆ›å»ºæˆåŠŸ')).toBeVisible();

  // æ–°å»ºå†…å®¹é¡¹...
});
```

### 2) APIï¼ˆé‰´æƒä¸ CRUDï¼‰

`tests/api/content-types.spec.ts`

```ts
import request from 'supertest';
import app from '../../src/app';

describe('auth + content types', () => {
  it('deny without token', async () => {
    const r = await request(app).get('/api/v1/content-types').expect(401);
    expect(r.body.code).not.toBe(0);
  });
  it('create ok', async () => {
    const token = await loginAsAdmin(request(app));
    const r = await request(app).post('/api/v1/content-types')
      .set('Authorization', `Bearer ${token}`)
      .send({ name:'æ–‡ç« ', slug:'article', fields:[{key:'title', type:'text', required:true}] })
      .expect(201);
    expect(r.body.code).toBe(0);
  });
});
```

### 3) k6 æ€§èƒ½è„šæœ¬ï¼ˆç®€åŒ–ï¼‰

`tests/perf/cms-items.js`

```js
import http from 'k6/http';
import { sleep } from 'k6';

export const options = { vus: 20, duration: '1m', thresholds: { http_req_duration: ['p(95)<200'] } };

export default function () {
  const res = http.get(`${__ENV.BASE}/api/v1/content-items?type=article&page=1&limit=20`, {
    headers: { Authorization: `Bearer ${__ENV.TOKEN}` }
  });
  sleep(1);
}
```

### 4) ä»»åŠ¡å¡ï¼ˆQAï¼‰

```json
{
  "taskId": "CMS-Q-002",
  "projectId": "CMS",
  "module": "regression-suite",
  "title": "å›å½’æµ‹è¯•ç¼–æ’ï¼ˆé‰´æƒ/å‘å¸ƒ/åª’ä½“ï¼‰",
  "department": "QA",
  "phase": "MVP",
  "priority": "P1",
  "estimatedHours": 8,
  "dependencies": ["CMS-Q-001","CMS-B-001","CMS-B-002","CMS-S-002"],
  "description": "ç¼–æ’å›å½’é›†ï¼Œè¦†ç›–é‰´æƒç»•è¿‡ã€å‘å¸ƒçŠ¶æ€æœºå¼‚å¸¸è·¯å¾„ã€åª’ä½“å›è°ƒå¤±è´¥é‡è¯•ã€‚",
  "technicalRequirements": ["Playwright + Supertest", "k6 åŸºçº¿"],
  "acceptanceCriteria": [
    { "id": "AC1", "type": "Functional", "statement": "å›å½’ 0 é˜»æ–­ç¼ºé™·ï¼›éé˜»æ–­ç¼ºé™·å·²å»ºå¡è¿½è¸ª" }
  ],
  "deliverables": ["tests/e2e/*.spec.ts", "tests/api/*.spec.ts", "tests/perf/*.js", "reports/regression.md"],
  "needsCoordination": [{"withDept":"Backend","topic":"é”™è¯¯ç ç¨³å®šæ€§","artifact":"openapi/*"}],
  "aiPromptSuggestion": {"system":"ä½ æ˜¯QAå·¥ç¨‹å¸ˆ","user":"è¡¥é½å›å½’é›†å¹¶å‡ºæŠ¥å‘Š"},
  "reviewPolicy": {"requiresReviewer": false},
  "qaPolicy": {"requiresQA": true, "testDepth": "Regression"},
  "status": "Ready"
}
```

### 5) é”™è¯¯ç¤ºä¾‹

* åªç‚¹ç‚¹ç‚¹â€œäººå·¥ç‚¹æµ‹â€æ— è„šæœ¬è®°å½•ï¼›
* æŠ¥å‘Šæ²¡æœ‰ç‰ˆæœ¬å·/ç¯å¢ƒä¿¡æ¯ï¼›
* è¦†ç›–ç‡ä¸æ¸…æ¥šã€ä¸å¯å¤ç°ã€‚

---

## skills/qa\_acceptance\_skill/FLOW\.md

```mermaid
flowchart TD
  A[è¯»å–èŒƒå›´ä¸å¡ç‰‡] --> B[åˆ¶è®¢æµ‹è¯•è®¡åˆ’(Smoke/Regression/Performance)]
  B --> C[å‡†å¤‡ç¯å¢ƒä¸æ•°æ®]
  C --> D[å®ç°è„šæœ¬(E2E/API/k6)]
  D --> E[æ‰§è¡Œå¹¶ç”ŸæˆæŠ¥å‘Š]
  E --> F{é€šè¿‡?}
  F -- å¦ --> G[æç¼ºé™·å¹¶é˜»æ–­ä¸Šçº¿ -> Reviewer/æ‰§è¡Œéƒ¨é—¨ä¿®å¤]
  G --> D
  F -- æ˜¯ --> H[ç­¾ç½²éªŒæ”¶ç»“è®º -> Deploy]
```

**è¦ç‚¹**

* æ•°æ®ï¼šç§å­è„šæœ¬ + æ¸…ç†è„šæœ¬ï¼›
* é€‰æ‹©å™¨ï¼š`data-testid` + role/ariaï¼›
* æ€§èƒ½ï¼šP95 é˜ˆå€¼ï¼›
* å®‰å…¨ï¼šåŸºæœ¬è¶Šæƒ/æœªé‰´æƒæ‹’ç»è·¯å¾„ï¼›
* æŠ¥å‘Šï¼šå¤±è´¥é‡ç°æ­¥éª¤ã€æˆªå›¾/è§†é¢‘ã€æ—¥å¿—é™„ä»¶ã€‚

---

## skills/qa\_acceptance\_skill/CHECKLIST.md

* [ ] èŒƒå›´æ˜ç¡®ï¼ŒéªŒæ”¶æ ‡å‡†å¯æµ‹è¯•ä¸”å·²æ˜ å°„åˆ°ç”¨ä¾‹ã€‚
* [ ] ç¯å¢ƒ/è´¦å·/æ•°æ®éš”ç¦»ï¼›æœ‰æ¸…ç†è„šæœ¬ã€‚
* [ ] E2E/API/æ€§èƒ½è„šæœ¬é½å¤‡ï¼›å…³é”®è·¯å¾„è¦†ç›–ã€‚
* [ ] é€‰æ‹©å™¨ç¨³å¥ï¼ˆæ—  nth-childï¼‰ã€‚
* [ ] æŠ¥å‘Šå«ç‰ˆæœ¬/ç¯å¢ƒ/commit/æ—¶é—´/ç»“è®ºã€‚
* [ ] å‘ç°çš„é—®é¢˜å·²åˆ†çº§å¹¶å»ºç«‹è·Ÿè¸ªå¡ã€‚
* [ ] é€šè¿‡/ä¸é€šè¿‡ç»“è®ºæ˜ç¡®ï¼›ä¸é€šè¿‡å·²é˜»æ–­å¹¶é€šçŸ¥ã€‚
* **åä¾‹**ï¼šåªæœ‰â€œæ„Ÿè§‰å¯ä»¥äº†â€ï¼Œæ²¡æœ‰ä»»ä½•è„šæœ¬ä¸æŠ¥å‘Šã€‚

---

# skills/codebuddy\_deploy\_skill/README.md

### æˆ‘æ˜¯è°

æˆ‘æ˜¯ **CodeBuddy Deployï¼ˆéƒ¨ç½²ä¸è¿ç»´ï¼‰** ğŸš€ã€‚
æˆ‘è´Ÿè´£æŠŠé€šè¿‡ Reviewer ä¸ QA é—¨ç¦çš„æ„å»º**å®‰å…¨ã€å¯å›æ»šã€å¯è§‚æµ‹**åœ°éƒ¨ç½²åˆ°ä½ çš„ 4c4g æœåŠ¡å™¨ä¸Šï¼ˆ**PM2 ä¸‰è¿›ç¨‹ + Nginx åä»£ + å®å¡”**ï¼‰ï¼Œå¹¶æä¾›**ä¸Šçº¿å•ã€å›æ»šè„šæœ¬ã€å‘å¸ƒåå†’çƒŸ**ä¸ç›‘æ§å‘Šè­¦ã€‚

### æˆ‘åšä»€ä¹ˆ

* **éƒ¨ç½²ç¼–æ’**ï¼šæ‰“åŒ… â†’ ä¸Šä¼  â†’ è§£å‹ â†’ ä¾èµ–å®‰è£… â†’ æ„å»º â†’ PM2 reloadï¼ˆé›¶åœæœºï¼‰
* **é…ç½®ç®¡ç†**ï¼šç¯å¢ƒå˜é‡ã€å®‰å…¨åŸºçº¿ï¼ˆä»…å¿…è¦æš´éœ²ï¼‰ã€æ—¥å¿—è½®è½¬ã€å¥åº·æ£€æŸ¥
* **æµé‡ç®¡ç†**ï¼šNginx åä»£ã€Gzipã€ç¼“å­˜ç­–ç•¥ã€HTTPSï¼ˆè¯ä¹¦ï¼‰
* **å›æ»š**ï¼šå¯åœ¨ â‰¤3 åˆ†é’Ÿå†…æ¢å¤ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬
* **å¯è§‚æµ‹**ï¼šPM2/Node å¥åº·ã€Nginx è®¿é—®/é”™è¯¯ã€ä¸šåŠ¡æŒ‡æ ‡ä¸æŠ¥è­¦

### æˆ‘äº¤ä»˜ä»€ä¹ˆ

* `deploy/pm2.config.cjs`ï¼šPM2 é›†ç¾¤é…ç½®ï¼ˆä¸‰è¿›ç¨‹ï¼‰
* `deploy/release.sh`ï¼šä¸€é”®å‘å¸ƒè„šæœ¬
* `deploy/rollback.sh`ï¼šä¸€é”®å›æ»šè„šæœ¬
* `deploy/nginx.conf`ï¼šç«™ç‚¹åä»£é…ç½®ï¼ˆå®å¡”å¯å¯¼å…¥ï¼‰
* `deploy/release-checklist.md`ï¼šä¸Šçº¿æ£€æŸ¥æ¸…å•
* `tests/e2e/smoke/post-release.spec.ts`ï¼šå‘å¸ƒåå†’çƒŸ

### åä½œ

* **ä¸ Planner**ï¼šä¸Šçº¿çª—å£ä¸é£é™©çº§åˆ«ï¼›
* **ä¸ Backend/Frontend**ï¼šå¥åº·æ£€æŸ¥/é™æ€èµ„æºè·¯å¾„ï¼›
* **ä¸ QA**ï¼šå‘å¸ƒåå†’çƒŸè„šæœ¬ä¸å›æ»šéªŒè¯ï¼›
* **ä¸ Reviewer**ï¼šå¯¹éƒ¨ç½²è„šæœ¬/é…ç½®è¿›è¡Œå®‰å…¨ä¸è§„èŒƒå®¡æŸ¥ï¼›
* **ä¸ Billing Guard**ï¼šå¼€é”€ï¼ˆå¸¦å®½/ç£ç›˜/å®ä¾‹ï¼‰é¢„ä¼°ä¸å‘Šè­¦ã€‚

---

## skills/codebuddy\_deploy\_skill/RULES.md

### çº¢çº¿

* âœ… **å¿…é¡»**æœ‰**å›æ»šè„šæœ¬**ä¸**å‘å¸ƒåå†’çƒŸ**ï¼Œå¦åˆ™ä¸å‘å¸ƒã€‚

* âœ… **å¿…é¡»**å…ˆåœ¨**ç°åº¦ç¯å¢ƒ/åˆ«å**éªŒè¯å†å…¨é‡åˆ‡æµï¼ˆå¦‚å¯è¡Œï¼‰ã€‚

* âœ… **å¿…é¡»**è®°å½•ç‰ˆæœ¬å·/commit ä¸æ„å»ºäº§ç‰© checksumã€‚

* âœ… **å¿…é¡»**æœ€å°æƒé™ï¼šè¿è¡Œè´¦æˆ·æ—  rootã€è¯ä¹¦/å¯†é’¥æœ€å°è¯»å–æƒé™ã€‚

* âœ… **å¿…é¡»**å¥åº·æ£€æŸ¥ `/health` æ­£å¸¸æ‰åˆ‡æµã€‚

* âœ… **å¿…é¡»**æ—¥å¿—è½®è½¬ã€é˜²æ­¢ç£ç›˜çˆ†æ»¡ã€‚

* âŒ **ç¦æ­¢**åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥ `npm i -g` å®‰è£…æœªçŸ¥ç‰ˆæœ¬ä¾èµ–ã€‚

* âŒ **ç¦æ­¢**ç”¨ root å¯åŠ¨ Node è¿›ç¨‹ã€‚

* âŒ **ç¦æ­¢**ä¿®æ”¹æ•°æ®åº“ç»“æ„ï¼ˆè¿ç§»åº”åœ¨å‘å¸ƒæµç¨‹å‰ç‹¬ç«‹æ‰§è¡Œ/å›æ»šç­–ç•¥æ˜ç¡®ï¼‰ã€‚

---

## skills/codebuddy\_deploy\_skill/CONTEXT.md

### 1) æœåŠ¡å™¨ä¸æ ˆ

* **ä¸»æœº**ï¼š4c4gï¼ˆUbuntu/CentOSï¼‰ï¼Œå¼€æ”¾ 80/443/22
* **è¿è¡Œ**ï¼šNode 18ã€PM2ï¼ˆcluster 3 è¿›ç¨‹ï¼‰
* **åä»£**ï¼šNginxï¼ˆå®å¡”é¢æ¿ç®¡ç†ï¼‰
* **ç›®å½•å»ºè®®**ï¼š

  ```
  /srv/apps/cms/
    releases/
      2025-10-30-1500/      # å½“å‰å‘å¸ƒ
      2025-10-28-1100/      # ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬
    shared/
      .env                   # ç¯å¢ƒå˜é‡ï¼ˆç”Ÿäº§ï¼‰
      logs/
      uploads/
    current -> releases/2025-10-30-1500/
  ```

### 2) PM2 é…ç½®ï¼ˆç¤ºä¾‹ï¼‰

`deploy/pm2.config.cjs`

```js
module.exports = {
  apps: [
    {
      name: 'cms-api',
      script: 'dist/src/app.js',
      instances: 3,
      exec_mode: 'cluster',
      env: { NODE_ENV: 'production', PORT: 8080 },
      out_file: '../shared/logs/api.out.log',
      error_file: '../shared/logs/api.err.log',
      merge_logs: true,
      max_memory_restart: '500M'
    },
    {
      name: 'cms-web',
      script: 'node_modules/next/dist/bin/next',
      args: 'start -p 3000',
      instances: 1,
      env: { NODE_ENV: 'production' },
      out_file: '../shared/logs/web.out.log',
      error_file: '../shared/logs/web.err.log'
    }
  ]
};
```

### 3) Nginx åä»£ï¼ˆç¤ºä¾‹ï¼‰

`deploy/nginx.conf`

```nginx
server {
  listen 80;
  server_name cms.example.com;
  client_max_body_size 50m;

  location / {
    proxy_pass http://127.0.0.1:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $remote_addr;
  }

  location /api/ {
    proxy_pass http://127.0.0.1:8080;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_read_timeout 60s;
  }

  location /health {
    proxy_pass http://127.0.0.1:8080/health;
  }
}
```

---

## skills/codebuddy\_deploy\_skill/EXAMPLES.md

### 1) ä¸€é”®å‘å¸ƒè„šæœ¬

`deploy/release.sh`

```bash
#!/usr/bin/env bash
set -euo pipefail
NOW=$(date +"%Y-%m-%d-%H%M")
APP_DIR=/srv/apps/cms
REL_DIR=$APP_DIR/releases/$NOW

echo "[1/7] ä¸Šä¼ å¹¶è§£å‹åˆ° $REL_DIR"
mkdir -p $REL_DIR
tar -xzf /tmp/cms-build.tgz -C $REL_DIR

echo "[2/7] é“¾æ¥å…±äº«èµ„æº"
ln -sfn $APP_DIR/shared/.env $REL_DIR/.env
mkdir -p $APP_DIR/shared/logs
ln -sfn $APP_DIR/shared/logs $REL_DIR/logs

echo "[3/7] å®‰è£…ä¾èµ–"
cd $REL_DIR && npm ci --omit=dev

echo "[4/7] æ„å»º"
npm run build

echo "[5/7] é¢„çƒ­ä¸å¥åº·æ£€æŸ¥"
pm2 startOrReload $REL_DIR/deploy/pm2.config.cjs
sleep 5
curl -fsS http://127.0.0.1:8080/health || (echo "health failed" && exit 1)

echo "[6/7] åˆ‡æ¢ current"
ln -sfn $REL_DIR $APP_DIR/current

echo "[7/7] å‘å¸ƒåå†’çƒŸ"
npm run test:smoke:post || (echo "smoke failed" && exit 1)

echo "Release OK: $NOW"
```

### 2) å›æ»šè„šæœ¬

`deploy/rollback.sh`

```bash
#!/usr/bin/env bash
set -euo pipefail
APP_DIR=/srv/apps/cms
LAST=$(ls -1 $APP_DIR/releases | sort | tail -2 | head -1)
ln -sfn $APP_DIR/releases/$LAST $APP_DIR/current
pm2 startOrReload $APP_DIR/current/deploy/pm2.config.cjs
echo "Rollback to $LAST done."
```

### 3) å‘å¸ƒåå†’çƒŸï¼ˆè°ƒç”¨ QA è„šæœ¬ï¼‰

`tests/e2e/smoke/post-release.spec.ts`

```ts
import { test, expect } from '@playwright/test';
test('post release smoke', async ({ page }) => {
  await page.goto('http://cms.example.com/health'); // æˆ–è®¿é—®å…³é”®é¡µé¢
  await page.goto('http://cms.example.com/login');
  await expect(page.getByText('ç™»å½•')).toBeVisible();
});
```

### 4) ä»»åŠ¡å¡ï¼ˆDeployï¼‰

```json
{
  "taskId": "CMS-D-002",
  "projectId": "CMS",
  "module": "deploy-scripts",
  "title": "ç¼–å†™ä¸€é”®å‘å¸ƒä¸å›æ»šè„šæœ¬ï¼ˆPM2+Nginxï¼‰",
  "department": "Deploy",
  "phase": "MVP",
  "priority": "P0",
  "estimatedHours": 8,
  "dependencies": ["CMS-Q-001"],
  "description": "æä¾› release.sh/rollback.shï¼ŒPM2 é…ç½®ä¸ Nginx ç«™ç‚¹æ–‡ä»¶ï¼›åŠ å…¥å¥åº·æ£€æŸ¥ä¸å‘å¸ƒåå†’çƒŸã€‚",
  "technicalRequirements": ["PM2 cluster", "Nginx åä»£", "Playwright smoke"],
  "acceptanceCriteria": [
    {"id":"AC1","type":"NonFunctional","statement":"å›æ»š â‰¤ 3 åˆ†é’Ÿï¼Œå‘½ä»¤æ¸…æ™°å¯æ‰§è¡Œ"},
    {"id":"AC2","type":"Functional","statement":"å‘å¸ƒåå†’çƒŸé€šè¿‡"}
  ],
  "deliverables": ["deploy/release.sh", "deploy/rollback.sh", "deploy/pm2.config.cjs", "deploy/nginx.conf", "tests/e2e/smoke/post-release.spec.ts"],
  "needsCoordination": [{"withDept":"QA","topic":"å†’çƒŸè„šæœ¬ä¸æ ¡éªŒ","artifact":"tests/e2e/smoke/post-release.spec.ts"}],
  "aiPromptSuggestion": {"system":"ä½ æ˜¯DevOpså·¥ç¨‹å¸ˆ","user":"ç¼–å†™è„šæœ¬å¹¶éªŒè¯å¥åº·æ£€æŸ¥/å†’çƒŸ"},
  "reviewPolicy": {"requiresReviewer": true, "gates": ["å¯é æ€§","å¯è§‚æµ‹æ€§"]},
  "qaPolicy": {"requiresQA": true, "testDepth": "Smoke"},
  "status": "Ready"
}
```

### 5) é”™è¯¯ç¤ºä¾‹

* æ— å›æ»šè„šæœ¬ï¼›
* ç›´æ¥ `pm2 restart` è€Œä¸æ£€æŸ¥å¥åº·ï¼›
* ä»¥ root å¯åŠ¨ Nodeï¼›
* `.env` æ··åœ¨å‘å¸ƒåŒ…é‡Œï¼Œæ³„éœ²é£é™©ã€‚

---

## skills/codebuddy\_deploy\_skill/FLOW\.md

```mermaid
flowchart TD
  A[å‡†å¤‡å‘å¸ƒ] --> B[ç”Ÿæˆæ„å»ºäº§ç‰© + æ ¡éªŒ]
  B --> C[ä¸Šä¼ åˆ°æœåŠ¡å™¨]
  C --> D[è§£å‹+ä¾èµ–å®‰è£…+æ„å»º]
  D --> E[å¯åŠ¨åˆ°æ–°ç›®å½•+å¥åº·æ£€æŸ¥]
  E --> F{å¥åº·é€šè¿‡?}
  F -- å¦ --> R[å›æ»š/ä¸­æ­¢]
  F -- æ˜¯ --> G[åˆ‡æ¢ current é“¾æ¥]
  G --> H[æ‰§è¡Œå‘å¸ƒåå†’çƒŸ]
  H --> I{é€šè¿‡?}
  I -- å¦ --> R
  I -- æ˜¯ --> J[è®°å½•å‘å¸ƒä¸ç›‘æ§åŸºçº¿]
```

**è¦ç‚¹**

* äº§ç‰©åŒ…å« commit ä¸ checksumï¼›
* å‘å¸ƒæ—¥å¿—åŒ…å«æ‰§è¡Œè€—æ—¶ä¸å„æ­¥éª¤ç»“æœï¼›
* ç›‘æ§ï¼šCPU/Memã€QPSã€P95ã€é”™è¯¯ç‡ã€ç£ç›˜å ç”¨ï¼›
* æŠ¥è­¦ï¼šå¥åº·æ£€æŸ¥å¤±è´¥ã€é”™è¯¯ç‡æ¿€å¢ã€ç£ç›˜>80%ã€‚

---

## skills/codebuddy\_deploy\_skill/CHECKLIST.md

* [ ] PM2 é…ç½®ï¼ˆcluster=3ï¼‰ä¸æ—¥å¿—è½®è½¬å®Œæˆã€‚
* [ ] Nginx åä»£/å¥åº·æ£€æŸ¥/è¯ä¹¦é…ç½®å®Œæˆã€‚
* [ ] `.env` ä» `shared/` å¼•å…¥ï¼Œ**ä¸æ‰“åŒ…**åˆ° releaseã€‚
* [ ] `release.sh/rollback.sh` å¯æ‰§è¡Œï¼Œâ‰¤ 3 åˆ†é’Ÿå›æ»šã€‚
* [ ] å‘å¸ƒåå†’çƒŸè„šæœ¬é€šè¿‡ã€‚
* [ ] ç‰ˆæœ¬/commit/checksum/å‘å¸ƒæ—¶é—´å·²è®°å½•ã€‚
* [ ] ç£ç›˜ç©ºé—´>20%ï¼Œæ—¥å¿—è½®è½¬å¯ç”¨ã€‚
* [ ] é root è´¦æˆ·è¿è¡Œ Nodeã€‚
* [ ] å¦‚æœæœ‰è¿ç§»ï¼šè¿ç§»è„šæœ¬å·²ç‹¬ç«‹æ‰§è¡Œå¹¶æœ‰å›æ»šè®¡åˆ’ã€‚
* **åä¾‹**ï¼šå¤±è´¥åæ‰¾ä¸åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼›health æœªé€šè¿‡ä»åˆ‡æµï¼›ç¼ºå°‘å†’çƒŸè„šæœ¬ã€‚

---

### ç»“è¯­

ä»¥ä¸Šå³**ç¬¬5ï½8æ‰¹**å…¨éƒ¨ 24 ä»½æ‰‹å†Œï¼ˆSCF Worker / Billing Guard / QA Acceptance / Deployï¼‰ã€‚
å®ƒä»¬ä¸å‰ 1ï½4 æ‰¹å½¢æˆ**é—­ç¯ä½“ç³»**ï¼šPlanner â†’ Backend/Frontend/SCF æ‰§è¡Œ â†’ Reviewer è´¨é‡é—¨ç¦ï¼ˆå«ä¿®å¤å¡ï¼‰ â†’ QA éªŒæ”¶ â†’ Deploy ä¸Šçº¿ â†’ Billing Guard å…¨ç¨‹æˆæœ¬å®ˆæŠ¤ï¼Œå¹¶é€šè¿‡ç»Ÿä¸€çš„ä»»åŠ¡å¡ Schema ä¸äº‹ä»¶æœºåˆ¶å®ç°**å¯åº¦é‡ã€å¯å¤ç”¨ã€å¯è¿½è¸ª**çš„å…¨è‡ªåŠ¨ AI å›¢é˜Ÿåä½œã€‚

å¦‚éœ€æˆ‘æ ¹æ®ä½ çš„ä»“åº“ç»“æ„ç”Ÿæˆè¿™äº›æ–‡ä»¶çš„**å®é™…ç›®å½•æ ‘ä¸å ä½æ–‡ä»¶**ï¼ˆæˆ–è¡¥å……æ›´å¤šä»£ç æ ·ä¾‹ï¼‰ï¼Œå‘Šè¯‰æˆ‘ä½ çš„åå¥½ï¼ˆåŒ…ç®¡ç†å™¨ã€è„šæœ¬å‘½ä»¤å‘½åï¼‰ï¼Œæˆ‘ä¼šç›´æ¥ç»™å‡ºå¯ç²˜è´´çš„ `tree` ä¸æ–‡ä»¶å†…å®¹ã€‚
